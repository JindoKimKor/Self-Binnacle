<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="**Pipeline Role**: Orchestration only (sequence/flow control)">
  <meta name="author" content="Jindo Kim">
  <title>JsJenkins/JenkinsfileDeployment - SRP Violation Analysis | Post-Refactoring Analysis</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
  <link rel="stylesheet" href="../../../css/portfolio-theme.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
  <!-- Mobile hamburger -->
  <button class="nav-toggle" aria-label="Toggle navigation">
    <span></span><span></span><span></span>
  </button>

  <!-- Sidebar overlay (mobile) -->
  <div class="nav-overlay"></div>

  <!-- Sidebar navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="../../../">Post-Refactoring Analysis</a>
    </div>
    <div class="sidebar-content">
      <ul class="nav-tree"><li class="nav-depth-1"><a href="../../../" class="nav-link">Home</a></li><li class="nav-depth-1"><button class="nav-section-btn expanded">Problem Analysis</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../../problem-analysis/problem-analysis-overview/" class="nav-link">Problem Analysis Overview</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/detailed-analysis/" class="nav-link">Detailed Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/architecture-smells-analysis/" class="nav-link">Architecture Smells Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/DRY-violation-analysis/" class="nav-link">DRY Violation Analysis</a></li><li class="nav-depth-2"><button class="nav-section-btn">Pipeline Sequence Diagrams</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/domain-mapping/" class="nav-link">Domain Mapping</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/dlx-ci/" class="nav-link">DLXJenkins CI</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/dlx-cd/" class="nav-link">DLXJenkins CD</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/js-ci/" class="nav-link">JsJenkins CI</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/js-cd/" class="nav-link">JsJenkins CD</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/jenkins-ci/" class="nav-link">PipelineForJenkins CI</a></li></ul></li><li class="nav-depth-2"><button class="nav-section-btn expanded">Per-File Analysis</button><ul class="nav-children"><li class="nav-depth-3"><button class="nav-section-btn">generalHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">jsHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">unityHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn expanded">JsJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link active">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">PipelineForJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li></ul></li></ul></li><li class="nav-depth-1"><button class="nav-section-btn">Problem Solving</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../../problem-solving/solution-overview/" class="nav-link">Solution Overview</a></li><li class="nav-depth-2"><a href="../../../problem-solving/solution-by-layer/" class="nav-link">Solution by Layer</a></li><li class="nav-depth-2"><a href="../../../problem-solving/solution-by-feature/" class="nav-link">Solution by Feature</a></li><li class="nav-depth-2"><a href="../../../problem-solving/logger-system-design-integration/" class="nav-link">Logger System Design and Integration</a></li><li class="nav-depth-2"><a href="../../../problem-solving/domain-driven-analysis/" class="nav-link">Domain-Driven Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-solving/jenkins-cps-serialization-diagram/" class="nav-link">Jenkins CPS Serialization Diagram</a></li><li class="nav-depth-2"><a href="../../../problem-solving/pull-request-documentation/" class="nav-link">Pull Request Documentation</a></li><li class="nav-depth-2"><button class="nav-section-btn">Implementation Phases</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../../problem-solving/phase-0-global-trusted-shared-library-setup/changelog/" class="nav-link">Phase 0 - Global Trusted Shared Library Setup</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-1-shellscript-modularization-and-initialization-stage/changelog/" class="nav-link">Phase 1 - Shell Script Modularization and Initialization Stage</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-2-3-level-logger-system-implementation/changelog/" class="nav-link">Phase 2 - 3-Level Logger System Implementation</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-3-bitbucket-api-and-shell-library-integration/changelog/" class="nav-link">Phase 3 - Bitbucket API and Shell Library Integration</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-4-full-pipeline-refactoring-and-stage-modularization/changelog/" class="nav-link">Phase 4 - Full Pipeline Refactoring and Stage Modularization</a></li></ul></li></ul></li></ul>
    </div>
  </nav>

  <!-- Main content -->
  <main class="content">
    <div class="container">
      <p><a href="../../../problem-analysis/detailed-analysis/">← Overview</a> | <a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/02-software-smells-analysis/">Software Smells →</a></p>
<h1 id="jsjenkinsjenkinsfiledeployment-srp-violation-analysis">JsJenkins/JenkinsfileDeployment - SRP Violation Analysis</h1>
<blockquote>
<p><strong>Pipeline Role</strong>: Orchestration only (sequence/flow control)</p>
<p><strong>SRP Violation</strong>: If inline code exists in Jenkinsfile, it violates orchestration-only principle</p>
</blockquote>
<hr />
<h2 id="1-srp-violation-analysis-criteria">1. SRP Violation Analysis Criteria</h2>
<ul>
<li><strong>Jenkinsfile Role</strong>: Orchestration (pipeline sequence/flow control)</li>
<li><strong>SRP Violation Condition</strong>: If actual logic exists in Jenkinsfile (not Helper calls)</li>
<li><strong>Analysis Method</strong>: Stage-by-Stage inline code detection</li>
</ul>
<hr />
<h2 id="2-inline-code-analysis-by-stage">2. Inline Code Analysis by Stage</h2>
<table>
<thead>
<tr>
<th>Stage</th>
<th>Inline Code Type</th>
<th style="text-align: center;">Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>Delete Merged Branch</td>
<td>mainBranches check + <code>find</code>/<code>rm</code> commands + folder name extraction</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td>Prepare WORKSPACE</td>
<td>Git commands (4x)</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td>Install Dependencies</td>
<td>Node/npm version checks (3x) + <code>cd</code></td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td>Linting</td>
<td>File System (<code>mkdir</code>)</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td>Unit Testing</td>
<td><code>cd</code> command</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td>Static Analysis</td>
<td>SonarQube scanner config + Quality Gate logic</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td>Check Build and Deploy Condition</td>
<td>Docker info + az login (2x)</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td>Server Build and Deploy</td>
<td>az acr + docker build/push + az containerapp + docker rmi</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td>Client Build and Deploy</td>
<td>Same pattern (duplicated)</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-inline-code-details-by-stage">3. Inline Code Details by Stage</h2>
<details>
<summary><code>Delete Merged Branch</code> stage (4 inline codes)</summary>
<pre><code class="language-groovy">script {
    if (!mainBranches.contains(DESTINATION_BRANCH)) {  // Inline 1: mainBranches check
        env.FAILURE_REASON = 'Not merging to the main branch. Exiting the pipeline...'
        currentBuild.result = 'ABORTED'
        error(env.FAILURE_REASON)
    }

    def branch_path = sh(script: &quot;/usr/bin/find ../ -type d -name \&quot;${PR_BRANCH}\&quot;&quot;, returnStdout: true)  // Inline 2: find command
    branch_path = branch_path.trim()
    if (!branch_path.isEmpty()) {
        sh &quot;rm -r -f \&quot;${branch_path}\&quot;&quot;  // Inline 3: rm command
        sh &quot;rm -r -f \&quot;${branch_path}@tmp\&quot;&quot;
    }

    env.FOLDER_NAME = &quot;${JOB_NAME}&quot;.split('/').first()  // Inline 4: folder name extraction
}
</code></pre>
</details>
<details>
<summary><code>Prepare WORKSPACE</code> stage (4 inline codes)</summary>
<pre><code class="language-groovy">script {
    if (!fileExists(&quot;${PROJECT_DIR}&quot;)) {
        sh &quot;git clone ${REPO_SSH} \&quot;${PROJECT_DIR}\&quot;&quot;  // Inline 1: Git clone
    }
}

dir(&quot;${PROJECT_DIR}&quot;) {
    sh &quot;git checkout ${DESTINATION_BRANCH}&quot;  // Inline 2: Git checkout
    sh 'git reset --hard HEAD'  // Inline 3: Git reset
    sh 'git pull'  // Inline 4: Git pull
}
</code></pre>
</details>
<details>
<summary><code>Install Dependencies</code> stage (4 inline codes)</summary>
<pre><code class="language-groovy">script {
    sh 'node -v'  // Inline 1: Node version check
    sh 'npm -v'  // Inline 2: npm version check
    sh 'npm config ls'  // Inline 3: npm config check

    jsUtil.installNpmInTestingDirs(env.TEST_DIRECTORIES)

    sh(script: 'cd &quot;' + env.WORKSPACE + '&quot;')  // Inline 4: cd command
}
</code></pre>
</details>
<details>
<summary><code>Static Analysis</code> stage (2 inline codes)</summary>
<pre><code class="language-groovy">// SonarQube scanner config (Inline 1)
script {
    String scannerHome = tool SONARQUBE_SCANNER
    withSonarQubeEnv(SONARQUBE_SERVER) {
        String sonarCommand = &quot;\&quot;${scannerHome}/bin/sonar-scanner\&quot; &quot; +
                            &quot;\&quot;-Dsonar.projectKey=${env.SONAR_PROJECT_KEY}\&quot; &quot; +
                            '\&quot;-Dsonar.host.url=http://localhost:9000/sonarqube\&quot; ' +
                            '\&quot;-Dsonar.sources=.\&quot; ' +
                            '\&quot;-Dsonar.python.version=3.10\&quot;'
        sh sonarCommand
    }
}

// Quality Gate check logic (Inline 2)
script {
    Map status = generalUtil.checkQualityGateStatus(SONAR_PROJECT_KEY, env.SONAR_QUBE_AUTH_TOKEN)
    if ((status.entireCodeStatus != 'OK') || (status.newCodeStatus != 'OK')) {
        error('Quality gate failed!')
    }
}
</code></pre>
</details>
<details>
<summary><code>Check Build and Deploy Condition</code> stage (3 inline codes)</summary>
<pre><code class="language-groovy">script {
    int isDockerRunning = sh(script: 'sudo docker info &gt; /dev/null 2&gt;&amp;1', returnStatus: true)  // Inline 1: Docker info
    if (isDockerRunning != 0) {
        error('Docker is not available. Please start Docker and try again.')
    }
}

script {
    sh 'sudo az login --identity --username 0ca5eb7b-0dfc-4449-8c1e-c9dae95c7a97'  // Inline 2: az login

    try {
        sh 'sudo az acr login --name webbuilds'  // Inline 3: az acr login
    } catch (Exception e) {
        error('Pipeline terminated: Azure Container Registry login failed.')
    }
}
</code></pre>
</details>
<details>
<summary><code>Server Build and Deploy</code> stage (5 inline codes) - Most Severe</summary>
<pre><code class="language-groovy">script {
    def server_latest_version = sh(
        script: &quot;&quot;&quot;
            sudo az acr repository show-tags --name webbuilds \\
            --repository ${params.SERVER_CONTAINER_NAME} \\
            --output tsv | grep -v &quot;latest&quot; | sort -V | tail -n 1
        &quot;&quot;&quot;,
        returnStdout: true
    ).trim()  // Inline 1: az acr show-tags

    // Docker build
    sh &quot;&quot;&quot;
        sudo docker build -t \\
        ${env.AZ_CONTAINER_REGISTRY_NAME}/${params.SERVER_CONTAINER_NAME}:${project_server_version} \\
        ${projectDir}/${params.SERVER_SOURCE_FOLDER}/.
    &quot;&quot;&quot;  // Inline 2: docker build

    // Docker push
    sh &quot;&quot;&quot;
        sudo docker push \\
        ${env.AZ_CONTAINER_REGISTRY_NAME}/${params.SERVER_CONTAINER_NAME}:${project_server_version}
    &quot;&quot;&quot;  // Inline 3: docker push

    // Azure Container Apps update
    sh &quot;&quot;&quot;
        sudo az containerapp update \\
        --name ${params.SERVER_CONTAINER_NAME} \\
        --resource-group ${params.AZ_RESOURCE_GROUP} \\
        --image ${env.AZ_CONTAINER_REGISTRY_NAME}/${params.SERVER_CONTAINER_NAME}:${project_server_version}
    &quot;&quot;&quot;  // Inline 4: az containerapp update

    // Docker image cleanup
    sh &quot;sudo docker rmi ${env.AZ_CONTAINER_REGISTRY_NAME}/${params.SERVER_CONTAINER_NAME}:${project_server_version}&quot;  // Inline 5: docker rmi
}
</code></pre>
</details>
<details>
<summary><code>Client Build and Deploy</code> stage (5 inline codes) - Duplicated Pattern</summary>
<pre><code class="language-groovy">// Same 5-step pattern as Server Build and Deploy:
// 1. az acr repository show-tags
// 2. docker build
// 3. docker push
// 4. az containerapp update
// 5. docker rmi

// Only variable names differ: SERVER_CONTAINER_NAME → CLIENT_CONTAINER_NAME
</code></pre>
</details>
<hr />
<h2 id="4-inline-code-summary">4. Inline Code Summary</h2>
<table>
<thead>
<tr>
<th>Type</th>
<th style="text-align: center;">Count</th>
<th>Stages</th>
</tr>
</thead>
<tbody>
<tr>
<td>Git commands (<code>clone</code>, <code>checkout</code>, <code>reset</code>, <code>pull</code>)</td>
<td style="text-align: center;">4</td>
<td>Prepare WORKSPACE</td>
</tr>
<tr>
<td>File System (<code>find</code>, <code>rm</code>, <code>mkdir</code>, <code>cd</code>)</td>
<td style="text-align: center;">6</td>
<td>Delete Merged Branch, Linting, Install, Unit Testing</td>
</tr>
<tr>
<td>Node/npm version checks</td>
<td style="text-align: center;">3</td>
<td>Install Dependencies</td>
</tr>
<tr>
<td>Docker commands (<code>info</code>, <code>build</code>, <code>push</code>, <code>rmi</code>)</td>
<td style="text-align: center;">7</td>
<td>Check Condition, Server Deploy, Client Deploy</td>
</tr>
<tr>
<td>Azure commands (<code>az login</code>, <code>az acr</code>, <code>az containerapp</code>)</td>
<td style="text-align: center;">6</td>
<td>Check Condition, Server Deploy, Client Deploy</td>
</tr>
<tr>
<td>SonarQube config + Quality Gate</td>
<td style="text-align: center;">2</td>
<td>Static Analysis</td>
</tr>
<tr>
<td>Branch logic</td>
<td style="text-align: center;">1</td>
<td>Delete Merged Branch</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="conclusion">Conclusion</h2>
<blockquote>
<p><strong>SRP Violation</strong>:
- <strong>Total 29 inline codes</strong> across 9 stages (DLX CI: 16, DLX CD: 23, JS CI: 9)
- <strong>Server/Client Build and Deploy</strong>: Most severe (5 inline codes each, same pattern duplicated = 75+ lines)
- <strong>Prepare WORKSPACE</strong>: Git commands directly in Jenkinsfile
- <strong>Key difference from JS CI</strong>: Docker/Azure commands inline, Server/Client deploy code duplicated
- <strong>Recommendation</strong>: Extract Docker/Azure commands to Helper functions, abstract Server/Client pattern</p>
</blockquote>
<hr />
<p><a href="../../../problem-analysis/detailed-analysis/">← Overview</a> | <a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/02-software-smells-analysis/">Software Smells →</a></p>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-groovy.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
  
  <script src="../../../js/nav.js"></script>
</body>
</html>