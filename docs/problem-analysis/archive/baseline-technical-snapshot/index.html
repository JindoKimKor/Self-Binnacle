<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="**Note**: This document was analyzed based on commit `54479b2`.">
  <meta name="author" content="Jindo Kim">
  <title>Baseline Technical Snapshot | Post-Refactoring Analysis</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
  <link rel="stylesheet" href="../../../css/portfolio-theme.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
  <!-- Mobile hamburger -->
  <button class="nav-toggle" aria-label="Toggle navigation">
    <span></span><span></span><span></span>
  </button>

  <!-- Sidebar overlay (mobile) -->
  <div class="nav-overlay"></div>

  <!-- Sidebar navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="../../../">Post-Refactoring Analysis</a>
    </div>
    <div class="sidebar-content">
      <ul class="nav-tree"><li class="nav-depth-1"><a href="../../../" class="nav-link">Home</a></li><li class="nav-depth-1"><button class="nav-section-btn">Problem Analysis</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../../problem-analysis/problem-analysis-overview/" class="nav-link">Problem Analysis Overview</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/detailed-analysis/" class="nav-link">Detailed Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/architecture-smells-analysis/" class="nav-link">Architecture Smells Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/DRY-violation-analysis/" class="nav-link">DRY Violation Analysis</a></li><li class="nav-depth-2"><button class="nav-section-btn">Pipeline Sequence Diagrams</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/domain-mapping/" class="nav-link">Domain Mapping</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/dlx-ci/" class="nav-link">DLXJenkins CI</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/dlx-cd/" class="nav-link">DLXJenkins CD</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/js-ci/" class="nav-link">JsJenkins CI</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/js-cd/" class="nav-link">JsJenkins CD</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/jenkins-ci/" class="nav-link">PipelineForJenkins CI</a></li></ul></li><li class="nav-depth-2"><button class="nav-section-btn">Per-File Analysis</button><ul class="nav-children"><li class="nav-depth-3"><button class="nav-section-btn">generalHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">jsHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">unityHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">PipelineForJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li></ul></li></ul></li><li class="nav-depth-1"><button class="nav-section-btn">Problem Solving</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../../problem-solving/solution-overview/" class="nav-link">Solution Overview</a></li><li class="nav-depth-2"><a href="../../../problem-solving/solution-by-layer/" class="nav-link">Solution by Layer</a></li><li class="nav-depth-2"><a href="../../../problem-solving/solution-by-feature/" class="nav-link">Solution by Feature</a></li><li class="nav-depth-2"><a href="../../../problem-solving/logger-system-design-integration/" class="nav-link">Logger System Design and Integration</a></li><li class="nav-depth-2"><a href="../../../problem-solving/domain-driven-analysis/" class="nav-link">Domain-Driven Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-solving/jenkins-cps-serialization-diagram/" class="nav-link">Jenkins CPS Serialization Diagram</a></li><li class="nav-depth-2"><a href="../../../problem-solving/pull-request-documentation/" class="nav-link">Pull Request Documentation</a></li><li class="nav-depth-2"><button class="nav-section-btn">Implementation Phases</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../../problem-solving/phase-0-global-trusted-shared-library-setup/changelog/" class="nav-link">Phase 0 - Global Trusted Shared Library Setup</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-1-shellscript-modularization-and-initialization-stage/changelog/" class="nav-link">Phase 1 - Shell Script Modularization and Initialization Stage</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-2-3-level-logger-system-implementation/changelog/" class="nav-link">Phase 2 - 3-Level Logger System Implementation</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-3-bitbucket-api-and-shell-library-integration/changelog/" class="nav-link">Phase 3 - Bitbucket API and Shell Library Integration</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-4-full-pipeline-refactoring-and-stage-modularization/changelog/" class="nav-link">Phase 4 - Full Pipeline Refactoring and Stage Modularization</a></li></ul></li></ul></li></ul>
    </div>
  </nav>

  <!-- Main content -->
  <main class="content">
    <div class="container">
      <h1 id="baseline-technical-snapshot">Baseline Technical Snapshot</h1>
<blockquote>
<p><strong>Note</strong>: This document was analyzed based on commit <code>54479b2</code>.</p>
<p>Other documents in <code>problem-analysis/</code> use commit <code>74fc356</code> as the baseline.</p>
<p><strong>Difference in analysis direction</strong>:
- <strong>This document</strong>: Focused on code statistics, file structure, technical state
- <strong>problem-analysis/</strong>: Problem analysis based on Software Smells classification system</p>
</blockquote>
<hr />
<p><strong>Commit</strong>: <code>54479b2</code> (2025-02-21) - "emergency fixed"</p>
<p>This document provides a comprehensive analysis of the codebase state before the architectural refactoring.</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#1-code-statistics">Code Statistics</a></li>
<li><a href="#2-file-structure-27-files">File Structure</a></li>
<li><a href="#3-domain-analysis">Domain Analysis</a></li>
<li><a href="#4-architecture-analysis">Architecture Analysis</a></li>
<li><a href="#5-folder-by-folder-analysis">Folder-by-Folder Analysis</a></li>
<li><a href="#6-critical-problems">Critical Problems</a></li>
<li><a href="#7-code-duplication-analysis-detailed">Code Duplication Analysis (Detailed)</a></li>
<li><a href="#8-dependency-graph">Dependency Graph</a></li>
<li><a href="#9-technical-debt-summary">Technical Debt Summary</a></li>
<li><a href="#10-summary-table">Summary Table</a></li>
<li><a href="#11-key-issues-for-refactoring">Key Issues for Refactoring</a></li>
</ol>
<hr />
<h2 id="1-code-statistics">1. Code Statistics</h2>
<h3 id="11-total-lines-by-category">1.1 Total Lines by Category</h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Files</th>
<th>Lines</th>
<th>Percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Jenkinsfiles</strong></td>
<td>5</td>
<td>1,239</td>
<td>33.1%</td>
</tr>
<tr>
<td><strong>Groovy Helpers</strong></td>
<td>3</td>
<td>1,148</td>
<td>30.6%</td>
</tr>
<tr>
<td><strong>Python Scripts</strong></td>
<td>9</td>
<td>749</td>
<td>20.0%</td>
</tr>
<tr>
<td><strong>Bash Scripts</strong></td>
<td>2</td>
<td>330</td>
<td>8.8%</td>
</tr>
<tr>
<td><strong>Tests</strong></td>
<td>2</td>
<td>84</td>
<td>2.2%</td>
</tr>
<tr>
<td><strong>Config/Other</strong></td>
<td>6</td>
<td>195</td>
<td>5.2%</td>
</tr>
<tr>
<td><strong>TOTAL</strong></td>
<td><strong>27</strong></td>
<td><strong>3,745</strong></td>
<td>100%</td>
</tr>
</tbody>
</table>
<h3 id="12-detailed-line-counts">1.2 Detailed Line Counts</h3>
<h4 id="jenkinsfiles-1239-lines">Jenkinsfiles (1,239 lines)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLXJenkins/Jenkinsfile</td>
<td>249</td>
</tr>
<tr>
<td>DLXJenkins/JenkinsfileDeployment</td>
<td>242</td>
</tr>
<tr>
<td>JsJenkins/Jenkinsfile</td>
<td>198</td>
</tr>
<tr>
<td>JsJenkins/JenkinsfileDeployment</td>
<td>372</td>
</tr>
<tr>
<td>PipelineForJenkins/Jenkinsfile</td>
<td>178</td>
</tr>
</tbody>
</table>
<h4 id="groovy-helpers-1148-lines">Groovy Helpers (1,148 lines)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>groovy/generalHelper.groovy</td>
<td>403</td>
</tr>
<tr>
<td>groovy/jsHelper.groovy</td>
<td>408</td>
</tr>
<tr>
<td>groovy/unityHelper.groovy</td>
<td>337</td>
</tr>
</tbody>
</table>
<h4 id="python-scripts-749-lines">Python Scripts (749 lines)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>python/linting_error_report.py</td>
<td>203</td>
</tr>
<tr>
<td>python/create_bitbucket_test_report.py</td>
<td>152</td>
</tr>
<tr>
<td>python/npm_audit.py</td>
<td>137</td>
</tr>
<tr>
<td>python/send_bitbucket_build_status.py</td>
<td>64</td>
</tr>
<tr>
<td>python/create_log_report.py</td>
<td>56</td>
</tr>
<tr>
<td>python/get_bitbucket_commit_hash.py</td>
<td>38</td>
</tr>
<tr>
<td>python/get_unity_version.py</td>
<td>34</td>
</tr>
<tr>
<td>python/get_unity_failure.py</td>
<td>26</td>
</tr>
<tr>
<td>python/log-template/logs.html</td>
<td>39</td>
</tr>
</tbody>
</table>
<h4 id="tests-84-lines">Tests (84 lines)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>tests/JsHelperSpec.groovy</td>
<td>66</td>
</tr>
<tr>
<td>tests/GeneralHelperSpec.groovy</td>
<td>18</td>
</tr>
</tbody>
</table>
<h4 id="other-files-525-lines">Other Files (525 lines)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bash/.editorconfig</td>
<td>264</td>
</tr>
<tr>
<td>Bash/Linting.bash</td>
<td>66</td>
</tr>
<tr>
<td>PipelineForJenkins/.groovylintrc.groovy.json</td>
<td>43</td>
</tr>
<tr>
<td>PipelineForJenkins/.groovylintrc.jenkins.json</td>
<td>19</td>
</tr>
<tr>
<td>.gitignore</td>
<td>51</td>
</tr>
<tr>
<td>build.gradle</td>
<td>42</td>
</tr>
<tr>
<td>Builder.cs</td>
<td>36</td>
</tr>
<tr>
<td>logErrors.txt</td>
<td>4</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-file-structure-27-files">2. File Structure (27 files)</h2>
<pre><code>54479b2/
├── .gitignore
├── build.gradle                          # Gradle build configuration
├── Builder.cs                            # Unity WebGL build script
├── logErrors.txt                         # Error log file
│
├── DLXJenkins/                           # Unity Project Pipeline
│   ├── Jenkinsfile                       # PR Pipeline (249 lines)
│   └── JenkinsfileDeployment             # Deployment Pipeline (242 lines)
│
├── JsJenkins/                            # JavaScript Project Pipeline
│   ├── Jenkinsfile                       # PR Pipeline (198 lines)
│   └── JenkinsfileDeployment             # Deployment Pipeline (372 lines)
│
├── PipelineForJenkins/                   # Jenkins Self Pipeline
│   ├── Jenkinsfile                       # (178 lines)
│   ├── .groovylintrc.groovy.json         # Groovy lint config
│   └── .groovylintrc.jenkins.json        # Jenkins lint config
│
├── groovy/                               # Helper Scripts
│   ├── generalHelper.groovy              # Common utilities (403 lines)
│   ├── unityHelper.groovy                # Unity-specific (337 lines)
│   └── jsHelper.groovy                   # JavaScript-specific (408 lines)
│
├── Bash/
│   ├── .editorconfig                     # Editor configuration
│   └── Linting.bash                      # dotnet format linting script
│
├── python/                               # Python Scripts
│   ├── send_bitbucket_build_status.py    # Send build status
│   ├── create_bitbucket_test_report.py   # Send test report
│   ├── create_log_report.py              # Generate log report
│   ├── get_bitbucket_commit_hash.py      # Get commit hash
│   ├── get_unity_failure.py              # Analyze Unity failures
│   ├── get_unity_version.py              # Get Unity version
│   ├── linting_error_report.py           # Linting error report
│   ├── npm_audit.py                      # npm security audit
│   └── log-template/logs.html            # Log HTML template
│
└── tests/                                # Tests
    ├── GeneralHelperSpec.groovy          # generalHelper tests
    └── JsHelperSpec.groovy               # jsHelper tests
</code></pre>
<hr />
<h2 id="3-domain-analysis">3. Domain Analysis</h2>
<h3 id="31-project-types">3.1 Project Types</h3>
<table>
<thead>
<tr>
<th>Domain</th>
<th>Pipeline Files</th>
<th>Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Unity Project</strong></td>
<td>DLXJenkins/Jenkinsfile, JenkinsfileDeployment</td>
<td>unityHelper.groovy</td>
</tr>
<tr>
<td><strong>JavaScript Project</strong></td>
<td>JsJenkins/Jenkinsfile, JenkinsfileDeployment</td>
<td>jsHelper.groovy</td>
</tr>
<tr>
<td><strong>Jenkins Pipeline Project</strong></td>
<td>PipelineForJenkins/Jenkinsfile</td>
<td>generalHelper.groovy</td>
</tr>
</tbody>
</table>
<h3 id="32-pipeline-types">3.2 Pipeline Types</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Trigger</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PR Pipeline</strong></td>
<td><code>PR_STATE = 'OPEN'</code></td>
<td>Pull Request validation (tests, linting, static analysis)</td>
</tr>
<tr>
<td><strong>Deployment Pipeline</strong></td>
<td><code>PR_STATE = 'MERGED'</code></td>
<td>Deployment (branch cleanup, build, server deployment)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4-architecture-analysis">4. Architecture Analysis</h2>
<h3 id="41-current-architecture-flatmonolithic">4.1 Current Architecture: Flat/Monolithic</h3>
<div class="mermaid">
flowchart TB
    subgraph Jenkinsfile["Jenkinsfile Layer"]
        direction TB
        J1["Pipeline declaration"]
        J2["Stage definitions"]
        J3["Business logic (inline)"]
        J4["Error handling (inline)"]
        J5["Logging (inline echo)"]
    end

    subgraph Helper["groovy/*Helper.groovy Layer"]
        direction TB
        H1["Git operations (functions)"]
        H2["API calls (Python wrapper)"]
        H3["Utility functions"]
        H4["Each file 400+ lines (everything mixed)"]
    end

    subgraph Python["python/*.py Layer"]
        direction TB
        P1["Bitbucket API calls"]
        P2["XML parsing"]
        P3["Report generation"]
    end

    Jenkinsfile -->|"load()"| Helper
    Helper -->|"sh(python...)"| Python
</div>

<h3 id="42-layer-analysis">4.2 Layer Analysis</h3>
<p><strong>Only 2 effective layers exist:</strong></p>
<ol>
<li><strong>Jenkinsfile Layer</strong>: Pipeline definition + business logic mixed</li>
<li><strong>Helper Layer</strong>: groovy/<em>.groovy + python/</em>.py (Flat structure)</li>
</ol>
<p><strong>Inter-layer dependencies:</strong></p>
<div class="mermaid">
flowchart LR
    A[Jenkinsfile] -->|"load()"| B[groovy/*Helper.groovy]
    B -->|"sh(python)"| C[python/*.py]
</div>

<hr />
<h2 id="5-folder-by-folder-analysis">5. Folder-by-Folder Analysis</h2>
<h3 id="51-dlxjenkins-unity-pipeline">5.1 DLXJenkins/ (Unity Pipeline)</h3>
<h4 id="jenkinsfile-249-lines">Jenkinsfile (249 lines)</h4>
<pre><code class="language-groovy">// Problem 1: All logic inline
stage('Prepare WORKSPACE') {
    steps {
        dir (&quot;${PROJECT_DIR}&quot;) {
            script {
                sh 'env'
                try {
                    generalUtil = load(&quot;${env.WORKSPACE}/groovy/generalHelper.groovy&quot;)
                    unityUtil = load(&quot;${env.WORKSPACE}/groovy/unityHelper.groovy&quot;)
                } catch (Exception e) {
                    error &quot;Failed to load Groovy scripts: ${e.message}&quot;
                }
                // ... 30+ lines of logic
            }
        }
    }
}

// Problem 2: Duplicated patterns repeated in every stage
stage('Linting') {
    steps {
        dir(&quot;${REPORT_DIR}&quot;) {
            sh 'mkdir -p linting_results'
        }
        script {
            sh &quot;cp -f '${env.WORKSPACE}/Bash/.editorconfig' '${PROJECT_DIR}'&quot;
            def exitCode = sh script: &quot;sh '${env.WORKSPACE}/Bash/Linting.bash'...&quot;, returnStatus: true
            // ... 20+ lines of error handling
        }
    }
}
</code></pre>
<p><strong>Problems:</strong>
- Stage logic written inline in Jenkinsfile
- Same patterns duplicated in JenkinsfileDeployment
- Structure not amenable to testing</p>
<h4 id="jenkinsfiledeployment-242-lines">JenkinsfileDeployment (242 lines)</h4>
<ul>
<li>70%+ code duplication with Jenkinsfile</li>
<li>Only deployment-specific logic added</li>
</ul>
<hr />
<h3 id="52-jsjenkins-javascript-pipeline">5.2 JsJenkins/ (JavaScript Pipeline)</h3>
<h4 id="characteristics">Characteristics</h4>
<ul>
<li>Same structure as DLXJenkins but uses jsHelper</li>
<li>Includes Azure Container Registry deployment logic</li>
<li>Includes SonarQube static analysis</li>
</ul>
<h4 id="problems">Problems</h4>
<pre><code class="language-groovy">// Almost identical code repeated from DLXJenkins
stage('Prepare WORKSPACE') {
    steps {
        dir(&quot;${PROJECT_DIR}&quot;) {
            script {
                sh 'env'
                generalUtil = load(&quot;${env.WORKSPACE}/groovy/generalHelper.groovy&quot;)
                jsUtil = load(&quot;${env.WORKSPACE}/groovy/jsHelper.groovy&quot;)
                // ... same pattern
            }
        }
    }
}
</code></pre>
<hr />
<h3 id="53-groovy-helper-scripts">5.3 groovy/ (Helper Scripts)</h3>
<h4 id="generalhelpergroovy-403-lines">generalHelper.groovy (403 lines)</h4>
<p><strong>Functions included (mixed):</strong>
1. <strong>Git operations</strong>: cloneOrUpdateRepo, checkoutBranch, mergeBranchIfNeeded, isBranchUpToDateWithRemote
2. <strong>Environment setup</strong>: initializeEnvironment, parseTicketNumber
3. <strong>API calls</strong>: sendBuildStatus (Python wrapper)
4. <strong>Server deployment</strong>: publishTestResultsHtmlToWebServer, cleanMergedBranchReportsFromWebServer
5. <strong>File cleanup</strong>: cleanUpPRBranch, closeLogfiles</p>
<p><strong>Problems:</strong></p>
<pre><code class="language-groovy">// Problem 1: All functionality mixed in one file
def cloneOrUpdateRepo(...) {
    // Git logic
}
def sendBuildStatus(...) {
    // Python script call
    sh &quot;python '${workspace}/python/send_bitbucket_build_status.py'...&quot;
}
def publishTestResultsHtmlToWebServer(...) {
    // SSH/SCP commands
}

// Problem 2: Duplicated shell commands
sh 'git reset --hard'
sh 'git clean -fd'
sh &quot;git checkout ${targetBranch}&quot;
// Repeated in multiple functions

// Problem 3: Inconsistent error handling
catch (Exception e) {
    echo &quot;An error occurred: ${e.getMessage()}&quot;
    error('Merge process failed.')
}
// vs
catch (Exception e) {
    error(&quot;Failed to execute: ${e.message}&quot;)
}
</code></pre>
<h4 id="unityhelpergroovy-337-lines">unityHelper.groovy (337 lines)</h4>
<p><strong>Functions included:</strong>
- Unity Batch Mode execution
- Test report generation
- Code Coverage configuration</p>
<p><strong>Problems:</strong></p>
<pre><code class="language-groovy">// Problem: Giant functions (100+ lines)
int runUnityBatchMode(String unityExecutable, String projectDirectory, String reportDirectory, String stageName) {
    // Closure definitions
    Closure setLogFilePathAndUrl = { ... }
    Closure&lt;String&gt; getTestRunArgs = { ... }
    Closure&lt;String&gt; getAdditionalArgs = { ... }

    // All stages handled in one function
    if (['EditMode', 'PlayMode'].contains(stageName)) { ... }
    else if (stageName == 'Coverage') { ... }
    else if (['Webgl', 'Rider'].contains(stageName)) { ... }
    // ... 100+ lines
}
</code></pre>
<h4 id="jshelpergroovy-408-lines">jsHelper.groovy (408 lines)</h4>
<p><strong>Functions included:</strong>
- npm command execution
- SonarQube integration
- Azure Container deployment</p>
<p><strong>Problems:</strong>
- Same issues as generalHelper.groovy
- Duplicated OS branching logic (isUnix() checks)</p>
<hr />
<h3 id="54-python-api-scripts">5.4 python/ (API Scripts)</h3>
<h4 id="role">Role</h4>
<p>Handles HTTP API calls that are difficult to do directly in Groovy</p>
<h4 id="file-list">File List</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>send_bitbucket_build_status.py</td>
<td>Send build status to Bitbucket</td>
</tr>
<tr>
<td>create_bitbucket_test_report.py</td>
<td>Send test report</td>
</tr>
<tr>
<td>get_bitbucket_commit_hash.py</td>
<td>Get commit hash</td>
</tr>
<tr>
<td>linting_error_report.py</td>
<td>Linting error report</td>
</tr>
<tr>
<td>npm_audit.py</td>
<td>npm security audit</td>
</tr>
<tr>
<td>get_unity_failure.py</td>
<td>Analyze Unity failures</td>
</tr>
<tr>
<td>get_unity_version.py</td>
<td>Get Unity version</td>
</tr>
</tbody>
</table>
<p><strong>Problems:</strong></p>
<pre><code class="language-python"># Problem 1: Groovy calling Python → complex dependency
def sendBuildStatus(workspace, state, commitHash, deployment = false, javascript = false) {
    def pythonCommand = &quot;python '${workspace}/python/send_bitbucket_build_status.py' '${commitHash}' '${state}'&quot;
    sh(script: pythonCommand, returnStatus: true)
}

# Problem 2: Debugging difficult on errors
# - Only exit code returned
# - Detailed error messages lost
</code></pre>
<hr />
<h3 id="55-bash-shell-scripts">5.5 Bash/ (Shell Scripts)</h3>
<h4 id="lintingbash">Linting.bash</h4>
<pre><code class="language-bash"># Script for C# project linting
dotnet format &quot;$SOLUTION_FILE&quot; --verify-no-changes
</code></pre>
<p><strong>Problems:</strong>
- Called directly from Jenkinsfile → difficult to test
- Error code interpretation done in Jenkinsfile</p>
<hr />
<h3 id="56-tests-test-files">5.6 tests/ (Test Files)</h3>
<pre><code class="language-groovy">// GeneralHelperSpec.groovy
class GeneralHelperSpec extends Specification {
    def &quot;parseTicketNumber should extract ticket numbers&quot;() {
        // Only one function tested
    }
}
</code></pre>
<p><strong>Problems:</strong>
- Extremely low test coverage (only parseTicketNumber function)
- Most functions depend on Jenkins environment, cannot be tested</p>
<hr />
<h2 id="6-critical-problems">6. Critical Problems</h2>
<h3 id="61-impact-of-file-changes">6.1 Impact of File Changes</h3>
<h4 id="when-generalhelpergroovy-is-modified">When generalHelper.groovy is modified:</h4>
<div class="mermaid">
flowchart TB
    GH[generalHelper.groovy]
    GH --> D1[DLXJenkins/Jenkinsfile]
    GH --> D2[DLXJenkins/JenkinsfileDeployment]
    GH --> J1[JsJenkins/Jenkinsfile]
    GH --> J2[JsJenkins/JenkinsfileDeployment]
    GH --> P1[PipelineForJenkins/Jenkinsfile]
</div>

<p><strong>→ All 5 pipelines affected!</strong>
<strong>→ Risk of system-wide failure when deployed without testing</strong></p>
<h4 id="when-pythonsend_bitbucket_build_statuspy-is-modified">When python/send_bitbucket_build_status.py is modified:</h4>
<div class="mermaid">
flowchart TB
    PY[send_bitbucket_build_status.py]
    PY --> GH[generalHelper.sendBuildStatus]
    GH --> D1[DLXJenkins/Jenkinsfile<br/>post success/failure]
    GH --> D2[DLXJenkins/JenkinsfileDeployment<br/>post success/failure]
    GH --> J1[JsJenkins/Jenkinsfile<br/>post success/failure]
    GH --> J2[JsJenkins/JenkinsfileDeployment<br/>post success/failure]
    GH --> P1[PipelineForJenkins/Jenkinsfile<br/>post success/failure]
</div>

<p><strong>→ Affects Bitbucket status updates for all pipelines!</strong></p>
<h3 id="62-code-duplication-overview">6.2 Code Duplication Overview</h3>
<pre><code class="language-groovy">// Patterns repeated across 5 Jenkinsfiles

// Pattern 1: Helper loading (~10 lines × 5)
generalUtil = load(&quot;${env.WORKSPACE}/groovy/generalHelper.groovy&quot;)

// Pattern 2: Branch check (~15 lines × 5)
if (generalUtil.isBranchUpToDateWithRemote(PR_BRANCH)...) {
    currentBuild.result = 'ABORTED'
    error('Branch is up to date...')
}

// Pattern 3: Post actions (~20 lines × 5)
post {
    success { generalUtil.sendBuildStatus(..., 'SUCCESSFUL'...) }
    failure { generalUtil.sendBuildStatus(..., 'FAILED'...) }
    aborted { generalUtil.sendBuildStatus(..., 'STOPPED'...) }
}
</code></pre>
<h3 id="63-testability-issues">6.3 Testability Issues</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Testable?</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jenkinsfile</td>
<td>No</td>
<td>Requires Jenkins environment</td>
</tr>
<tr>
<td>generalHelper.groovy</td>
<td>Partial (1 function only)</td>
<td>Depends on Jenkins APIs (sh, withCredentials, etc.)</td>
</tr>
<tr>
<td>unityHelper.groovy</td>
<td>No</td>
<td>Requires Jenkins + Unity environment</td>
</tr>
<tr>
<td>jsHelper.groovy</td>
<td>No</td>
<td>Requires Jenkins + Node.js environment</td>
</tr>
<tr>
<td>python/*.py</td>
<td>Partial</td>
<td>Requires environment variables + API tokens</td>
</tr>
</tbody>
</table>
<h3 id="64-logging-problems">6.4 Logging Problems</h3>
<pre><code class="language-groovy">// Inconsistent echo usage
echo 'Identifying Unity version...'
echo &quot;Parameters for bash: ${env.WORKSPACE}/Linting.bash...&quot;
echo &quot;After bash call, exit code: ${exitCode}&quot;
echo 'Error linting calling report'

// Problems:
// 1. No Stage/Step distinction
// 2. Inconsistent format
// 3. Difficult to identify error location
</code></pre>
<h3 id="65-inconsistent-error-handling">6.5 Inconsistent Error Handling</h3>
<pre><code class="language-groovy">// Method 1: catch + echo + error
catch (Exception e) {
    echo &quot;An error occurred: ${e.getMessage()}&quot;
    error('Process failed.')
}

// Method 2: catch + error directly
catch (Exception e) {
    error &quot;Failed: ${e.message}&quot;
}

// Method 3: catchError
catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
    error(&quot;Failed with exit code: ${exitCode}&quot;)
}

// Problems:
// - Stack trace lost
// - Difficult to trace where error occurred
</code></pre>
<hr />
<h2 id="7-code-duplication-analysis-detailed">7. Code Duplication Analysis (Detailed)</h2>
<p>This section provides a comprehensive analysis of duplicated code patterns found across the codebase in commit 54479b2.</p>
<h3 id="duplication-definition">Duplication Definition</h3>
<p><strong>What IS counted as duplication:</strong>
- Structural patterns appearing in multiple files with similar/identical code
- Boilerplate code that could be extracted to shared modules
- Copy-paste patterns where same logic exists in different locations</p>
<p><strong>What is NOT counted:</strong>
- Project-specific configuration values (different env vars per project)
- Intentional variations (OPEN vs MERGED triggers)
- Single occurrences of any pattern</p>
<h3 id="71-duplication-summary">7.1 Duplication Summary</h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Duplicated Lines</th>
<th>Base Lines</th>
<th>Percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jenkinsfile Patterns</td>
<td>463</td>
<td>1,239</td>
<td>37.4%</td>
</tr>
<tr>
<td>Groovy Helper Patterns</td>
<td>106</td>
<td>1,148</td>
<td>9.2%</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>569</strong></td>
<td><strong>3,136</strong>*</td>
<td><strong>18.1%</strong></td>
</tr>
</tbody>
</table>
<p><em>*Base = Jenkinsfiles (1,239) + Groovy Helpers (1,148) + Python (749), excluding Tests (84) and Config (525)</em></p>
<h3 id="72-jenkinsfile-duplication-patterns">7.2 Jenkinsfile Duplication Patterns</h3>
<h4 id="pattern-1-parameters-block-47-lines-total">Pattern 1: Parameters Block (47 lines total)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLXJenkins/Jenkinsfile</td>
<td>10</td>
</tr>
<tr>
<td>DLXJenkins/JenkinsfileDeployment</td>
<td>9</td>
</tr>
<tr>
<td>JsJenkins/Jenkinsfile</td>
<td>10</td>
</tr>
<tr>
<td>JsJenkins/JenkinsfileDeployment</td>
<td>8</td>
</tr>
<tr>
<td>PipelineForJenkins/Jenkinsfile</td>
<td>10</td>
</tr>
</tbody>
</table>
<pre><code class="language-groovy">parameters {
    string(name: 'PR_BRANCH', defaultValue: '', description: '')
    string(name: 'PR_DESTINATION_BRANCH', defaultValue: '', description: '')
    string(name: 'PR_REPO_HTML', defaultValue: '', description: '')
    string(name: 'PR_REPO_NAME', defaultValue: '', description: '')
    string(name: 'PR_COMMIT', defaultValue: '', description: '')
    string(name: 'PR_PROJECT', defaultValue: '', description: '')
    string(name: 'PR_STATE', defaultValue: '', description: '')
    string(name: 'TEST_RUN', defaultValue: '', description: '...')
}
</code></pre>
<h4 id="pattern-2-triggers-block-83-lines-total">Pattern 2: Triggers Block (83 lines total)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLXJenkins/Jenkinsfile</td>
<td>17</td>
</tr>
<tr>
<td>DLXJenkins/JenkinsfileDeployment</td>
<td>17</td>
</tr>
<tr>
<td>JsJenkins/Jenkinsfile</td>
<td>17</td>
</tr>
<tr>
<td>JsJenkins/JenkinsfileDeployment</td>
<td>16</td>
</tr>
<tr>
<td>PipelineForJenkins/Jenkinsfile</td>
<td>16</td>
</tr>
</tbody>
</table>
<pre><code class="language-groovy">triggers {
    GenericTrigger(
        genericVariables: [
            [key: 'PR_BRANCH', value: '$.pullrequest.source.branch.name'],
            [key: 'PR_DESTINATION_BRANCH', value: '$.pullrequest.destination.branch.name'],
            [key: 'PR_REPO_HTML', value: '$.repository.links.self.href'],
            [key: 'PR_REPO_NAME', value: '$.repository.name'],
            [key: 'PR_COMMIT', value: '$.pullrequest.source.commit.hash'],
            [key: 'PR_PROJECT', value: '$.repository.full_name'],
            [key: 'PR_STATE', value: '$.pullrequest.state']
        ],
        tokenCredentialId: 'trigger-token',
        regexpFilterText: '$PR_STATE',
        regexpFilterExpression: 'OPEN'  // or 'MERGED' for deployment
    )
}
</code></pre>
<h4 id="pattern-3-environment-block-63-lines-total">Pattern 3: Environment Block (63 lines total)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLXJenkins/Jenkinsfile</td>
<td>11</td>
</tr>
<tr>
<td>DLXJenkins/JenkinsfileDeployment</td>
<td>10</td>
</tr>
<tr>
<td>JsJenkins/Jenkinsfile</td>
<td>16</td>
</tr>
<tr>
<td>JsJenkins/JenkinsfileDeployment</td>
<td>14</td>
</tr>
<tr>
<td>PipelineForJenkins/Jenkinsfile</td>
<td>12</td>
</tr>
</tbody>
</table>
<pre><code class="language-groovy">environment {
    CI_PIPELINE = 'true'
    PROJECT_TYPE = 'Unity_Project'
    PROJECT_DIR = &quot;${env.WORKSPACE}/${PROJECT_TYPE}&quot;
    REPORT_DIR = &quot;${env.WORKSPACE}/PRJob/${PR_BRANCH}&quot;
    JOB_REPO = &quot;${PR_REPO_HTML}&quot;
    BITBUCKET_ACCESS_TOKEN = credentials('bitbucket-access-token')
    REPO_SSH = &quot;git@bitbucket.org:${PR_PROJECT}.git&quot;
    DESTINATION_BRANCH = &quot;${PR_DESTINATION_BRANCH}&quot;
}
</code></pre>
<h4 id="pattern-4-post-actions-block-119-lines-total">Pattern 4: Post Actions Block (119 lines total)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLXJenkins/Jenkinsfile</td>
<td>24</td>
</tr>
<tr>
<td>DLXJenkins/JenkinsfileDeployment</td>
<td>24</td>
</tr>
<tr>
<td>JsJenkins/Jenkinsfile</td>
<td>23</td>
</tr>
<tr>
<td>JsJenkins/JenkinsfileDeployment</td>
<td>23</td>
</tr>
<tr>
<td>PipelineForJenkins/Jenkinsfile</td>
<td>25</td>
</tr>
</tbody>
</table>
<pre><code class="language-groovy">post {
    always {
        script {
            echo 'Returning to the main branch...'
            generalUtil.checkoutBranch(PROJECT_DIR, DESTINATION_BRANCH)
        }
    }
    success {
        script {
            generalUtil.sendBuildStatus(env.WORKSPACE, 'SUCCESSFUL', env.COMMIT_HASH)
        }
    }
    failure {
        script {
            generalUtil.sendBuildStatus(env.WORKSPACE, 'FAILED', env.COMMIT_HASH)
        }
    }
    aborted {
        script {
            generalUtil.sendBuildStatus(env.WORKSPACE, 'STOPPED', env.COMMIT_HASH)
        }
    }
}
</code></pre>
<h4 id="pattern-5-prepare-workspace-stage-151-lines-total">Pattern 5: Prepare WORKSPACE Stage (151 lines total)</h4>
<p>Each Jenkinsfile has a similar 'Prepare WORKSPACE' stage that includes helper loading, branch checks, environment initialization, and repository setup:</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLXJenkins/Jenkinsfile</td>
<td>35</td>
</tr>
<tr>
<td>DLXJenkins/JenkinsfileDeployment</td>
<td>28</td>
</tr>
<tr>
<td>JsJenkins/Jenkinsfile</td>
<td>33</td>
</tr>
<tr>
<td>JsJenkins/JenkinsfileDeployment</td>
<td>30</td>
</tr>
<tr>
<td>PipelineForJenkins/Jenkinsfile</td>
<td>25</td>
</tr>
</tbody>
</table>
<pre><code class="language-groovy">stage('Prepare WORKSPACE') {
    steps {
        dir(&quot;${PROJECT_DIR}&quot;) {
            script {
                sh 'env'
                try {
                    generalUtil = load(&quot;${env.WORKSPACE}/groovy/generalHelper.groovy&quot;)
                    unityUtil = load(&quot;${env.WORKSPACE}/groovy/unityHelper.groovy&quot;)
                } catch (Exception e) {
                    error &quot;Failed to load Groovy scripts: ${e.message}&quot;
                }

                if (generalUtil.isBranchUpToDateWithRemote(PR_BRANCH) &amp;&amp; !TEST_RUN.equals('Y')) {
                    echo 'Local branch commit is up to date with remote branch, no changes. Aborting pipeline.'
                    currentBuild.result = 'ABORTED'
                    error('Branch is up to date, no changes.')
                }

                env.COMMIT_HASH = generalUtil.getFullCommitHash(env.WORKSPACE, PR_COMMIT)
                generalUtil.initializeEnvironment(env.WORKSPACE, env.COMMIT_HASH, PR_BRANCH)
                generalUtil.cloneOrUpdateRepo(PROJECT_TYPE, env.WORKSPACE, PROJECT_DIR, REPO_SSH, PR_BRANCH)
                generalUtil.mergeBranchIfNeeded()
            }
        }
    }
}
</code></pre>
<p><strong>Jenkinsfile Total: 47 + 83 + 63 + 119 + 151 = 463 lines</strong></p>
<h3 id="73-groovy-helper-duplication-patterns">7.3 Groovy Helper Duplication Patterns</h3>
<h4 id="pattern-6-git-command-sequences-24-lines-in-generalhelpergroovy">Pattern 6: Git Command Sequences (24 lines in generalHelper.groovy)</h4>
<p>12 git shell commands repeated across multiple functions:</p>
<pre><code class="language-groovy">// Found in generalHelper.groovy - repeated in cloneOrUpdateRepo(), checkoutBranch(), mergeBranchIfNeeded()
sh 'git reset --hard'
sh 'git clean -fd'
sh &quot;git checkout ${targetBranch}&quot;
sh 'git pull origin'
sh 'git fetch origin'
sh 'git branch --show-current'
</code></pre>
<h4 id="pattern-7-python-script-wrapper-calls-16-lines-in-generalhelpergroovy">Pattern 7: Python Script Wrapper Calls (16 lines in generalHelper.groovy)</h4>
<p>8 Python wrapper calls using same pattern:</p>
<pre><code class="language-groovy">def sendBuildStatus(workspace, state, commitHash) {
    def pythonCommand = &quot;python '${workspace}/python/send_bitbucket_build_status.py' '${commitHash}' '${state}'&quot;
    sh(script: pythonCommand, returnStatus: true)
}
// Similar calls for: create_bitbucket_test_report.py, get_unity_version.py, linting_error_report.py, etc.
</code></pre>
<h4 id="pattern-8-error-handling-patterns-24-lines-in-generalhelpergroovy">Pattern 8: Error Handling Patterns (24 lines in generalHelper.groovy)</h4>
<p>8 inconsistent error handling blocks:</p>
<pre><code class="language-groovy">// Version 1
catch (Exception e) {
    echo &quot;An error occurred: ${e.getMessage()}&quot;
    error('Process failed.')
}

// Version 2
catch (Exception e) {
    error &quot;Failed: ${e.message}&quot;
}
</code></pre>
<h4 id="pattern-9-isunix-branching-12-lines-in-jshelpergroovy">Pattern 9: isUnix() Branching (12 lines in jsHelper.groovy)</h4>
<p>2 OS branching blocks:</p>
<pre><code class="language-groovy">if (isUnix()) {
    sh &quot;command for unix&quot;
} else {
    bat &quot;command for windows&quot;
}
</code></pre>
<h4 id="pattern-10-error-handling-in-jshelperunityhelper-30-lines">Pattern 10: Error Handling in jsHelper/unityHelper (30 lines)</h4>
<ul>
<li>jsHelper.groovy: 6 occurrences (18 lines)</li>
<li>unityHelper.groovy: 4 occurrences (12 lines)</li>
</ul>
<p><strong>Groovy Helper Total: 24 + 16 + 24 + 12 + 30 = 106 lines</strong></p>
<h3 id="74-cross-file-duplication-matrix">7.4 Cross-File Duplication Matrix</h3>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>DLX/JF</th>
<th>DLX/JFD</th>
<th>JS/JF</th>
<th>JS/JFD</th>
<th>Pipe/JF</th>
<th>generalH</th>
<th>unityH</th>
<th>jsH</th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameters Block</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Triggers Block</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Environment Block</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Post Actions</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Prepare WORKSPACE</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Git Commands</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>isUnix() Branch</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>Python Wrapper</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>✓</td>
<td>✓</td>
<td>-</td>
</tr>
<tr>
<td>Error Handling</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
</tbody>
</table>
<p><em>Legend: JF=Jenkinsfile, JFD=JenkinsfileDeployment, H=Helper</em></p>
<h3 id="75-impact-of-duplication">7.5 Impact of Duplication</h3>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Maintenance Overhead</strong></td>
<td>Changes must be made in 5+ locations for common patterns</td>
</tr>
<tr>
<td><strong>Bug Propagation Risk</strong></td>
<td>Fixing a bug in one place doesn't fix copies elsewhere</td>
</tr>
<tr>
<td><strong>Inconsistent Behavior</strong></td>
<td>Small variations in copied code cause different behavior</td>
</tr>
<tr>
<td><strong>Testing Difficulty</strong></td>
<td>Same logic must be tested multiple times</td>
</tr>
<tr>
<td><strong>Code Review Burden</strong></td>
<td>Reviewers must verify consistency across all copies</td>
</tr>
</tbody>
</table>
<h3 id="76-deduplication-opportunities">7.6 Deduplication Opportunities</h3>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Current</th>
<th>After Refactoring</th>
<th>Reduction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameters Block</td>
<td>47 lines</td>
<td>10 lines (1 shared)</td>
<td>37 lines</td>
</tr>
<tr>
<td>Triggers Block</td>
<td>83 lines</td>
<td>17 lines (1 shared)</td>
<td>66 lines</td>
</tr>
<tr>
<td>Environment Block</td>
<td>63 lines</td>
<td>12 lines (1 shared)</td>
<td>51 lines</td>
</tr>
<tr>
<td>Post Actions Block</td>
<td>119 lines</td>
<td>25 lines (1 shared)</td>
<td>94 lines</td>
</tr>
<tr>
<td>Prepare WORKSPACE</td>
<td>151 lines</td>
<td>30 lines (1 shared)</td>
<td>121 lines</td>
</tr>
<tr>
<td>Git Commands</td>
<td>24 lines</td>
<td>6 lines (closures)</td>
<td>18 lines</td>
</tr>
<tr>
<td>Python Wrappers</td>
<td>16 lines</td>
<td>0 lines (HttpApiService)</td>
<td>16 lines</td>
</tr>
<tr>
<td>Error Handling</td>
<td>66 lines</td>
<td>10 lines (centralized)</td>
<td>56 lines</td>
</tr>
</tbody>
</table>
<p><strong>Total Potential Reduction: 459 lines (81% of duplicated code)</strong></p>
<h3 id="77-pipeline-specific-duplication-analysis">7.7 Pipeline-Specific Duplication Analysis</h3>
<p>This section analyzes file-level duplication between pipelines, revealing cross-project code sharing patterns.</p>
<h4 id="file-sizes-4-main-jenkinsfiles">File Sizes (4 Main Jenkinsfiles)</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLXJenkins/Jenkinsfile</td>
<td>249</td>
</tr>
<tr>
<td>DLXJenkins/JenkinsfileDeployment</td>
<td>242</td>
</tr>
<tr>
<td>JsJenkins/Jenkinsfile</td>
<td>198</td>
</tr>
<tr>
<td>JsJenkins/JenkinsfileDeployment</td>
<td>372</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>1,061</strong></td>
</tr>
</tbody>
</table>
<h4 id="within-project-duplication-pr-vs-deployment">Within-Project Duplication (PR vs Deployment)</h4>
<p><strong>DLX Pipeline (Unity)</strong></p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Total lines (both files)</td>
<td>491</td>
</tr>
<tr>
<td>Identical lines</td>
<td>146</td>
</tr>
<tr>
<td><strong>Duplication rate</strong></td>
<td><strong>29.7%</strong></td>
</tr>
</tbody>
</table>
<p><strong>JS Pipeline (JavaScript)</strong></p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Total lines (both files)</td>
<td>570</td>
</tr>
<tr>
<td>Identical lines</td>
<td>156</td>
</tr>
<tr>
<td><strong>Duplication rate</strong></td>
<td><strong>27.4%</strong></td>
</tr>
</tbody>
</table>
<h4 id="cross-project-duplication-dlx-vs-js">Cross-Project Duplication (DLX vs JS)</h4>
<p><strong>PR Pipelines (DLX Jenkinsfile vs JS Jenkinsfile)</strong></p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLX Jenkinsfile</td>
<td>249 lines</td>
</tr>
<tr>
<td>JS Jenkinsfile</td>
<td>198 lines</td>
</tr>
<tr>
<td><strong>Identical lines</strong></td>
<td><strong>135</strong></td>
</tr>
<tr>
<td><strong>Duplication rate</strong></td>
<td><strong>54.2%</strong> (of smaller file)</td>
</tr>
</tbody>
</table>
<p><strong>Deployment Pipelines (DLX vs JS JenkinsfileDeployment)</strong></p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLX JenkinsfileDeployment</td>
<td>242 lines</td>
</tr>
<tr>
<td>JS JenkinsfileDeployment</td>
<td>372 lines</td>
</tr>
<tr>
<td><strong>Identical lines</strong></td>
<td><strong>167</strong></td>
</tr>
<tr>
<td><strong>Duplication rate</strong></td>
<td><strong>69.0%</strong> (of smaller file)</td>
</tr>
</tbody>
</table>
<h4 id="summary">Summary</h4>
<table>
<thead>
<tr>
<th>Comparison</th>
<th>Identical Lines</th>
<th>Rate</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLX: PR vs Deployment</td>
<td>146</td>
<td>29.7%</td>
</tr>
<tr>
<td>JS: PR vs Deployment</td>
<td>156</td>
<td>27.4%</td>
</tr>
<tr>
<td><strong>DLX PR vs JS PR</strong></td>
<td><strong>135</strong></td>
<td><strong>54.2%</strong></td>
</tr>
<tr>
<td><strong>DLX Deploy vs JS Deploy</strong></td>
<td><strong>167</strong></td>
<td><strong>69.0%</strong></td>
</tr>
</tbody>
</table>
<h4 id="key-insight">Key Insight</h4>
<p><strong>Cross-project duplication (54-69%) is significantly higher than within-project duplication (27-30%)</strong></p>
<p>This reveals that:
1. DLX and JS pipelines share enormous amounts of identical code
2. Deployment pipelines are even more similar than PR pipelines
3. Refactoring to a Global Shared Library would eliminate this massive redundancy
4. The 569 lines (18.1%) from pattern-based analysis is a <strong>conservative estimate</strong></p>
<hr />
<h2 id="8-dependency-graph">8. Dependency Graph</h2>
<div class="mermaid">
flowchart TB
    subgraph Jenkinsfiles["Jenkinsfiles (5 files)"]
        JF1[DLXJenkins/Jenkinsfile]
        JF2[DLXJenkins/JenkinsfileDeployment]
        JF3[JsJenkins/Jenkinsfile]
        JF4[JsJenkins/JenkinsfileDeployment]
        JF5[PipelineForJenkins/Jenkinsfile]
    end

    subgraph Helpers["groovy/*.groovy"]
        GH[generalHelper.groovy]
        UH[unityHelper.groovy]
        JH[jsHelper.groovy]
    end

    subgraph Python["python/*.py"]
        P1[send_bitbucket_build_status.py]
        P2[create_bitbucket_test_report.py]
        P3[get_unity_version.py]
        P4[...]
    end

    JF1 -->|"load()"| GH
    JF1 -->|"load()"| UH
    JF2 -->|"load()"| GH
    JF2 -->|"load()"| UH
    JF3 -->|"load()"| GH
    JF3 -->|"load()"| JH
    JF4 -->|"load()"| GH
    JF4 -->|"load()"| JH
    JF5 -->|"load()"| GH

    GH -->|"sh(python...)"| P1
    GH -->|"sh(python...)"| P2
    UH -->|"sh(python...)"| P3
</div>

<hr />
<h2 id="9-technical-debt-summary">9. Technical Debt Summary</h2>
<h3 id="91-code-metrics">9.1 Code Metrics</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Total Files</td>
<td>27</td>
</tr>
<tr>
<td>Total Lines</td>
<td>3,745</td>
</tr>
<tr>
<td>Jenkinsfile Lines</td>
<td>1,239 lines (5 files)</td>
</tr>
<tr>
<td>Groovy Helper Lines</td>
<td>1,148 lines (3 files)</td>
</tr>
<tr>
<td>Python Scripts</td>
<td>749 lines (9 files)</td>
</tr>
<tr>
<td>Test Lines</td>
<td>84 lines (2 files)</td>
</tr>
<tr>
<td>Test Coverage</td>
<td>~1 function testable</td>
</tr>
</tbody>
</table>
<h3 id="92-duplication-analysis">9.2 Duplication Analysis</h3>
<table>
<thead>
<tr>
<th>Duplicated Pattern</th>
<th>Occurrences</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameters block</td>
<td>5 files</td>
<td>47</td>
</tr>
<tr>
<td>Triggers block</td>
<td>5 files</td>
<td>83</td>
</tr>
<tr>
<td>Environment block</td>
<td>5 files</td>
<td>63</td>
</tr>
<tr>
<td>Post actions block</td>
<td>5 files</td>
<td>119</td>
</tr>
<tr>
<td>Prepare WORKSPACE stage</td>
<td>5 files</td>
<td>151</td>
</tr>
<tr>
<td>Git commands (generalHelper)</td>
<td>12 calls</td>
<td>24</td>
</tr>
<tr>
<td>Python wrappers (generalHelper)</td>
<td>8 calls</td>
<td>16</td>
</tr>
<tr>
<td>Error handling (all helpers)</td>
<td>18 blocks</td>
<td>66</td>
</tr>
</tbody>
</table>
<p><strong>Total Duplication: 569 lines (18.1% of active codebase*)</strong></p>
<p><em>*Active codebase = Jenkinsfiles (1,239) + Groovy Helpers (1,148) + Python (749) = 3,136 lines</em></p>
<hr />
<h2 id="10-summary-table">10. Summary Table</h2>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Status</th>
<th>Problem</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Architecture</strong></td>
<td>Flat/Monolithic</td>
<td>No layer separation</td>
</tr>
<tr>
<td><strong>Code Reuse</strong></td>
<td>Poor</td>
<td>Duplicated code across 5 Jenkinsfiles</td>
</tr>
<tr>
<td><strong>Testability</strong></td>
<td>Very Low</td>
<td>Only 1 function testable</td>
</tr>
<tr>
<td><strong>Maintainability</strong></td>
<td>Poor</td>
<td>1 file modification → affects everything</td>
</tr>
<tr>
<td><strong>Logging</strong></td>
<td>Inconsistent</td>
<td>No format consistency, no hierarchy</td>
</tr>
<tr>
<td><strong>Error Handling</strong></td>
<td>Inconsistent</td>
<td>Stack trace lost</td>
</tr>
<tr>
<td><strong>API Communication</strong></td>
<td>Python dependent</td>
<td>Not possible directly in Groovy</td>
</tr>
<tr>
<td><strong>Documentation</strong></td>
<td>Partial</td>
<td>Some JSDoc present</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="11-key-issues-for-refactoring">11. Key Issues for Refactoring</h2>
<ol>
<li><strong>Separate concerns</strong>: Extract stage logic from Jenkinsfile into reusable modules</li>
<li><strong>Eliminate Python dependency</strong>: Implement HTTP communication directly in Groovy</li>
<li><strong>Standardize logging</strong>: Create centralized logging system with hierarchy</li>
<li><strong>Unify error handling</strong>: Create consistent error handling with stack trace preservation</li>
<li><strong>Enable testing</strong>: Structure code to allow unit testing</li>
<li><strong>Reduce duplication</strong>: Extract common patterns into reusable components</li>
<li><strong>Create layer architecture</strong>: Establish clear separation between layers</li>
</ol>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-groovy.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#363650',
        primaryTextColor: '#cdd6f4',
        primaryBorderColor: '#6c7bda',
        lineColor: '#a6adc8',
        secondaryColor: '#252536',
        tertiaryColor: '#1e1e2e',
        noteBkgColor: '#2a2a3d',
        noteTextColor: '#cdd6f4',
        actorBkg: '#2a2a3d',
        actorBorder: '#6c7bda',
        actorTextColor: '#cdd6f4',
        signalColor: '#cdd6f4',
        signalTextColor: '#cdd6f4',
        labelBoxBkgColor: '#252536',
        labelBoxBorderColor: '#363650',
        labelTextColor: '#cdd6f4',
        loopTextColor: '#cdd6f4',
        activationBorderColor: '#6c7bda',
        activationBkgColor: '#363650',
        sequenceNumberColor: '#1e1e2e'
      }
    });
  </script>
  
  <script src="../../../js/nav.js"></script>
</body>
</html>