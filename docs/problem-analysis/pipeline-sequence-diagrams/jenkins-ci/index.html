<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="**Analysis Target**: `PipelineForJenkins/Jenkinsfile` (Jenkins Groovy CI Pipeline)">
  <meta name="author" content="Jindo Kim">
  <title>Jenkins CI Pipeline Sequence Diagrams | Post-Refactoring Analysis</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
  <link rel="stylesheet" href="../../../css/portfolio-theme.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
  <!-- Mobile hamburger -->
  <button class="nav-toggle" aria-label="Toggle navigation">
    <span></span><span></span><span></span>
  </button>

  <!-- Sidebar overlay (mobile) -->
  <div class="nav-overlay"></div>

  <!-- Sidebar navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="../../../">Post-Refactoring Analysis</a>
    </div>
    <div class="sidebar-content">
      <ul class="nav-tree"><li class="nav-depth-1"><a href="../../../" class="nav-link">Home</a></li><li class="nav-depth-1"><button class="nav-section-btn expanded">Problem Analysis</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../../problem-analysis/problem-analysis-overview/" class="nav-link">Problem Analysis Overview</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/detailed-analysis/" class="nav-link">Detailed Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/architecture-smells-analysis/" class="nav-link">Architecture Smells Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-analysis/DRY-violation-analysis/" class="nav-link">DRY Violation Analysis</a></li><li class="nav-depth-2"><button class="nav-section-btn expanded">Pipeline Sequence Diagrams</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/domain-mapping/" class="nav-link">Domain Mapping</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/dlx-ci/" class="nav-link">DLXJenkins CI</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/dlx-cd/" class="nav-link">DLXJenkins CD</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/js-ci/" class="nav-link">JsJenkins CI</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/js-cd/" class="nav-link">JsJenkins CD</a></li><li class="nav-depth-3"><a href="../../../problem-analysis/pipeline-sequence-diagrams/jenkins-ci/" class="nav-link active">PipelineForJenkins CI</a></li></ul></li><li class="nav-depth-2"><button class="nav-section-btn">Per-File Analysis</button><ul class="nav-children"><li class="nav-depth-3"><button class="nav-section-btn">generalHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/01-generalHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">jsHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/02-jsHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">unityHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/03-unityHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/04-DLXJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/06-JsJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">PipelineForJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li></ul></li></ul></li><li class="nav-depth-1"><button class="nav-section-btn">Problem Solving</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../../problem-solving/solution-overview/" class="nav-link">Solution Overview</a></li><li class="nav-depth-2"><a href="../../../problem-solving/solution-by-layer/" class="nav-link">Solution by Layer</a></li><li class="nav-depth-2"><a href="../../../problem-solving/solution-by-feature/" class="nav-link">Solution by Feature</a></li><li class="nav-depth-2"><a href="../../../problem-solving/logger-system-design-integration/" class="nav-link">Logger System Design and Integration</a></li><li class="nav-depth-2"><a href="../../../problem-solving/domain-driven-analysis/" class="nav-link">Domain-Driven Analysis</a></li><li class="nav-depth-2"><a href="../../../problem-solving/jenkins-cps-serialization-diagram/" class="nav-link">Jenkins CPS Serialization Diagram</a></li><li class="nav-depth-2"><a href="../../../problem-solving/pull-request-documentation/" class="nav-link">Pull Request Documentation</a></li><li class="nav-depth-2"><button class="nav-section-btn">Implementation Phases</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../../problem-solving/phase-0-global-trusted-shared-library-setup/changelog/" class="nav-link">Phase 0 - Global Trusted Shared Library Setup</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-1-shellscript-modularization-and-initialization-stage/changelog/" class="nav-link">Phase 1 - Shell Script Modularization and Initialization Stage</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-2-3-level-logger-system-implementation/changelog/" class="nav-link">Phase 2 - 3-Level Logger System Implementation</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-3-bitbucket-api-and-shell-library-integration/changelog/" class="nav-link">Phase 3 - Bitbucket API and Shell Library Integration</a></li><li class="nav-depth-3"><a href="../../../problem-solving/phase-4-full-pipeline-refactoring-and-stage-modularization/changelog/" class="nav-link">Phase 4 - Full Pipeline Refactoring and Stage Modularization</a></li></ul></li></ul></li></ul>
    </div>
  </nav>

  <!-- Main content -->
  <main class="content">
    <div class="container">
      <h1 id="jenkins-ci-pipeline-sequence-diagrams">Jenkins CI Pipeline Sequence Diagrams</h1>
<blockquote>
<p><strong>Analysis Target</strong>: <code>PipelineForJenkins/Jenkinsfile</code> (Jenkins Groovy CI Pipeline)</p>
<p><strong>Trigger</strong>: Runs when PR is <code>OPEN</code> or <code>MERGED</code> (differs from other pipelines)</p>
<p><strong>Related</strong>: <a href="../../../problem-analysis/pipeline-sequence-diagrams/domain-mapping/">Domain Mapping Summary</a></p>
</blockquote>
<hr />
<h2 id="why-sequence-diagrams">Why Sequence Diagrams?</h2>
<blockquote>
<p><strong>Q: Why use Sequence Diagrams for Jenkins Pipeline analysis?</strong></p>
<p>A: Jenkins Pipeline is <strong>procedural code</strong>. Unlike OOP where classes naturally define domain boundaries, procedural code mixes multiple domains within sequential execution flow. Sequence Diagrams visualize the <strong>call flow</strong> between components, making it easier to identify which domains are involved at each stage.</p>
<p><strong>Q: What is the goal of this analysis?</strong></p>
<p>A: To <strong>identify domains by function</strong>. By tracing "who calls what", I can classify each function into its domain (Git, Bitbucket, Unity, etc.) and detect where domain boundaries are violated (e.g., one function mixing multiple domains).</p>
</blockquote>
<hr />
<h2 id="domain-summary">Domain Summary</h2>
<h3 id="helper-domains-used">Helper Domains Used</h3>
<table>
<thead>
<tr>
<th>Helper</th>
<th>Domain</th>
<th>Functions Called</th>
<th>Used Stage</th>
</tr>
</thead>
<tbody>
<tr>
<td>generalHelper</td>
<td>Git</td>
<td><code>cloneOrUpdateRepo</code>, <code>isBranchUpToDateWithRemote</code>, <code>checkoutBranch</code></td>
<td>Prepare WORKSPACE</td>
</tr>
<tr>
<td>generalHelper</td>
<td>Bitbucket</td>
<td><code>getFullCommitHash</code>, <code>sendBuildStatus</code></td>
<td>Prepare WORKSPACE, Post</td>
</tr>
<tr>
<td>generalHelper</td>
<td>Web Server</td>
<td><code>publishGroovyDocToWebServer</code></td>
<td>Generate Groovydoc (MERGED only)</td>
</tr>
<tr>
<td>generalHelper</td>
<td>SonarQube</td>
<td><code>checkQualityGateStatus</code></td>
<td>Static Analysis</td>
</tr>
<tr>
<td>generalHelper</td>
<td>Parsing</td>
<td><code>parseJson</code></td>
<td>Prepare WORKSPACE</td>
</tr>
<tr>
<td>generalHelper</td>
<td>Mixed (Bitbucket + Parsing)</td>
<td><code>initializeEnvironment</code></td>
<td>Prepare WORKSPACE</td>
</tr>
</tbody>
</table>
<h3 id="jenkinsfile-direct-calls">Jenkinsfile Direct Calls</h3>
<table>
<thead>
<tr>
<th>Domain</th>
<th>Direct Call</th>
<th>Used Stage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jenkins Pipeline DSL</td>
<td><code>pipeline</code>, <code>stages</code>, <code>post</code>, <code>script</code>, <code>dir</code>, <code>credentials</code>, <code>tool</code>, <code>withSonarQubeEnv</code>, <code>withCredentials</code>, <code>docker.image().inside()</code>, <code>junit</code></td>
<td>All</td>
</tr>
<tr>
<td>Docker</td>
<td><code>docker info</code>, <code>docker.image().inside()</code>, <code>npm-groovy-lint</code></td>
<td>Lint Groovy Code</td>
</tr>
<tr>
<td>Gradle</td>
<td><code>gradle test</code></td>
<td>Run Unit Tests</td>
</tr>
<tr>
<td>Groovydoc</td>
<td><code>groovydoc</code></td>
<td>Generate Groovydoc</td>
</tr>
<tr>
<td>File System</td>
<td><code>mkdir -p</code>, <code>find</code></td>
<td>Generate Groovydoc</td>
</tr>
<tr>
<td>SonarQube</td>
<td><code>sonar-scanner</code></td>
<td>Static Analysis</td>
</tr>
<tr>
<td>Bitbucket (Python)</td>
<td><code>Lint_groovy_report.py</code></td>
<td>Lint Groovy Code</td>
</tr>
</tbody>
</table>
<h3 id="domain-mapping-by-stage">Domain Mapping by Stage</h3>
<table>
<thead>
<tr>
<th>Stage</th>
<th style="text-align: center;">Git</th>
<th style="text-align: center;">Bitbucket</th>
<th style="text-align: center;">Docker</th>
<th style="text-align: center;">Gradle</th>
<th style="text-align: center;">Groovydoc</th>
<th style="text-align: center;">Web Server</th>
<th style="text-align: center;">SonarQube</th>
<th style="text-align: center;">Parsing</th>
<th style="text-align: center;">File System</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prepare WORKSPACE</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Lint Groovy Code</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Generate Groovydoc</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td>Run Unit Tests</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Publish Test Results</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Static Analysis</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Post</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>*Web Server: Groovydoc deployed only when <code>PR_STATE == 'MERGED'</code></p>
</blockquote>
<hr />
<h2 id="overall-pipeline-overview">Overall Pipeline Overview</h2>
<div class="mermaid">
flowchart LR
    subgraph Stages
        S1[Prepare WORKSPACE]
        S2[Lint Groovy Code]
        S3[Generate Groovydoc]
        S4[Run Unit Tests]
        S5[Publish Test Results]
        S6[Static Analysis]
    end

    S1 --> S2 --> S3 --> S4 --> S5 --> S6

    S6 --> Post[Post<br/>always/success/failure/aborted]
</div>

<hr />
<h2 id="stage-1-prepare-workspace">Stage 1: Prepare WORKSPACE</h2>
<div class="mermaid">
sequenceDiagram
    autonumber

    participant JF as Jenkinsfile<br/>(Orchestrator)
    participant GH as generalHelper
    participant Git as Git CLI
    participant Python as Python Scripts
    participant BB as Bitbucket API

    Note over JF: Stage: Prepare WORKSPACE

    JF->>GH: load("generalHelper.groovy")

    JF->>GH: parseJson()
    Note over GH: Domain: Parsing
    GH-->>JF: buildResults, stageResults

    JF->>GH: isBranchUpToDateWithRemote(PR_BRANCH)
    Note over GH: Domain: Git
    GH->>Git: git fetch origin
    GH->>Git: git rev-parse HEAD
    GH->>Git: git rev-parse origin/{branch}
    Git-->>GH: commit hashes
    GH-->>JF: true/false

    JF->>GH: getFullCommitHash(workspace, PR_COMMIT)
    Note over GH: Domain: Bitbucket
    GH->>Python: get_bitbucket_commit_hash.py
    Python->>BB: GET /commits
    BB-->>Python: commit hash
    Python-->>GH: full commit hash
    GH-->>JF: COMMIT_HASH

    JF->>GH: initializeEnvironment(workspace, commitHash, prBranch)
    Note over GH: Mixed: Bitbucket + Parsing
    GH->>GH: sendBuildStatus('INPROGRESS')
    GH->>Python: send_bitbucket_build_status.py
    Python->>BB: POST /statuses/build
    GH->>GH: parseTicketNumber(prBranch)
    GH-->>JF: TICKET_NUMBER, FOLDER_NAME

    JF->>GH: cloneOrUpdateRepo(workspace, projectDir, prBranch)
    Note over GH: Domain: Git
    GH->>Git: git clone / git fetch
    GH->>Git: git checkout
    GH->>Git: git reset --hard
    GH->>Git: git clean -fd
    Git-->>GH: OK
    GH-->>JF: OK

    JF->>GH: checkoutBranch(PROJECT_DIR, PR_BRANCH)
    Note over GH: Domain: Git
    GH->>Git: git reset --hard
    GH->>Git: git clean -fd
    GH->>Git: git checkout {branch}
    GH->>Git: git reset --hard origin/{branch}
    Git-->>GH: OK
    GH-->>JF: OK
</div>

<blockquote>
<p><strong>Note</strong>: Unlike other CI pipelines, Jenkins CI does <strong>not</strong> call <code>mergeBranchIfNeeded</code></p>
</blockquote>
<hr />
<h2 id="stage-2-lint-groovy-code">Stage 2: Lint Groovy Code</h2>
<div class="mermaid">
sequenceDiagram
    autonumber

    participant JF as Jenkinsfile<br/>(Orchestrator)
    participant Docker as Docker Container<br/>(npm-groovy-lint)
    participant Python as Python Scripts
    participant BB as Bitbucket API

    Note over JF: Stage: Lint Groovy Code

    JF->>JF: docker info
    Note over JF: Jenkinsfile Direct: Docker

    JF->>Docker: docker.image('nvuillam/npm-groovy-lint').inside()
    Note over Docker: Lint Groovy scripts
    Docker->>Docker: npm-groovy-lint --path groovy --output groovy-lint-report.json
    Docker-->>JF: exitCodeGroovy

    JF->>Docker: docker.image('nvuillam/npm-groovy-lint').inside()
    Note over Docker: Lint Jenkinsfiles
    Docker->>Docker: npm-groovy-lint --path DLXJenkins,JsJenkins,PipelineForJenkins
    Docker-->>JF: exitCodeJenkins

    alt exitCodeGroovy != 0 OR exitCodeJenkins != 0
        JF->>Python: Lint_groovy_report.py ... Fail
        Note over JF: Jenkinsfile Direct: Bitbucket (Python)
        Python->>BB: POST /reports
        BB-->>Python: OK
        Note over JF: catchError - stage FAILURE
    else all passed
        JF->>Python: Lint_groovy_report.py ... Pass
        Python->>BB: POST /reports
        BB-->>Python: OK
    end
</div>

<hr />
<h2 id="stage-3-generate-groovydoc">Stage 3: Generate Groovydoc</h2>
<div class="mermaid">
sequenceDiagram
    autonumber

    participant JF as Jenkinsfile<br/>(Orchestrator)
    participant FS as File System
    participant Groovy as Groovydoc CLI
    participant GH as generalHelper
    participant WS as Web Server<br/>(SSH/SCP)

    Note over JF: Stage: Generate Groovydoc

    JF->>FS: find ${PROJECT_DIR}/groovy -type f -name '*.groovy'
    Note over JF: Jenkinsfile Direct: File System
    FS-->>JF: fileList

    JF->>FS: mkdir -p ${REPORT_DIR}

    JF->>Groovy: groovydoc -d ${REPORT_DIR} ${fileList}
    Note over JF: Jenkinsfile Direct: Groovydoc
    Groovy-->>JF: build/docs/groovydoc/

    alt PR_STATE == 'MERGED'
        JF->>GH: publishGroovyDocToWebServer(REPORT_DIR)
        Note over GH: Domain: Web Server
        GH->>WS: ssh mkdir -p /var/www/html/Jenkins/GroovyDoc
        GH->>WS: ssh rm -rf (clean old)
        GH->>WS: scp -r groovydoc/*
        GH->>WS: ssh find ... chmod 755/644
        WS-->>GH: OK
        GH-->>JF: OK
    end
</div>

<hr />
<h2 id="stage-4-run-unit-tests">Stage 4: Run Unit Tests</h2>
<div class="mermaid">
sequenceDiagram
    autonumber

    participant JF as Jenkinsfile<br/>(Orchestrator)
    participant Gradle as Gradle CLI

    Note over JF: Stage: Run Unit Tests

    JF->>Gradle: gradle test
    Note over JF: Jenkinsfile Direct: Gradle
    Gradle->>Gradle: Spock Framework test execution
    Gradle-->>JF: build/test-results/test/*.xml
    Gradle-->>JF: build/reports/tests/test/index.html
    Gradle-->>JF: exitCode

    alt exitCode != 0
        Note over JF: catchError - stage FAILURE
    end
</div>

<hr />
<h2 id="stage-5-publish-test-results">Stage 5: Publish Test Results</h2>
<div class="mermaid">
sequenceDiagram
    autonumber

    participant JF as Jenkinsfile<br/>(Orchestrator)
    participant Jenkins as Jenkins JUnit Plugin

    Note over JF: Stage: Publish Test Results

    JF->>Jenkins: junit 'build/test-results/test/*.xml'
    Note over JF: Jenkins Pipeline DSL
    Jenkins-->>JF: Test results published
</div>

<blockquote>
<p><strong>Note</strong>: Unlike other pipelines, Jenkins CI does <strong>not</strong> send test/coverage reports to Bitbucket via Python scripts</p>
</blockquote>
<hr />
<h2 id="stage-6-static-analysis">Stage 6: Static Analysis</h2>
<div class="mermaid">
sequenceDiagram
    autonumber

    participant JF as Jenkinsfile<br/>(Orchestrator)
    participant GH as generalHelper
    participant SQ as SonarQube

    Note over JF: Stage: Static Analysis

    JF->>SQ: sonar-scanner -Dsonar.projectKey={key} -Dsonar.sources=.
    Note over JF: Jenkinsfile Direct: SonarQube
    SQ-->>JF: analysis queued

    JF->>GH: checkQualityGateStatus(SONAR_PROJECT_KEY, token)
    Note over GH: Domain: SonarQube
    loop retry (max 5)
        GH->>SQ: GET /api/ce/component
        SQ-->>GH: queue status
        alt queue not empty
            GH->>GH: sleep(10)
        else queue empty
            GH->>SQ: GET /api/qualitygates/project_status
            SQ-->>GH: entireCodeStatus, newCodeStatus
        end
    end
    GH-->>JF: PASSED/FAILED

    alt status != OK
        Note over JF: catchError - stage FAILURE
    end
</div>

<hr />
<h2 id="post-alwayssuccessfailureaborted">Post: always/success/failure/aborted</h2>
<div class="mermaid">
sequenceDiagram
    autonumber

    participant JF as Jenkinsfile<br/>(Orchestrator)
    participant GH as generalHelper
    participant Python as Python Scripts
    participant BB as Bitbucket API

    Note over JF: Post: always/success/failure/aborted

    Note over JF: always block
    JF->>JF: currentBuild.description = PR_BRANCH
    Note over JF: No checkoutBranch call (differs from other pipelines)

    Note over JF,GH: success/failure/aborted
    alt success
        JF->>GH: sendBuildStatus(workspace, 'SUCCESSFUL', commitHash)
    else failure
        JF->>GH: sendBuildStatus(workspace, 'FAILED', commitHash)
    else aborted
        JF->>GH: sendBuildStatus(workspace, 'STOPPED', commitHash)
    end
    Note over GH: Domain: Bitbucket
    GH->>Python: send_bitbucket_build_status.py
    Python->>BB: POST /statuses/build
    BB-->>Python: OK
    GH-->>JF: OK
</div>

<hr />
<h2 id="observations">Observations</h2>
<h3 id="delegation-pattern">Delegation Pattern</h3>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Example</th>
<th style="text-align: center;">Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jenkinsfile → generalHelper → External</td>
<td><code>sendBuildStatus</code> → Python → Bitbucket API</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td>Jenkinsfile → Docker direct</td>
<td><code>docker.image().inside()</code> → npm-groovy-lint</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td>Jenkinsfile → Gradle direct</td>
<td><code>gradle test</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td>Jenkinsfile → Groovydoc direct</td>
<td><code>groovydoc</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td>Jenkinsfile → SonarQube direct</td>
<td><code>sonar-scanner</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td>Jenkinsfile → Python direct</td>
<td><code>Lint_groovy_report.py</code></td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<h3 id="ci-pipeline-comparison-dlx-ci-vs-js-ci-vs-jenkins-ci">CI Pipeline Comparison (DLX CI vs JS CI vs Jenkins CI)</h3>
<table>
<thead>
<tr>
<th>Item</th>
<th>DLX CI</th>
<th>JS CI</th>
<th>Jenkins CI</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tool</td>
<td>Unity CLI</td>
<td>Node.js (npm)</td>
<td>Gradle + Docker</td>
</tr>
<tr>
<td>Helper</td>
<td>unityHelper</td>
<td>jsHelper</td>
<td><strong>(none)</strong></td>
</tr>
<tr>
<td>Trigger</td>
<td>OPEN</td>
<td>OPEN</td>
<td><strong>OPEN + MERGED</strong></td>
</tr>
<tr>
<td><code>initializeEnvironment</code></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td><code>mergeBranchIfNeeded</code></td>
<td>✓</td>
<td>✓</td>
<td><strong>✗</strong></td>
</tr>
<tr>
<td><code>checkoutBranch</code> in Post</td>
<td>✓</td>
<td>✓</td>
<td><strong>✗</strong></td>
</tr>
<tr>
<td>Linting</td>
<td>Bash Script (C#)</td>
<td>jsHelper (ESLint)</td>
<td>Docker (npm-groovy-lint)</td>
</tr>
<tr>
<td>Test Type</td>
<td>EditMode/PlayMode</td>
<td>Jest</td>
<td>Spock (Gradle)</td>
</tr>
<tr>
<td>Code Coverage</td>
<td>Unity Code Coverage</td>
<td>lcov-report</td>
<td>JaCoCo</td>
</tr>
<tr>
<td>Static Analysis</td>
<td>No</td>
<td>SonarQube</td>
<td>SonarQube</td>
</tr>
<tr>
<td>Build Project</td>
<td>WebGL</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>Documentation</td>
<td>No</td>
<td>No</td>
<td><strong>Groovydoc</strong></td>
</tr>
<tr>
<td>Test Report to Bitbucket</td>
<td>✓ (Python)</td>
<td>✓ (Python)</td>
<td><strong>✗</strong></td>
</tr>
</tbody>
</table>
<h3 id="inconsistencies">Inconsistencies</h3>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mixed domain function</td>
<td><code>initializeEnvironment</code> combines Bitbucket + Parsing (SRP violation)</td>
</tr>
<tr>
<td>No <code>mergeBranchIfNeeded</code></td>
<td>Unlike other CI pipelines, does not merge default branch before build</td>
</tr>
<tr>
<td>No <code>checkoutBranch</code> in Post</td>
<td>Unlike other pipelines, does not return to destination branch after build</td>
</tr>
<tr>
<td>No test report to Bitbucket</td>
<td>Unlike DLX CI and JS CI, does not send test/coverage reports via Python</td>
</tr>
<tr>
<td>No dedicated Helper</td>
<td>Unlike DLX (unityHelper) and JS (jsHelper), no project-specific helper</td>
</tr>
</tbody>
</table>
<hr />
<p><a href="../../../problem-analysis/pipeline-sequence-diagrams/js-cd/">← JS CD</a> | <a href="../../../problem-analysis/pipeline-sequence-diagrams/domain-mapping/">Domain Mapping Summary →</a></p>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-groovy.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#363650',
        primaryTextColor: '#cdd6f4',
        primaryBorderColor: '#6c7bda',
        lineColor: '#a6adc8',
        secondaryColor: '#252536',
        tertiaryColor: '#1e1e2e',
        noteBkgColor: '#2a2a3d',
        noteTextColor: '#cdd6f4',
        actorBkg: '#2a2a3d',
        actorBorder: '#6c7bda',
        actorTextColor: '#cdd6f4',
        signalColor: '#cdd6f4',
        signalTextColor: '#cdd6f4',
        labelBoxBkgColor: '#252536',
        labelBoxBorderColor: '#363650',
        labelTextColor: '#cdd6f4',
        loopTextColor: '#cdd6f4',
        activationBorderColor: '#6c7bda',
        activationBkgColor: '#363650',
        sequenceNumberColor: '#1e1e2e'
      }
    });
  </script>
  
  <script src="../../../js/nav.js"></script>
</body>
</html>