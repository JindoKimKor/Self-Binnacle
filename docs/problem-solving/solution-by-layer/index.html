<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Layer-by-layer architecture analysis of the refactored codebase.">
  <meta name="author" content="Jindo Kim">
  <title>Solution by Layer | Post-Refactoring Analysis</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
  <link rel="stylesheet" href="../../css/portfolio-theme.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
  <!-- Mobile hamburger -->
  <button class="nav-toggle" aria-label="Toggle navigation">
    <span></span><span></span><span></span>
  </button>

  <!-- Sidebar overlay (mobile) -->
  <div class="nav-overlay"></div>

  <!-- Sidebar navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="../../">Post-Refactoring Analysis</a>
    </div>
    <div class="sidebar-content">
      <ul class="nav-tree"><li class="nav-depth-1"><a href="../../" class="nav-link">Home</a></li><li class="nav-depth-1"><button class="nav-section-btn">Problem Analysis</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../problem-analysis/problem-analysis-overview/" class="nav-link">Problem Analysis Overview</a></li><li class="nav-depth-2"><a href="../../problem-analysis/detailed-analysis/" class="nav-link">Detailed Analysis</a></li><li class="nav-depth-2"><a href="../../problem-analysis/architecture-smells-analysis/" class="nav-link">Architecture Smells Analysis</a></li><li class="nav-depth-2"><a href="../../problem-analysis/DRY-violation-analysis/" class="nav-link">DRY Violation Analysis</a></li><li class="nav-depth-2"><button class="nav-section-btn">Pipeline Sequence Diagrams</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/domain-mapping/" class="nav-link">Domain Mapping</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/dlx-ci/" class="nav-link">DLXJenkins CI</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/dlx-cd/" class="nav-link">DLXJenkins CD</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/js-ci/" class="nav-link">JsJenkins CI</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/js-cd/" class="nav-link">JsJenkins CD</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/jenkins-ci/" class="nav-link">PipelineForJenkins CI</a></li></ul></li><li class="nav-depth-2"><button class="nav-section-btn">Per-File Analysis</button><ul class="nav-children"><li class="nav-depth-3"><button class="nav-section-btn">generalHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/01-generalHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/01-generalHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/01-generalHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">jsHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/02-jsHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/02-jsHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/02-jsHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">unityHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/03-unityHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/03-unityHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/03-unityHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/04-DLXJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/04-DLXJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/04-DLXJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/06-JsJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/06-JsJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/06-JsJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">PipelineForJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li></ul></li></ul></li><li class="nav-depth-1"><button class="nav-section-btn expanded">Problem Solving</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../problem-solving/solution-overview/" class="nav-link">Solution Overview</a></li><li class="nav-depth-2"><a href="../../problem-solving/solution-by-layer/" class="nav-link active">Solution by Layer</a></li><li class="nav-depth-2"><a href="../../problem-solving/solution-by-feature/" class="nav-link">Solution by Feature</a></li><li class="nav-depth-2"><a href="../../problem-solving/logger-system-design-integration/" class="nav-link">Logger System Design and Integration</a></li><li class="nav-depth-2"><a href="../../problem-solving/domain-driven-analysis/" class="nav-link">Domain-Driven Analysis</a></li><li class="nav-depth-2"><a href="../../problem-solving/jenkins-cps-serialization-diagram/" class="nav-link">Jenkins CPS Serialization Diagram</a></li><li class="nav-depth-2"><a href="../../problem-solving/pull-request-documentation/" class="nav-link">Pull Request Documentation</a></li><li class="nav-depth-2"><button class="nav-section-btn">Implementation Phases</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../problem-solving/phase-0-global-trusted-shared-library-setup/changelog/" class="nav-link">Phase 0 - Global Trusted Shared Library Setup</a></li><li class="nav-depth-3"><a href="../../problem-solving/phase-1-shellscript-modularization-and-initialization-stage/changelog/" class="nav-link">Phase 1 - Shell Script Modularization and Initialization Stage</a></li><li class="nav-depth-3"><a href="../../problem-solving/phase-2-3-level-logger-system-implementation/changelog/" class="nav-link">Phase 2 - 3-Level Logger System Implementation</a></li><li class="nav-depth-3"><a href="../../problem-solving/phase-3-bitbucket-api-and-shell-library-integration/changelog/" class="nav-link">Phase 3 - Bitbucket API and Shell Library Integration</a></li><li class="nav-depth-3"><a href="../../problem-solving/phase-4-full-pipeline-refactoring-and-stage-modularization/changelog/" class="nav-link">Phase 4 - Full Pipeline Refactoring and Stage Modularization</a></li></ul></li></ul></li></ul>
    </div>
  </nav>

  <!-- Main content -->
  <main class="content">
    <div class="container">
      <h1 id="solution-by-layer">Solution by Layer</h1>
<blockquote>
<p>Layer-by-layer architecture analysis of the refactored codebase.</p>
<p>For feature-by-feature breakdown, see <a href="../../problem-solving/solution-by-feature/">solution-by-feature.md</a>.
For high-level overview, see <a href="../../">README.md</a>.</p>
</blockquote>
<hr />
<h2 id="reference-commit">Reference Commit</h2>
<table>
<thead>
<tr>
<th>State</th>
<th>Commit Hash</th>
<th>Date</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Final</strong></td>
<td><a href="https://github.com/JindoKimKor/devops-jenkins-linux/tree/ff74ac8"><code>ff74ac8</code></a></td>
<td>2025-05-12</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#1-overview">Overview</a></li>
<li><a href="#2-complete-file-structure">Complete File Structure</a></li>
<li><a href="#3-folder-by-folder-analysis">Folder-by-Folder Analysis</a></li>
<li><a href="#4-design-patterns-applied">Design Patterns Applied</a></li>
<li><a href="#5-current-state-summary">Current State Summary</a></li>
<li><a href="#6-reference">Reference</a></li>
</ul>
<hr />
<h2 id="1-overview">1. Overview</h2>
<h3 id="11-file-statistics">1.1 File Statistics</h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Files</th>
<th>Lines (approx)</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>sharedLibraries/vars/</strong></td>
<td>13</td>
<td>1,104</td>
<td>NEW - Pipeline stages</td>
</tr>
<tr>
<td><strong>sharedLibraries/src/</strong></td>
<td>5</td>
<td>1,047</td>
<td>NEW - Core business logic</td>
</tr>
<tr>
<td><strong>groovy/</strong></td>
<td>3</td>
<td>1,824</td>
<td>Legacy (being migrated)</td>
</tr>
<tr>
<td><strong>DLXJenkins/</strong></td>
<td>2</td>
<td>286</td>
<td>Refactored</td>
</tr>
<tr>
<td><strong>JsJenkins/</strong></td>
<td>2</td>
<td>743</td>
<td>Being Refactored</td>
</tr>
<tr>
<td><strong>PipelineForJenkins/</strong></td>
<td>1</td>
<td>185</td>
<td>Being Refactored</td>
</tr>
<tr>
<td><strong>python/</strong></td>
<td>15</td>
<td>2,069</td>
<td>Legacy (to be eliminated)</td>
</tr>
<tr>
<td><strong>Bash/</strong></td>
<td>2</td>
<td>330</td>
<td>Shell scripts</td>
</tr>
<tr>
<td><strong>tests/</strong></td>
<td>5</td>
<td>200</td>
<td>NEW - Unit tests</td>
</tr>
<tr>
<td><strong>TOTAL</strong></td>
<td>48</td>
<td>7,788</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="12-architecture-summary">1.2 Architecture Summary</h3>
<p>The refactored codebase implements a <strong>4-Layer Architecture</strong> with clear separation of concerns:</p>
<div class="mermaid">
flowchart TB
    subgraph Layer1["Layer 1: Entry Point"]
        JF[Jenkinsfile]
    end

    subgraph Layer2["Layer 2: Orchestration (vars/)"]
        STAGES[Stage Functions]
    end

    subgraph Layer3["Layer 3: Services"]
        subgraph L3_SRC["src/service/"]
            HTTP[HttpApiService]
        end
        subgraph L3_VARS["vars/ (CPS Constraint)"]
            SSH[shellScriptHelper]
            BAH[bitbucketApiHelper]
        end
    end

    subgraph Layer4["Layer 4: Utilities (src/utils/ + src/resource/)"]
        GIT[GitLibrary]
        SHELL[ShellLibrary]
        SSHLIB[SSHShellLibrary]
        STATUS[Status Constants]
        subgraph L4_CC["Cross-Cutting (vars/)"]
            LOGGER[logger]
            BAL[bitbucketApiLibrary]
        end
    end

    JF --> STAGES
    STAGES --> SSH
    STAGES --> BAH
    STAGES -.-> LOGGER
    SSH --> GIT
    SSH --> SHELL
    SSH --> SSHLIB
    SSH -.-> LOGGER
    BAH --> BAL
    BAH --> HTTP
    STAGES --> STATUS
    HTTP --> STATUS
</div>

<hr />
<h2 id="2-complete-file-structure">2. Complete File Structure</h2>
<pre><code>devops-linux-jenkins/
â”‚
â”œâ”€â”€ sharedLibraries/                                    [18 files - Core Library]
â”‚   â”œâ”€â”€ vars/                                           [13 files - Pipeline Functions]
â”‚   â”‚   â”œâ”€â”€ logger.groovy                                   - Centralized logging
â”‚   â”‚   â”œâ”€â”€ shellScriptHelper.groovy                        - Shell execution wrapper
â”‚   â”‚   â”œâ”€â”€ bitbucketApiHelper.groovy                       - Bitbucket API facade
â”‚   â”‚   â”œâ”€â”€ bitbucketApiLibrary.groovy                      - API request builder
â”‚   â”‚   â”œâ”€â”€ stageInitialization.groovy                      - Pipeline initialization
â”‚   â”‚   â”œâ”€â”€ stageProjectPrepare.groovy                      - Project preparation
â”‚   â”‚   â”œâ”€â”€ stageLintUnity.groovy                           - Unity linting
â”‚   â”‚   â”œâ”€â”€ stageLintGroovyJenkinsfile.groovy               - Groovy linting
â”‚   â”‚   â”œâ”€â”€ stageUnityExecution.groovy                      - Unity test execution
â”‚   â”‚   â”œâ”€â”€ stageStaticAnalysis.groovy                      - SonarQube analysis
â”‚   â”‚   â”œâ”€â”€ stageSendBuildResults.groovy                    - Build result reporting
â”‚   â”‚   â”œâ”€â”€ stageDeployBuild.groovy                         - Build deployment
â”‚   â”‚   â””â”€â”€ stageCleanupPRBranchArtifacts.groovy            - PR cleanup
â”‚   â”‚
â”‚   â””â”€â”€ src/                                            [5 files - Library Source]
â”‚       â”œâ”€â”€ resource/
â”‚       â”‚   â””â”€â”€ Status.groovy                               - Status constants
â”‚       â”‚
â”‚       â”œâ”€â”€ service/general/
â”‚       â”‚   â””â”€â”€ HttpApiService.groovy                       - HTTP client
â”‚       â”‚
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ GitLibrary.groovy                           - Git operations (23 closures)
â”‚           â”œâ”€â”€ ShellLibrary.groovy                         - Shell operations (15 closures)
â”‚           â””â”€â”€ SSHShellLibrary.groovy                      - SSH operations (8 closures)
â”‚
â”œâ”€â”€ DLXJenkins/                                         [2 files - Unity Pipeline]
â”‚   â”œâ”€â”€ Jenkinsfile
â”‚   â””â”€â”€ JenkinsfileDeployment
â”‚
â”œâ”€â”€ JsJenkins/                                          [2 files - JavaScript Pipeline]
â”‚   â”œâ”€â”€ Jenkinsfile
â”‚   â””â”€â”€ JenkinsfileDeployment
â”‚
â”œâ”€â”€ PipelineForJenkins/                                 [1 file - Self Pipeline]
â”‚   â””â”€â”€ Jenkinsfile
â”‚
â”œâ”€â”€ groovy/                                             [3 files - Legacy Helpers]
â”‚   â”œâ”€â”€ generalHelper.groovy                                - Being migrated
â”‚   â”œâ”€â”€ jsHelper.groovy                                     - Being migrated
â”‚   â””â”€â”€ unityHelper.groovy                                  - Being migrated
â”‚
â”œâ”€â”€ python/                                             [15 files - Legacy Scripts]
â”‚   â””â”€â”€ (to be eliminated)
â”‚
â””â”€â”€ tests/                                              [5 files - Unit Tests]
    â”œâ”€â”€ GeneralHelperSpec.groovy
    â””â”€â”€ src/
        â”œâ”€â”€ resource/
        â”‚   â”œâ”€â”€ JenkinsFile.groovy                          - Mock interface
        â”‚   â””â”€â”€ StatusSpec.groovy
        â””â”€â”€ utils/
            â””â”€â”€ GitLibrarySpec.groovy                       - Git closure tests
</code></pre>
<hr />
<h2 id="3-folder-by-folder-analysis">3. Folder-by-Folder Analysis</h2>
<h3 id="31-sharedlibrariesvars-pipeline-stage-functions">3.1 sharedLibraries/vars/ - Pipeline Stage Functions</h3>
<p>The <code>vars/</code> directory in Jenkins Global Shared Library defines global functions callable directly from pipelines.</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stageInitialization.groovy</code></td>
<td>103</td>
<td>Environment setup, send INPROGRESS status</td>
</tr>
<tr>
<td><code>stageProjectPrepare.groovy</code></td>
<td>186</td>
<td>Git workspace preparation, branch sync</td>
</tr>
<tr>
<td><code>stageLintUnity.groovy</code></td>
<td>67</td>
<td>Unity C# linting</td>
</tr>
<tr>
<td><code>stageLintGroovyJenkinsfile.groovy</code></td>
<td>96</td>
<td>Groovy/Jenkinsfile linting</td>
</tr>
<tr>
<td><code>stageUnityExecution.groovy</code></td>
<td>99</td>
<td>Unity test execution (EditMode/PlayMode/Coverage/WebGL)</td>
</tr>
<tr>
<td><code>stageStaticAnalysis.groovy</code></td>
<td>87</td>
<td>SonarQube analysis</td>
</tr>
<tr>
<td><code>stageSendBuildResults.groovy</code></td>
<td>39</td>
<td>Build result publishing</td>
</tr>
<tr>
<td><code>stageDeployBuild.groovy</code></td>
<td>72</td>
<td>SSH deployment</td>
</tr>
<tr>
<td><code>stageCleanupPRBranchArtifacts.groovy</code></td>
<td>62</td>
<td>PR artifact cleanup</td>
</tr>
</tbody>
</table>
<h4 id="loggergroovy-3-level-hierarchical-logging">logger.groovy - 3-Level Hierarchical Logging</h4>
<div class="mermaid">
flowchart TB
    subgraph Level1["Level 1: Stage"]
        SS[stageStart]
        SE[stageEnd]
    end

    subgraph Level2["Level 2: Steps Group"]
        SGS[stepsGroupStart]
        SGE[stepsGroupEnd]
    end

    subgraph Level3["Level 3: Step"]
        SSTART[stepStart âž¡ï¸]
        SINFO[stepInfo ðŸ’¬]
        SPROC[stepProcessing ðŸƒ]
        SSUC[stepSuccess âœ…]
        SWARN[stepWarning âš ï¸]
        SFAIL[stepFailed âŒ]
        SERR[stepError ðŸ”¥]
    end

    SS --> SGS
    SGS --> SSTART
    SGS --> SINFO
    SGS --> SPROC
    SGS --> SSUC
    SGS --> SWARN
    SGS --> SFAIL
    SGS --> SERR
    SGE --> SE
</div>

<h4 id="shellscripthelpergroovy-validated-shell-execution">shellScriptHelper.groovy - Validated Shell Execution</h4>
<div class="mermaid">
flowchart LR
    subgraph Input
        CL[Closure from Library]
        ARGS[Arguments List]
    end

    subgraph Validation
        V1[Non-null script]
        V2[Non-null label]
        V3[Mutually exclusive flags]
    end

    subgraph Execution
        RS[returnStatus â†’ int]
        RO[returnStdout â†’ String]
        RV[returnVoid â†’ void]
    end

    subgraph Output
        LOG[Logger Integration]
        RES[Result]
    end

    CL --> V1
    ARGS --> V1
    V1 --> V2
    V2 --> V3
    V3 --> RS
    V3 --> RO
    V3 --> RV
    RS --> LOG
    RO --> LOG
    RV --> LOG
    LOG --> RES
</div>

<hr />
<h3 id="32-sharedlibrariessrc-core-business-logic">3.2 sharedLibraries/src/ - Core Business Logic</h3>
<blockquote>
<p><strong>* CPS Constraint Note</strong>: <code>logger.groovy</code>, <code>shellScriptHelper.groovy</code>, <code>bitbucketApiHelper.groovy</code>, <code>bitbucketApiLibrary.groovy</code> are located in <code>vars/</code> instead of <code>src/</code> due to Jenkins CPS (Continuation Passing Style) serialization constraints. These files use Jenkins DSL methods (<code>echo</code>, <code>sh</code>, <code>withCredentials</code>) that require CPS-compatible execution context.</p>
</blockquote>
<h4 id="321-vars-helpers-cps-constrained">3.2.1 vars/ Helpers (CPS-constrained)*</h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Lines</th>
<th>Purpose</th>
<th>Design Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>logger.groovy</code></td>
<td>83</td>
<td>3-level hierarchical logging</td>
<td>Facade</td>
</tr>
<tr>
<td><code>shellScriptHelper.groovy</code></td>
<td>105</td>
<td>Validated shell execution</td>
<td>Command/Adapter</td>
</tr>
<tr>
<td><code>bitbucketApiHelper.groovy</code></td>
<td>36</td>
<td>Bitbucket API facade</td>
<td>Facade</td>
</tr>
<tr>
<td><code>bitbucketApiLibrary.groovy</code></td>
<td>69</td>
<td>API request builder</td>
<td>Builder</td>
</tr>
</tbody>
</table>
<h4 id="loggergroovy-3-level-hierarchical-logging_1">logger.groovy - 3-Level Hierarchical Logging</h4>
<h4 id="322-srcutils-command-libraries">3.2.2 src/utils/ - Command Libraries</h4>
<h5 id="gitlibrarygroovy-23-closures">GitLibrary.groovy (23 Closures)</h5>
<table>
<thead>
<tr>
<th>Category</th>
<th>Closures</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Fetch</strong></td>
<td>FetchOrigin, FetchBranch</td>
</tr>
<tr>
<td><strong>Branch</strong></td>
<td>ShowCurrentBranch, CheckoutBranch, GetOriginDefaultBranch, CheckOriginBranchExists, CheckBranchExists</td>
</tr>
<tr>
<td><strong>Status</strong></td>
<td>CheckUpToDateWithRemote, CheckIsRemoteBranchAncestor</td>
</tr>
<tr>
<td><strong>Reset/Clean</strong></td>
<td>ResetHardHead, CleanUntracked, RemoveIndexLock</td>
</tr>
<tr>
<td><strong>Clone/Pull</strong></td>
<td>CloneRepository, Pull, ResetHardOriginBranch</td>
</tr>
<tr>
<td><strong>Merge</strong></td>
<td>MergeOriginBranch</td>
</tr>
<tr>
<td><strong>LFS</strong></td>
<td>LfsListUntrackedFiles, LfsFetchAndCheckout</td>
</tr>
<tr>
<td><strong>Hash</strong></td>
<td>GetRemoteBranchHash</td>
</tr>
</tbody>
</table>
<h5 id="shelllibrarygroovy-15-closures">ShellLibrary.groovy (15 Closures)</h5>
<table>
<thead>
<tr>
<th>Category</th>
<th>Closures</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Environment</strong></td>
<td>PrintJenkinsEnv</td>
</tr>
<tr>
<td><strong>Directory</strong></td>
<td>FindPRJobDirectory, FindProjectDirectory, CreateLintingResultsDir</td>
</tr>
<tr>
<td><strong>Docker</strong></td>
<td>DockerInfo, GroovyLint</td>
</tr>
<tr>
<td><strong>Unity</strong></td>
<td>GetUnityExecutable, LintUnity, CopyWebGLBuilder, CopyLintConfig</td>
</tr>
<tr>
<td><strong>Reporting</strong></td>
<td>ExecutePythonStatusReport, CreateBitbucketBuildReport, CreateBitbucketTestReport</td>
</tr>
</tbody>
</table>
<h5 id="sshshelllibrarygroovy-8-closures">SSHShellLibrary.groovy (8 Closures)</h5>
<table>
<thead>
<tr>
<th>Closure</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>CheckSSHConnectivity</td>
<td>Test SSH connection</td>
</tr>
<tr>
<td>CreateDirectoryAndSetPermission</td>
<td>Create remote directory</td>
</tr>
<tr>
<td>CopyBuildToHostServer</td>
<td>SCP build artifacts</td>
</tr>
<tr>
<td>UpdateBuildURL</td>
<td>Execute remote script</td>
</tr>
<tr>
<td>CleanMergedPRBranchFromHostServer</td>
<td>Remove PR artifacts</td>
</tr>
<tr>
<td>CreateDirectoryAndSetPermissionForEconestogaDlxServer</td>
<td>Econestoga server setup</td>
</tr>
<tr>
<td>CopyBuildToEconestogaDlxServer</td>
<td>Econestoga deployment</td>
</tr>
<tr>
<td>UpdateBuildURLForEconestogaDlxServer</td>
<td>Econestoga URL update</td>
</tr>
</tbody>
</table>
<h4 id="323-srcservice-business-logic-services">3.2.3 src/service/ - Business Logic Services</h4>
<h5 id="httpapiservicegroovy-172-lines">HttpApiService.groovy (172 lines)</h5>
<div class="mermaid">
flowchart TB
    subgraph API["HttpApiService"]
        GET[get]
        POST[post]
        PUT[put]
        DELETE[delete]
    end

    subgraph Execution
        EXEC[executeRequest]
    end

    subgraph ErrorHandling["Error Handling"]
        UH[UnknownHostException]
        CE[ConnectException]
        ST[SocketTimeoutException]
        SSL[SSLHandshakeException]
        CC[ConnectionClosedException]
        IO[IOException]
    end

    subgraph Response
        RES["[statusCode, success, body]"]
    end

    GET --> EXEC
    POST --> EXEC
    PUT --> EXEC
    DELETE --> EXEC
    EXEC --> UH
    EXEC --> CE
    EXEC --> ST
    EXEC --> SSL
    EXEC --> CC
    EXEC --> IO
    EXEC --> RES
</div>

<h4 id="324-srcresource-constants">3.2.4 src/resource/ - Constants</h4>
<h5 id="statusgroovy">Status.groovy</h5>
<pre><code class="language-groovy">class Status {
    static final Map&lt;String, String&gt; STAGE_STATUS = [
        'SUCCESS', 'UNSTABLE', 'FAILURE', 'ABORTED', 'SKIPPED'
    ]
    static final Map&lt;String, String&gt; BUILD_STATUS = [
        'SUCCESS', 'UNSTABLE', 'FAILURE', 'ABORTED', 'NOT_BUILT'
    ]
    static final Map&lt;String, String&gt; COMMIT_STATUS = [
        'SUCCESSFUL', 'INPROGRESS', 'FAILED', 'STOPPED'
    ]
}
</code></pre>
<hr />
<h3 id="33-dlxjenkins-pipeline-definitions-refactored">3.3 DLXJenkins/ - Pipeline Definitions (Refactored)</h3>
<pre><code class="language-groovy">@Library('global-trusted-shared-library@main') _

import resource.Status
import utils.GitLibrary

pipeline {
    stages {
        stage('Jenkins Initialization') { steps { stageInitialization() } }
        stage('Project Preparation') { steps { stageProjectPrepare() } }
        stage('Linting') { steps { stageLintUnity() } }
        stage('EditMode Tests') { steps { stageUnityExecution('EditMode') } }
        stage('PlayMode Tests') { steps { stageUnityExecution('PlayMode') } }
        stage('Build Project') { steps { stageUnityExecution('Webgl') } }
        stage('Send Build Results') { steps { stageSendBuildResults() } }
    }
    post {
        always {
            script {
                dir(env.PROJECT_DIR) {
                    shellScriptHelper(GitLibrary.ShowCurrentBranch)
                    shellScriptHelper(GitLibrary.ResetHardHead)
                    shellScriptHelper(GitLibrary.CleanUntracked)
                    shellScriptHelper(GitLibrary.CheckoutBranch, [env.DESTINATION_BRANCH])
                }
            }
        }
        success { bitbucketApiHelper(bitbucketApiLibrary.createBuildStatusForCommit(...)) }
        failure { bitbucketApiHelper(bitbucketApiLibrary.createBuildStatusForCommit(...)) }
    }
}
</code></pre>
<p><strong>Characteristics:</strong>
- No business logic (all delegated to vars/ functions)
- Declarative pipeline structure
- Consistent pattern: <code>steps { stageFunctionName() }</code></p>
<hr />
<h2 id="4-design-patterns-applied">4. Design Patterns Applied</h2>
<blockquote>
<p><strong>Source:</strong> Gang of Four (GoF) - "Design Patterns: Elements of Reusable Object-Oriented Software" (1994) by Erich Gamma, Richard Helm, Ralph Johnson, and John Vlissides</p>
</blockquote>
<h3 id="41-command-pattern-behavioral">4.1 Command Pattern (Behavioral)</h3>
<p><strong>Definition:</strong> Encapsulates a request as an object, allowing parameterization and queuing of requests.</p>
<p><strong>Where:</strong> GitLibrary, ShellLibrary, SSHShellLibrary</p>
<p><strong>Why it applies:</strong> Each Closure encapsulates a shell command as an object (Map with script, label, returnType). The <code>shellScriptHelper</code> (Invoker) executes these commands without knowing their implementation details.</p>
<div class="mermaid">
flowchart LR
    subgraph Client["Client (stage*.groovy)"]
        CALL["shellScriptHelper(<br/>GitLibrary.CheckoutBranch,<br/>['main'])"]
    end

    subgraph Command["Command (GitLibrary)"]
        CLOSURE["Closure CheckoutBranch<br/>â†’ returns Map"]
    end

    subgraph Invoker["Invoker (shellScriptHelper)"]
        VALIDATE["validateShMap()"]
        EXECUTE["execute*()"]
    end

    subgraph Receiver["Receiver (Jenkins)"]
        SH["sh(map)"]
    end

    Client -->|"passes Command"| Invoker
    Invoker -->|"calls"| Command
    Command -->|"returns Map"| Invoker
    Invoker -->|"delegates to"| Receiver
</div>

<h3 id="42-facade-pattern-structural">4.2 Facade Pattern (Structural)</h3>
<p><strong>Definition:</strong> Provides a simplified interface to a complex subsystem, reducing dependencies between clients and the subsystems they interact with.</p>
<p><strong>Where:</strong> logger, shellScriptHelper</p>
<p><strong>Why it applies:</strong> These helpers hide the complexity of Jenkins DSL (<code>echo</code>, <code>sh</code>, <code>error</code>) and internal logic (validation, routing, formatting) behind simple function calls.</p>
<div class="mermaid">
flowchart TB
    subgraph Client["Client (stage*.groovy)"]
        STAGE["stageProjectPrepare()<br/>stageLintUnity()<br/>stageDeployBuild()"]
    end

    subgraph Facade["Facade (vars/)"]
        LOG["logger<br/>.stepStart()<br/>.stepError()<br/>.stepInfo()"]
        SSH["shellScriptHelper<br/>(Closure, args)"]
    end

    subgraph Subsystem["Subsystem (Hidden)"]
        ECHO["Jenkins echo()"]
        SH["Jenkins sh()"]
        ERR["Jenkins error()"]
        VALID["validateShMap()"]
        ROUTE["executeReturn*()"]
    end

    Client -->|"uses simple API"| Facade
    LOG -->|"delegates"| ECHO
    LOG -->|"delegates"| ERR
    SSH -->|"internally uses"| VALID
    SSH -->|"internally uses"| ROUTE
    SSH -->|"delegates"| SH
</div>

<h3 id="43-adapter-pattern-structural">4.3 Adapter Pattern (Structural)</h3>
<p><strong>Definition:</strong> Converts the interface of a class into another interface clients expect, allowing incompatible interfaces to work together.</p>
<p><strong>Where:</strong> shellScriptHelper</p>
<p><strong>Why it applies:</strong> Converts <code>(Closure, args)</code> interface that Client uses into <code>Map</code> interface that Jenkins <code>sh()</code> expects.</p>
<div class="mermaid">
flowchart LR
    subgraph Client["Client (stage*.groovy)"]
        CALL["shellScriptHelper(<br/>ShellLibrary.CreateLintingResultsDir,<br/>['workDir'])"]
    end

    subgraph Adapter["Adapter (shellScriptHelper)"]
        CONVERT["Closure(*args) â†’ Map"]
    end

    subgraph Target["Target (Jenkins sh)"]
        SH["sh(Map)"]
    end

    subgraph Adaptee["Adaptee (ShellLibrary)"]
        CLOSURE["Closure returns Map"]
    end

    Client -->|"(Closure, args)"| Adapter
    Adapter -->|"calls"| Adaptee
    Adaptee -->|"returns Map"| Adapter
    Adapter -->|"Map"| Target
</div>

<blockquote>
<p><strong>Note:</strong> <code>shellScriptHelper</code> is both Adapter and Facade. Adapter for interface conversion, Facade for hiding internal complexity (validation, routing, logging).</p>
</blockquote>
<hr />
<h2 id="5-current-state-summary">5. Current State Summary</h2>
<table>
<thead>
<tr>
<th>Principle</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Separation of Concerns</strong></td>
<td>vars/: orchestration, service/: business logic, utils/: commands, resource/: constants</td>
</tr>
<tr>
<td><strong>Reusability</strong></td>
<td>46 shell commands available to all stages, single logger instance</td>
</tr>
<tr>
<td><strong>Maintainability</strong></td>
<td>Change logging â†’ edit logger.groovy only, Add Git op â†’ add 1 closure</td>
</tr>
<tr>
<td><strong>Testability</strong></td>
<td>Mock-friendly constructors, Spock framework integration</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6-reference">6. Reference</h2>
<h3 id="repository">Repository</h3>
<ul>
<li><strong>GitHub</strong>: <code>https://github.com/JindoKimKor/devops-jenkins-linux</code></li>
</ul>
<h3 id="related-documents">Related Documents</h3>
<ul>
<li><a href="../../problem-solving/solution-by-feature/">solution-by-feature.md</a> - Feature-by-feature breakdown</li>
<li><a href="../../problem-solving/logger-system-design-integration/">logger-system-design-integration.md</a> - Logger System design</li>
<li><a href="../../problem-solving/domain-driven-analysis/">domain-driven-analysis.md</a> - DDD pattern analysis</li>
</ul>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-groovy.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#363650',
        primaryTextColor: '#cdd6f4',
        primaryBorderColor: '#6c7bda',
        lineColor: '#a6adc8',
        secondaryColor: '#252536',
        tertiaryColor: '#1e1e2e',
        noteBkgColor: '#2a2a3d',
        noteTextColor: '#cdd6f4',
        actorBkg: '#2a2a3d',
        actorBorder: '#6c7bda',
        actorTextColor: '#cdd6f4',
        signalColor: '#cdd6f4',
        signalTextColor: '#cdd6f4',
        labelBoxBkgColor: '#252536',
        labelBoxBorderColor: '#363650',
        labelTextColor: '#cdd6f4',
        loopTextColor: '#cdd6f4',
        activationBorderColor: '#6c7bda',
        activationBkgColor: '#363650',
        sequenceNumberColor: '#1e1e2e'
      }
    });
  </script>
  
  <script src="../../js/nav.js"></script>
</body>
</html>