<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Hierarchical logging system design for consistent logging in Jenkins Pipeline">
  <meta name="author" content="Jindo Kim">
  <title>3-Level Logger System Design & Integration | Post-Refactoring Analysis</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
  <link rel="stylesheet" href="../../css/portfolio-theme.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
  <!-- Mobile hamburger -->
  <button class="nav-toggle" aria-label="Toggle navigation">
    <span></span><span></span><span></span>
  </button>

  <!-- Sidebar overlay (mobile) -->
  <div class="nav-overlay"></div>

  <!-- Sidebar navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="../../">Post-Refactoring Analysis</a>
    </div>
    <div class="sidebar-content">
      <ul class="nav-tree"><li class="nav-depth-1"><a href="../../" class="nav-link">Home</a></li><li class="nav-depth-1"><button class="nav-section-btn">Problem Analysis</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../problem-analysis/problem-analysis-overview/" class="nav-link">Problem Analysis Overview</a></li><li class="nav-depth-2"><a href="../../problem-analysis/detailed-analysis/" class="nav-link">Detailed Analysis</a></li><li class="nav-depth-2"><a href="../../problem-analysis/architecture-smells-analysis/" class="nav-link">Architecture Smells Analysis</a></li><li class="nav-depth-2"><a href="../../problem-analysis/DRY-violation-analysis/" class="nav-link">DRY Violation Analysis</a></li><li class="nav-depth-2"><button class="nav-section-btn">Pipeline Sequence Diagrams</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/domain-mapping/" class="nav-link">Domain Mapping</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/dlx-ci/" class="nav-link">DLXJenkins CI</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/dlx-cd/" class="nav-link">DLXJenkins CD</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/js-ci/" class="nav-link">JsJenkins CI</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/js-cd/" class="nav-link">JsJenkins CD</a></li><li class="nav-depth-3"><a href="../../problem-analysis/pipeline-sequence-diagrams/jenkins-ci/" class="nav-link">PipelineForJenkins CI</a></li></ul></li><li class="nav-depth-2"><button class="nav-section-btn">Per-File Analysis</button><ul class="nav-children"><li class="nav-depth-3"><button class="nav-section-btn">generalHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/01-generalHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/01-generalHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/01-generalHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">jsHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/02-jsHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/02-jsHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/02-jsHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">unityHelper</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/03-unityHelper/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/03-unityHelper/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/03-unityHelper/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/04-DLXJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/04-DLXJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/04-DLXJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">DLXJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/05-DLXJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/06-JsJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/06-JsJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/06-JsJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">JsJenkins-JenkinsfileDeployment</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/07-JsJenkins-JenkinsfileDeployment/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li><li class="nav-depth-3"><button class="nav-section-btn">PipelineForJenkins-Jenkinsfile</button><ul class="nav-children"><li class="nav-depth-4"><a href="../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/01-srp-violation-analysis/" class="nav-link">SRP Violation Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/02-software-smells-analysis/" class="nav-link">Software Smells Analysis</a></li><li class="nav-depth-4"><a href="../../problem-analysis/08-PipelineForJenkins-Jenkinsfile/03-design-smells-symptoms/" class="nav-link">Design Smells Analysis</a></li></ul></li></ul></li></ul></li><li class="nav-depth-1"><button class="nav-section-btn expanded">Problem Solving</button><ul class="nav-children"><li class="nav-depth-2"><a href="../../problem-solving/solution-overview/" class="nav-link">Solution Overview</a></li><li class="nav-depth-2"><a href="../../problem-solving/solution-by-layer/" class="nav-link">Solution by Layer</a></li><li class="nav-depth-2"><a href="../../problem-solving/solution-by-feature/" class="nav-link">Solution by Feature</a></li><li class="nav-depth-2"><a href="../../problem-solving/logger-system-design-integration/" class="nav-link active">Logger System Design and Integration</a></li><li class="nav-depth-2"><a href="../../problem-solving/domain-driven-analysis/" class="nav-link">Domain-Driven Analysis</a></li><li class="nav-depth-2"><a href="../../problem-solving/jenkins-cps-serialization-diagram/" class="nav-link">Jenkins CPS Serialization Diagram</a></li><li class="nav-depth-2"><a href="../../problem-solving/pull-request-documentation/" class="nav-link">Pull Request Documentation</a></li><li class="nav-depth-2"><button class="nav-section-btn">Implementation Phases</button><ul class="nav-children"><li class="nav-depth-3"><a href="../../problem-solving/phase-0-global-trusted-shared-library-setup/changelog/" class="nav-link">Phase 0 - Global Trusted Shared Library Setup</a></li><li class="nav-depth-3"><a href="../../problem-solving/phase-1-shellscript-modularization-and-initialization-stage/changelog/" class="nav-link">Phase 1 - Shell Script Modularization and Initialization Stage</a></li><li class="nav-depth-3"><a href="../../problem-solving/phase-2-3-level-logger-system-implementation/changelog/" class="nav-link">Phase 2 - 3-Level Logger System Implementation</a></li><li class="nav-depth-3"><a href="../../problem-solving/phase-3-bitbucket-api-and-shell-library-integration/changelog/" class="nav-link">Phase 3 - Bitbucket API and Shell Library Integration</a></li><li class="nav-depth-3"><a href="../../problem-solving/phase-4-full-pipeline-refactoring-and-stage-modularization/changelog/" class="nav-link">Phase 4 - Full Pipeline Refactoring and Stage Modularization</a></li></ul></li></ul></li></ul>
    </div>
  </nav>

  <!-- Main content -->
  <main class="content">
    <div class="container">
      <h1 id="3-level-logger-system-design-integration">3-Level Logger System Design &amp; Integration</h1>
<blockquote>
<p>Hierarchical logging system design for consistent logging in Jenkins Pipeline</p>
</blockquote>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#1-design-background">Design Background</a></li>
<li><a href="#11-problem-issues-with-existing-logging">Problem: Issues with Existing Logging</a><ul>
<li><a href="#111-problem-summary">Problem Summary</a></li>
<li><a href="#112-lack-of-consistency">Lack of Consistency</a></li>
<li><a href="#113-lack-of-structure-cognitive-chunking-impossible">Lack of Structure: Cognitive Chunking Impossible</a></li>
<li><a href="#114-jenkins-logging-system-limitations">Jenkins Logging System Limitations</a></li>
<li><a href="#115-code-duplication-dry-violation">Code Duplication (DRY Violation)</a></li>
</ul>
</li>
<li><a href="#12-solution-discovering-chunking-units-steps-group">Solution: Discovering Chunking Units (Steps Group)</a><ul>
<li><a href="#121-what-is-steps-group">What is Steps Group?</a></li>
<li><a href="#122-3-level-logger-design">3-Level Logger Design</a></li>
<li><a href="#123-design-result-logging-responsibility-distribution-by-layer">Design Result: Logging Responsibility Distribution by Layer</a></li>
</ul>
</li>
<li><a href="#2-architecture-integration">Architecture Integration</a></li>
<li><a href="#21-position-within-4-layer-architecture">Position within 4-Layer Architecture</a></li>
<li><a href="#22-library-helper-auto-logging-integration">Library-Helper Auto Logging Integration</a><ul>
<li><a href="#221-embedding-logging-metadata-in-library">Embedding Logging Metadata in Library</a></li>
<li><a href="#222-helper-auto-logging-with-metadata">Helper Auto Logging with Metadata</a></li>
</ul>
</li>
<li><a href="#23-integration-with-shellscripthelper">Integration with shellScriptHelper</a></li>
<li><a href="#3-beforeafter-comparison">Before/After Comparison</a></li>
</ul>
<hr />
<h2 id="1-design-background">1. Design Background</h2>
<h3 id="11-problem-issues-with-existing-logging">1.1 Problem: Issues with Existing Logging</h3>
<h4 id="111-problem-summary">1.1.1 Problem Summary</h4>
<table>
<thead>
<tr>
<th>#</th>
<th>Problem</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><strong>Lack of Consistency</strong></td>
<td>Different logging formats in each file</td>
</tr>
<tr>
<td>2</td>
<td><strong>Lack of Structure</strong></td>
<td>No cognitive chunking unit besides Stage</td>
</tr>
<tr>
<td>3</td>
<td><strong>Jenkins Output Constraints</strong></td>
<td>Format customization impossible due to CPS/Sandbox</td>
</tr>
<tr>
<td>4</td>
<td><strong>Code Duplication</strong></td>
<td><code>logMessage()</code> function copied across multiple files</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="112-lack-of-consistency">1.1.2 Lack of Consistency</h4>
<p>Different logging methods in each file:</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Logging Method</th>
<th>Problem</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>generalHelper.groovy</code></td>
<td><code>logMessage()</code> function</td>
<td>Self-implemented</td>
</tr>
<tr>
<td><code>jsHelper.groovy</code></td>
<td><code>logMessage()</code> function</td>
<td>Same copy as generalHelper (DRY violation)</td>
</tr>
<tr>
<td><code>Jenkinsfile</code></td>
<td>Direct <code>echo</code> call</td>
<td>No format</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="113-lack-of-structure-cognitive-chunking-impossible">1.1.3 Lack of Structure: Cognitive Chunking Impossible</h4>
<p><strong>Problem</strong>: In the entire Pipeline, except for <code>Stage</code>, <strong>there is no conceptual distinction useful for human recognition</strong></p>
<blockquote>
<p>In cognitive psychology, <strong>Chunking</strong> is a strategy for processing information by grouping it into meaningful units. The clearer the boundary, the faster and easier it is to receive information.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Current State</th>
<th>Problem</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stage â†’ (all logs listed flat)</td>
<td>Dozens of lines of logs without intermediate units</td>
</tr>
<tr>
<td>Individual Steps listed</td>
<td>Cannot distinguish logical task groups</td>
</tr>
<tr>
<td>When error occurs</td>
<td>Difficult to trace "where did the error occur?"</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="114-jenkins-logging-system-limitations">1.1.4 Jenkins Logging System Limitations</h4>
<h5 id="1141-same-echo-call-simultaneous-output-to-two-places">1.1.4.1 Same echo Call â†’ Simultaneous Output to Two Places</h5>
<table>
<thead>
<tr>
<th style="text-align: center;">Stage View (actual screenshot)</th>
<th style="text-align: center;">Console Output (example)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><img alt="Stage View - scattered echo" src="../../../resources/stage-logger-before.png" /></td>
<td style="text-align: center;"><img alt="Console Output" src="../../../resources/console-log-view-example.png" /></td>
</tr>
<tr>
<td style="text-align: center;">Log visible in Pipeline Stage UI</td>
<td style="text-align: center;">Same log example visible in Console Log</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Core Problem</strong>: A single <code>echo</code> call outputs to <strong>both</strong> Stage View and Console Output, and <strong>neither can customize the format</strong></p>
</blockquote>
<h5 id="1142-output-flow">1.1.4.2 Output Flow</h5>
<div class="mermaid">
flowchart LR
    subgraph Groovy["Pipeline Script"]
        ECHO["echo 'message'"]
        SH["sh 'command'"]
    end

    subgraph Jenkins["Jenkins Internal"]
        CPS["CPS Transform"]
        LOG["Console Logger"]
    end

    subgraph Output["Output (Fixed Format)"]
        STAGE["Stage View"]
        CONSOLE["Console Output"]
    end

    ECHO --> CPS
    SH --> CPS
    CPS --> LOG
    LOG --> STAGE
    LOG --> CONSOLE

    style CPS fill:#ff6b6b,stroke:#333
    style LOG fill:#ff6b6b,stroke:#333
</div>

<h5 id="1143-constraints">1.1.4.3 Constraints</h5>
<table>
<thead>
<tr>
<th>Constraint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fixed format</td>
<td>Timestamp + <code>[Pipeline]</code> marker + message mixed</td>
</tr>
<tr>
<td>Flat structure</td>
<td>All <code>echo</code>, <code>sh</code> commands listed at the same level</td>
</tr>
<tr>
<td>No customization</td>
<td>Jenkins Content Security Policy enforces UI output format</td>
</tr>
<tr>
<td>No hierarchy</td>
<td>Difficult to find specific tasks in long logs</td>
</tr>
</tbody>
</table>
<h5 id="1144-jenkins-content-security-policy-constraints-reference">1.1.4.4 Jenkins Content Security Policy Constraints (Reference)</h5>
<p>Jenkins applies a <strong>restrictive Content Security Policy</strong> by default to prevent XSS attacks:</p>
<blockquote>
<p>Do not use inline JavaScript (JS) in the Jenkins GUI, i.e., JS embedded in HTML output.</p>
<p>â€” <a href="https://www.jenkins.io/doc/developer/security/csp/">Jenkins Developer: Content-Security-Policy Compatibility</a></p>
</blockquote>
<ul>
<li>Default CSP: <code>default-src 'none'</code> - blocks scripts, fonts, iframes, etc.</li>
<li>Cannot customize Console Output UI (requires system property modification with admin privileges)</li>
<li><code>echo</code> and <code>println</code> are processed identically internally by Jenkins (<a href="https://groups.google.com/g/jenkinsci-users/c/Bing10GEyhs">reference</a>)</li>
</ul>
<hr />
<h4 id="115-code-duplication-dry-violation">1.1.5 Code Duplication (DRY Violation)</h4>
<pre><code class="language-groovy">// generalHelper.groovy line 35-44
void logMessage(String message) { ... }

// jsHelper.groovy line 7-16 (exact same copy)
void logMessage(String message) { ... }
</code></pre>
<hr />
<h3 id="12-solution-discovering-chunking-units-steps-group">1.2 Solution: Discovering Chunking Units (Steps Group)</h3>
<h4 id="121-what-is-steps-group">1.2.1 What is Steps Group?</h4>
<p>A group where multiple Steps come together to form a <strong>meaningful unit of work</strong> (Task).</p>
<pre><code>Stage: Jenkins Initialization
â”‚
â”œâ”€â”€ Steps Group: &quot;Set Up Environment Variables&quot;  â† Meaningful unit of work
â”‚   â”œâ”€â”€ Step: Configure Report Directory
â”‚   â”œâ”€â”€ Step: Extract ticket number
â”‚   â””â”€â”€ Step: Set build parameters
â”‚
â””â”€â”€ Steps Group: &quot;Send Build Status&quot;             â† Meaningful unit of work
    â”œâ”€â”€ Step: Prepare API request
    â””â”€â”€ Step: POST to Bitbucket API
</code></pre>
<h4 id="122-3-level-logger-design">1.2.2 3-Level Logger Design</h4>
<p><strong>Jenkins Provides vs What's Needed:</strong></p>
<table>
<thead>
<tr>
<th>Jenkins Default</th>
<th>Actually Needed</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stage Level: <code>stage('name') { ... }</code></td>
<td>Stage Level</td>
</tr>
<tr>
<td>(None)</td>
<td><strong>Steps Group Level</strong> â† Newly introduced</td>
</tr>
<tr>
<td>Step Level: <code>sh</code>, <code>echo</code>, <code>withCredentials</code>, etc.</td>
<td>Step Level</td>
</tr>
</tbody>
</table>
<p><strong>Conclusion</strong>: <strong>Steps Group</strong> level is needed between Stage and Step</p>
<p><strong>3-Level Structure:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1: Stage                                              â”‚
â”‚ ===== STAGE Starting: [ Jenkins Initialization ] =====      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Level 2: Steps Group                                        â”‚
â”‚ --- STEPS Starting Group: [ Set Up Environment ] ---        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Level 3: Step (by status)                                   â”‚
â”‚ â¡ï¸ Step Starting: [ Configure Report Directory ]...         â”‚
â”‚ ğŸ’¬ Step Info: [ REPORT_DIR: /workspace/PRJob ]              â”‚
â”‚ ğŸƒ Step Processing: [ Fetching origin branches ]            â”‚
â”‚ âœ… Step Completed: [ Configure Report Directory ]           â”‚
â”‚ âš ï¸ Step Warning: [ Branch not found, using default ]        â”‚
â”‚ âŒ Step Failed: [ Git fetch failed ]                        â”‚
â”‚ ğŸ”¥ Step Error: [ Exception occurred ]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Step Status Classification:</strong></p>
<table>
<thead>
<tr>
<th>Status</th>
<th>Emoji</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Starting</td>
<td>â¡ï¸</td>
<td>Task start notification</td>
</tr>
<tr>
<td>Info</td>
<td>ğŸ’¬</td>
<td>Informational message (variable values, settings, etc.)</td>
</tr>
<tr>
<td>Processing</td>
<td>ğŸƒ</td>
<td>Task in progress</td>
</tr>
<tr>
<td>Success</td>
<td>âœ…</td>
<td>Task completed successfully</td>
</tr>
<tr>
<td>Warning</td>
<td>âš ï¸</td>
<td>Warning (can continue)</td>
</tr>
<tr>
<td>Failed</td>
<td>âŒ</td>
<td>Task failed (recoverable)</td>
</tr>
<tr>
<td>Error</td>
<td>ğŸ”¥</td>
<td>Serious error (pipeline stops)</td>
</tr>
</tbody>
</table>
<p><strong>Logger API:</strong></p>
<pre><code class="language-groovy">// Level 1: Stage
logger.stageStart(stageName)
logger.stageEnd(stageName)

// Level 2: Steps Group
logger.stepsGroupStart(groupName)
logger.stepsGroupEnd(groupName)

// Level 3: Step (by status)
logger.stepStart(description)
logger.stepInfo(description)
logger.stepProcessing(description)
logger.stepSuccess(description)
logger.stepWarning(description)
logger.stepFailed(description)
logger.stepError(description)
logger.stepError(description, Throwable)  // Including stack trace
</code></pre>
<h4 id="123-design-result-logging-responsibility-distribution-by-layer">1.2.3 Design Result: Logging Responsibility Distribution by Layer</h4>
<p>Introduced a <strong>3-Level chunking-based logging system</strong> to the Pipeline domain and integrated with the existing 4-Layer Architecture to implement a systematic solution where <strong>each layer only handles logging responsibility appropriate to its role</strong>.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Role</th>
<th>Logging Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Logger</strong></td>
<td>3-Level chunking system (Stage/Steps Group/Step)</td>
<td>Output format, hierarchy structure definition</td>
</tr>
<tr>
<td><strong>Library</strong></td>
<td>Cognitive classification unit for specific functions within domain</td>
<td>Define <code>label</code> appropriate for that function</td>
</tr>
<tr>
<td><strong>Helper</strong></td>
<td>Domain logic orchestration</td>
<td>Call logger according to orchestration flow</td>
</tr>
<tr>
<td><strong>Stage</strong></td>
<td>Business workflow</td>
<td>Define Steps Group boundaries</td>
</tr>
</tbody>
</table>
<blockquote>
<p>See <a href="#2-architecture-integration">Section 2: Architecture Integration</a> for detailed implementation</p>
</blockquote>
<hr />
<h2 id="2-architecture-integration">2. Architecture Integration</h2>
<h3 id="21-position-within-4-layer-architecture">2.1 Position within 4-Layer Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Entry Point (Jenkinsfile)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 2: Orchestration (vars/stage*.groovy)                 â”‚
â”‚          â†“ uses                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 3: Business Logic (src/service/)                      â”‚
â”‚          â†“ uses                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 4: Infrastructure                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ src/utils/      â”‚ src/resource/   â”‚ vars/ (Cross)   â”‚   â”‚
â”‚  â”‚ *Library.groovy â”‚ Status.groovy   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚ â”‚ logger      â”‚ â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚ â”‚ bitbucket   â”‚ â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚ â”‚ ApiLibrary  â”‚ â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Logger's Position</strong>: Layer 4 (Infrastructure) - Cross-Cutting Concerns</p>
<hr />
<h3 id="22-library-helper-auto-logging-integration">2.2 Library-Helper Auto Logging Integration</h3>
<p>Logger is used system-wide as a <strong>Cross-Cutting Concern</strong>:
- Used by all Stage modules
- shellScriptHelper, bitbucketApiHelper internally use logger (auto logging)
- Single entry point for unified logging format</p>
<h4 id="221-embedding-logging-metadata-in-library">2.2.1 Embedding Logging Metadata in Library</h4>
<h5 id="a-shell-script-logging-integration">(a) Shell Script Logging Integration</h5>
<div class="mermaid">
flowchart LR
    subgraph Libraries["Shell Libraries"]
        GIT[GitLibrary]
        SHL[ShellLibrary]
        SSHL[SSHShellLibrary]
    end

    subgraph Helper["shellScriptHelper"]
        VALIDATE[validateShMap]
        EXEC[execute]
    end

    subgraph Logger["logger"]
        START[stepStart]
        SUCCESS[stepSuccess]
        FAILED[stepFailed]
        RESULT[stepShellExecutedResult]
    end

    GIT -->|"{script, label}"| VALIDATE
    SHL -->|"{script, label}"| VALIDATE
    SSHL -->|"{script, label}"| VALIDATE

    VALIDATE --> START
    VALIDATE --> EXEC
    EXEC -->|success| SUCCESS
    EXEC -->|failure| FAILED
    EXEC -->|result| RESULT
</div>

<p><strong>Core Design</strong>: Each Library's closure includes <code>label</code> metadata for Helper to auto-log</p>
<pre><code class="language-groovy">// GitLibrary.groovy - Each closure includes script + label
static final Closure FetchOriginReturnStatus = {
    [
        script: 'git fetch origin',
        label: 'Fetch all remote branches from origin',  // â† Logging metadata
        returnStatus: true
    ]
}

static final Closure CheckoutBranch = { String branchName -&gt;
    [
        script: &quot;git checkout ${branchName}&quot;,
        label: &quot;Checkout branch '${branchName}'&quot;,  // â† Parameterized label
        returnStdout: true
    ]
}
</code></pre>
<h5 id="b-bitbucket-api-logging-integration">(b) Bitbucket API Logging Integration</h5>
<div class="mermaid">
flowchart LR
    subgraph Library["bitbucketApiLibrary"]
        BUILD[createBuildStatus]
        REPORT[createTestReport]
    end

    subgraph Helper["bitbucketApiHelper"]
        CALL[call]
        HTTP[HttpApiService]
    end

    subgraph Logger["logger"]
        START[stepStart]
        SUCCESS[stepSuccess]
        ERROR[stepError]
    end

    BUILD -->|"{apiUrl, body, method}"| CALL
    REPORT -->|"{apiUrl, body, method}"| CALL

    CALL --> START
    CALL --> HTTP
    HTTP -->|success| SUCCESS
    HTTP -->|failure| ERROR
</div>

<h5 id="same-pattern-applied">Same Pattern Applied</h5>
<table>
<thead>
<tr>
<th>Library</th>
<th>Metadata</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>GitLibrary</td>
<td><code>script</code>, <code>label</code></td>
<td>Shell command + log message</td>
</tr>
<tr>
<td>ShellLibrary</td>
<td><code>script</code>, <code>label</code></td>
<td>Shell command + log message</td>
</tr>
<tr>
<td>SSHShellLibrary</td>
<td><code>script</code>, <code>label</code></td>
<td>SSH command + log message</td>
</tr>
<tr>
<td>bitbucketApiLibrary</td>
<td><code>apiUrlString</code>, <code>requestBody</code>, <code>method</code></td>
<td>API request info</td>
</tr>
</tbody>
</table>
<h4 id="222-helper-auto-logging-with-metadata">2.2.2 Helper Auto Logging with Metadata</h4>
<p><strong>shellScriptHelper</strong>: Reads <code>label</code> from Library and automatically calls logger</p>
<pre><code class="language-groovy">// shellScriptHelper.groovy
def call(Closure shellScriptClosure, List args = []) {
    Map shMap = shellScriptClosure(*args)
    Map validatedShMap = validateShMap(shMap)

    // Read label for auto logging
    logger.stepStart(&quot;'${validatedShMap.script}' '${validatedShMap.label}' (Execute)&quot;)

    if (validatedShMap.returnStatus) {
        return executeReturnStatus(validatedShMap)  // Success/failure logging inside
    } else if (validatedShMap.returnStdout) {
        return executeReturnStdout(validatedShMap)  // Result logging inside
    }
    // ...
}
</code></pre>
<p><strong>bitbucketApiHelper</strong>: Same pattern for API execution + auto logging</p>
<pre><code class="language-groovy">// bitbucketApiHelper.groovy
def call(Map bitbucketApiMap) {
    logger.stepStart(&quot;bitbucketApiHelper execution started&quot;)

    // Execute API with Map received from bitbucketApiLibrary
    if (bitbucketApiMap.method == 'POST') {
        return bitbucketApiService.post(
            bitbucketApiMap.apiUrlString,
            bitbucketApiMap.requestBody,
            bitbucketAccessToken
        )
    }

    logger.stepSuccess(&quot;bitbucketApiHelper execution completed&quot;)
}
</code></pre>
<hr />
<h3 id="23-integration-with-shellscripthelper">2.3 Integration with shellScriptHelper</h3>
<p>shellScriptHelper uses logger internally for auto logging:</p>
<div class="mermaid">
sequenceDiagram
    participant Stage as stageProjectPrepare
    participant SSH as shellScriptHelper
    participant LOG as logger
    participant SH as Jenkins sh()

    Stage->>SSH: execute(GitLibrary.FetchOrigin)
    SSH->>LOG: stepStart("Fetching origin")
    SSH->>SH: sh("git fetch origin")
    SH-->>SSH: result
    alt Success
        SSH->>LOG: stepSuccess("Origin fetched")
    else Failure
        SSH->>LOG: stepFailed("Fetch failed")
    end
    SSH-->>Stage: result
</div>

<p><strong>Integration Benefits:</strong>
- No need to write logging code every time in Stage module
- Auto start/success/failure logging when executing Shell commands
- Consistent format guaranteed</p>
<hr />
<h2 id="3-beforeafter-comparison">3. Before/After Comparison</h2>
<h3 id="stage-log-blue-ocean-ui">Stage Log (Blue Ocean UI)</h3>
<table>
<thead>
<tr>
<th>Before</th>
<th>After</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="Before - scattered echo" src="../../../resources/stage-logger-before.png" /></td>
<td><img alt="After - 3-Level logging" src="../../../resources/stage-logger-after.png" /></td>
</tr>
</tbody>
</table>
<hr />
<h3 id="console-log">Console Log</h3>
<blockquote>
<p><strong>Note</strong>: Console screenshot could not be captured, substituting with text.</p>
</blockquote>
<h4 id="before-scattered-echo">Before (scattered echo)</h4>
<pre><code>[Pipeline] echo
2025-03-20T10:23:45.123Z Fetching origin...
[Pipeline] sh
2025-03-20T10:23:45.456Z + git fetch origin
[Pipeline] echo
2025-03-20T10:23:46.789Z REPORT_DIR: /workspace/PRJob/feature-branch
[Pipeline] echo
2025-03-20T10:23:47.012Z Sending build status to Bitbucket
</code></pre>
<p><strong>Problems</strong>: All messages at same level, no structure, difficult to trace errors</p>
<h4 id="after-3-level-logger">After (3-Level Logger)</h4>
<pre><code>===== STAGE Starting: [ Jenkins Initialization ] =====
--- STEPS Starting Group: [ Set Up Environment Variables ] ---
â¡ï¸ Step Starting: [ Configure Report Directory ]...
ğŸ’¬ Step Info: [ REPORT_DIR: /workspace/PRJob/feature-branch ]
âœ… Step Completed: [ Configure Report Directory ]
--- STEPS Completed Group: [ Set Up Environment Variables ] ---
===== STAGE Completed: [ Jenkins Initialization ] =====
</code></pre>
<hr />
<h3 id="change-summary">Change Summary</h3>
<table>
<thead>
<tr>
<th>Item</th>
<th>Before</th>
<th>After</th>
</tr>
</thead>
<tbody>
<tr>
<td>Logging function location</td>
<td>generalHelper, jsHelper (copied)</td>
<td>logger.groovy (single)</td>
</tr>
<tr>
<td>Format consistency</td>
<td>None</td>
<td>100%</td>
</tr>
<tr>
<td>Error traceability</td>
<td>Difficult</td>
<td>Immediate identification</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="reference">Reference</h2>
<ul>
<li><a href="../../problem-solving/phase-2-3-level-logger-system-implementation/changelog/">Phase 2 Changelog</a> - Detailed implementation process record</li>
<li><a href="highlights.md">highlights.md</a> - Logger System Integration section</li>
<li><a href="refactoring-result-snapshot.md">refactoring-result-snapshot.md</a> - Facade Pattern explanation</li>
</ul>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-groovy.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#363650',
        primaryTextColor: '#cdd6f4',
        primaryBorderColor: '#6c7bda',
        lineColor: '#a6adc8',
        secondaryColor: '#252536',
        tertiaryColor: '#1e1e2e',
        noteBkgColor: '#2a2a3d',
        noteTextColor: '#cdd6f4',
        actorBkg: '#2a2a3d',
        actorBorder: '#6c7bda',
        actorTextColor: '#cdd6f4',
        signalColor: '#cdd6f4',
        signalTextColor: '#cdd6f4',
        labelBoxBkgColor: '#252536',
        labelBoxBorderColor: '#363650',
        labelTextColor: '#cdd6f4',
        loopTextColor: '#cdd6f4',
        activationBorderColor: '#6c7bda',
        activationBkgColor: '#363650',
        sequenceNumberColor: '#1e1e2e'
      }
    });
  </script>
  
  <script src="../../js/nav.js"></script>
</body>
</html>