{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Software Smells Analysis &amp; Architecture Redesign","text":"<p>Context: 14-month technical debt resolution at VARLab</p> <p>Analysis: SRP/DRY Violation &amp; Code, Design (Symptoms/Principles), Architecture Smells</p> <p>Solution: 4-Layer Architecture, 3-Level Logger System</p> <p>Keywords: Jenkins, Groovy, Design Patterns (Command/Facade/Builder/Strategy)</p>"},{"location":"#purpose","title":"Purpose","text":"<p>This portfolio is a post-refactoring analysis of intuitive problem-solving done during VARLab Co-op.</p> What I Did What This Document Does Refactored 5 monolithic pipelines into 4-Layer Architecture Classify and define those intuitive fixes using industry conventions Designed 3-Level Logger System Analyze why the design worked and how it integrates with the architecture <p>Goal: Transform experience-based understanding into systematic, reusable knowledge</p> <ul> <li>Learn how problems I \"felt\" are formally named (Software Smells, Anti-patterns)</li> <li>Validate solutions against established principles (SOLID, Design Patterns)</li> <li>Understand integration points that made the Logger System possible</li> </ul>"},{"location":"#quick-navigation","title":"Quick Navigation","text":"Part Question Document Content Part 1 What? highlights.md Final Architecture, Key Features, Testability Part 2 Why? problem-analysis-overview.md Problems, Analysis Results Part 3 How? legs/README.md Step-by-step Implementation"},{"location":"#project-overview","title":"Project Overview","text":""},{"location":"#background","title":"Background","text":"<ul> <li>14 months of accumulated Technical Debt</li> <li>5 monolithic pipelines (37% duplication, untestable)</li> <li>Discovered Jenkins Global Trusted Shared Library feature at month 13</li> <li>Performed refactoring over 54 days (Library setup 35 days, Core refactoring ~2 weeks)</li> </ul>"},{"location":"#timeline","title":"Timeline","text":"Milestone Date Commit Repository Initial commit (Windows) 2023-12-17 <code>e9d8028</code> devops-jenkins-windows Migration to Linux 2025-01-07 <code>5a59d45</code> devops-jenkins-linux Baseline (Before refactoring) 2025-03-20 <code>74fc356</code> devops-jenkins-linux Technical Debt Period ~14 months Refactoring complete 2025-05-12 <code>ff74ac8</code> devops-jenkins-linux <p>Repository started in Windows environment and migrated to Linux. Initial commit (2023-12-17) \u2192 Baseline (2025-03-20) = ~14 months of accumulated Technical Debt</p>"},{"location":"#document-structure-details","title":"Document Structure Details","text":""},{"location":"#part-1-what-final-results","title":"Part 1: What - Final Results","text":"Document Content Volume highlights.md 4-Layer Architecture, Logger, Shell Libraries, Testability Core pull-request-documentation.pdf Documentation attached to Pull Request Detailed"},{"location":"#part-2-why-problem-analysis","title":"Part 2: Why - Problem Analysis","text":"Document Content Volume problem-analysis-overview.md Problem Summary Core problem-analysis/detailed-analysis.md Software Smells Analysis by File In-depth problem-analysis/baseline-technical-snapshot.md Baseline Code Statistics, File Structure (commit <code>54479b2</code>) Detailed"},{"location":"#part-3-how-implementation-process","title":"Part 3: How - Implementation Process","text":"Document Content Volume legs/README.md 5-stage Leg Overview Core legs/leg-0~4/changelog.md Detailed Records by Commit Detailed legs/refactoring-result-snapshot.md Architecture Details, Design Patterns (commit <code>12910c1</code>) Detailed logger-system-design-integration.md 3-Level Logger Design (Problem Analysis \u2192 Solution \u2192 Implementation) Detailed"},{"location":"#document-structure","title":"Document Structure","text":"<pre><code>4-layer-architecture-and-logger-system-integration/\n\u2502\n\u251c\u2500\u2500 README.md                    # \u2190 This document (entry point)\n\u2502\n\u251c\u2500\u2500 Part 1: What (Results)\n\u2502   \u251c\u2500\u2500 highlights.md            # Final architecture highlights\n\u2502   \u251c\u2500\u2500 logger-system-design-integration.md  # Logger design document\n\u2502   \u2514\u2500\u2500 pull-request-documentation.pdf   # Pull Request attachment\n\u2502\n\u251c\u2500\u2500 Part 2: Why (Problems)\n\u2502   \u251c\u2500\u2500 problem-analysis-overview.md  # Problem summary\n\u2502   \u2514\u2500\u2500 problem-analysis/        # Detailed analysis\n\u2502       \u251c\u2500\u2500 detailed-analysis.md      # Analysis methodology, results summary\n\u2502       \u251c\u2500\u2500 baseline-technical-snapshot.md  # Code statistics/file structure\n\u2502       \u251c\u2500\u2500 DRY-violation-analysis.md       # System-wide DRY violation analysis\n\u2502       \u2502\n\u2502       \u251c\u2500\u2500 01-generalHelper/               # Per-file analysis\n\u2502       \u2502   \u251c\u2500\u2500 srp-violation-analysis.md\n\u2502       \u2502   \u251c\u2500\u2500 software-smells-analysis.md\n\u2502       \u2502   \u2514\u2500\u2500 design-smells-symptoms.md\n\u2502       \u251c\u2500\u2500 02-jsHelper/\n\u2502       \u251c\u2500\u2500 03-unityHelper/\n\u2502       \u251c\u2500\u2500 04-DLXJenkins-Jenkinsfile/\n\u2502       \u251c\u2500\u2500 ...                             # (05~08 same structure)\n\u2502       \u2502\n\u2502       \u251c\u2500\u2500 pipeline-sequence-diagrams/\n\u2502       \u2502\n\u2502       \u2514\u2500\u2500 reference/                      # Smells Taxonomy reference documents\n\u2502           \u251c\u2500\u2500 01-code-smells-taxonomy.md\n\u2502           \u251c\u2500\u2500 02a-design-smells-symptoms.md\n\u2502           \u251c\u2500\u2500 02b-design-smells-principles.md\n\u2502           \u251c\u2500\u2500 03-architecture-smells-taxonomy.md\n\u2502           \u2514\u2500\u2500 ...\n\u2502\n\u251c\u2500\u2500 Part 3: How (Process)\n\u2502   \u2514\u2500\u2500 legs/                    # Step-by-step implementation\n\u2502       \u251c\u2500\u2500 README.md\n\u2502       \u251c\u2500\u2500 refactoring-result-snapshot.md  # Architecture/patterns detailed\n\u2502       \u251c\u2500\u2500 leg-0-global-trusted-shared-library-setup/\n\u2502       \u251c\u2500\u2500 leg-1-shellscript-modularization-and-initialization-stage/\n\u2502       \u251c\u2500\u2500 leg-2-3-level-logger-system-implementation/\n\u2502       \u251c\u2500\u2500 leg-3-bitbucket-api-and-shell-library-integration/\n\u2502       \u2514\u2500\u2500 leg-4-full-pipeline-refactoring-and-stage-modularization/\n\u2502\n\u2514\u2500\u2500 resources/                   # Images\n    \u251c\u2500\u2500 stage-logger-before.png\n    \u2514\u2500\u2500 stage-logger-after.png\n</code></pre>"},{"location":"#tech-stack","title":"Tech Stack","text":"<ul> <li>Jenkins Pipeline (Declarative/Scripted)</li> <li>Groovy</li> <li>Jenkins Global Trusted Shared Library</li> <li>Bitbucket API</li> <li>SonarQube</li> </ul>"},{"location":"#reference","title":"Reference","text":"<ul> <li>Jenkins Shared Libraries Documentation</li> </ul>"},{"location":"highlights/","title":"Domain-Driven 4-Layer Architecture &amp; Logger System Integration","text":""},{"location":"highlights/#reference-commits","title":"Reference Commits","text":"State Commit Hash Date Baseline (Before) <code>74fc356</code> 2025-03-20 Final (After) <code>ff74ac8</code> 2025-05-12"},{"location":"highlights/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Achievement Summary</li> <li>4-Layer Architecture<ol> <li>Structure Visualization</li> <li>Layer Responsibilities</li> <li>Before/After Comparison<ol> <li>Folder Structure</li> <li>Dependency Flow</li> </ol> </li> </ol> </li> <li>Logger System Integration<ol> <li>3-Level Structure</li> <li>Execution Flow</li> <li>Before/After Comparison<ol> <li>Stage Log Output Comparison</li> <li>Console Log Output Comparison</li> </ol> </li> <li>Design Decisions<ol> <li>Jenkins Platform Constraints</li> <li>Design Decisions</li> </ol> </li> </ol> </li> <li>Key Changes in Detail<ol> <li>Bitbucket API Migration<ol> <li>Folder Structure Comparison</li> <li>Before</li> <li>After</li> <li>Design Decisions</li> </ol> </li> <li>Shell Script Libraries<ol> <li>File Structure</li> <li>Closure Pattern Structure</li> <li>Before</li> <li>After</li> <li>Closure List by Library</li> <li>Closure Map Schema</li> <li>Design Decisions</li> </ol> </li> <li>Stage Modularization<ol> <li>Folder Structure Comparison (Linting Stage Example)</li> <li>Linting Stage Example</li> <li>Complete Stage Modularization Design</li> </ol> </li> <li>Testability<ol> <li>Before: Helper + Python Script Structure</li> <li>After: Library + Service Separation</li> <li>Test Code Examples</li> <li>Before vs After: API Testability Comparison</li> </ol> </li> </ol> </li> <li>Reference</li> </ol>"},{"location":"highlights/#1-achievement-summary","title":"1. Achievement Summary","text":"<ul> <li>4-Layer Architecture: Refactored monolithic pipelines (5 Jenkinsfiles, 37% duplication) into a layered structure, achieving reusability and testability.</li> <li>Logger System Integration: Unified scattered <code>echo</code> calls into a 3-Level hierarchical logging system (Cross-Cutting Infrastructure), establishing a pipeline-wide standard interface.</li> </ul>"},{"location":"highlights/#2-4-layer-architecture","title":"2. 4-Layer Architecture","text":""},{"location":"highlights/#21-structure-visualization","title":"2.1 Structure Visualization","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Layer 1: Entry Point (Jenkinsfiles)                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  DLXJenkins/Jenkinsfile              JsJenkins/Jenkinsfile                  \u2502\n\u2502  DLXJenkins/JenkinsfileDeployment    JsJenkins/JenkinsfileDeployment        \u2502\n\u2502  PipelineForJenkins/Jenkinsfile                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Layer 2: Orchestration (vars/)                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Stage Modules (9)                         Helpers                          \u2502\n\u2502  \u251c\u2500\u2500 stageInitialization.groovy             \u251c\u2500\u2500 shellScriptHelper.groovy    \u2502\n\u2502  \u251c\u2500\u2500 stageProjectPrepare.groovy             \u2514\u2500\u2500 bitbucketApiHelper.groovy   \u2502\n\u2502  \u251c\u2500\u2500 stageLintUnity.groovy                                                  \u2502\n\u2502  \u251c\u2500\u2500 stageLintGroovyJenkinsfile.groovy                                      \u2502\n\u2502  \u251c\u2500\u2500 stageStaticAnalysis.groovy                                             \u2502\n\u2502  \u251c\u2500\u2500 stageUnityExecution.groovy                                             \u2502\n\u2502  \u251c\u2500\u2500 stageDeployBuild.groovy                                                \u2502\n\u2502  \u251c\u2500\u2500 stageCleanupPRBranchArtifacts.groovy                                   \u2502\n\u2502  \u2514\u2500\u2500 stageSendBuildResults.groovy                                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Layer 3: Services (src/service/)                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  BitbucketApiService.groovy                                                 \u2502\n\u2502  BuildProjectService.groovy                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Layer 4: Utilities (src/utils/ + src/resource/)        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Libraries (src/utils/)                     Constants (src/resource/)       \u2502\n\u2502  \u251c\u2500\u2500 GitLibrary.groovy (18 Closures)        \u2514\u2500\u2500 Status.groovy               \u2502\n\u2502  \u251c\u2500\u2500 ShellLibrary.groovy (13 Closures)          (COMMIT_STATUS,             \u2502\n\u2502  \u2514\u2500\u2500 SSHShellLibrary.groovy (8 Closures)         BUILD_STATUS,              \u2502\n\u2502                                                  STAGE_STATUS)              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502  Cross-Cutting Concerns (vars/ - physical location, CPS constraint)         \u2502\n\u2502  \u251c\u2500\u2500 logger.groovy - 3-Level logging infrastructure                         \u2502\n\u2502  \u2514\u2500\u2500 bitbucketApiLibrary.groovy - API Closure Library                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"highlights/#22-layer-responsibilities","title":"2.2 Layer Responsibilities","text":"Layer Location Responsibility Files Layer 1 Each project folder Pipeline Entry Point Jenkinsfile (5) Layer 2 vars/ Stage orchestration stage*.groovy, helpers Layer 3 src/service/ Business logic *Service.groovy Layer 4 src/utils/, src/resource/, vars/ Utilities, constants, Cross-Cutting *Library.groovy, Status.groovy, logger, bitbucketApiLibrary <p>CPS Constraint: Jenkins Pipeline applies Continuation-Passing Style (CPS) transformation. Classes in <code>src/</code> folder cannot use certain Groovy features without <code>@NonCPS</code>, so <code>logger</code> and <code>bitbucketApiLibrary</code> are placed in <code>vars/</code> (classified as Cross-Cutting Concerns).</p>"},{"location":"highlights/#23-beforeafter-comparison","title":"2.3 Before/After Comparison","text":""},{"location":"highlights/#231-folder-structure","title":"2.3.1 Folder Structure","text":"<pre><code>Before (74fc356)                          After (ff74ac8)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                         \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndevops-jenkins-linux/                     devops-jenkins-linux/\n\u251c\u2500\u2500 DLXJenkins/                           \u251c\u2500\u2500 DLXJenkins/\n\u2502   \u2514\u2500\u2500 Jenkinsfile                       \u2502   \u2514\u2500\u2500 Jenkinsfile\n\u251c\u2500\u2500 JsJenkins/                            \u251c\u2500\u2500 JsJenkins/\n\u2502   \u2514\u2500\u2500 Jenkinsfile                       \u2502   \u2514\u2500\u2500 Jenkinsfile\n\u251c\u2500\u2500 groovy/                               \u2514\u2500\u2500 sharedLibraries/\n\u2502   \u251c\u2500\u2500 generalHelper.groovy                  \u251c\u2500\u2500 vars/ (13 files)\n\u2502   \u2514\u2500\u2500 unityHelper.groovy                    \u2514\u2500\u2500 src/ (7 files)\n\u2514\u2500\u2500 python/\n    \u2514\u2500\u2500 *.py (9 files)\n</code></pre>"},{"location":"highlights/#232-dependency-flow","title":"2.3.2 Dependency Flow","text":"<pre><code>flowchart TD\n    subgraph L1[\"Layer 1: Entry Point\"]\n        JF[\"Jenkinsfiles (5)\"]\n    end\n\n    subgraph L2[\"Layer 2: Orchestration\"]\n        direction LR\n        STAGE[\"stage*.groovy (9)\"]\n        SSH[\"shellScriptHelper\"]\n        BAH[\"bitbucketApiHelper\"]\n    end\n\n    subgraph L3[\"Layer 3: Services\"]\n        direction LR\n        BAS[\"BitbucketApiService\"]\n        BPS[\"BuildProjectService\"]\n    end\n\n    subgraph L4[\"Layer 4: Utilities\"]\n        direction LR\n        subgraph L4_LIB[\"Libraries\"]\n            GIT[\"GitLibrary\"]\n            SHL[\"ShellLibrary\"]\n            SSHL[\"SSHShellLibrary\"]\n        end\n        STS[\"Status\"]\n        subgraph L4_CC[\"Cross-Cutting\"]\n            LOG[\"logger\"]\n            BAL[\"bitbucketApiLibrary\"]\n        end\n    end\n\n    JF --&gt; STAGE\n    STAGE --&gt; SSH\n    STAGE --&gt; BAH\n    STAGE --&gt; BPS\n    STAGE -.-&gt; LOG\n    SSH --&gt; GIT\n    SSH --&gt; SHL\n    SSH --&gt; SSHL\n    SSH -.-&gt; LOG\n    BAH --&gt; BAL\n    BAH --&gt; BAS\n    BAS --&gt; STS\n    STAGE --&gt; STS</code></pre>"},{"location":"highlights/#3-logger-system-integration","title":"3. Logger System Integration","text":""},{"location":"highlights/#31-3-level-structure","title":"3.1 3-Level Structure","text":"<pre><code>sharedLibraries/\n\u2514\u2500\u2500 vars/\n    \u2514\u2500\u2500 logger.groovy (63 lines)\n        \u2502\n        \u251c\u2500\u2500 Stage Level\n        \u2502   \u251c\u2500\u2500 stageStart(name)\n        \u2502   \u2514\u2500\u2500 stageEnd(name)\n        \u2502\n        \u251c\u2500\u2500 Steps Group Level\n        \u2502   \u251c\u2500\u2500 stepsGroupStart(name)\n        \u2502   \u2514\u2500\u2500 stepsGroupEnd(name)\n        \u2502\n        \u2514\u2500\u2500 Step Level\n            \u251c\u2500\u2500 stepStart(desc)\n            \u251c\u2500\u2500 stepInfo(desc)\n            \u251c\u2500\u2500 stepProcessing(desc)\n            \u251c\u2500\u2500 stepSuccess(desc)\n            \u251c\u2500\u2500 stepWarning(desc)\n            \u251c\u2500\u2500 stepFailed(desc)\n            \u251c\u2500\u2500 stepError(desc)\n            \u2514\u2500\u2500 stepShellExecutedResult(desc)\n</code></pre>"},{"location":"highlights/#logger-function-list","title":"Logger Function List","text":"Level Function Purpose Stage <code>stageStart(name)</code> Mark stage start Stage <code>stageEnd(name)</code> Mark stage completion Steps Group <code>stepsGroupStart(name)</code> Mark task group start Steps Group <code>stepsGroupEnd(name)</code> Mark task group completion Step <code>stepStart(desc)</code> Individual task start Step <code>stepInfo(desc)</code> Information output Step <code>stepProcessing(desc)</code> In-progress status Step <code>stepSuccess(desc)</code> Successful completion Step <code>stepWarning(desc)</code> Warning Step <code>stepFailed(desc)</code> Failure Step <code>stepError(desc)</code> Error (pipeline abort) Step <code>stepShellExecutedResult(desc)</code> Shell execution result"},{"location":"highlights/#32-execution-flow","title":"3.2 Execution Flow","text":"<pre><code>sequenceDiagram\n    participant Stage as Stage Level\n    participant Group as Steps Group Level\n    participant Step as Step Level\n    participant Console as Jenkins Console\n\n    Stage-&gt;&gt;Console: ===== STAGE Starting: [ Jenkins Initialization ] =====\n\n    Stage-&gt;&gt;Group: stepsGroupStart('Set Up Environment Variables')\n    Group-&gt;&gt;Console: --- STEPS Starting Group: [ Set Up Environment Variables ] ---\n\n    Group-&gt;&gt;Step: stepStart('Configure Report Directory')\n    Step-&gt;&gt;Console: \u27a1\ufe0f Step Starting: [ Configure Report Directory ]...\n    Step-&gt;&gt;Console: \ud83d\udcac Step Info: [ REPORT_DIR: /workspace/PRJob/branch ]\n    Step-&gt;&gt;Console: \u2705 Step Completed: [ Configure Report Directory ]\n\n    Group-&gt;&gt;Step: stepStart('Extract ticket number')\n    Step-&gt;&gt;Console: \u27a1\ufe0f Step Starting: [ Extract ticket number ]...\n    Step-&gt;&gt;Console: \ud83d\udcac Step Info: [ TICKET_NUMBER: CORE-1234 ]\n    Step-&gt;&gt;Console: \u2705 Step Completed: [ Extract ticket number ]\n\n    Group-&gt;&gt;Console: --- STEPS Completed Group: [ Set Up Environment Variables ] ---\n\n    Stage-&gt;&gt;Group: stepsGroupStart('Send Build Status')\n    Group-&gt;&gt;Console: --- STEPS Starting Group: [ Send Build Status ] ---\n\n    Group-&gt;&gt;Step: stepStart('bitbucketApiHelper')\n    Step-&gt;&gt;Console: \u27a1\ufe0f Step Starting: [ bitbucketApiHelper ]...\n    Step-&gt;&gt;Console: \ud83c\udfc3 Step Processing: [ POST to Bitbucket API ]\n    Step-&gt;&gt;Console: \u2705 Step Completed: [ bitbucketApiHelper ]\n\n    Group-&gt;&gt;Console: --- STEPS Completed Group: [ Send Build Status ] ---\n\n    Stage-&gt;&gt;Console: ===== STAGE Completed: [ Jenkins Initialization ] =====</code></pre>"},{"location":"highlights/#33-beforeafter-comparison","title":"3.3 Before/After Comparison","text":""},{"location":"highlights/#331-stage-log-output-comparison","title":"3.3.1 Stage Log Output Comparison","text":""},{"location":"highlights/#before-74fc356","title":"Before (<code>74fc356</code>)","text":"<p>Problems: - No Stage/Step distinction - Inconsistent format - Difficult to trace error locations</p>"},{"location":"highlights/#after-ff74ac8","title":"After (<code>ff74ac8</code>)","text":"<p>Improvements: - 3-Level hierarchical structure (Stage \u2192 Steps Group \u2192 Step) - Consistent format with emojis - Immediate error location identification</p>"},{"location":"highlights/#332-console-log-output-comparison","title":"3.3.2 Console Log Output Comparison","text":"<p>Unlike Stage Log, Console Log shows Jenkins-added timestamps and <code>[Pipeline]</code> tags:</p> <p>Before - Scattered echo, inconsistent format:</p> <pre><code>[Pipeline] echo\n2025-03-20T10:23:45.123Z Fetching origin...\n[Pipeline] sh\n2025-03-20T10:23:45.456Z + git fetch origin\n[Pipeline] echo\n2025-03-20T10:23:46.789Z REPORT_DIR: /workspace/PRJob/feature-branch\n[Pipeline] echo\n2025-03-20T10:23:47.012Z Sending build status to Bitbucket\n[Pipeline] sh\n2025-03-20T10:23:47.345Z + python send_bitbucket_build_status.py INPROGRESS ...\n[Pipeline] echo\n2025-03-20T10:23:48.678Z Done.\n</code></pre> <p>After - 3-Level hierarchical logging:</p> <pre><code>[Pipeline] echo\n2025-05-12T10:23:45.123Z ===== STAGE Starting: [ Jenkins Initialization ] =====\n[Pipeline] echo\n2025-05-12T10:23:45.456Z --- STEPS Starting Group: [ Set Up Environment Variables ] ---\n[Pipeline] echo\n2025-05-12T10:23:45.789Z \u27a1\ufe0f Step Starting:\n[ Configure Report Directory ]...\n[Pipeline] echo\n2025-05-12T10:23:46.012Z \ud83d\udcac Step Info:\n[ REPORT_DIR: /workspace/PRJob/feature-branch ]\n[Pipeline] echo\n2025-05-12T10:23:46.345Z \u2705 Step Completed:\n[ Configure Report Directory ]\n[Pipeline] echo\n2025-05-12T10:23:46.678Z --- STEPS Completed Group: [ Set Up Environment Variables ] ---\n[Pipeline] echo\n2025-05-12T10:23:47.012Z ===== STAGE Completed: [ Jenkins Initialization ] =====\n</code></pre> <p>Note: Step-level functions include <code>\\n</code> within messages, resulting in two-line output in Console Log (e.g., <code>\"\u27a1\ufe0f Step Starting: \\n[ desc ]...\"</code>). Stage/Steps Group functions output single lines without <code>\\n</code>.</p>"},{"location":"highlights/#34-design-decisions","title":"3.4 Design Decisions","text":""},{"location":"highlights/#341-jenkins-platform-constraints","title":"3.4.1 Jenkins Platform Constraints","text":"Constraint Description CSP (Content Security Policy) Jenkins blocks inline CSS, external stylesheets, and JavaScript by default for XSS prevention. Text color/style customization is limited. Output Format Control When calling <code>echo()</code>, Stage Log shows Jenkins auto-grouping/formatting, while Console Log shows raw output with timestamps and <code>[Pipeline]</code> tags. Developers cannot control this output format. <p>Reference: Jenkins Security - Configuring Content Security Policy</p>"},{"location":"highlights/#342-design-decisions","title":"3.4.2 Design Decisions","text":"Constraint Solution Color/style limitations Visual hierarchy using text-based delimiters (<code>=====</code>, <code>---</code>) and emojis Output format control <code>\\n</code> insertion in step-level functions for Console Log hierarchical readability. Stage Log auto-formatted by Jenkins requires no special handling"},{"location":"highlights/#4-key-changes-in-detail","title":"4. Key Changes in Detail","text":""},{"location":"highlights/#41-bitbucket-api-migration","title":"4.1 Bitbucket API Migration","text":"<p>Migrated from Python subprocess to Native Groovy/Java HTTP Client.</p>"},{"location":"highlights/#411-folder-structure-comparison","title":"4.1.1 Folder Structure Comparison","text":"<pre><code>Before (74fc356)                          After (ff74ac8)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                         \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndevops-jenkins-linux/                     devops-jenkins-linux/\n\u251c\u2500\u2500 DLXJenkins/                           \u251c\u2500\u2500 DLXJenkins/\n\u2502   \u2514\u2500\u2500 Jenkinsfile \u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502   \u2514\u2500\u2500 Jenkinsfile \u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u251c\u2500\u2500 groovy/                     \u2502         \u2514\u2500\u2500 sharedLibraries/                      \u2502\n\u2502   \u2514\u2500\u2500 generalHelper.groovy \u2190\u2500\u2500\u2524             \u251c\u2500\u2500 vars/                             \u2502\n\u2514\u2500\u2500 python/                     \u2502             \u2502   \u251c\u2500\u2500 bitbucketApiHelper.groovy \u2190\u2500\u2500\u2500\u2524\n    \u2514\u2500\u2500 send_bitbucket_build_   \u2502             \u2502   \u2514\u2500\u2500 bitbucketApiLibrary.groovy \u2190\u2500\u2500\u2518\n        status.py \u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2514\u2500\u2500 src/service/general/\n                                                  \u2514\u2500\u2500 BitbucketApiService.groovy\n</code></pre>"},{"location":"highlights/#412-before-74fc356","title":"4.1.2 Before (<code>74fc356</code>)","text":"<pre><code>sequenceDiagram\n    participant JF as Jenkinsfile\n    participant GH as generalHelper.groovy\n    participant SH as sh (Shell)\n    participant PY as Python Script\n    participant BB as Bitbucket API\n\n    JF-&gt;&gt;GH: sendBuildStatus(workspace, 'INPROGRESS', commitHash)\n    GH-&gt;&gt;SH: sh \"python send_bitbucket_build_status.py ...\"\n    SH-&gt;&gt;PY: spawn process\n    PY-&gt;&gt;PY: Prepare requests.post()\n    PY-&gt;&gt;BB: HTTP POST /commit/{hash}/statuses/build\n    BB--&gt;&gt;PY: 200 OK\n    PY--&gt;&gt;SH: exit 0\n    SH--&gt;&gt;GH: return\n    GH--&gt;&gt;JF: return</code></pre> <p>Code Path: - <code>DLXJenkins/Jenkinsfile</code> \u2192 <code>groovy/generalHelper.groovy:sendBuildStatus()</code> \u2192 <code>python/send_bitbucket_build_status.py</code></p> <p>Problems: - Python process spawn overhead - External dependency (requests library) - Distributed error handling</p>"},{"location":"highlights/#413-after-ff74ac8","title":"4.1.3 After (<code>ff74ac8</code>)","text":"<pre><code>sequenceDiagram\n    participant JF as Jenkinsfile\n    participant BAH as bitbucketApiHelper\n    participant BAL as bitbucketApiLibrary\n    participant BAS as BitbucketApiService\n    participant HC as Apache HttpClient\n    participant BB as Bitbucket API\n\n    JF-&gt;&gt;BAL: createBuildStatusForCommit(status, description)\n    BAL--&gt;&gt;JF: return {apiUrlString, requestBody, method}\n    JF-&gt;&gt;BAH: bitbucketApiHelper(apiMap)\n    BAH-&gt;&gt;BAS: new BitbucketApiService(this)\n    BAH-&gt;&gt;BAS: post(apiUrl, requestBody, token)\n    BAS-&gt;&gt;HC: HttpPost.execute()\n    HC-&gt;&gt;BB: HTTP POST /commit/{hash}/statuses/build\n    BB--&gt;&gt;HC: 200 OK\n    HC--&gt;&gt;BAS: HttpResponse\n    BAS--&gt;&gt;BAH: {statusCode, body}\n    BAH--&gt;&gt;JF: return result</code></pre> <p>Code Path: - <code>DLXJenkins/Jenkinsfile</code> - \u2192 <code>sharedLibraries/vars/bitbucketApiHelper.groovy</code> - \u2192 <code>sharedLibraries/vars/bitbucketApiLibrary.groovy</code> - \u2192 <code>sharedLibraries/src/service/general/BitbucketApiService.groovy</code></p> <p>Improvements: - HTTP processing within JVM (no process spawn) - Structured error handling (Exception hierarchy) - Reusable API Service class</p>"},{"location":"highlights/#414-design-decisions","title":"4.1.4 Design Decisions","text":""},{"location":"highlights/#problem-situation","title":"Problem Situation","text":"<ul> <li>Time-consuming to diagnose Bitbucket API communication failures when Jenkins service URL's third-party certificate expired</li> <li>Inconsistent error handling across Python scripts - some had it, some didn't</li> <li>No distinction between network error types - all treated uniformly</li> </ul>"},{"location":"highlights/#solution-centralized-error-handling","title":"Solution: Centralized Error Handling","text":"<p><code>BitbucketApiService.executeRequest()</code> classifies all HTTP request errors by type:</p> Exception Cause Log Message <code>UnknownHostException</code> DNS/URL issue \"Unable to resolve host\" <code>ConnectException</code> TCP connection failure \"Failed to establish TCP connection\" <code>SocketTimeoutException</code> Network timeout \"Connection timed out\" <code>SSLHandshakeException</code> Certificate error \"TLS Handshake failed - possible certificate error\" <code>ConnectionClosedException</code> Premature connection closure \"Connection closed prematurely\" <code>IOException</code> General I/O error \"I/O error occurred\""},{"location":"highlights/#structure","title":"Structure","text":"<pre><code>flowchart LR\n    BAL[bitbucketApiLibrary&lt;br/&gt;API request definition]\n    BAH[bitbucketApiHelper&lt;br/&gt;API call entry point]\n    BAS[BitbucketApiService&lt;br/&gt;HTTP + error handling]\n    LOG[logger&lt;br/&gt;Immediate output]\n\n    BAL --&gt; BAH --&gt; BAS --&gt; LOG</code></pre> <p>All GET/POST/PUT/DELETE requests execute through <code>executeRequest()</code>, centralizing error handling.</p>"},{"location":"highlights/#42-shell-script-libraries","title":"4.2 Shell Script Libraries","text":"<p>Library system abstracting shell commands using Closure pattern. Three domain-specific Libraries: Git, Shell, SSH.</p>"},{"location":"highlights/#421-file-structure","title":"4.2.1 File Structure","text":"<pre><code>sharedLibraries/\n\u251c\u2500\u2500 vars/\n\u2502   \u2514\u2500\u2500 shellScriptHelper.groovy      \u2190 Closure execution + logging integration\n\u2502       \u251c\u2500\u2500 call(Closure, List args)\n\u2502       \u251c\u2500\u2500 validateShMap(Map)\n\u2502       \u251c\u2500\u2500 executeReturnStatus(Map)\n\u2502       \u251c\u2500\u2500 executeReturnStdout(Map)\n\u2502       \u2514\u2500\u2500 executeReturnVoid(Map)\n\u2502\n\u2514\u2500\u2500 src/utils/\n    \u251c\u2500\u2500 GitLibrary.groovy (258 lines)     \u2190 Git command Closures (18)\n    \u251c\u2500\u2500 ShellLibrary.groovy (210 lines)   \u2190 General shell command Closures (13)\n    \u2514\u2500\u2500 SSHShellLibrary.groovy (99 lines) \u2190 SSH/SCP remote command Closures (8)\n</code></pre>"},{"location":"highlights/#422-closure-pattern-structure","title":"4.2.2 Closure Pattern Structure","text":"<pre><code>classDiagram\n    class shellScriptHelper {\n        +call(Closure, List args)\n        -validateShMap(Map)\n        -executeReturnStatus(Map)\n        -executeReturnStdout(Map)\n        -executeReturnVoid(Map)\n    }\n\n    class GitLibrary {\n        &lt;&lt;static&gt;&gt;\n        +Closure FetchOrigin\n        +Closure FetchBranch\n        +Closure GetRemoteBranchHash\n        +Closure CheckoutBranch\n        +Closure MergeOriginBranch\n        +Closure LfsFetchAndCheckout\n        ... (18 Closures)\n    }\n\n    class ShellLibrary {\n        &lt;&lt;static&gt;&gt;\n        +Closure PrintJenkinsEnv\n        +Closure GroovyLint\n        +Closure LintUnity\n        +Closure GetUnityExecutable\n        +Closure CreateBitbucketBuildReport\n        ... (13 Closures)\n    }\n\n    class SSHShellLibrary {\n        &lt;&lt;static&gt;&gt;\n        +Closure CleanMergedPRBranchFromHostServer\n        +Closure CopyBuildToHostServer\n        +Closure UpdateBuildURL\n        +Closure CheckSSHConnectivity\n        ... (8 Closures)\n    }\n\n    shellScriptHelper --&gt; GitLibrary : uses\n    shellScriptHelper --&gt; ShellLibrary : uses\n    shellScriptHelper --&gt; SSHShellLibrary : uses</code></pre>"},{"location":"highlights/#423-before-74fc356","title":"4.2.3 Before (<code>74fc356</code>)","text":"<pre><code>sequenceDiagram\n    participant JF as Jenkinsfile\n    participant SH as sh (Shell)\n\n    JF-&gt;&gt;SH: sh 'git fetch origin'\n    SH--&gt;&gt;JF: return\n    JF-&gt;&gt;SH: sh \"git checkout ${branch}\"\n    SH--&gt;&gt;JF: return\n    JF-&gt;&gt;SH: sh 'git reset --hard'\n    SH--&gt;&gt;JF: return\n    JF-&gt;&gt;SH: sh 'git clean -fd'\n    SH--&gt;&gt;JF: return\n    JF-&gt;&gt;SH: sh \"git reset --hard origin/${branch}\"\n    SH--&gt;&gt;JF: return\n    JF-&gt;&gt;SH: sh 'git pull'\n    SH--&gt;&gt;JF: return</code></pre> <p>Problems: - Same git commands duplicated across multiple pipelines - No error handling - No logging - Untestable</p>"},{"location":"highlights/#424-after-ff74ac8","title":"4.2.4 After (<code>ff74ac8</code>)","text":"<pre><code>sequenceDiagram\n    participant Caller\n    participant SSH as shellScriptHelper\n    participant LIB as *Library (Git/Shell/SSH)\n    participant LOG as logger\n    participant SH as sh\n\n    Caller-&gt;&gt;SSH: shellScriptHelper(GitLibrary.CheckoutBranch, ['feature-branch'])\n    SSH-&gt;&gt;LIB: CheckoutBranch('feature-branch')\n    LIB--&gt;&gt;SSH: {script: \"git checkout feature-branch\", label: \"...\", returnStdout: true}\n    SSH-&gt;&gt;SSH: validateShMap(paramsMap)\n    SSH-&gt;&gt;LOG: stepStart('[ShellScript] Checkout branch')\n    SSH-&gt;&gt;SH: sh([script: \"git checkout feature-branch\", ...])\n    SH--&gt;&gt;SSH: \"Switched to branch 'feature-branch'\"\n    SSH-&gt;&gt;LOG: stepShellExecutedResult(output)\n    SSH--&gt;&gt;Caller: return \"Switched to branch 'feature-branch'\"</code></pre> <p>Improvements: - Shell command reuse through Closure pattern - Automatic logging integration - Consistent error handling - Centralized validation logic</p>"},{"location":"highlights/#425-closure-list-by-library","title":"4.2.5 Closure List by Library","text":""},{"location":"highlights/#gitlibrary-18-closures-git-version-control","title":"GitLibrary (18 Closures) - Git Version Control","text":"Closure Parameters Return Type Purpose <code>FetchOrigin</code> - void Fetch origin <code>FetchBranch</code> branchName void Fetch specific branch <code>GetRemoteBranchHash</code> branchName stdout Remote branch commit hash <code>CloneRepository</code> gitUrl, projectDir void Clone repository <code>ShowCurrentBranch</code> - stdout Current branch name <code>RemoveIndexLock</code> - void Remove .git/index.lock <code>ResetHardHead</code> - stdout Hard reset to HEAD <code>CleanUntracked</code> - stdout Delete untracked files <code>CheckoutBranch</code> branchName stdout Checkout branch <code>ResetHardOriginBranch</code> branchName stdout Reset to origin branch <code>Pull</code> - stdout Git pull <code>GetOriginDefaultBranch</code> - stdout Default branch name <code>CheckOriginBranchExists</code> branchName status Check remote branch exists <code>CheckBranchExists</code> targetBranch status Check local branch exists <code>CheckUpToDateWithRemote</code> branchName status Check sync with remote <code>CheckIsRemoteBranchAncestor</code> remoteBranchName status Check ancestor branch <code>MergeOriginBranch</code> branchToMerge status Merge remote branch <code>LfsFetchAndCheckout</code> - status LFS file fetch &amp; checkout"},{"location":"highlights/#shelllibrary-13-closures-general-shell-commands","title":"ShellLibrary (13 Closures) - General Shell Commands","text":"Closure Parameters Return Type Purpose <code>PrintJenkinsEnv</code> - stdout Print environment variables <code>FindPRJobDirectory</code> workingDir, prBranch stdout Search PR Job directory <code>FindProjectDirectory</code> workingDir, projectType status Search project directory <code>DockerInfo</code> - stdout Print Docker info <code>GroovyLint</code> reportFile, configFile, targetDir, desc status Groovy linting <code>GetUnityExecutable</code> workspace, projectDir stdout Unity executable path <code>CreateLintingResultsDir</code> workingDir status Create linting results directory <code>CopyWebGLBuilder</code> projectDir status Copy WebGL Builder <code>CopyLintConfig</code> workingDir, projectDir status Copy .editorconfig <code>LintUnity</code> workingDir, projectDir, reportDir status Unity project linting <code>ExecutePythonStatusReport</code> workingDir, projectDir, reportDir, status, commit stdout Python status report <code>CreateBitbucketBuildReport</code> workspace, commit, logPath, debugMode status Bitbucket build report <code>CreateBitbucketTestReport</code> workspace, commitHash, reportDir status Bitbucket test report"},{"location":"highlights/#sshshelllibrary-8-closures-sshscp-remote-commands","title":"SSHShellLibrary (8 Closures) - SSH/SCP Remote Commands","text":"Closure Parameters Return Type Purpose <code>CleanMergedPRBranchFromHostServer</code> folderName, ticketNumber, sshKey, hostUrl stdout Clean PR branch artifacts <code>CreateDirectoryAndSetPermission</code> folderName, sshKey, hostUrl status Create remote directory <code>CopyBuildToHostServer</code> folderName, sshKey, hostUrl, projectDir status SCP build transfer <code>UpdateBuildURL</code> folderName, sshKey, hostUrl status Update build URL <code>CreateDirectoryAndSetPermissionForEconestogaDlxServer</code> folderName, sshKey, econestogaUrl status Econestoga server directory creation <code>CopyBuildToEconestogaDlxServer</code> folderName, sshKey, econestogaUrl, projectDir status Econestoga server SCP transfer <code>UpdateBuildURLForEconestogaDlxServer</code> folderName, sshKey, econestogaUrl status Econestoga URL update <code>CheckSSHConnectivity</code> sshKey, hostUrl stdout SSH connection test"},{"location":"highlights/#426-closure-map-schema","title":"4.2.6 Closure Map Schema","text":"<pre><code>[\n    script: String,        // (Required) Shell script to execute\n    label: String,         // (Required) Description shown in Jenkins build log\n    returnStdout: Boolean, // (Optional) Return stdout\n    returnStatus: Boolean, // (Optional) Return exit code\n    returnStderr: Boolean, // (Optional) Return stderr\n    encoding: String       // (Optional) Encoding (default: UTF-8)\n]\n</code></pre> <p>Constraint: Only one of <code>returnStdout</code>, <code>returnStatus</code>, <code>returnStderr</code> can be true</p>"},{"location":"highlights/#427-design-decisions","title":"4.2.7 Design Decisions","text":""},{"location":"highlights/#pattern-identification","title":"Pattern Identification","text":"<p>Analysis of all <code>sh</code> calls across pipelines revealed three domains:</p> Domain Library Purpose Git GitLibrary Version control commands (fetch, checkout, merge, etc.) Shell ShellLibrary General system commands (lint, copy, mkdir, etc.) SSH SSHShellLibrary Remote server commands (scp, ssh, etc.)"},{"location":"highlights/#leveraging-jenkins-sh-characteristics","title":"Leveraging Jenkins sh() Characteristics","text":"<p>Jenkins Pipeline's <code>sh()</code> step can directly accept Map-type parameters:</p> <pre><code>// Groovy Map can be directly passed to sh()\nsh([script: \"git fetch origin\", label: \"Fetch origin\", returnStatus: true])\n</code></pre>"},{"location":"highlights/#return-type-processing-patterns","title":"Return Type Processing Patterns","text":"Return Type Purpose Result Handling void Execution only (side effect) Check success/failure only stdout Output value needed Parse returned string status Exit code needed 0=success, non-zero=failure/warning"},{"location":"highlights/#logger-system-integration","title":"Logger System Integration","text":"<p>Clear return type rules enable automatic logging in <code>shellScriptHelper</code>:</p> <pre><code>flowchart LR\n    LIB[*Library&lt;br/&gt;Closure Map]\n    SSH[shellScriptHelper&lt;br/&gt;Execute + Validate]\n    LOG[logger&lt;br/&gt;Auto logging]\n\n    LIB --&gt; SSH --&gt; LOG</code></pre> <ul> <li>Success: Call <code>stepSuccess()</code></li> <li>Failure: Call <code>stepError()</code> (pipeline abort)</li> <li>Warning: Call <code>stepWarning()</code> (specific status codes)</li> </ul>"},{"location":"highlights/#43-stage-modularization","title":"4.3 Stage Modularization","text":""},{"location":"highlights/#431-folder-structure-comparison-linting-stage-example","title":"4.3.1 Folder Structure Comparison (Linting Stage Example)","text":"<pre><code>Before (74fc356)                                    After (ff74ac8)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndevops-jenkins-linux/                               devops-jenkins-linux/\n\u251c\u2500\u2500 DLXJenkins/                                     \u251c\u2500\u2500 DLXJenkins/\n\u2502   \u251c\u2500\u2500 Jenkinsfile                                 \u2502   \u251c\u2500\u2500 Jenkinsfile\n\u2502   \u2502   stage('Linting') {Inline/Duplicated}        \u2502   \u2502   stage('Linting') { stageLintUnity() }\n\u2502   \u2514\u2500\u2500 JenkinsfileDeployment                       \u2502   \u2514\u2500\u2500 JenkinsfileDeployment\n\u2502       stage('Linting') {Inline/Duplicated}        \u2502       stage('Linting') { stageLintUnity() }\n\u251c\u2500\u2500 JsJenkins/                                      \u251c\u2500\u2500 JsJenkins/\n\u2502   \u251c\u2500\u2500 Jenkinsfile                                 \u2502   \u251c\u2500\u2500 Jenkinsfile\n\u2502   \u2502   stage('Linting') {Inline/Duplicated}        \u2502   \u2502   stage('Linting') { stageLintJs() } *\n\u2502   \u2514\u2500\u2500 JenkinsfileDeployment                       \u2502   \u2514\u2500\u2500 JenkinsfileDeployment\n\u2502       stage('Linting') {Inline/Duplicated}        \u2502       stage('Linting') { stageLintJs() } *\n\u251c\u2500\u2500 PipelineForJenkins/                             \u251c\u2500\u2500 PipelineForJenkins/\n\u2502   \u2514\u2500\u2500 Jenkinsfile                                 \u2502   \u2514\u2500\u2500 Jenkinsfile\n\u2502       stage('Lint Groovy Code') {                 \u2502       stage('Lint Groovy Code') {\n\u2502           Inline/Duplicated }                     \u2502           stageLintGroovyJenkinsfile() }\n\u2502                                                   \u2502\n\u2514\u2500\u2500 groovy/                                         \u2514\u2500\u2500 sharedLibraries/vars/\n    \u251c\u2500\u2500 generalHelper.groovy                            \u251c\u2500\u2500 stageLintUnity.groovy\n    \u2514\u2500\u2500 unityHelper.groovy                              \u251c\u2500\u2500 stageLintJs.groovy *\n                                                        \u2514\u2500\u2500 stageLintGroovyJenkinsfile.groovy\n</code></pre> <p>*stageLintJs is not yet developed</p>"},{"location":"highlights/#432-linting-stage-example","title":"4.3.2 Linting Stage Example","text":""},{"location":"highlights/#before-74fc356-50-lines","title":"Before (<code>74fc356</code>) - ~50 lines","text":"<pre><code>sequenceDiagram\n    participant JF as Jenkinsfile\n    participant SH as sh\n    participant PY as Python\n\n    JF-&gt;&gt;SH: sh 'mkdir -p linting_results'\n    JF-&gt;&gt;SH: sh \"cp -f .editorconfig ...\"\n    JF-&gt;&gt;SH: sh \"Linting.bash ${PROJECT_DIR} ${REPORT_DIR}\"\n    SH--&gt;&gt;JF: exitCode\n\n    alt exitCode != 0\n        JF-&gt;&gt;JF: echo 'Error linting'\n        alt exitCode == 2\n            JF-&gt;&gt;SH: sh \"python linting_error_report.py ... ${fail}\"\n            SH-&gt;&gt;PY: spawn\n            PY--&gt;&gt;SH: exit\n        end\n        JF-&gt;&gt;JF: catchError { error(\"Linting failed\") }\n    else exitCode == 0\n        JF-&gt;&gt;SH: sh \"python linting_error_report.py ... ${pass}\"\n        SH-&gt;&gt;PY: spawn\n        PY--&gt;&gt;SH: exit\n    end</code></pre> <p>Problems: - Same Stage logic Inline/Duplicated across 5 pipelines - Modifications require changes in all 5 places - No logging, untestable</p>"},{"location":"highlights/#after-ff74ac8-1-line","title":"After (<code>ff74ac8</code>) - 1 line","text":"<pre><code>sequenceDiagram\n    participant JF as Jenkinsfile\n    participant SLU as stageLintUnity\n    participant LOG as logger\n    participant SSH as shellScriptHelper\n\n    JF-&gt;&gt;SLU: stageLintUnity()\n    SLU-&gt;&gt;LOG: stageStart('Linting')\n    SLU-&gt;&gt;LOG: stepsGroupStart('Setup')\n    SLU-&gt;&gt;SSH: shellScriptHelper(...)\n    SSH--&gt;&gt;SLU: return\n    SLU-&gt;&gt;LOG: stepsGroupEnd('Setup')\n    SLU-&gt;&gt;LOG: stepsGroupStart('Execute Lint')\n    SLU-&gt;&gt;SSH: shellScriptHelper(...)\n    SSH--&gt;&gt;SLU: exitCode\n    SLU-&gt;&gt;LOG: stepsGroupEnd('Execute Lint')\n    SLU-&gt;&gt;LOG: stageEnd('Linting')\n    SLU--&gt;&gt;JF: return</code></pre> <p>Actual Logic: Encapsulated in <code>sharedLibraries/vars/stageLintUnity.groovy</code></p> <p>Improvements: - Stage logic separated into module files (<code>stage*.groovy</code>) - Pipeline calls replaced with 1-line invocation - Automatic Logger system integration - Single Source of Truth</p>"},{"location":"highlights/#433-complete-stage-modularization-design","title":"4.3.3 Complete Stage Modularization Design","text":"<pre><code>Before (74fc356)                                    After (ff74ac8)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n&gt; Stage logic Inline/Duplicated                     &gt; Stage logic separated into stage*.groovy modules\n&gt; groovy/ Helper mixed with                         &gt; Role-based Layer separation, 1-line calls\n  Git/API/logging/domain logic (God Object)\n\nDLXJenkins/Jenkinsfile                              DLXJenkins/Jenkinsfile\n\u251c\u2500\u2500 stage('Prepare WORKSPACE')                      \u251c\u2500\u2500 stage('Jenkins Initialization') { stageInitialization() }\n\u251c\u2500\u2500 stage('Linting')                                \u251c\u2500\u2500 stage('Prepare Project') { stageProjectPrepare() }\n\u251c\u2500\u2500 stage('EditMode Tests')                         \u251c\u2500\u2500 stage('Linting') { stageLintUnity() }\n\u251c\u2500\u2500 stage('PlayMode Tests in Editor')               \u251c\u2500\u2500 stage('Unity Execution') { stageUnityExecution() }\n\u251c\u2500\u2500 stage('Code Coverage Send Reports')             \u2514\u2500\u2500 stage('Send Build Results') { stageSendBuildResults() }\n\u2514\u2500\u2500 stage('Build Project')\n                                                    DLXJenkins/JenkinsfileDeployment\nDLXJenkins/JenkinsfileDeployment                    \u251c\u2500\u2500 stage('Cleanup PR Branch Artifacts') { stageCleanupPRBranchArtifacts() }\n\u251c\u2500\u2500 stage('Delete Merged Branch')                   \u251c\u2500\u2500 stage('Jenkins Initialization') { stageInitialization() }\n\u251c\u2500\u2500 stage('Prepare WORKSPACE')                      \u251c\u2500\u2500 stage('Prepare Project') { stageProjectPrepare() }\n\u251c\u2500\u2500 stage('Linting')                                \u251c\u2500\u2500 stage('Linting') { stageLintUnity() }\n\u251c\u2500\u2500 stage('EditMode Tests')                         \u251c\u2500\u2500 stage('Unity Execution') { stageUnityExecution() }\n\u251c\u2500\u2500 stage('PlayMode Tests In Editor')               \u251c\u2500\u2500 stage('Deploy Build') { stageDeployBuild() }\n\u251c\u2500\u2500 stage('Build Project')                          \u2514\u2500\u2500 stage('Send Build Results') { stageSendBuildResults() }\n\u2514\u2500\u2500 stage('Deploy Build')\n                                                    JsJenkins/Jenkinsfile *\nJsJenkins/Jenkinsfile                               \u251c\u2500\u2500 stage('Jenkins Initialization') { stageInitialization() }\n\u251c\u2500\u2500 stage('Prepare WORKSPACE')                      \u251c\u2500\u2500 stage('Install Dependencies') { stageInstallDependencies() }\n\u251c\u2500\u2500 stage('Install Dependencies')                   \u251c\u2500\u2500 stage('Linting') { stageLintJs() }\n\u251c\u2500\u2500 stage('Linting')                                \u251c\u2500\u2500 stage('Unit Testing') { stageUnitTesting() }\n\u251c\u2500\u2500 stage('Unit Testing')                           \u2514\u2500\u2500 stage('Static Analysis') { stageStaticAnalysis() }\n\u2514\u2500\u2500 stage('Static Analysis')\n                                                    JsJenkins/JenkinsfileDeployment *\nJsJenkins/JenkinsfileDeployment                     \u251c\u2500\u2500 stage('Cleanup PR Branch Artifacts') { stageCleanupPRBranchArtifacts() }\n\u251c\u2500\u2500 stage('Delete Merged Branch')                   \u251c\u2500\u2500 stage('Jenkins Initialization') { stageInitialization() }\n\u251c\u2500\u2500 stage('Prepare WORKSPACE')                      \u251c\u2500\u2500 stage('Install Dependencies') { stageInstallDependencies() }\n\u251c\u2500\u2500 stage('Install Dependencies')                   \u251c\u2500\u2500 stage('Linting') { stageLintJs() }\n\u251c\u2500\u2500 stage('Linting')                                \u251c\u2500\u2500 stage('Unit Testing') { stageUnitTesting() }\n\u251c\u2500\u2500 stage('Unit Testing')                           \u251c\u2500\u2500 stage('Static Analysis') { stageStaticAnalysis() }\n\u251c\u2500\u2500 stage('Static Analysis')                        \u251c\u2500\u2500 stage('Server Build and Deploy') { stageServerBuildAndDeploy() }\n\u251c\u2500\u2500 stage('Check Build and Deploy Condition')       \u2514\u2500\u2500 stage('Client Build and Deploy') { stageClientBuildAndDeploy() }\n\u251c\u2500\u2500 stage('Server Build and Deploy')\n\u2514\u2500\u2500 stage('Client Build and Deploy')                PipelineForJenkins/Jenkinsfile\n                                                    \u251c\u2500\u2500 stage('Jenkins Initialization') { stageInitialization() }\nPipelineForJenkins/Jenkinsfile                      \u251c\u2500\u2500 stage('Lint Groovy Code') { stageLintGroovyJenkinsfile() }\n\u251c\u2500\u2500 stage('Prepare Workspace')                      \u251c\u2500\u2500 stage('Generate Groovydoc') { stageGenerateGroovydoc() } *\n\u251c\u2500\u2500 stage('Lint Groovy Code')                       \u251c\u2500\u2500 stage('Run Unit Tests') { stageRunUnitTests() } *\n\u251c\u2500\u2500 stage('Generate Groovydoc')                     \u251c\u2500\u2500 stage('Publish Test Results') { stagePublishTestResults() } *\n\u251c\u2500\u2500 stage('Run Unit Tests')                         \u2514\u2500\u2500 stage('Static Analysis') { stageStaticAnalysis() }\n\u251c\u2500\u2500 stage('Publish Test Results')\n\u2514\u2500\u2500 stage('Static Analysis')                        sharedLibraries/vars/\n                                                    \u251c\u2500\u2500 stageInitialization.groovy\ngroovy/                                             \u251c\u2500\u2500 stageProjectPrepare.groovy\n\u251c\u2500\u2500 generalHelper.groovy                            \u251c\u2500\u2500 stageLintUnity.groovy\n\u251c\u2500\u2500 jsHelper.groovy                                 \u251c\u2500\u2500 stageLintGroovyJenkinsfile.groovy\n\u2514\u2500\u2500 unityHelper.groovy                              \u251c\u2500\u2500 stageStaticAnalysis.groovy\n                                                    \u251c\u2500\u2500 stageUnityExecution.groovy\n                                                    \u251c\u2500\u2500 stageDeployBuild.groovy\n                                                    \u251c\u2500\u2500 stageCleanupPRBranchArtifacts.groovy\n                                                    \u251c\u2500\u2500 stageSendBuildResults.groovy\n                                                    \u251c\u2500\u2500 stageLintJs.groovy *\n                                                    \u251c\u2500\u2500 stageInstallDependencies.groovy *\n                                                    \u251c\u2500\u2500 stageUnitTesting.groovy *\n                                                    \u251c\u2500\u2500 stageGenerateGroovydoc.groovy *\n                                                    \u251c\u2500\u2500 stageRunUnitTests.groovy *\n                                                    \u251c\u2500\u2500 stagePublishTestResults.groovy *\n                                                    \u251c\u2500\u2500 stageServerBuildAndDeploy.groovy *\n                                                    \u2514\u2500\u2500 stageClientBuildAndDeploy.groovy *\n</code></pre> <p>*Not yet developed</p>"},{"location":"highlights/#44-testability","title":"4.4 Testability","text":"<p>One of the core goals of refactoring was to transition to a structure that enables unit testing.</p>"},{"location":"highlights/#441-before-helper-python-script-structure","title":"4.4.1 Before: Helper + Python Script Structure","text":"<p>In the Before state, 2 untestable patterns existed:</p> <p>Pattern 1: Direct <code>sh()</code> calls in Helper</p> <pre><code>// groovy/generalHelper.groovy (Before - commit 74fc356)\nvoid checkoutBranch(String prBranch) {\n    sh(script: \"git checkout ${prBranch}\", returnStdout: true)  // Direct Jenkins DSL call\n    echo \"Checked out branch: ${prBranch}\"                       // Direct Jenkins DSL call\n}\n</code></pre> File Lines Role generalHelper.groovy 403 lines 21 functions, 8 domains mixed jsHelper.groovy 408 lines JS build, Python wrappers unityHelper.groovy 337 lines Unity build Total 1,148 lines Testable: 1 function <p>Pattern 2: API calls via Python scripts</p> <pre><code># python/send_bitbucket_build_status.py (Before)\nimport requests\nimport os\n\n# Direct environment variable access\naccess_token = os.getenv('BITBUCKET_ACCESS_TOKEN')\npr_repo = os.getenv('JOB_REPO')\n\n# Direct HTTP request execution\nurl = f'{pr_repo}/commit/{args[\"pr-commit\"]}/statuses/build'\nresponse = requests.post(url, data=build_status, headers=headers)\n</code></pre> <p>Python script call from Jenkins:</p> <pre><code>// jsHelper.groovy (Before)\nsh \"python3 python/send_bitbucket_build_status.py ${commitHash} SUCCESSFUL\"\n</code></pre> <p>Discovered Python API scripts (9):</p> File Role HTTP Method send_bitbucket_build_status.py Send build status POST get_bitbucket_commit_hash.py Get commit hash GET create_bitbucket_coverage_report.py Coverage report PUT create_bitbucket_test_report.py Test report PUT/POST create_bitbucket_webgl_build_report.py WebGL build report GET/DELETE/PUT npm_audit.py npm security audit PUT/POST linting_error_report.py Linting error report PUT/POST Lint_groovy_report.py Groovy linting report PUT/POST create_log_report.py Log report GET <p>Reasons for Being Untestable:</p> Before Structure Problem Helper: Direct <code>sh()</code> call Requires Jenkins DSL, cannot mock Python: <code>os.getenv()</code> Environment variable dependency, difficult to isolate Python: <code>requests.post()</code> Direct HTTP execution, complex mocking Jenkins: <code>sh \"python3 ...\"</code> External process call, integration test only"},{"location":"highlights/#442-after-library-service-separation","title":"4.4.2 After: Library + Service Separation","text":"<p>Core Change: \"Definition\" and \"Execution\" separation + Dependency Injection</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Library (src/utils/)                                                \u2502\n\u2502 \u2192 Shell command \"definition\" (returns Map)                          \u2502\n\u2502 \u2192 No Jenkins dependency                                             \u2502\n\u2502 \u2192 \u2705 100% unit testable                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Service (src/service/)                                              \u2502\n\u2502 \u2192 Business logic + API calls                                        \u2502\n\u2502 \u2192 Constructor dependency injection                                  \u2502\n\u2502 \u2192 \u2705 Testable with mocks                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Helper (vars/)                                                      \u2502\n\u2502 \u2192 Command \"execution\" (sh calls)                                    \u2502\n\u2502 \u2192 Jenkins DSL orchestration                                         \u2502\n\u2502 \u2192 \u26a0\ufe0f Integration test                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>4.4.2.1 Library: Shell Command Definition (Map Return)</p> <pre><code>// src/utils/GitLibrary.groovy\nclass GitLibrary {\n    static final Closure CheckoutBranch = { String branchName -&gt;\n        [\n            script: \"git checkout ${branchName}\",\n            label: \"Checkout branch '${branchName}'\",\n            returnStdout: true\n        ]\n    }\n}\n</code></pre> <p>4.4.2.2 Service: API Call Logic (Dependency Injection)</p> <pre><code>// src/service/general/HttpApiService.groovy\nclass HttpApiService {\n    def jenkinsfile  // Dependency injection\n    def logger\n\n    HttpApiService(def jenkinsfile) {\n        this.jenkinsfile = jenkinsfile\n        this.logger = jenkinsfile.logger\n    }\n\n    def post(String apiUrlString, String requestBodyJson, String bearerToken) {\n        HttpPost httpPost = new HttpPost(apiUrlString)\n        httpPost.setHeader(HttpHeaders.CONTENT_TYPE, 'application/json')\n        return executeRequest(httpPost, bearerToken)\n    }\n}\n</code></pre> <p>Service usage in bitbucketApiHelper:</p> <pre><code>// vars/bitbucketApiHelper.groovy\ndef call(Map bitbucketApiMap) {\n    HttpApiService httpApiService = new HttpApiService(this)  // Dependency injection\n\n    withCredentials([string(credentialsId: 'bitbucket-access-token', variable: 'bitbucketAccessToken')]) {\n        if (bitbucketApiMap.method == 'POST') {\n            return httpApiService.post(bitbucketApiMap.apiUrlString, bitbucketApiMap.requestBody, bitbucketAccessToken)\n        }\n    }\n}\n</code></pre> <p>Reasons for Testability:</p> After Structure Benefit Library: Map return No Jenkins dependency, 100% unit test Service: Constructor injection jenkinsfile mockable Service: Apache HttpClient WireMock and other test servers available"},{"location":"highlights/#443-test-code-examples","title":"4.4.3 Test Code Examples","text":"<p>4.4.3.1 Library Test - Pure unit test without Jenkins:</p> <pre><code>// GitLibrarySpec.groovy\nclass GitLibrarySpec extends Specification {\n\n    def \"CheckoutBranch - branch name correctly inserted into script\"() {\n        when: 'Closure called'\n        def result = GitLibrary.CheckoutBranch('feature/JIRA-123')\n\n        then: 'Map contains correct values'\n        result.script == \"git checkout feature/JIRA-123\"\n        result.label == \"Checkout branch 'feature/JIRA-123'\"\n        result.returnStdout == true\n    }\n}\n</code></pre> <p>4.4.3.2 Service Test - Behavior verification through mocks:</p> <pre><code>// PrepareWorkspaceServiceSpec.groovy\nclass PrepareWorkspaceServiceSpec extends Specification {\n\n    def \"checkAndPullUntrackedLFSFiles - executes git lfs pull when untracked files exist\"() {\n        given: 'Mocked Jenkinsfile'\n        def jenkinsfile = Mock(JenkinsFile)\n        jenkinsfile.sh(_) &gt;&gt; { Map args -&gt;\n            if (args.script.contains(\"git lfs ls-files\")) {\n                return 'untracked_file_1\\nuntracked_file_2'\n            }\n        }\n        def service = new PrepareWorkspaceService(jenkinsfile)\n\n        when: 'Method called'\n        service.checkAndPullUntrackedLFSFiles()\n\n        then: 'Verify git lfs pull execution'\n        1 * jenkinsfile.echo('Untracked large files detected: untracked_file_1\\nuntracked_file_2')\n        1 * jenkinsfile.sh(script: 'git lfs pull', returnStdout: true)\n    }\n}\n</code></pre>"},{"location":"highlights/#444-before-vs-after-api-testability-comparison","title":"4.4.4 Before vs After: API Testability Comparison","text":"<p>Before: 9 Python script files</p> <pre><code>Jenkins Pipeline\n    \u2193 sh(\"python3 script.py\")\nPython Script\n    \u2193 os.getenv(), requests.post()\nBitbucket API\n</code></pre> <ul> <li>Direct <code>requests.post()</code> call \u2192 Complex mocking (monkeypatch required)</li> <li>CLI script \u2192 Difficult to modularize</li> <li>Environment variable dependency \u2192 Difficult test environment isolation</li> </ul> <p>After: 1 HttpApiService class</p> <pre><code>Jenkins Pipeline\n    \u2193 bitbucketApiHelper()\nbitbucketApiLibrary (returns Map)\n    \u2193\nHttpApiService (dependency injection)\n    \u2193 Apache HttpClient\nBitbucket API\n</code></pre> <ul> <li>Constructor injection \u2192 Simple mocking</li> <li>Class structure \u2192 Modularization complete</li> <li>Apache HttpClient \u2192 WireMock integration available</li> </ul> Item Before (Python) After (HttpApiService) Structure 9 CLI scripts 1 Service class Test Method Integration only Unit + Integration Mock Complexity High (process isolation) Low (constructor injection) Reusability Low (copy-paste) High (DI) Lines of Code ~1,484 lines 172 lines <p>Core Difference:</p> <pre><code>Before: sh(\"python3 script.py\") \u2500\u2500\u2192 Direct requests.post() call\n        (external process)          (complex mocking)\n\nAfter:  bitbucketApiLibrary \u2500\u2500\u2192 Map { apiUrlString, requestBody, method }\n        (pure data return)       (testable)\n\n        HttpApiService \u2500\u2500\u2192 Apache HttpClient\n        (dependency injection)  (WireMock testable)\n</code></pre>"},{"location":"highlights/#5-reference","title":"5. Reference","text":""},{"location":"highlights/#repository","title":"Repository","text":"<ul> <li>Local clone: <code>repos/devops-jenkins-linux</code></li> <li>GitHub: <code>https://github.com/JindoKimKor/devops-jenkins-linux</code></li> </ul>"},{"location":"highlights/#related-documents","title":"Related Documents","text":"<ul> <li>legs/ - Step-by-step change records</li> <li>logger-system-design-integration.md - Logger System design details</li> </ul>"},{"location":"logger-system-design-integration/","title":"3-Level Logger System Design &amp; Integration","text":"<p>Hierarchical logging system design for consistent logging in Jenkins Pipeline</p>"},{"location":"logger-system-design-integration/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Design Background</li> <li>1.1 Problem: Issues with Existing Logging<ul> <li>1.1.1 Problem Summary</li> <li>1.1.2 Lack of Consistency</li> <li>1.1.3 Lack of Structure: Cognitive Chunking Impossible</li> <li>1.1.4 Jenkins Logging System Limitations</li> <li>1.1.4.1 Same echo Call \u2192 Simultaneous Output to Two Places</li> <li>1.1.4.2 Output Flow</li> <li>1.1.4.3 Constraints</li> <li>1.1.4.4 Jenkins Content Security Policy Constraints (Reference)</li> <li>1.1.5 Code Duplication (DRY Violation)</li> </ul> </li> <li>1.2 Solution: Discovering Chunking Units (Steps Group)<ul> <li>1.2.1 What is Steps Group?</li> <li>1.2.2 3-Level Logger Design</li> <li>1.2.3 Design Result: Logging Responsibility Distribution by Layer</li> </ul> </li> <li>Architecture Integration</li> <li>2.1 Position within 4-Layer Architecture</li> <li>2.2 Library-Helper Auto Logging Integration<ul> <li>2.2.1 Embedding Logging Metadata in Library</li> <li>2.2.2 Helper Auto Logging with Metadata</li> </ul> </li> <li>2.3 Integration with shellScriptHelper</li> <li>Before/After Comparison</li> </ol>"},{"location":"logger-system-design-integration/#1-design-background","title":"1. Design Background","text":""},{"location":"logger-system-design-integration/#11-problem-issues-with-existing-logging","title":"1.1 Problem: Issues with Existing Logging","text":""},{"location":"logger-system-design-integration/#111-problem-summary","title":"1.1.1 Problem Summary","text":"# Problem Description 1 Lack of Consistency Different logging formats in each file 2 Lack of Structure No cognitive chunking unit besides Stage 3 Jenkins Output Constraints Format customization impossible due to CPS/Sandbox 4 Code Duplication <code>logMessage()</code> function copied across multiple files"},{"location":"logger-system-design-integration/#112-lack-of-consistency","title":"1.1.2 Lack of Consistency","text":"<p>Different logging methods in each file:</p> File Logging Method Problem <code>generalHelper.groovy</code> <code>logMessage()</code> function Self-implemented <code>jsHelper.groovy</code> <code>logMessage()</code> function Same copy as generalHelper (DRY violation) <code>Jenkinsfile</code> Direct <code>echo</code> call No format"},{"location":"logger-system-design-integration/#113-lack-of-structure-cognitive-chunking-impossible","title":"1.1.3 Lack of Structure: Cognitive Chunking Impossible","text":"<p>Problem: In the entire Pipeline, except for <code>Stage</code>, there is no conceptual distinction useful for human recognition</p> <p>In cognitive psychology, Chunking is a strategy for processing information by grouping it into meaningful units. The clearer the boundary, the faster and easier it is to receive information.</p> Current State Problem Stage \u2192 (all logs listed flat) Dozens of lines of logs without intermediate units Individual Steps listed Cannot distinguish logical task groups When error occurs Difficult to trace \"where did the error occur?\""},{"location":"logger-system-design-integration/#114-jenkins-logging-system-limitations","title":"1.1.4 Jenkins Logging System Limitations","text":""},{"location":"logger-system-design-integration/#1141-same-echo-call-simultaneous-output-to-two-places","title":"1.1.4.1 Same echo Call \u2192 Simultaneous Output to Two Places","text":"Stage View (actual screenshot) Console Output (example) Log visible in Pipeline Stage UI Same log example visible in Console Log <p>Core Problem: A single <code>echo</code> call outputs to both Stage View and Console Output, and neither can customize the format</p>"},{"location":"logger-system-design-integration/#1142-output-flow","title":"1.1.4.2 Output Flow","text":"<pre><code>flowchart LR\n    subgraph Groovy[\"Pipeline Script\"]\n        ECHO[\"echo 'message'\"]\n        SH[\"sh 'command'\"]\n    end\n\n    subgraph Jenkins[\"Jenkins Internal\"]\n        CPS[\"CPS Transform\"]\n        LOG[\"Console Logger\"]\n    end\n\n    subgraph Output[\"Output (Fixed Format)\"]\n        STAGE[\"Stage View\"]\n        CONSOLE[\"Console Output\"]\n    end\n\n    ECHO --&gt; CPS\n    SH --&gt; CPS\n    CPS --&gt; LOG\n    LOG --&gt; STAGE\n    LOG --&gt; CONSOLE\n\n    style CPS fill:#ff6b6b,stroke:#333\n    style LOG fill:#ff6b6b,stroke:#333</code></pre>"},{"location":"logger-system-design-integration/#1143-constraints","title":"1.1.4.3 Constraints","text":"Constraint Description Fixed format Timestamp + <code>[Pipeline]</code> marker + message mixed Flat structure All <code>echo</code>, <code>sh</code> commands listed at the same level No customization Jenkins Content Security Policy enforces UI output format No hierarchy Difficult to find specific tasks in long logs"},{"location":"logger-system-design-integration/#1144-jenkins-content-security-policy-constraints-reference","title":"1.1.4.4 Jenkins Content Security Policy Constraints (Reference)","text":"<p>Jenkins applies a restrictive Content Security Policy by default to prevent XSS attacks:</p> <p>Do not use inline JavaScript (JS) in the Jenkins GUI, i.e., JS embedded in HTML output.</p> <p>\u2014 Jenkins Developer: Content-Security-Policy Compatibility</p> <ul> <li>Default CSP: <code>default-src 'none'</code> - blocks scripts, fonts, iframes, etc.</li> <li>Cannot customize Console Output UI (requires system property modification with admin privileges)</li> <li><code>echo</code> and <code>println</code> are processed identically internally by Jenkins (reference)</li> </ul>"},{"location":"logger-system-design-integration/#115-code-duplication-dry-violation","title":"1.1.5 Code Duplication (DRY Violation)","text":"<pre><code>// generalHelper.groovy line 35-44\nvoid logMessage(String message) { ... }\n\n// jsHelper.groovy line 7-16 (exact same copy)\nvoid logMessage(String message) { ... }\n</code></pre>"},{"location":"logger-system-design-integration/#12-solution-discovering-chunking-units-steps-group","title":"1.2 Solution: Discovering Chunking Units (Steps Group)","text":""},{"location":"logger-system-design-integration/#121-what-is-steps-group","title":"1.2.1 What is Steps Group?","text":"<p>A group where multiple Steps come together to form a meaningful unit of work (Task).</p> <pre><code>Stage: Jenkins Initialization\n\u2502\n\u251c\u2500\u2500 Steps Group: \"Set Up Environment Variables\"  \u2190 Meaningful unit of work\n\u2502   \u251c\u2500\u2500 Step: Configure Report Directory\n\u2502   \u251c\u2500\u2500 Step: Extract ticket number\n\u2502   \u2514\u2500\u2500 Step: Set build parameters\n\u2502\n\u2514\u2500\u2500 Steps Group: \"Send Build Status\"             \u2190 Meaningful unit of work\n    \u251c\u2500\u2500 Step: Prepare API request\n    \u2514\u2500\u2500 Step: POST to Bitbucket API\n</code></pre>"},{"location":"logger-system-design-integration/#122-3-level-logger-design","title":"1.2.2 3-Level Logger Design","text":"<p>Jenkins Provides vs What's Needed:</p> Jenkins Default Actually Needed Stage Level: <code>stage('name') { ... }</code> Stage Level (None) Steps Group Level \u2190 Newly introduced Step Level: <code>sh</code>, <code>echo</code>, <code>withCredentials</code>, etc. Step Level <p>Conclusion: Steps Group level is needed between Stage and Step</p> <p>3-Level Structure:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Level 1: Stage                                              \u2502\n\u2502 ===== STAGE Starting: [ Jenkins Initialization ] =====      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Level 2: Steps Group                                        \u2502\n\u2502 --- STEPS Starting Group: [ Set Up Environment ] ---        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Level 3: Step (by status)                                   \u2502\n\u2502 \u27a1\ufe0f Step Starting: [ Configure Report Directory ]...         \u2502\n\u2502 \ud83d\udcac Step Info: [ REPORT_DIR: /workspace/PRJob ]              \u2502\n\u2502 \ud83c\udfc3 Step Processing: [ Fetching origin branches ]            \u2502\n\u2502 \u2705 Step Completed: [ Configure Report Directory ]           \u2502\n\u2502 \u26a0\ufe0f Step Warning: [ Branch not found, using default ]        \u2502\n\u2502 \u274c Step Failed: [ Git fetch failed ]                        \u2502\n\u2502 \ud83d\udd25 Step Error: [ Exception occurred ]                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Step Status Classification:</p> Status Emoji Usage Starting \u27a1\ufe0f Task start notification Info \ud83d\udcac Informational message (variable values, settings, etc.) Processing \ud83c\udfc3 Task in progress Success \u2705 Task completed successfully Warning \u26a0\ufe0f Warning (can continue) Failed \u274c Task failed (recoverable) Error \ud83d\udd25 Serious error (pipeline stops) <p>Logger API:</p> <pre><code>// Level 1: Stage\nlogger.stageStart(stageName)\nlogger.stageEnd(stageName)\n\n// Level 2: Steps Group\nlogger.stepsGroupStart(groupName)\nlogger.stepsGroupEnd(groupName)\n\n// Level 3: Step (by status)\nlogger.stepStart(description)\nlogger.stepInfo(description)\nlogger.stepProcessing(description)\nlogger.stepSuccess(description)\nlogger.stepWarning(description)\nlogger.stepFailed(description)\nlogger.stepError(description)\nlogger.stepError(description, Throwable)  // Including stack trace\n</code></pre>"},{"location":"logger-system-design-integration/#123-design-result-logging-responsibility-distribution-by-layer","title":"1.2.3 Design Result: Logging Responsibility Distribution by Layer","text":"<p>Introduced a 3-Level chunking-based logging system to the Pipeline domain and integrated with the existing 4-Layer Architecture to implement a systematic solution where each layer only handles logging responsibility appropriate to its role.</p> Component Role Logging Responsibility Logger 3-Level chunking system (Stage/Steps Group/Step) Output format, hierarchy structure definition Library Cognitive classification unit for specific functions within domain Define <code>label</code> appropriate for that function Helper Domain logic orchestration Call logger according to orchestration flow Stage Business workflow Define Steps Group boundaries <p>See Section 2: Architecture Integration for detailed implementation</p>"},{"location":"logger-system-design-integration/#2-architecture-integration","title":"2. Architecture Integration","text":""},{"location":"logger-system-design-integration/#21-position-within-4-layer-architecture","title":"2.1 Position within 4-Layer Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 1: Entry Point (Jenkinsfile)                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Layer 2: Orchestration (vars/stage*.groovy)                 \u2502\n\u2502          \u2193 uses                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Layer 3: Business Logic (src/service/)                      \u2502\n\u2502          \u2193 uses                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Layer 4: Infrastructure                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 src/utils/      \u2502 src/resource/   \u2502 vars/ (Cross)   \u2502   \u2502\n\u2502  \u2502 *Library.groovy \u2502 Status.groovy   \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502   \u2502\n\u2502  \u2502                 \u2502                 \u2502 \u2502 logger      \u2502 \u2502   \u2502\n\u2502  \u2502                 \u2502                 \u2502 \u2502 bitbucket   \u2502 \u2502   \u2502\n\u2502  \u2502                 \u2502                 \u2502 \u2502 ApiLibrary  \u2502 \u2502   \u2502\n\u2502  \u2502                 \u2502                 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Logger's Position: Layer 4 (Infrastructure) - Cross-Cutting Concerns</p>"},{"location":"logger-system-design-integration/#22-library-helper-auto-logging-integration","title":"2.2 Library-Helper Auto Logging Integration","text":"<p>Logger is used system-wide as a Cross-Cutting Concern: - Used by all Stage modules - shellScriptHelper, bitbucketApiHelper internally use logger (auto logging) - Single entry point for unified logging format</p>"},{"location":"logger-system-design-integration/#221-embedding-logging-metadata-in-library","title":"2.2.1 Embedding Logging Metadata in Library","text":""},{"location":"logger-system-design-integration/#a-shell-script-logging-integration","title":"(a) Shell Script Logging Integration","text":"<pre><code>flowchart LR\n    subgraph Libraries[\"Shell Libraries\"]\n        GIT[GitLibrary]\n        SHL[ShellLibrary]\n        SSHL[SSHShellLibrary]\n    end\n\n    subgraph Helper[\"shellScriptHelper\"]\n        VALIDATE[validateShMap]\n        EXEC[execute]\n    end\n\n    subgraph Logger[\"logger\"]\n        START[stepStart]\n        SUCCESS[stepSuccess]\n        FAILED[stepFailed]\n        RESULT[stepShellExecutedResult]\n    end\n\n    GIT --&gt;|\"{script, label}\"| VALIDATE\n    SHL --&gt;|\"{script, label}\"| VALIDATE\n    SSHL --&gt;|\"{script, label}\"| VALIDATE\n\n    VALIDATE --&gt; START\n    VALIDATE --&gt; EXEC\n    EXEC --&gt;|success| SUCCESS\n    EXEC --&gt;|failure| FAILED\n    EXEC --&gt;|result| RESULT</code></pre> <p>Core Design: Each Library's closure includes <code>label</code> metadata for Helper to auto-log</p> <pre><code>// GitLibrary.groovy - Each closure includes script + label\nstatic final Closure FetchOriginReturnStatus = {\n    [\n        script: 'git fetch origin',\n        label: 'Fetch all remote branches from origin',  // \u2190 Logging metadata\n        returnStatus: true\n    ]\n}\n\nstatic final Closure CheckoutBranch = { String branchName -&gt;\n    [\n        script: \"git checkout ${branchName}\",\n        label: \"Checkout branch '${branchName}'\",  // \u2190 Parameterized label\n        returnStdout: true\n    ]\n}\n</code></pre>"},{"location":"logger-system-design-integration/#b-bitbucket-api-logging-integration","title":"(b) Bitbucket API Logging Integration","text":"<pre><code>flowchart LR\n    subgraph Library[\"bitbucketApiLibrary\"]\n        BUILD[createBuildStatus]\n        REPORT[createTestReport]\n    end\n\n    subgraph Helper[\"bitbucketApiHelper\"]\n        CALL[call]\n        HTTP[HttpApiService]\n    end\n\n    subgraph Logger[\"logger\"]\n        START[stepStart]\n        SUCCESS[stepSuccess]\n        ERROR[stepError]\n    end\n\n    BUILD --&gt;|\"{apiUrl, body, method}\"| CALL\n    REPORT --&gt;|\"{apiUrl, body, method}\"| CALL\n\n    CALL --&gt; START\n    CALL --&gt; HTTP\n    HTTP --&gt;|success| SUCCESS\n    HTTP --&gt;|failure| ERROR</code></pre>"},{"location":"logger-system-design-integration/#same-pattern-applied","title":"Same Pattern Applied","text":"Library Metadata Usage GitLibrary <code>script</code>, <code>label</code> Shell command + log message ShellLibrary <code>script</code>, <code>label</code> Shell command + log message SSHShellLibrary <code>script</code>, <code>label</code> SSH command + log message bitbucketApiLibrary <code>apiUrlString</code>, <code>requestBody</code>, <code>method</code> API request info"},{"location":"logger-system-design-integration/#222-helper-auto-logging-with-metadata","title":"2.2.2 Helper Auto Logging with Metadata","text":"<p>shellScriptHelper: Reads <code>label</code> from Library and automatically calls logger</p> <pre><code>// shellScriptHelper.groovy\ndef call(Closure shellScriptClosure, List args = []) {\n    Map shMap = shellScriptClosure(*args)\n    Map validatedShMap = validateShMap(shMap)\n\n    // Read label for auto logging\n    logger.stepStart(\"'${validatedShMap.script}' '${validatedShMap.label}' (Execute)\")\n\n    if (validatedShMap.returnStatus) {\n        return executeReturnStatus(validatedShMap)  // Success/failure logging inside\n    } else if (validatedShMap.returnStdout) {\n        return executeReturnStdout(validatedShMap)  // Result logging inside\n    }\n    // ...\n}\n</code></pre> <p>bitbucketApiHelper: Same pattern for API execution + auto logging</p> <pre><code>// bitbucketApiHelper.groovy\ndef call(Map bitbucketApiMap) {\n    logger.stepStart(\"bitbucketApiHelper execution started\")\n\n    // Execute API with Map received from bitbucketApiLibrary\n    if (bitbucketApiMap.method == 'POST') {\n        return bitbucketApiService.post(\n            bitbucketApiMap.apiUrlString,\n            bitbucketApiMap.requestBody,\n            bitbucketAccessToken\n        )\n    }\n\n    logger.stepSuccess(\"bitbucketApiHelper execution completed\")\n}\n</code></pre>"},{"location":"logger-system-design-integration/#23-integration-with-shellscripthelper","title":"2.3 Integration with shellScriptHelper","text":"<p>shellScriptHelper uses logger internally for auto logging:</p> <pre><code>sequenceDiagram\n    participant Stage as stageProjectPrepare\n    participant SSH as shellScriptHelper\n    participant LOG as logger\n    participant SH as Jenkins sh()\n\n    Stage-&gt;&gt;SSH: execute(GitLibrary.FetchOrigin)\n    SSH-&gt;&gt;LOG: stepStart(\"Fetching origin\")\n    SSH-&gt;&gt;SH: sh(\"git fetch origin\")\n    SH--&gt;&gt;SSH: result\n    alt Success\n        SSH-&gt;&gt;LOG: stepSuccess(\"Origin fetched\")\n    else Failure\n        SSH-&gt;&gt;LOG: stepFailed(\"Fetch failed\")\n    end\n    SSH--&gt;&gt;Stage: result</code></pre> <p>Integration Benefits: - No need to write logging code every time in Stage module - Auto start/success/failure logging when executing Shell commands - Consistent format guaranteed</p>"},{"location":"logger-system-design-integration/#3-beforeafter-comparison","title":"3. Before/After Comparison","text":""},{"location":"logger-system-design-integration/#stage-log-blue-ocean-ui","title":"Stage Log (Blue Ocean UI)","text":"Before After"},{"location":"logger-system-design-integration/#console-log","title":"Console Log","text":"<p>Note: Console screenshot could not be captured, substituting with text.</p>"},{"location":"logger-system-design-integration/#before-scattered-echo","title":"Before (scattered echo)","text":"<pre><code>[Pipeline] echo\n2025-03-20T10:23:45.123Z Fetching origin...\n[Pipeline] sh\n2025-03-20T10:23:45.456Z + git fetch origin\n[Pipeline] echo\n2025-03-20T10:23:46.789Z REPORT_DIR: /workspace/PRJob/feature-branch\n[Pipeline] echo\n2025-03-20T10:23:47.012Z Sending build status to Bitbucket\n</code></pre> <p>Problems: All messages at same level, no structure, difficult to trace errors</p>"},{"location":"logger-system-design-integration/#after-3-level-logger","title":"After (3-Level Logger)","text":"<pre><code>===== STAGE Starting: [ Jenkins Initialization ] =====\n--- STEPS Starting Group: [ Set Up Environment Variables ] ---\n\u27a1\ufe0f Step Starting: [ Configure Report Directory ]...\n\ud83d\udcac Step Info: [ REPORT_DIR: /workspace/PRJob/feature-branch ]\n\u2705 Step Completed: [ Configure Report Directory ]\n--- STEPS Completed Group: [ Set Up Environment Variables ] ---\n===== STAGE Completed: [ Jenkins Initialization ] =====\n</code></pre>"},{"location":"logger-system-design-integration/#change-summary","title":"Change Summary","text":"Item Before After Logging function location generalHelper, jsHelper (copied) logger.groovy (single) Format consistency None 100% Error traceability Difficult Immediate identification"},{"location":"logger-system-design-integration/#reference","title":"Reference","text":"<ul> <li>Leg 2 Changelog - Detailed implementation process record</li> <li>highlights.md - Logger System Integration section</li> <li>refactoring-result-snapshot.md - Facade Pattern explanation</li> </ul>"},{"location":"problem-analysis-overview/","title":"Problem Analysis: Baseline Code Analysis","text":"<p>Analysis Target: Commit <code>74fc356</code> (2025-03-20)</p> <p>Total Code: 2,975 lines across 8 files</p>"},{"location":"problem-analysis-overview/#overview","title":"Overview","text":"<p>Technical debt analysis of 5 pipelines (DLX CI/CD, JS CI/CD, PipelineForJenkins) that grew over 14 months with focus on feature additions.</p>"},{"location":"problem-analysis-overview/#key-metrics","title":"Key Metrics","text":"Metric Value Total Lines of Code 2,975 lines Helper Files 1,369 lines (46%) Jenkinsfile 1,606 lines (54%) Identified Issues 51 (High 20, Medium 23, Low 8)"},{"location":"problem-analysis-overview/#project-structure","title":"Project Structure","text":"<pre><code>devops-jenkins-linux/\n\u251c\u2500\u2500 groovy/                              # Helper files (1,369 lines, 46%)\n\u2502   \u251c\u2500\u2500 generalHelper.groovy      656 lines    \u2190 Kitchen Sink (19% cohesion)\n\u2502   \u251c\u2500\u2500 unityHelper.groovy        357 lines    \u2190 Unity specific\n\u2502   \u2514\u2500\u2500 jsHelper.groovy           356 lines    \u2190 JS Web specific\n\u251c\u2500\u2500 DLXJenkins/                          # Unity pipeline (551 lines)\n\u2502   \u251c\u2500\u2500 Jenkinsfile               286 lines    \u2190 CI\n\u2502   \u2514\u2500\u2500 JenkinsfileDeployment     265 lines    \u2190 CD\n\u251c\u2500\u2500 JsJenkins/                           # JS Web pipeline (740 lines)\n\u2502   \u251c\u2500\u2500 Jenkinsfile               314 lines    \u2190 CI\n\u2502   \u2514\u2500\u2500 JenkinsfileDeployment     426 lines    \u2190 CD\n\u2514\u2500\u2500 PipelineForJenkins/                  # Jenkins self pipeline (315 lines)\n    \u2514\u2500\u2500 Jenkinsfile               315 lines    \u2190 CI only\n</code></pre>"},{"location":"problem-analysis-overview/#detailed-analysis-documents","title":"Detailed Analysis Documents","text":"<p>\ud83d\udc49 Problem Analysis Summary - Complete list of 51 issues with severity classification</p>"},{"location":"problem-analysis-overview/#per-file-analysis","title":"Per-File Analysis","text":"# File SRP Analysis Software Smells Design Symptoms 01 generalHelper.groovy srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 02 jsHelper.groovy srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 03 unityHelper.groovy srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 04 DLXJenkins/Jenkinsfile srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 05 DLXJenkins/JenkinsfileDeployment srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 06 JsJenkins/Jenkinsfile srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 07 JsJenkins/JenkinsfileDeployment srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 08 PipelineForJenkins/Jenkinsfile srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md"},{"location":"problem-analysis-overview/#system-level-analysis","title":"System-Level Analysis","text":"<ul> <li>DRY Violation Analysis - Duplication patterns across pipelines/helpers</li> <li>Pipeline Sequence Diagrams - Call flow visualization by pipeline</li> <li>Software Smells Taxonomy - Theoretical classification framework used in analysis</li> </ul>"},{"location":"problem-analysis-overview/#analysis-results-summary","title":"Analysis Results Summary","text":""},{"location":"problem-analysis-overview/#baseline-analysis-conclusions","title":"Baseline Analysis Conclusions","text":"<ul> <li>Jenkinsfile INLINE duplication: 29-31% (not abstracted to helpers)</li> <li>Change reasons per Helper file: 8-17 (God Object)</li> <li>generalHelper: Kitchen Sink class (no classification criteria, 19% cohesion)</li> </ul>"},{"location":"problem-analysis-overview/#key-symptoms","title":"Key Symptoms","text":"<ul> <li>Untestable Structure: Helper functions strongly coupled to Jenkins environment, making unit testing impossible</li> <li>Shotgun Surgery: One line of code change \u2192 Must check all 5 pipelines</li> <li>Technical Debt Vicious Cycle: Code no one dares touch \u2192 New features copy-pasted INLINE \u2192 Duplication increases</li> </ul>"},{"location":"problem-analysis-overview/#real-world-experience","title":"Real-World Experience","text":""},{"location":"problem-analysis-overview/#human-error-prone-structure","title":"Human Error Prone Structure","text":"<ul> <li>Modified INLINE code in CI Jenkinsfile, tested only CI pipeline</li> <li>Forgot about identical INLINE code in CD Jenkinsfile, deployed \u2192 CD pipeline not applied</li> <li>Modified Helper function + CI Jenkinsfile, missed CD Jenkinsfile update \u2192 CD pipeline broken</li> </ul>"},{"location":"problem-analysis-overview/#risk-of-needing-to-consider-everything-for-one-feature","title":"Risk of Needing to Consider Everything for One Feature","text":"<ul> <li>When changing common functionality like \"Add Warning status to build results\":</li> <li>Must find and modify all 5 pipelines individually</li> <li>Context switching when interrupted by other ticket work</li> <li>Need to notify team members before every change</li> </ul>"},{"location":"problem-analysis-overview/#workflow-and-teamwork-threatened-by-strong-coupling","title":"Workflow and Teamwork Threatened by Strong Coupling","text":"<ul> <li>Multiple responsibilities concentrated in single file + strong coupling</li> <li>One person's code changes affect other team members' work</li> <li>Psychologically reluctant to modify/add features \u2192 Teamwork degradation</li> </ul>"},{"location":"problem-analysis-overview/#roi-degradation","title":"ROI Degradation","text":"<ul> <li>Even simple modifications can't focus on just that feature</li> <li>Must consider 5 pipelines + Jenkins UI settings + Webhook/Third-party APIs</li> <li>10-20 minute tasks extend to hours or days</li> </ul> Case Study: cloneOrUpdateRepo() function unable to handle project structure changes <p>The <code>cloneOrUpdateRepo()</code> function was designed with the assumption that there's only one project in the root folder.</p> <ul> <li>Unity: Single project folder at root (<code>Unity_Project/</code>)</li> <li>JS Web: <code>frontend/</code>, <code>backend/</code> subfolders at root, each with independent <code>package.json</code></li> </ul> <p>When the web development team used a different folder structure, this function threw errors:</p> <ol> <li>Debugging difficulty: Error handling and logging were inadequate, couldn't determine what values were being passed</li> <li>Root cause identification: Contacted dev team \u2192 Checked project structure \u2192 Discovered different folder structure than Unity</li> <li>Code modification attempt: Tried modifying helper function internals \u2192 Caused issues in other pipeline (Unity)</li> <li>Jenkinsfile modification attempt: Couldn't bring myself to touch it (affects 5 pipelines)</li> <li>Final workaround: Temporarily handled by modifying environment variables in pipeline webhook settings via Jenkins web UI</li> </ol> <p>Eventually gave up on helper for CD pipeline and implemented INLINE directly:</p> <pre><code>// JenkinsfileDeployment - INLINE implementation instead of helper\ndir(\"${PROJECT_DIR}\") {\n    sh \"git checkout ${DESTINATION_BRANCH}\"\n    sh 'git reset --hard HEAD'\n    sh 'git pull'\n}\n</code></pre>"},{"location":"problem-analysis-overview/#reference","title":"Reference","text":"<ul> <li>Jenkins Shared Libraries Documentation</li> <li>Pipeline: Groovy Plugin - load step</li> </ul>"},{"location":"pull-request-documentation/","title":"Pull Request Documentation","text":"<p>Documentation attached to the Pull Request for Jenkins Shared Library refactoring.</p>"},{"location":"legs/","title":"Legs: Step-by-Step Refactoring Records","text":""},{"location":"legs/#1-overview","title":"1. Overview","text":"<p>This folder documents the Jenkins Shared Library 4-Layer architecture construction process divided into 5 Legs.</p> <ul> <li>Total Duration: 2025-03-20 ~ 2025-05-12 (54 days)</li> <li>Total Commits: 275</li> <li>Goal: Refactoring from single Jenkinsfile \u2192 4-Layer structure</li> </ul>"},{"location":"legs/#2-related-documents","title":"2. Related Documents","text":"Document Description Reading Order highlights.md Final architecture and key features 1. Results first problem-analysis-overview.md Baseline code problems 2. Why it was needed legs/ (current) Step-by-step implementation process 3. How it was built"},{"location":"legs/#3-reference-commits","title":"3. Reference Commits","text":"Status Commit Hash Date Baseline (Before) <code>74fc356</code> 2025-03-20 Final (After) <code>ff74ac8</code> 2025-05-12"},{"location":"legs/#4-legs-details","title":"4. Legs Details","text":"Leg Title Duration Commits Key Achievements 0 Global Trusted Shared Library Setup 03-20 ~ 04-24 40 Layer 1-3 basic structure, vars/ folder 1 ShellScript Modularization 04-25 12 ShellScript Helper, Stage modularization 2 3-Level Logger System 04-26 11 stageStart/stepsGroup/stepInfo 3 Bitbucket API &amp; Shell Library 05-01 ~ 05-05 84 Layer 4, GitLibrary, BitbucketAPI 4 Full Pipeline Refactoring 05-06 ~ 05-12 128 All Stage modularization, SSH Library"},{"location":"legs/#5-key-content-by-leg","title":"5. Key Content by Leg","text":"Leg 0: Global Trusted Shared Library Setup <ul> <li>Jenkins Global Trusted Shared Library connection</li> <li>4-Layer architecture basic design</li> <li>vars/, src/ folder structure establishment</li> <li>Learning: @NonCPS, CPS compatibility</li> </ul> Leg 1: ShellScript Modularization <ul> <li>helperShellScript.groovy separation</li> <li>stageInitialization first Stage module</li> <li>ShellParams data class</li> <li>Learning: @Canonical removal (CPS issue)</li> </ul> Leg 2: 3-Level Logger System <ul> <li>logger.groovy 3-level logging</li> <li>Stage &gt; Steps Group &gt; Step</li> <li>Emoji-based status display</li> <li>Learning: private/static removal (CPS issue)</li> </ul> Leg 3: Bitbucket API &amp; Shell Library <ul> <li>BitbucketApiService class</li> <li>GitLibrary, ShellLibrary separation</li> <li>stageProjectPrepare module</li> <li>Learning: HttpURLConnection, Closure pattern</li> </ul> Leg 4: Full Pipeline Refactoring <ul> <li>Complete refactoring of 3 pipelines</li> <li>All Stage modularization completed</li> <li>SSHShellLibrary added</li> <li>Result: Jenkinsfile reduced to under 10 lines</li> </ul>"},{"location":"legs/#6-progress-flow","title":"6. Progress Flow","text":"<pre><code>Leg 0: Infrastructure \u2192 Leg 1: Shell Helper \u2192 Leg 2: Logger \u2192 Leg 3: API/Library \u2192 Leg 4: Completion\n       (35 days)            (1 day)              (1 day)          (5 days)             (7 days)\n</code></pre>"},{"location":"legs/#7-related-documents","title":"7. Related Documents","text":"Document Description Analysis Basis refactoring-result-snapshot.md 4-Layer Architecture details, Design Patterns, code statistics Commit <code>12910c1</code> logger-system-design-integration.md 3-Level Logger design document (Problem analysis \u2192 Solution \u2192 Implementation) Leg 2 details"},{"location":"legs/#8-reference","title":"8. Reference","text":"<ul> <li>Jenkins Shared Libraries Documentation</li> <li>Pipeline: Groovy Plugin - load step</li> </ul>"},{"location":"legs/refactoring-result-snapshot/","title":"Refactoring Result Snapshot","text":"<p>Note: This document is analyzed based on commit <code>12910c1</code>.</p> <p>Analysis Direction: - 4-Layer Architecture detailed structure - Design Patterns application status - Integration Flow (Mermaid Diagrams) - Code Duplication Before/After comparison</p> <p>This document provides a comprehensive analysis of the codebase after the refactoring effort.</p> <ul> <li>Commit: <code>12910c1</code> (Latest on Temporary-Branch)</li> <li>Purpose: Portfolio documentation, Resume preparation, Interview reference, Technical blog content</li> </ul>"},{"location":"legs/refactoring-result-snapshot/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Overview</li> <li>1.1 File Statistics</li> <li>1.2 Architecture Summary</li> <li>Complete File Structure</li> <li>Folder-by-Folder Analysis</li> <li>3.1 sharedLibraries/vars/</li> <li>3.2 sharedLibraries/src/</li> <li>3.3 DLXJenkins/ &amp; JsJenkins/</li> <li>3.4 groovy/</li> <li>3.5 python/</li> <li>3.6 tests/</li> <li>Design Patterns Applied</li> <li>Integration Flow</li> <li>Current State Summary</li> <li>Dependency Graph</li> <li>Remaining Work</li> <li>Code Duplication Analysis</li> <li>Conclusion</li> </ol>"},{"location":"legs/refactoring-result-snapshot/#1-overview","title":"1. Overview","text":""},{"location":"legs/refactoring-result-snapshot/#11-file-statistics","title":"1.1 File Statistics","text":"Category Files Lines (approx) Status sharedLibraries/vars/ 13 1,104 NEW - Pipeline stages sharedLibraries/src/ 7 1,126 NEW - Core business logic groovy/ 3 1,824 Legacy (being migrated) DLXJenkins/ 2 286 Refactored JsJenkins/ 2 743 Being Refactored PipelineForJenkins/ 1 185 Being Refactored python/ 15 2,069 Legacy (to be eliminated) Bash/ 2 330 Shell scripts tests/ 6 243 NEW - Unit tests TOTAL 51 7,910"},{"location":"legs/refactoring-result-snapshot/#12-architecture-summary","title":"1.2 Architecture Summary","text":"<p>The refactored codebase implements a 4-Layer Architecture with clear separation of concerns:</p> <pre><code>flowchart TB\n    subgraph Layer1[\"Layer 1: Entry Point\"]\n        JF[Jenkinsfile]\n    end\n\n    subgraph Layer2[\"Layer 2: Orchestration (vars/)\"]\n        STAGES[Stage Functions]\n        LOGGER[logger.groovy]\n        SSH[shellScriptHelper.groovy]\n        BAH[bitbucketApiHelper.groovy]\n    end\n\n    subgraph Layer3[\"Layer 3: Services (src/service/)\"]\n        HTTP[HttpApiService]\n        PWS[PrepareWorkspaceService]\n        BPS[BuildProjectService]\n    end\n\n    subgraph Layer4[\"Layer 4: Utilities (src/utils/)\"]\n        GIT[GitLibrary]\n        SHELL[ShellLibrary]\n        SSHLIB[SSHShellLibrary]\n    end\n\n    subgraph Layer5[\"Layer 5: Resources (src/resource/)\"]\n        STATUS[Status Constants]\n    end\n\n    JF --&gt; STAGES\n    STAGES --&gt; LOGGER\n    STAGES --&gt; SSH\n    STAGES --&gt; BAH\n    SSH --&gt; GIT\n    SSH --&gt; SHELL\n    SSH --&gt; SSHLIB\n    BAH --&gt; HTTP\n    STAGES --&gt; STATUS\n    HTTP --&gt; STATUS</code></pre>"},{"location":"legs/refactoring-result-snapshot/#2-complete-file-structure","title":"2. Complete File Structure","text":"<pre><code>devops-linux-jenkins/\n\u2502\n\u251c\u2500\u2500 sharedLibraries/                                    [20 files - Core Library]\n\u2502   \u251c\u2500\u2500 vars/                                           [13 files - Pipeline Functions]\n\u2502   \u2502   \u251c\u2500\u2500 logger.groovy                                   - Centralized logging\n\u2502   \u2502   \u251c\u2500\u2500 shellScriptHelper.groovy                        - Shell execution wrapper\n\u2502   \u2502   \u251c\u2500\u2500 bitbucketApiHelper.groovy                       - Bitbucket API facade\n\u2502   \u2502   \u251c\u2500\u2500 bitbucketApiLibrary.groovy                      - API request builder\n\u2502   \u2502   \u251c\u2500\u2500 stageInitialization.groovy                      - Pipeline initialization\n\u2502   \u2502   \u251c\u2500\u2500 stageProjectPrepare.groovy                      - Project preparation\n\u2502   \u2502   \u251c\u2500\u2500 stageLintUnity.groovy                           - Unity linting\n\u2502   \u2502   \u251c\u2500\u2500 stageLintGroovyJenkinsfile.groovy               - Groovy linting\n\u2502   \u2502   \u251c\u2500\u2500 stageUnityExecution.groovy                      - Unity test execution\n\u2502   \u2502   \u251c\u2500\u2500 stageStaticAnalysis.groovy                      - SonarQube analysis\n\u2502   \u2502   \u251c\u2500\u2500 stageSendBuildResults.groovy                    - Build result reporting\n\u2502   \u2502   \u251c\u2500\u2500 stageDeployBuild.groovy                         - Build deployment\n\u2502   \u2502   \u2514\u2500\u2500 stageCleanupPRBranchArtifacts.groovy            - PR cleanup\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 src/                                            [7 files - Library Source]\n\u2502       \u251c\u2500\u2500 resource/\n\u2502       \u2502   \u2514\u2500\u2500 Status.groovy                               - Status constants\n\u2502       \u2502\n\u2502       \u251c\u2500\u2500 service/\n\u2502       \u2502   \u251c\u2500\u2500 general/\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 HttpApiService.groovy                   - HTTP client\n\u2502       \u2502   \u2502   \u2514\u2500\u2500 PrepareWorkspaceService.groovy\n\u2502       \u2502   \u2502\n\u2502       \u2502   \u2514\u2500\u2500 unity/\n\u2502       \u2502       \u2514\u2500\u2500 BuildProjectService.groovy\n\u2502       \u2502\n\u2502       \u2514\u2500\u2500 utils/\n\u2502           \u251c\u2500\u2500 GitLibrary.groovy                           - Git operations\n\u2502           \u251c\u2500\u2500 ShellLibrary.groovy                         - Shell operations\n\u2502           \u2514\u2500\u2500 SSHShellLibrary.groovy                      - SSH operations\n\u2502\n\u251c\u2500\u2500 DLXJenkins/                                         [2 files - Unity Pipeline]\n\u2502   \u251c\u2500\u2500 Jenkinsfile\n\u2502   \u2514\u2500\u2500 JenkinsfileDeployment\n\u2502\n\u251c\u2500\u2500 JsJenkins/                                          [2 files - JavaScript Pipeline]\n\u2502   \u251c\u2500\u2500 Jenkinsfile\n\u2502   \u2514\u2500\u2500 JenkinsfileDeployment\n\u2502\n\u251c\u2500\u2500 PipelineForJenkins/                                 [1 file - Self Pipeline]\n\u2502   \u2514\u2500\u2500 Jenkinsfile\n\u2502\n\u251c\u2500\u2500 groovy/                                             [3 files - Legacy Helpers]\n\u2502   \u251c\u2500\u2500 generalHelper.groovy                                - Being migrated\n\u2502   \u251c\u2500\u2500 jsHelper.groovy                                     - Being migrated\n\u2502   \u2514\u2500\u2500 unityHelper.groovy                                  - Being migrated\n\u2502\n\u251c\u2500\u2500 python/                                             [15 files - Supporting Scripts]\n\u2502   \u251c\u2500\u2500 send_bitbucket_build_status.py                      - Being migrated\n\u2502   \u251c\u2500\u2500 create_bitbucket_test_report.py                     - Being migrated\n\u2502   \u251c\u2500\u2500 create_bitbucket_coverage_report.py                 - Being migrated\n\u2502   \u251c\u2500\u2500 create_bitbucket_webgl_build_report.py              - Being migrated\n\u2502   \u251c\u2500\u2500 create_log_report.py                                - Being migrated\n\u2502   \u251c\u2500\u2500 get_bitbucket_commit_hash.py                        - Being migrated\n\u2502   \u251c\u2500\u2500 get_unity_failure.py                                - Being migrated\n\u2502   \u251c\u2500\u2500 get_unity_version.py                                - Being migrated\n\u2502   \u251c\u2500\u2500 linting_error_report.py                             - Being migrated\n\u2502   \u251c\u2500\u2500 npm_audit.py                                        - Being migrated\n\u2502   \u251c\u2500\u2500 extract_build_error_log_messages.py                 - Being migrated\n\u2502   \u251c\u2500\u2500 Lint_groovy_report.py                               - Being migrated\n\u2502   \u2514\u2500\u2500 JsReporting/\n\u2502       \u251c\u2500\u2500 extract_coverage_rates.py                       - Being migrated\n\u2502       \u2514\u2500\u2500 extract_test_result.py                          - Being migrated\n\u2502\n\u251c\u2500\u2500 Bash/                                               [2 files]\n\u2502   \u251c\u2500\u2500 .editorconfig\n\u2502   \u2514\u2500\u2500 Linting.bash\n\u2502\n\u251c\u2500\u2500 tests/                                              [6 files - Unit Tests]\n\u2502   \u251c\u2500\u2500 GeneralHelperSpec.groovy\n\u2502   \u2514\u2500\u2500 src/\n\u2502       \u251c\u2500\u2500 resource/\n\u2502       \u2502   \u251c\u2500\u2500 JenkinsFile.groovy                          - Mock interface\n\u2502       \u2502   \u2514\u2500\u2500 StatusSpec.groovy\n\u2502       \u2514\u2500\u2500 service/\n\u2502           \u251c\u2500\u2500 MyPipelineTest.groovy\n\u2502           \u251c\u2500\u2500 general/\n\u2502           \u2502   \u2514\u2500\u2500 PrepareWorkspaceServiceSpec.groovy\n\u2502           \u2514\u2500\u2500 unity/\n\u2502               \u2514\u2500\u2500 BuildProjectServiceSpec.groovy\n\u2502\n\u2514\u2500\u2500 Configuration Files\n    \u251c\u2500\u2500 build.gradle\n    \u251c\u2500\u2500 .groovylintrc.groovy.json\n    \u2514\u2500\u2500 .groovylintrc.jenkins.json\n</code></pre>"},{"location":"legs/refactoring-result-snapshot/#3-folder-by-folder-analysis","title":"3. Folder-by-Folder Analysis","text":""},{"location":"legs/refactoring-result-snapshot/#31-sharedlibrariesvars-pipeline-stage-functions","title":"3.1 sharedLibraries/vars/ - Pipeline Stage Functions","text":""},{"location":"legs/refactoring-result-snapshot/#purpose","title":"Purpose","text":"<p>The <code>vars/</code> directory in Jenkins Global Shared Library defines global functions that can be called directly from pipelines.</p>"},{"location":"legs/refactoring-result-snapshot/#file-analysis","title":"File Analysis","text":"File Lines Purpose Design Pattern <code>logger.groovy</code> 83 3-level hierarchical logging Facade <code>shellScriptHelper.groovy</code> 105 Validated shell execution Command/Adapter <code>bitbucketApiHelper.groovy</code> 36 Bitbucket API facade Facade <code>bitbucketApiLibrary.groovy</code> 69 API request builder Builder <code>stageInitialization.groovy</code> 103 Environment setup Initialization <code>stageProjectPrepare.groovy</code> 186 Git workspace preparation State Machine <code>stageLintUnity.groovy</code> 67 Unity C# linting Wrapper <code>stageLintGroovyJenkinsfile.groovy</code> 96 Groovy/Jenkinsfile linting Wrapper <code>stageUnityExecution.groovy</code> 99 Unity test execution Strategy <code>stageStaticAnalysis.groovy</code> 87 SonarQube analysis Configuration <code>stageSendBuildResults.groovy</code> 39 Build result publishing Publisher <code>stageDeployBuild.groovy</code> 72 SSH deployment Command <code>stageCleanupPRBranchArtifacts.groovy</code> 62 PR artifact cleanup Cleanup"},{"location":"legs/refactoring-result-snapshot/#loggergroovy-3-level-hierarchical-logging","title":"logger.groovy - 3-Level Hierarchical Logging","text":"<pre><code>flowchart TB\n    subgraph Level1[\"Level 1: Stage\"]\n        SS[stageStart]\n        SE[stageEnd]\n    end\n\n    subgraph Level2[\"Level 2: Steps Group\"]\n        SGS[stepsGroupStart]\n        SGE[stepsGroupEnd]\n    end\n\n    subgraph Level3[\"Level 3: Step\"]\n        SSTART[stepStart \u27a1\ufe0f]\n        SINFO[stepInfo \ud83d\uddd2\ufe0f]\n        SATT[stepAttention \u2757]\n        SPROC[stepProcessing \ud83c\udfc3]\n        SSUC[stepSuccess \u2705]\n        SWARN[stepWarning \u26a0\ufe0f]\n        SFAIL[stepFailed \u274c]\n        SERR[stepError \ud83d\udd25]\n    end\n\n    SS --&gt; SGS\n    SGS --&gt; SSTART\n    SGS --&gt; SINFO\n    SGS --&gt; SATT\n    SGS --&gt; SPROC\n    SGS --&gt; SSUC\n    SGS --&gt; SWARN\n    SGS --&gt; SFAIL\n    SGS --&gt; SERR\n    SGE --&gt; SE</code></pre> <p>Key Features: - Automatic stack trace capture (<code>stepError(String, Throwable)</code>) - Emoji-based visual identification - Consistent formatting across all pipeline stages</p>"},{"location":"legs/refactoring-result-snapshot/#shellscripthelpergroovy-validated-shell-execution","title":"shellScriptHelper.groovy - Validated Shell Execution","text":"<pre><code>flowchart LR\n    subgraph Input\n        CL[Closure from Library]\n        ARGS[Arguments List]\n    end\n\n    subgraph Validation\n        V1[Non-null script]\n        V2[Non-null label]\n        V3[Mutually exclusive flags]\n    end\n\n    subgraph Execution\n        RS[returnStatus \u2192 int]\n        RO[returnStdout \u2192 String]\n        RV[returnVoid \u2192 void]\n    end\n\n    subgraph Output\n        LOG[Logger Integration]\n        RES[Result]\n    end\n\n    CL --&gt; V1\n    ARGS --&gt; V1\n    V1 --&gt; V2\n    V2 --&gt; V3\n    V3 --&gt; RS\n    V3 --&gt; RO\n    V3 --&gt; RV\n    RS --&gt; LOG\n    RO --&gt; LOG\n    RV --&gt; LOG\n    LOG --&gt; RES</code></pre> <p>Validation Rules: - <code>script</code>: Non-null, non-empty string required - <code>label</code>: Non-null, non-empty string required - Return flags: <code>returnStatus</code>, <code>returnStdout</code>, <code>returnStderr</code> are mutually exclusive</p>"},{"location":"legs/refactoring-result-snapshot/#32-sharedlibrariessrc-core-business-logic","title":"3.2 sharedLibraries/src/ - Core Business Logic","text":""},{"location":"legs/refactoring-result-snapshot/#321-utils-command-libraries","title":"3.2.1 utils/ - Command Libraries","text":""},{"location":"legs/refactoring-result-snapshot/#gitlibrarygroovy-480-lines-31-operations","title":"GitLibrary.groovy (480 lines, 31 operations)","text":"Category Operations Fetch FetchOriginReturnStatus, FetchOriginReturnStdout, FetchOriginBranchReturnStatus, FetchOriginBranchReturnStdout Branch ShowCurrentBranch, CheckoutBranch, GetOriginDefaultBranch, CheckOriginBranchExists, CheckBranchExists Status StatusPorcelain, CheckUpToDateWithRemote, CheckIsRemoteBranchAncestor Reset/Clean ResetHard, CleanUntracked, RestoreWorkingDirectory, RemoveIndexLock Clone/Pull CloneRepository, Pull, ResetHardOriginBranch Merge MergeOriginBranch LFS LfsFilesMissingFromGitIndex, LfsFetchAndCheckout Hash GetRemoteBranchHash <p>Command Pattern Implementation: <pre><code>static final Closure ShowCurrentBranch = {\n    [\n        script: 'git branch --show-current 2&gt;&amp;1',\n        label: 'Show current branch name',\n        returnStdout: true\n    ]\n}\n</code></pre></p>"},{"location":"legs/refactoring-result-snapshot/#shelllibrarygroovy-252-lines-15-operations","title":"ShellLibrary.groovy (252 lines, 15+ operations)","text":"Category Operations Environment PrintJenkinsEnv Directory FindPRJobDirectory, FindProjectDirectory, CreateLintingResultsDir Docker DockerInfo, GroovyLint Unity GetUnityExecutable, LintUnity, CopyWebGLBuilder, CopyLintConfig Python ExecutePythonStatusReport, CreateBitbucketBuildReport, CreateBitbucketTestReport SonarQube SonarqubeScanner Azure UploadWebGLBuildToWebStorageContainer"},{"location":"legs/refactoring-result-snapshot/#sshshelllibrarygroovy-115-lines-8-operations","title":"SSHShellLibrary.groovy (115 lines, 8 operations)","text":"Operation Purpose CheckSSHConnectivity Test SSH connection CreateDirectoryAndSetPermission Create remote directory CopyBuildToHostServer SCP build artifacts UpdateBuildURL Execute remote script CleanMergedPRBranchFromHostServer Remove PR artifacts CreateDirectoryAndSetPermissionForEconestogaDlxServer Econestoga server setup CopyBuildToEconestogaDlxServer Econestoga deployment UpdateBuildURLForEconestogaDlxServer Econestoga URL update"},{"location":"legs/refactoring-result-snapshot/#322-service-business-logic-services","title":"3.2.2 service/ - Business Logic Services","text":""},{"location":"legs/refactoring-result-snapshot/#httpapiservicegroovy-171-lines","title":"HttpApiService.groovy (171 lines)","text":"<pre><code>flowchart TB\n    subgraph API[\"HttpApiService\"]\n        GET[get]\n        POST[post]\n        PUT[put]\n        DELETE[delete]\n    end\n\n    subgraph Execution\n        EXEC[executeRequest]\n    end\n\n    subgraph ErrorHandling[\"Error Handling\"]\n        UH[UnknownHostException]\n        CE[ConnectException]\n        ST[SocketTimeoutException]\n        SSL[SSLHandshakeException]\n        CC[ConnectionClosedException]\n        IO[IOException]\n    end\n\n    subgraph Response\n        RES[\"[statusCode, success, body]\"]\n    end\n\n    GET --&gt; EXEC\n    POST --&gt; EXEC\n    PUT --&gt; EXEC\n    DELETE --&gt; EXEC\n    EXEC --&gt; UH\n    EXEC --&gt; CE\n    EXEC --&gt; ST\n    EXEC --&gt; SSL\n    EXEC --&gt; CC\n    EXEC --&gt; IO\n    EXEC --&gt; RES</code></pre> <p>Key Features: - Built on Apache HttpClient - Bearer Token authentication - 6 exception types handled - Automatic resource cleanup</p>"},{"location":"legs/refactoring-result-snapshot/#prepareworkspaceservicegroovy-34-lines","title":"PrepareWorkspaceService.groovy (34 lines)","text":"<ul> <li>Git LFS file management</li> <li>Untracked LFS file detection and pull</li> </ul>"},{"location":"legs/refactoring-result-snapshot/#buildprojectservicegroovy-45-lines","title":"BuildProjectService.groovy (45 lines)","text":"<ul> <li>Unity build asset validation</li> <li>LightingData.asset, ReflectionProbe verification</li> </ul>"},{"location":"legs/refactoring-result-snapshot/#323-resource-constants","title":"3.2.3 resource/ - Constants","text":""},{"location":"legs/refactoring-result-snapshot/#statusgroovy-29-lines","title":"Status.groovy (29 lines)","text":"<pre><code>class Status {\n    static final Map&lt;String, String&gt; STAGE_STATUS = [\n        'SUCCESS': 'SUCCESS',\n        'UNSTABLE': 'UNSTABLE',\n        'FAILURE': 'FAILURE',\n        'ABORTED': 'ABORTED',\n        'SKIPPED': 'SKIPPED'\n    ]\n\n    static final Map&lt;String, String&gt; BUILD_STATUS = [...]\n\n    static final Map&lt;String, String&gt; COMMIT_STATUS = [\n        'SUCCESSFUL': 'SUCCESSFUL',\n        'INPROGRESS': 'INPROGRESS',\n        'FAILED': 'FAILED',\n        'STOPPED': 'STOPPED'\n    ]\n}\n</code></pre>"},{"location":"legs/refactoring-result-snapshot/#33-dlxjenkins-jsjenkins-pipeline-definitions","title":"3.3 DLXJenkins/ &amp; JsJenkins/ - Pipeline Definitions","text":""},{"location":"legs/refactoring-result-snapshot/#jenkinsfile-structure-after-refactoring","title":"Jenkinsfile Structure (After Refactoring)","text":"<pre><code>@Library('global-trusted-shared-library@Temporary-Branch') _\n\nimport resource.Status\nimport utils.GitLibrary\n\npipeline {\n    agent any\n    tools { ... }\n    parameters { ... }\n    triggers { ... }\n\n    stages {\n        stage('Initialize') {\n            steps { script { stageInitialization() } }\n        }\n        stage('Prepare') {\n            steps { script { stageProjectPrepare() } }\n        }\n        stage('Lint') {\n            steps { script { stageLintUnity() } }\n        }\n        // ... more stages\n    }\n\n    post {\n        always { ... }\n        success { ... }\n        failure { ... }\n    }\n}\n</code></pre> <p>Key Characteristics: - No business logic (all delegated to vars/ functions) - Declarative pipeline structure - Clean stage definitions - Consistent pattern across all Jenkinsfiles</p> <p>Target State (Goal): All stages should follow the pattern: <code>steps { script { stageFunctionName() } }</code></p>"},{"location":"legs/refactoring-result-snapshot/#34-groovy-legacy-helpers-migration-in-progress","title":"3.4 groovy/ - Legacy Helpers (Migration in Progress)","text":"File Lines Status Migration Target <code>generalHelper.groovy</code> 654 Being migrated vars/, services/ <code>jsHelper.groovy</code> 796 Being migrated vars/, services/ <code>unityHelper.groovy</code> 374 Being migrated vars/, services/ <p>Migration Strategy: 1. Common functions \u2192 Extract to vars/ functions 2. Business logic \u2192 Move to service/ classes 3. Shell commands \u2192 Move to utils/ Libraries 4. Incremental migration (maintain existing functionality)</p>"},{"location":"legs/refactoring-result-snapshot/#35-python-legacy-scripts-to-be-eliminated","title":"3.5 python/ - Legacy Scripts (To Be Eliminated)","text":"Category Scripts Replacement Status Bitbucket API send_bitbucket_build_status.py, create_bitbucket_test_report.py, create_bitbucket_coverage_report.py, create_bitbucket_webgl_build_report.py Replaced by HttpApiService + bitbucketApiHelper Unity get_unity_failure.py, get_unity_version.py To be migrated Reporting create_log_report.py, linting_error_report.py, Lint_groovy_report.py To be migrated Security npm_audit.py To be migrated Analysis extract_build_error_log_messages.py To be migrated JavaScript JsReporting/extract_coverage_rates.py, JsReporting/extract_test_result.py To be migrated <p>Elimination Goal: The refactoring established the foundation to completely eliminate Python dependencies: - <code>HttpApiService.groovy</code> replaces Python HTTP/API calls - <code>bitbucketApiHelper.groovy</code> + <code>bitbucketApiLibrary.groovy</code> handle Bitbucket API - All Python scripts will be converted to native Groovy services</p>"},{"location":"legs/refactoring-result-snapshot/#36-tests-unit-tests","title":"3.6 tests/ - Unit Tests","text":"<pre><code>flowchart TB\n    subgraph TestFramework[\"Spock Framework\"]\n        SPEC[Specification]\n    end\n\n    subgraph MockInfra[\"Mock Infrastructure\"]\n        JF[JenkinsFile.groovy&lt;br/&gt;Mock Interface]\n    end\n\n    subgraph Tests[\"Test Suites\"]\n        SS[StatusSpec.groovy]\n        PWSS[PrepareWorkspaceServiceSpec.groovy]\n        BPSS[BuildProjectServiceSpec.groovy]\n    end\n\n    SPEC --&gt; Tests\n    JF --&gt; PWSS\n    JF --&gt; BPSS</code></pre> <p>Test Coverage: - <code>GeneralHelperSpec.groovy</code>: General helper function tests - <code>StatusSpec.groovy</code>: Status constants verification - <code>MyPipelineTest.groovy</code>: Pipeline test framework setup - <code>PrepareWorkspaceServiceSpec.groovy</code>: Workspace preparation logic - <code>BuildProjectServiceSpec.groovy</code>: Unity build validation logic - <code>JenkinsFile.groovy</code>: Jenkins method mocking interface</p>"},{"location":"legs/refactoring-result-snapshot/#4-design-patterns-applied","title":"4. Design Patterns Applied","text":""},{"location":"legs/refactoring-result-snapshot/#41-command-pattern","title":"4.1 Command Pattern","text":"<p>Where: GitLibrary, ShellLibrary, SSHShellLibrary</p> <pre><code>flowchart LR\n    subgraph Command[\"Command (Closure)\"]\n        GIT[\"GitLibrary.ShowCurrentBranch\"]\n    end\n\n    subgraph Invoker[\"Invoker\"]\n        SSH[\"shellScriptHelper\"]\n    end\n\n    subgraph Receiver[\"Receiver\"]\n        SH[\"Jenkins sh() step\"]\n    end\n\n    Command --&gt; Invoker\n    Invoker --&gt; Receiver</code></pre> <p>Benefits: - Separation of command definition and execution - Reusable command set - Parameterized command support - Improved testability</p>"},{"location":"legs/refactoring-result-snapshot/#42-facade-pattern","title":"4.2 Facade Pattern","text":"<p>Where: logger, bitbucketApiHelper, shellScriptHelper</p> <pre><code>flowchart TB\n    subgraph Client[\"Pipeline Stage\"]\n        STAGE[stageProjectPrepare]\n    end\n\n    subgraph Facades[\"Facades\"]\n        LOG[logger]\n        SSH[shellScriptHelper]\n        BAH[bitbucketApiHelper]\n    end\n\n    subgraph Subsystems[\"Complex Subsystems\"]\n        ECHO[Jenkins echo]\n        SH[Jenkins sh]\n        HTTP[HttpApiService]\n        CREDS[Jenkins credentials]\n    end\n\n    STAGE --&gt; LOG\n    STAGE --&gt; SSH\n    STAGE --&gt; BAH\n    LOG --&gt; ECHO\n    SSH --&gt; SH\n    BAH --&gt; HTTP\n    BAH --&gt; CREDS</code></pre>"},{"location":"legs/refactoring-result-snapshot/#43-service-layer-pattern","title":"4.3 Service Layer Pattern","text":"<p>Where: HttpApiService, PrepareWorkspaceService, BuildProjectService</p> <p>Benefits: - Business logic encapsulation - Single Responsibility Principle - Dependency injection (jenkinsfile object) - Testable structure</p>"},{"location":"legs/refactoring-result-snapshot/#44-builder-pattern","title":"4.4 Builder Pattern","text":"<p>Where: bitbucketApiLibrary</p> <pre><code>def createBuildStatusForCommit(String status, String description) {\n    // Builds complex API request Map step by step\n    return [\n        apiUrlString: \"https://api.bitbucket.org/...\",\n        requestBody: JsonOutput.toJson([...]),\n        method: 'POST'\n    ]\n}\n</code></pre>"},{"location":"legs/refactoring-result-snapshot/#45-strategy-pattern","title":"4.5 Strategy Pattern","text":"<p>Where: stageUnityExecution</p> <pre><code>flowchart TB\n    subgraph Context[\"stageUnityExecution\"]\n        CALL[\"call(stageName)\"]\n    end\n\n    subgraph Strategies[\"Execution Strategies\"]\n        EM[editMode]\n        PM[playMode]\n        COV[coverage]\n        WGL[webgl]\n    end\n\n    CALL --&gt;|\"'EditMode'\"| EM\n    CALL --&gt;|\"'PlayMode'\"| PM\n    CALL --&gt;|\"'Coverage'\"| COV\n    CALL --&gt;|\"'Webgl'\"| WGL</code></pre>"},{"location":"legs/refactoring-result-snapshot/#5-integration-flow","title":"5. Integration Flow","text":""},{"location":"legs/refactoring-result-snapshot/#51-stage-execution-flow","title":"5.1 Stage Execution Flow","text":"<pre><code>sequenceDiagram\n    participant JF as Jenkinsfile\n    participant STAGE as stageProjectPrepare\n    participant LOG as logger\n    participant SSH as shellScriptHelper\n    participant GIT as GitLibrary\n    participant SH as Jenkins sh()\n\n    JF-&gt;&gt;STAGE: call()\n    STAGE-&gt;&gt;LOG: stageStart(\"Project Prepare\")\n    STAGE-&gt;&gt;LOG: stepsGroupStart(\"Validate Workspace\")\n    STAGE-&gt;&gt;SSH: shellScriptHelper(GitLibrary.StatusPorcelain)\n    SSH-&gt;&gt;GIT: Invoke closure\n    GIT--&gt;&gt;SSH: Returns Map {script, label, returnStdout}\n    SSH-&gt;&gt;SH: sh(map)\n    SH--&gt;&gt;SSH: stdout result\n    SSH-&gt;&gt;LOG: stepSuccess(\"...\")\n    SSH--&gt;&gt;STAGE: result\n    STAGE-&gt;&gt;LOG: stepsGroupEnd(\"Validate Workspace\")\n    STAGE-&gt;&gt;LOG: stageEnd(\"Project Prepare\")</code></pre>"},{"location":"legs/refactoring-result-snapshot/#52-bitbucket-api-flow","title":"5.2 Bitbucket API Flow","text":"<pre><code>sequenceDiagram\n    participant STAGE as stageInitialization\n    participant BAL as bitbucketApiLibrary\n    participant BAH as bitbucketApiHelper\n    participant CREDS as Jenkins Credentials\n    participant HTTP as HttpApiService\n    participant BB as Bitbucket API\n\n    STAGE-&gt;&gt;BAL: createBuildStatusForCommit(\"INPROGRESS\", \"...\")\n    BAL--&gt;&gt;STAGE: {apiUrl, body, method}\n    STAGE-&gt;&gt;BAH: call(map)\n    BAH-&gt;&gt;CREDS: withCredentials()\n    CREDS--&gt;&gt;BAH: Bearer Token\n    BAH-&gt;&gt;HTTP: post(url, body, token)\n    HTTP-&gt;&gt;BB: HTTP POST\n    BB--&gt;&gt;HTTP: Response\n    HTTP--&gt;&gt;BAH: {statusCode, success, body}\n    BAH--&gt;&gt;STAGE: Response</code></pre>"},{"location":"legs/refactoring-result-snapshot/#6-current-state-summary","title":"6. Current State Summary","text":""},{"location":"legs/refactoring-result-snapshot/#61-architecture-characteristics","title":"6.1 Architecture Characteristics","text":"Aspect Current State Architecture 4-Layer Modular Design Code Location Centralized in sharedLibraries Logging 3-Level hierarchical logger (15+ methods) Shell Execution Validated shellScriptHelper with Command Pattern Git Operations 31 reusable closures in GitLibrary API Calls Native HttpApiService (Apache HttpClient) Error Handling Centralized with automatic stack traces Test Infrastructure Spock framework + Mock interface Constants Centralized in Status.groovy"},{"location":"legs/refactoring-result-snapshot/#62-code-statistics","title":"6.2 Code Statistics","text":"Metric Count Total files 51 Total lines 7,910 vars/ functions 13 Service classes 3 Utility libraries 3 Shell command closures 54 Logger methods 15+ Test specs 5 Test lines 243"},{"location":"legs/refactoring-result-snapshot/#63-architectural-principles-applied","title":"6.3 Architectural Principles Applied","text":"<ol> <li>Separation of Concerns</li> <li>vars/: Pipeline orchestration (WHAT to do)</li> <li>service/: Business logic (HOW to do it)</li> <li>utils/: Command definitions (WHAT commands)</li> <li> <p>resource/: Constants (shared knowledge)</p> </li> <li> <p>Reusability</p> </li> <li>Stage functions designed to be used across multiple Jenkinsfiles</li> <li>54 shell commands available to all stages</li> <li> <p>Single logger instance used everywhere</p> </li> <li> <p>Maintainability</p> </li> <li>Change logging format \u2192 Edit 1 file (logger.groovy)</li> <li>Add Git operation \u2192 Add 1 closure to GitLibrary</li> <li> <p>Fix API issue \u2192 Edit HttpApiService only</p> </li> <li> <p>Testability</p> </li> <li>Services accept injectable jenkinsfile object</li> <li>Mock interface (JenkinsFile.groovy) for testing</li> <li>Spock framework integration</li> </ol>"},{"location":"legs/refactoring-result-snapshot/#7-dependency-graph","title":"7. Dependency Graph","text":"<pre><code>flowchart TB\n    subgraph Jenkinsfiles\n        DLX[DLXJenkins/Jenkinsfile]\n        JS[JsJenkins/Jenkinsfile]\n        PFJ[PipelineForJenkins/Jenkinsfile]\n    end\n\n    subgraph VarsLayer[\"vars/ Layer\"]\n        STAGES[stage*.groovy]\n        LOG[logger.groovy]\n        SSH[shellScriptHelper.groovy]\n        BAH[bitbucketApiHelper.groovy]\n        BAL[bitbucketApiLibrary.groovy]\n    end\n\n    subgraph ServiceLayer[\"service/ Layer\"]\n        HTTP[HttpApiService]\n        PWS[PrepareWorkspaceService]\n        BPS[BuildProjectService]\n    end\n\n    subgraph UtilsLayer[\"utils/ Layer\"]\n        GIT[GitLibrary]\n        SHELL[ShellLibrary]\n        SSHLIB[SSHShellLibrary]\n    end\n\n    subgraph ResourceLayer[\"resource/ Layer\"]\n        STATUS[Status]\n    end\n\n    DLX --&gt; STAGES\n    JS --&gt; STAGES\n    PFJ --&gt; STAGES\n\n    STAGES --&gt; LOG\n    STAGES --&gt; SSH\n    STAGES --&gt; BAH\n    STAGES --&gt; BAL\n\n    SSH --&gt; GIT\n    SSH --&gt; SHELL\n    SSH --&gt; SSHLIB\n\n    BAH --&gt; HTTP\n    BAL --&gt; STATUS\n\n    HTTP --&gt; STATUS</code></pre>"},{"location":"legs/refactoring-result-snapshot/#8-remaining-work-migration-targets","title":"8. Remaining Work (Migration Targets)","text":""},{"location":"legs/refactoring-result-snapshot/#81-legacy-code-to-migrate","title":"8.1 Legacy Code to Migrate","text":"Item Current State Target groovy/generalHelper.groovy 654 lines legacy Migrate to vars/ and services/ groovy/jsHelper.groovy 796 lines legacy Migrate to vars/ and services/ groovy/unityHelper.groovy 374 lines legacy Migrate to vars/ and services/ JsJenkins/Jenkinsfile Being refactored Apply <code>steps { script { stage*() } }</code> pattern JsJenkins/JenkinsfileDeployment Being refactored Apply <code>steps { script { stage*() } }</code> pattern PipelineForJenkins/Jenkinsfile Being refactored Apply <code>steps { script { stage*() } }</code> pattern"},{"location":"legs/refactoring-result-snapshot/#82-python-scripts-to-eliminate","title":"8.2 Python Scripts to Eliminate","text":"Script Replacement send_bitbucket_build_status.py HttpApiService + bitbucketApiHelper (DONE) create_bitbucket_test_report.py HttpApiService + new API library create_bitbucket_coverage_report.py HttpApiService + new API library create_bitbucket_webgl_build_report.py HttpApiService + new API library Other Python scripts Native Groovy services"},{"location":"legs/refactoring-result-snapshot/#83-foundation-established","title":"8.3 Foundation Established","text":"<p>The refactoring has established the architectural foundation to: 1. Completely eliminate Python dependencies using HttpApiService pattern 2. Convert all Jenkinsfile stages to <code>steps { script { stageFunctionName() } }</code> pattern 3. Migrate all legacy groovy helpers to modular services and vars functions</p>"},{"location":"legs/refactoring-result-snapshot/#9-code-duplication-analysis","title":"9. Code Duplication Analysis","text":"<p>This section compares code duplication metrics between the pre-refactoring state (commit 54479b2) and post-refactoring state (commit 12910c1), using the same methodology as BEFORE_REFACTORING_ANALYSIS.md Section 7.7.</p>"},{"location":"legs/refactoring-result-snapshot/#91-pipeline-specific-duplication-analysis","title":"9.1 Pipeline-Specific Duplication Analysis","text":""},{"location":"legs/refactoring-result-snapshot/#file-sizes-4-main-jenkinsfiles","title":"File Sizes (4 Main Jenkinsfiles)","text":"File Before (54479b2) After (12910c1) Change DLXJenkins/Jenkinsfile 249 150 -99 DLXJenkins/JenkinsfileDeployment 242 136 -106 JsJenkins/Jenkinsfile 198 298 +100 JsJenkins/JenkinsfileDeployment 372 445 +73 Total 1,061 1,029 -32 <p>Note: DLX pipelines significantly reduced by moving logic to shared library. JS pipelines increased due to additional features added during partial refactoring.</p>"},{"location":"legs/refactoring-result-snapshot/#within-project-duplication-pr-vs-deployment","title":"Within-Project Duplication (PR vs Deployment)","text":"<p>DLX Pipeline (Unity)</p> Metric Before After Change Total lines (both files) 491 286 -205 Identical lines 146 126 -20 Duplication rate 29.7% 44.1% +14.4% <p>Note: Higher rate despite fewer absolute lines because both files are now much smaller (shared library usage)</p> <p>JS Pipeline (JavaScript)</p> Metric Before After Change Total lines (both files) 570 743 +173 Identical lines 156 172 +16 Duplication rate 27.4% 23.1% -4.3%"},{"location":"legs/refactoring-result-snapshot/#cross-project-duplication-dlx-vs-js","title":"Cross-Project Duplication (DLX vs JS)","text":"<p>PR Pipelines (DLX Jenkinsfile vs JS Jenkinsfile)</p> Metric Before After Change Smaller file 198 lines 150 lines -48 Identical lines 135 103 -32 Duplication rate 54.2% 68.7% +14.5% <p>Deployment Pipelines (DLX vs JS JenkinsfileDeployment)</p> Metric Before After Change Smaller file 242 lines 136 lines -106 Identical lines 167 95 -72 Duplication rate 69.0% 69.9% +0.9%"},{"location":"legs/refactoring-result-snapshot/#summary-comparison","title":"Summary Comparison","text":"Comparison Before After Identical Lines Change DLX: PR vs Deployment 146 (29.7%) 126 (44.1%) -20 lines JS: PR vs Deployment 156 (27.4%) 172 (23.1%) +16 lines DLX PR vs JS PR 135 (54.2%) 103 (68.7%) -32 lines DLX Deploy vs JS Deploy 167 (69.0%) 95 (69.9%) -72 lines"},{"location":"legs/refactoring-result-snapshot/#92-key-insights","title":"9.2 Key Insights","text":""},{"location":"legs/refactoring-result-snapshot/#what-changed","title":"What Changed","text":"<ol> <li>DLX Pipelines (Fully Refactored)</li> <li>File sizes reduced by ~40% (249\u2192150, 242\u2192136)</li> <li>Stage logic moved to shared library functions</li> <li>Post block uses <code>bitbucketApiHelper()</code> + <code>Status</code> constants</li> <li> <p>Identical lines reduced but percentage increased (smaller denominator)</p> </li> <li> <p>JS Pipelines (Partially Refactored)</p> </li> <li>File sizes increased (additional features added)</li> <li>Still uses legacy <code>generalUtil</code>/<code>jsUtil</code> helpers</li> <li> <p>Post block still uses <code>generalUtil.sendBuildStatus()</code></p> </li> <li> <p>Cross-Project Duplication Reduced</p> </li> <li>DLX PR vs JS PR: 135 \u2192 103 lines (-24%)</li> <li>DLX Deploy vs JS Deploy: 167 \u2192 95 lines (-43%)</li> <li>DLX now uses shared library, JS uses legacy \u2192 less common code</li> </ol>"},{"location":"legs/refactoring-result-snapshot/#93-migration-status-by-pipeline","title":"9.3 Migration Status by Pipeline","text":"Pipeline Status Implementation DLXJenkins/Jenkinsfile \u2705 Fully Refactored All stages use shared library (stageInitialization, stageProjectPrepare, etc.) DLXJenkins/JenkinsfileDeployment \u2705 Fully Refactored All stages use shared library + bitbucketApiHelper JsJenkins/Jenkinsfile \u26a0\ufe0f Partial stageInitialization + stageProjectPrepare only, rest uses legacy JsJenkins/JenkinsfileDeployment \u26a0\ufe0f Partial stageInitialization + stageProjectPrepare only, rest uses legacy PipelineForJenkins/Jenkinsfile \u26a0\ufe0f Partial Mixed usage"},{"location":"legs/refactoring-result-snapshot/#94-refactoring-solutions-applied","title":"9.4 Refactoring Solutions Applied","text":"Before Pattern After Solution Location <code>generalUtil.sendBuildStatus()</code> <code>bitbucketApiHelper()</code> + <code>bitbucketApiLibrary</code> vars/ Helper loading in Prepare WORKSPACE <code>stageProjectPrepare()</code> vars/stageProjectPrepare.groovy Multiple <code>echo</code> statements <code>logger.*</code> methods vars/logger.groovy Raw <code>sh</code> commands <code>shellScriptHelper()</code> + Library closures vars/shellScriptHelper.groovy Direct git commands <code>GitLibrary.*</code> closures src/utils/GitLibrary.groovy Python HTTP calls <code>HttpApiService</code> src/service/general/HttpApiService.groovy"},{"location":"legs/refactoring-result-snapshot/#95-target-state-after-full-js-migration","title":"9.5 Target State (After Full JS Migration)","text":"<p>When JS pipelines are fully migrated to use shared library:</p> Metric Current Target Expected Change JS Jenkinsfile 298 lines ~150 lines -148 lines JS JenkinsfileDeployment 445 lines ~150 lines -295 lines Cross-project identical lines 103/95 ~120/~110 Increase (more shared patterns) <p>Full migration would result in all pipelines having similar structure: declarative boilerplate + shared library stage calls.</p>"},{"location":"legs/refactoring-result-snapshot/#10-conclusion","title":"10. Conclusion","text":"<p>This commit (<code>12910c1</code>) represents a well-structured, modular Jenkins CI/CD pipeline architecture.</p> <p>Architecture Characteristics: - 4-Layer Architecture with clear separation of concerns - Command Pattern for 54 shell operations - Facade Pattern for simplified interfaces (logger, shellScriptHelper, bitbucketApiHelper) - Service Layer for testable business logic - 3-Level hierarchical logging system - Spock-based test infrastructure with mock interfaces</p> <p>Architecture Quality: - High cohesion within each layer - Low coupling between layers - Single Responsibility Principle applied - Dependency Injection enabled - Jenkins CPS-compatible design</p> <p>Refactoring Goal: The ultimate goal is to have all pipeline logic encapsulated in sharedLibraries, with Jenkinsfiles containing only declarative structure and stage function calls. Python dependencies will be completely eliminated in favor of native Groovy services.</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/","title":"Leg 0: Global Trusted Shared Library Setup","text":""},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#basic-information","title":"Basic Information","text":"Item Value Baseline <code>74fc356</code> (2025-03-20) Final <code>3c6422c</code> (2025-04-24) Total Commits 40 Duration 2025-03-21 ~ 2025-04-24 (approximately 1 month)"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Goal</li> <li>Commit List (by Phase)</li> <li>Phase-by-Phase Detailed Analysis</li> <li>3.1 Phase 1: Shared Library Folder Structure Exploration</li> <li>3.2 Phase 2: Shared Library Call Test</li> <li>3.3 Phase 3: Service Layer Construction</li> <li>3.4 Phase 4: Global Library Configuration Test</li> <li>3.5 Phase 5: Full Implementation</li> <li>Before/After Comparison</li> <li>Design Decisions</li> <li>Next Steps</li> </ol>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#1-goal","title":"1. Goal","text":"<p>Build Jenkins Global Trusted Shared Library foundation</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#2-commit-list-by-phase","title":"2. Commit List (by Phase)","text":"Phase Content Commit Count 1 Shared Library Folder Structure Exploration (2025-03-21) 4 2 Shared Library Call Test (2025-03-27) 6 3 Service Layer Construction (2025-03-31 ~ 2025-04-01) 8 4 Global Library Configuration Test (2025-04-13) 3 5 Full Implementation (2025-04-21 ~ 2025-04-24) 22 Phase 1: Shared Library Folder Structure Exploration (4 commits) Date Commit Message 2025-03-21 <code>bfab15f</code> Test Shared Library 2025-03-21 <code>62c03c2</code> Fix shared library path 2025-03-21 <code>c509fa0</code> Fixed shared library path 2025-03-21 <code>3be0817</code> Final Try Phase 2: Shared Library Call Test (6 commits) Date Commit Message 2025-03-27 <code>144fe00</code> test 2025-03-27 <code>eacdcce</code> test 2025-03-27 <code>7aa3ff4</code> Fixed 2025-03-27 <code>04ea7e0</code> test 2025-03-27 <code>8f14918</code> ests 2025-03-27 <code>8d17c86</code> asdf Phase 3: Service Layer Construction (8 commits) Date Commit Message 2025-03-31 <code>e9d184b</code> Add new package GitLFSHelper 2025-03-31 <code>29fb14d</code> Add new package GitLFSHelper 2025-04-01 <code>76e5586</code> Added GitLFSHelper to its test 2025-04-01 <code>1b7981c</code> Use different mocking framework for unit testing 2025-04-01 <code>a6d6547</code> Refactor CheckIfLightAndReflectionFilesExist to be a shared library 2025-04-01 <code>107ab3a</code> Re-categorize GitLFSHelper and LightAndReflectionFileChecker 2025-04-01 <code>19a296f</code> Modified Infrastructure of Shared Library 2025-04-01 <code>abbac32</code> Modified BuildProjectService.groovy Phase 4: Global Library Configuration Test (3 commits) Date Commit Message 2025-04-13 <code>18f9bbb</code> Try to assign the shared library files to the correct location 2025-04-13 <code>d68c0c7</code> test global library 2025-04-13 <code>e15ea80</code> test Phase 5: Full Implementation (22 commits) Date Commit Message 2025-04-21 <code>d0ed2e2</code> Global Library Test 2025-04-21 <code>cdf4b36</code> test 2025-04-21 <code>09adc72</code> test 2025-04-21 <code>2324c2e</code> teest 2025-04-21 <code>befd0f0</code> test 2025-04-21 <code>cb42797</code> test 2025-04-21 <code>eb45331</code> test 2025-04-21 <code>7c15211</code> Test 2025-04-21 <code>c47b663</code> Delete Load Shared Library Stage after managing Global Trusted Library Configuration worked 2025-04-21 <code>c33334c</code> Renamed my-simple-lib to global-trusted-shared-library 2025-04-21 <code>0af1ac2</code> Refactoring DLX-PR pipeline implementing the Global Trusted Shared Library 2025-04-21 <code>323823c</code> Try a different way to use 'new' operator 2025-04-21 <code>183feab</code> Modifed other way to call new operator in PR-DLX pipeline 2025-04-21 <code>6df93e4</code> Implement Global Trusted Shared Library for Deployment-DLX pipeline 2025-04-21 <code>5ccb037</code> Implement Global Trusted Shared Library for JavaScript Deployment Pipeline 2025-04-23 <code>77c024a</code> Delete Optional filter to test executing pipeline run by repo push trigger 2025-04-24 <code>99708f4</code> vars test 2025-04-24 <code>9f2cc5d</code> vars test 2025-04-24 <code>91cf049</code> vars Test with Library branch change 2025-04-24 <code>fa0a5be</code> Revert \"Delete Optional filter to test executing pipeline run by repo push trigger\" 2025-04-24 <code>ddb5bd0</code> Revert \"vars test\" 2025-04-24 <code>3c6422c</code> Revert \"vars test\""},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#3-phase-by-phase-detailed-analysis","title":"3. Phase-by-Phase Detailed Analysis","text":""},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#31-phase-1-shared-library-folder-structure-exploration-core-1543","title":"3.1 Phase 1: Shared Library Folder Structure Exploration (CORE-1543)","text":"View Details <p>Duration: 2025-03-21 (4 commits)</p> <p>Goal: Establish folder structure for Jenkins Shared Library introduction</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#problem-solving-process","title":"Problem Solving Process","text":"Commit Attempt Problem Solution <code>bfab15f</code> Created <code>sharedLibraries/resource/StageResults.groovy</code> Jenkins doesn't recognize class - <code>62c03c2</code> Moved <code>sharedLibraries/resource/</code> \u2192 <code>src/resource/</code> Still not recognized Jenkins recognizes <code>src/</code> folder as classpath <code>c509fa0</code> Moved <code>src/resource/</code> \u2192 <code>sharedLibraries/src/resource/</code> - Need <code>sharedLibraries/src/</code> structure under repository <code>3be0817</code> Refactored <code>StageResults</code> \u2192 <code>ResultStatus</code> - Separated Stage status and Build status, specified <code>static final</code> type"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#code-changes","title":"Code Changes","text":"<p>Before (<code>bfab15f</code>): <pre><code>// sharedLibraries/resource/StageResults.groovy\npackage resource\n\nclass StageResults {\n    static def stageResults = [\n        'SUCCESS': 'SUCCESS',\n        'FAILURE': 'FAILURE',\n        'ABORTED': 'ABORTED',\n        'SKIPPED': 'SKIPPED'\n    ]\n}\n</code></pre></p> <p>After (<code>3be0817</code>): <pre><code>// sharedLibraries/src/resource/ResultStatus.groovy\npackage resource\n\nclass ResultStatus {\n    static final Map&lt;String, String&gt; STAGE_STATUS = [\n        'SUCCESS': 'SUCCESS',\n        'FAILURE': 'FAILURE',\n        'ABORTED': 'ABORTED',\n        'SKIPPED': 'SKIPPED'\n    ]\n\n    static final Map&lt;String, String&gt; BUILD_STATUS = [\n        'SUCCESS': 'SUCCESS',\n        'UNSTABLE': 'UNSTABLE',\n        'FAILURE': 'FAILURE',\n        'ABORTED': 'ABORTED',\n        'NOT_BUILT': 'NOT_BUILT'\n    ]\n}\n</code></pre></p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#32-phase-2-shared-library-call-test-core-1526","title":"3.2 Phase 2: Shared Library Call Test (CORE-1526)","text":"View Details <p>Duration: 2025-03-27 (6 commits)</p> <p>Goal: Test how to call Shared Library classes from Jenkinsfile</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#test-content","title":"Test Content","text":"<p>Added/modified various <code>call()</code> methods to <code>ResultStatus.groovy</code>:</p> <pre><code>// Attempt 1: void method\nvoid Call() {\n    each \"Here\"\n}\n\n// Attempt 2: parameter + return\nvoid call(String param) {\n    return param\n}\n\n// Attempt 3: constructor + instance variable\nprivate String test\n\nResultStatus(String test) {\n    this.test = test\n}\n\nvoid call() {\n    return this.test\n}\n</code></pre> <p>Learning Points: - Scripts in <code>vars/</code> folder can be called directly via <code>call()</code> method - Classes in <code>src/</code> folder are used via <code>new ClassName()</code> or <code>import</code></p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#33-phase-3-service-layer-construction-core-1547","title":"3.3 Phase 3: Service Layer Construction (CORE-1547)","text":"View Details <p>Duration: 2025-03-31 ~ 2025-04-01 (8 commits)</p> <p>Goal: Build Service class for Git LFS problem resolution</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#problem-situation","title":"Problem Situation","text":"<ol> <li>Git LFS File Missing: LFS-managed files (images, audio) not checked out during pipeline execution</li> <li>Unity Lighting File Missing: WebGL build lighting breaks without <code>LightingData.asset</code>, <code>ReflectionProbe-0.exr</code> files</li> </ol>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#solution-process","title":"Solution Process","text":"Commit Changes <code>e9d184b</code> Created <code>GitLFSHelper.groovy</code> - Auto pull logic for LFS files <code>a6d6547</code> Created <code>CheckIfLightAndReflectionFilesExist.groovy</code> - Lighting file verification <code>107ab3a</code> Folder structure reorganization: <code>service/general/prepareWorkspace/</code>, <code>service/unity/buildProject/</code> <code>19a296f</code> Integrated Helper \u2192 Service: <code>PrepareWorkspaceService</code>, <code>BuildProjectService</code>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#code-changes_1","title":"Code Changes","text":"<p>GitLFSHelper Core Logic (<code>e9d184b</code>): <pre><code>void checkAndPullUntrackedLFSFiles() {\n    try {\n        // Check files managed by LFS but not yet downloaded\n        String missingFiles = script.sh(\n            script: \"git lfs ls-files | awk '\\$2 == \\\"-\\\" {print \\$3}'\",\n            returnStdout: true\n        ).trim()\n\n        if (missingFiles) {\n            script.echo \"Untracked large files detected: ${missingFiles}\"\n            script.sh 'git lfs pull'\n        }\n    } catch (Exception e) {\n        script.echo \"Failed to check for untracked LFS files: ${e.message}\"\n    }\n}\n</code></pre></p> <p>Folder Structure Evolution: <pre><code>Attempt 1: service/general/GitLFSHelper.groovy\nAttempt 2: service/general/prepareWorkspace/GitLFSHelper.groovy\nAttempt 3: service/unity/buildProject/LightAndReflectionFileChecker.groovy\nFinal:     service/general/PrepareWorkspaceService.groovy\n           service/unity/BuildProjectService.groovy\n</code></pre></p> <p>Learning Points: - Integrated Helper classes into Service classes for domain-based responsibility separation - Inject <code>script</code> object via constructor to access Jenkins Pipeline context</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#34-phase-4-global-library-configuration-test","title":"3.4 Phase 4: Global Library Configuration Test","text":"View Details <p>Duration: 2025-04-13 (3 commits)</p> <p>Goal: Test Jenkins Global Library Configuration settings</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#test-content_1","title":"Test Content","text":"Commit Change Purpose <code>18f9bbb</code> Deleted all files in sharedLibraries (-99 lines) Test if file location affects Global Library recognition <code>d68c0c7</code> Restored files (+99 lines) Verify recognition after restoration <code>e15ea80</code> Deleted again (-99 lines) Test different configuration combinations <p>Learning Points: - Configuration needed in Jenkins &gt; Manage Jenkins &gt; Configure System &gt; Global Pipeline Libraries - Specify Library name, Git Repository URL, Default Version (branch) - Learned that Library type and Version Control is possible through Library settings</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#35-phase-5-full-implementation-implement-global-trusted-shared-library","title":"3.5 Phase 5: Full Implementation (Implement-Global-Trusted-Shared-Library)","text":"View Details <p>Duration: 2025-04-21 ~ 2025-04-24 (22 commits)</p> <p>Goal: Apply Global Trusted Shared Library to 5 pipelines</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#implementation-steps","title":"Implementation Steps","text":""},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#step-1-vars-test-d0ed2e2","title":"Step 1: vars/ Test (<code>d0ed2e2</code>)","text":"<pre><code>// sharedLibraries/vars/sayHello.groovy\ndef call(String name = 'World') {\n    echo \"Hello, ${name}! This message came from the global library.\"\n}\n</code></pre> <p>Verified <code>@Library('my-simple-lib@main') _</code> works in Jenkins Global Configuration.</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#step-2-delete-load-shared-library-stage-c47b663","title":"Step 2: Delete Load Shared Library Stage (<code>c47b663</code>)","text":"<p>Before (-63 lines): <pre><code>def sharedLib\ndef resultStatus\n\nstage('Load Shared Library') {\n    steps {\n        script {\n            def LIBRARY_PATH = 'sharedLibraries'\n            sh \"\"\"\n                cd ${WORKSPACE}/${LIBRARY_PATH} &amp;&amp; \\\n                (rm -rf .git || true) &amp;&amp; \\\n                git init &amp;&amp; \\\n                git add --all &amp;&amp; \\\n                git commit -m 'init'\n            \"\"\"\n            def repoPath = sh(returnStdout: true, script: 'pwd').trim() + \"/${LIBRARY_PATH}\"\n            sharedLib = library identifier: 'local-lib@master',\n                    retriever: modernSCM([$class: 'GitSCMSource', remote: \"${repoPath}\"]),\n                    changelog: false\n        }\n    }\n}\n\n// Usage\nresultStatus = sharedLib.resource.ResultStatus\ncurrentBuild.result = resultStatus.BUILD_STATUS.ABORTED\n</code></pre></p> <p>After (+6 lines): <pre><code>@Library('my-simple-lib@main') _\n\nimport resource.ResultStatus\n\n// Usage\ncurrentBuild.result = ResultStatus.BUILD_STATUS.ABORTED\n</code></pre></p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#step-3-new-operator-syntax-fix-323823c","title":"Step 3: new Operator Syntax Fix (<code>323823c</code>)","text":"<p>Before (Local Library approach): <pre><code>prepareWorkspaceService = sharedLib.service.general.PrepareWorkspaceService\nprepareWorkspaceServiceClass = prepareWorkspaceService.new(this)\n</code></pre></p> <p>After (Global Library approach): <pre><code>import service.general.PrepareWorkspaceService\n\nPrepareWorkspaceService prepareWorkspaceService = new PrepareWorkspaceService(this)\n</code></pre></p> <p>Problem: With Local Library, <code>sharedLib.xxx.ClassName</code> returns a wrapped form rather than a Class object, requiring <code>.new()</code> syntax. With Global Library, direct <code>import</code> allows standard Groovy syntax.</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#step-4-applied-to-5-pipelines","title":"Step 4: Applied to 5 Pipelines","text":"Commit Pipeline Change Amount <code>c47b663</code> PipelineForJenkins/Jenkinsfile -63 lines, +6 lines <code>0af1ac2</code> DLXJenkins/Jenkinsfile -47 lines, +11 lines <code>6df93e4</code> DLXJenkins/JenkinsfileDeployment -53 lines <code>5ccb037</code> JsJenkins/Jenkinsfile, JenkinsfileDeployment -86 lines"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#4-beforeafter-comparison","title":"4. Before/After Comparison","text":""},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#code-change-amount","title":"Code Change Amount","text":"Item Before After Change Shared Library Loading ~30 lines/pipeline 1 line -29 lines Class Usage Syntax <code>sharedLib.xxx.Class</code> <code>import xxx.Class</code> Standard Groovy new Operator <code>Class.new(this)</code> <code>new Class(this)</code> Standard Groovy"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#folder-structure","title":"Folder Structure","text":"<pre><code>Before                              After\n\u2500\u2500\u2500\u2500\u2500\u2500                              \u2500\u2500\u2500\u2500\u2500\n(No Shared Library)                 sharedLibraries/\n                                    \u251c\u2500\u2500 src/\n                                    \u2502   \u251c\u2500\u2500 resource/\n                                    \u2502   \u2502   \u2514\u2500\u2500 ResultStatus.groovy\n                                    \u2502   \u2514\u2500\u2500 service/\n                                    \u2502       \u251c\u2500\u2500 general/\n                                    \u2502       \u2502   \u2514\u2500\u2500 PrepareWorkspaceService.groovy\n                                    \u2502       \u2514\u2500\u2500 unity/\n                                    \u2502           \u2514\u2500\u2500 BuildProjectService.groovy\n                                    \u2514\u2500\u2500 vars/\n                                        \u2514\u2500\u2500 sayHello.groovy\n</code></pre>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#5-design-decisions","title":"5. Design Decisions","text":""},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#51-why-global-trusted-library","title":"5.1 Why Global Trusted Library?","text":"Approach Advantages Disadvantages Local Library No separate configuration needed Requires git init/commit every execution, non-standard syntax Global Library Standard import syntax, version control possible Requires Jenkins configuration Global Trusted No sandbox restrictions (<code>@NonCPS</code>, file I/O possible) Security caution needed"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#52-why-trusted-is-needed","title":"5.2 Why Trusted is Needed","text":"<p>Features to be implemented in subsequent Legs: - <code>@NonCPS</code> annotation usage (CPS transformation bypass) - File I/O operations - Direct Apache HttpClient usage</p> <p>These features are unavailable in regular Shared Library due to sandbox restrictions.</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#53-version-control","title":"5.3 Version Control","text":"<pre><code>@Library('global-trusted-shared-library@main') _           // main branch\n@Library('global-trusted-shared-library@Refactor-with-TDD') _  // development branch\n@Library('global-trusted-shared-library@v1.0.0') _         // tag version\n</code></pre> <p>Branch/tag specification enables per-pipeline Library version management.</p>"},{"location":"legs/leg-0-global-trusted-shared-library-setup/changelog/#6-next-steps","title":"6. Next Steps","text":"<p>\u2192 Leg 1: ShellScript Modularization &amp; Initialization Stage</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/","title":"Leg 1: ShellScript Modularization &amp; Initialization Stage","text":""},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#basic-information","title":"Basic Information","text":"Item Value Start <code>3c6422c</code> (2025-04-24, Leg 0 ended) Final <code>d699fac</code> (2025-04-26) Total Commits 12 Duration 2025-04-25 (1 day)"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Goal</li> <li>Commit List</li> <li>Step-by-Step Detailed Analysis</li> <li>3.1 Step 1: Initialization Stage Initial Implementation</li> <li>3.2 Step 2: ShellScript Modularization</li> <li>3.3 Step 3: Package Structure and Annotation Modifications</li> <li>3.4 Step 4: Naming Convention Establishment and Logging Improvement</li> <li>New Files</li> <li>Architecture Significance</li> <li>Core Patterns</li> <li>Benefits</li> <li>Next Steps</li> </ol>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#1-goal","title":"1. Goal","text":"<p>Separate Shell script execution logic from pipeline code and modularize common initialization logic into Stage</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#2-commit-list","title":"2. Commit List","text":"Date Commit Message 2025-04-25 <code>fe1a82a</code> Initialization initial test 2025-04-25 <code>5f079ff</code> Added PRBRANCH git origin fetch in Initialization stage 2025-04-25 <code>44c4d06</code> Added git origin fetch and get shell latest commit commands in Intialization groovy with error handling 2025-04-25 <code>8be55ee</code> ShellScripting Modulized 2025-04-25 <code>d492539</code> initialization.groovy has been updated to Initialization.groovy with the initial letter capitalized 2025-04-25 <code>8ef6fef</code> Shell Script Data Class and Improve ShellScriptHelper 2025-04-25 <code>58a41e0</code> Move import ShellParams Package in Jenkinsfile 2025-04-25 <code>0b9e4a8</code> Fixed the way to do Package and use it 2025-04-25 <code>40bf3c4</code> Removed Canonical annotation 2025-04-25 <code>d12ef93</code> Added logic for TICKET NUMBER and FOLDER NAME and test initial lowercase Stage class name 2025-04-25 <code>d501f2d</code> Try initial lowercase groovy file name in vars folder 2025-04-25 <code>d3613c8</code> Improved log in Initialization stage and ShellScript Helper"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#3-step-by-step-detailed-analysis","title":"3. Step-by-Step Detailed Analysis","text":""},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#31-step-1-initialization-stage-initial-implementation","title":"3.1 Step 1: Initialization Stage Initial Implementation","text":"View Details <p>Commits: <code>fe1a82a</code> ~ <code>44c4d06</code> (3 commits)</p> <p>Goal: Create first Stage module in vars/ folder and implement Git initialization logic</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#work-by-commit","title":"Work by Commit","text":"Commit Work File Changes <code>fe1a82a</code> Created Initialization.groovy, tested calling from Jenkinsfile +<code>vars/Initialization.groovy</code> <code>5f079ff</code> Added git origin fetch for PR_BRANCH Modified <code>vars/Initialization.groovy</code> <code>44c4d06</code> Added git fetch origin, shell latest commit commands, implemented error handling <code>vars/Initialization.groovy</code> +41 lines <p>Result: - Created <code>vars/Initialization.groovy</code> file - Includes basic git fetch and error handling</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#32-step-2-shellscript-modularization","title":"3.2 Step 2: ShellScript Modularization","text":"View Details <p>Commits: <code>8be55ee</code> ~ <code>8ef6fef</code> (3 commits)</p> <p>Goal: Separate Shell execution logic into separate Helper and create data class</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#work-by-commit_1","title":"Work by Commit","text":"Commit Work File Changes <code>8be55ee</code> Separated shell logic from Initialization, created shellUtils.groovy +<code>vars/shellUtils.groovy</code> (52 lines) <code>d492539</code> Tested file name capitalization (initialization \u2192 Initialization) Modified Jenkinsfile <code>8ef6fef</code> Created ShellParams data class, refactored to ShellScriptHelper +<code>src/utils/ShellParams.groovy</code>, +<code>vars/ShellScriptHelper.groovy</code>, -<code>vars/shellUtils.groovy</code> <p>Architecture Change: <pre><code>Before: vars/Initialization.groovy (includes shell logic)\nAfter:  vars/Initialization.groovy\n        vars/ShellScriptHelper.groovy (handles shell execution)\n        src/utils/ShellParams.groovy (parameter data class)\n</code></pre></p> <p>Learning Points: - Files in vars/ folder can be called directly from Jenkins - Classes in src/ folder are used via import</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#33-step-3-package-structure-and-annotation-modifications","title":"3.3 Step 3: Package Structure and Annotation Modifications","text":"View Details <p>Commits: <code>58a41e0</code> ~ <code>40bf3c4</code> (3 commits)</p> <p>Goal: Resolve Groovy package import issues and Jenkins CPS compatibility</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#problem-solving-process","title":"Problem Solving Process","text":"Commit Attempt Problem Solution <code>58a41e0</code> Moved ShellParams import location Import issue in vars Moved to Jenkinsfile <code>0b9e4a8</code> Fixed package path Wrong package declaration Fixed to <code>utils.ShellParams</code> <code>40bf3c4</code> Removed @Canonical annotation Jenkins CPS compatibility issue Implemented manual constructor/getter <p>Code Change: <pre><code>// Before: Groovy @Canonical annotation\n@Canonical\nclass ShellParams {\n    String script\n    String label\n}\n\n// After: Manual implementation (Jenkins CPS compatible)\nclass ShellParams {\n    String script\n    String label\n\n    ShellParams(String script, String label) {\n        this.script = script\n        this.label = label\n    }\n}\n</code></pre></p> <p>Learning Points: - Jenkins Pipeline's CPS transformation is incompatible with some Groovy annotations - <code>@Canonical</code>, <code>@Immutable</code>, etc. need to be replaced with manual implementation</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#34-step-4-naming-convention-establishment-and-logging-improvement","title":"3.4 Step 4: Naming Convention Establishment and Logging Improvement","text":"View Details <p>Commits: <code>d12ef93</code> ~ <code>d3613c8</code> (3 commits)</p> <p>Goal: Establish vars/ file naming conventions and improve logging</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#work-by-commit_2","title":"Work by Commit","text":"Commit Work File Changes <code>d12ef93</code> Added TICKET_NUMBER/FOLDER_NAME logic, renamed Initialization \u2192 stageInitialization <code>vars/Initialization.groovy</code> \u2192 <code>vars/stageInitialization.groovy</code> <code>d501f2d</code> Renamed ShellScriptHelper \u2192 helperShellScript <code>vars/ShellScriptHelper.groovy</code> \u2192 <code>vars/helperShellScript.groovy</code> <code>d3613c8</code> Improved logging messages, organized output format Modified both files <p>Naming Convention Established: <pre><code>vars/ File Naming Convention:\n- Stage modules: stage{StageName}.groovy (e.g., stageInitialization.groovy)\n- Helpers: helper{HelperName}.groovy (e.g., helperShellScript.groovy)\n</code></pre></p> <p>Result: - <code>stageInitialization.groovy</code>: Stage module - <code>helperShellScript.groovy</code>: Shell execution helper</p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#4-new-files","title":"4. New Files","text":""},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#41-sharedlibrariessrcutilsshellparamsgroovy-43-lines","title":"4.1 <code>sharedLibraries/src/utils/ShellParams.groovy</code> (43 lines)","text":"<p>Parameter data class for Shell command execution <pre><code>class ShellParams {\n    String script\n    String label\n    boolean returnStdout = false\n    boolean returnStatus = false\n}\n</code></pre></p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#42-sharedlibrariesvarshelpershellscriptgroovy-100-lines","title":"4.2 <code>sharedLibraries/vars/helperShellScript.groovy</code> (100 lines)","text":"<p>Shell script execution helper - Executes sh commands in a standardized way <pre><code>def execute(Map params) {\n    // params: script, label, returnStdout, returnStatus\n    // Integrated logging, error handling\n}\n</code></pre></p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#43-sharedlibrariesvarsstageinitializationgroovy-41-lines","title":"4.3 <code>sharedLibraries/vars/stageInitialization.groovy</code> (41 lines)","text":"<p>Pipeline initialization Stage - Environment variable setup, Git information collection <pre><code>def call() {\n    echo \"\u25b6\ufe0f Stage '${env.STAGE_NAME}' Starting\"\n    // Initialize environment variables like TICKET_NUMBER, FOLDER_NAME\n    // Git origin fetch\n}\n</code></pre></p>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#5-architecture-significance","title":"5. Architecture Significance","text":""},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#51-layer-2-4-established","title":"5.1 Layer 2 &amp; 4 Established","text":"<pre><code>sharedLibraries/\n\u251c\u2500\u2500 vars/                    # Layer 2: Orchestration\n\u2502   \u251c\u2500\u2500 helperShellScript.groovy      # Helper\n\u2502   \u2514\u2500\u2500 stageInitialization.groovy    # Stage Module\n\u2514\u2500\u2500 src/\n    \u2514\u2500\u2500 utils/               # Layer 4: Utilities\n        \u2514\u2500\u2500 ShellParams.groovy\n</code></pre>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#52-separation-of-concerns-begins","title":"5.2 Separation of Concerns Begins","text":"<ul> <li>Before: sh commands written directly in Jenkinsfile</li> <li>After: sh execution abstracted in vars/, integrated logging/error handling</li> </ul>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#6-core-patterns","title":"6. Core Patterns","text":""},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#61-shell-execution-standardization","title":"6.1 Shell Execution Standardization","text":"<pre><code>// Before (inside Jenkinsfile)\nsh 'git fetch origin'\n\n// After (using vars/helperShellScript.groovy)\nhelperShellScript.execute([\n    script: 'git fetch origin',\n    label: 'Fetch origin branches'\n])\n</code></pre>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#62-stage-modularization","title":"6.2 Stage Modularization","text":"<pre><code>// Before (logic written inside Jenkinsfile)\nstage('Initialization') {\n    steps {\n        script {\n            // 10-20 lines of initialization code\n        }\n    }\n}\n\n// After (calling vars/stageInitialization.groovy)\nstage('Initialization') {\n    steps {\n        stageInitialization()\n    }\n}\n</code></pre>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#7-benefits","title":"7. Benefits","text":"<ol> <li>Code Reuse: All pipelines use the same Shell execution logic</li> <li>Consistent Logging: Automatically outputs label during Shell execution</li> <li>Integrated Error Handling: Same error handling for all Shell executions</li> <li>Testability: Separated modules can be unit tested</li> </ol>"},{"location":"legs/leg-1-shellscript-modularization-and-initialization-stage/changelog/#8-next-steps","title":"8. Next Steps","text":"<p>\u2192 Leg 2: 3-Level Logger System Implementation</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/","title":"Leg 2: 3-Level Logger System Implementation","text":""},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#basic-information","title":"Basic Information","text":"Item Value Start <code>d699fac</code> (2025-04-26, Leg 1 ended) Final <code>9c245c1</code> (2025-04-27) Total Commits 11 Duration 2025-04-26 (1 day)"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Goal</li> <li>Commit List</li> <li>Step-by-Step Detailed Analysis</li> <li>3.1 Step 1: vars Call Method Test</li> <li>3.2 Step 2: Logger Initial Implementation and CPS Issue Resolution</li> <li>3.3 Step 3: Logger Completion and Integration</li> <li>3-Level Logging Pattern</li> <li>New File</li> <li>Usage Examples</li> <li>Error Handling</li> <li>Architecture Significance</li> <li>Benefits</li> <li>Next Steps</li> </ol>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#1-goal","title":"1. Goal","text":"<p>Design and implement a 3-level logger system for consistent logging output during pipeline execution</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#2-commit-list","title":"2. Commit List","text":"Date Commit Message 2025-04-26 <code>aa7c86e</code> Improved logging and test vars 2025-04-26 <code>5ca3a49</code> Re-test vars 2025-04-26 <code>63abf6b</code> re-test vars no call method 2025-04-26 <code>238838a</code> Logger test 2025-04-26 <code>45d7588</code> Delete private access limiter in logger groovy regarding Jenkins pipeline access field member variables, CPS 2025-04-26 <code>0f782a5</code> Try to fix logger field variables scope issue 2025-04-26 <code>cdb1984</code> Second try to fix logger field variables scope issue, CPS 2025-04-26 <code>2267005</code> Try logging without the field variables 2025-04-26 <code>a4eb7ee</code> initial logger implemented 2025-04-26 <code>44ffef5</code> Fixed using incorrect shellScriptHelper name 2025-04-26 <code>d699fac</code> Fixed throw error handling"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#3-step-by-step-detailed-analysis","title":"3. Step-by-Step Detailed Analysis","text":""},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#31-step-1-vars-call-method-test","title":"3.1 Step 1: vars Call Method Test","text":"View Details <p>Commits: <code>aa7c86e</code> ~ <code>63abf6b</code> (3 commits)</p> <p>Goal: Test how scripts in vars/ folder are called</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#work-by-commit","title":"Work by Commit","text":"Commit Work File Changes <code>aa7c86e</code> Improved logging, created varsTest.groovy to test vars calling +<code>vars/varsTest.groovy</code>, modified <code>vars/stageInitialization.groovy</code> <code>5ca3a49</code> Re-tested vars Modified <code>vars/stageInitialization.groovy</code> <code>63abf6b</code> Tested vars without call() method Modified <code>vars/stageInitialization.groovy</code> <p>Test Purpose: - Verify how Groovy files in vars/ folder are called by Jenkins - Understand behavior differences with/without <code>call()</code> method</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#32-step-2-logger-initial-implementation-and-cps-issue-resolution","title":"3.2 Step 2: Logger Initial Implementation and CPS Issue Resolution","text":"View Details <p>Commits: <code>238838a</code> ~ <code>2267005</code> (5 commits)</p> <p>Goal: Create logger.groovy and resolve Jenkins CPS compatibility issues</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#problem-solving-process","title":"Problem Solving Process","text":"Commit Attempt Problem Solution <code>238838a</code> Created logger.groovy, used private static final fields - Initial implementation <code>45d7588</code> Removed private access modifier CPS cannot access private fields Deleted private keyword <code>0f782a5</code> Field variable scope modification attempt 1 Still inaccessible Tried different approach <code>cdb1984</code> Field variable scope modification attempt 2 CPS transformation issue persists Tried structure change <code>2267005</code> Completely removed field variables - Resolved by using strings directly <p>Code Change: <pre><code>// Before: Using field variables (CPS issue occurred)\nprivate static final String STAGE_MARKER = '===== STAGE'\nvoid stageStart(String stageName) {\n    echo \"${STAGE_MARKER} Starting: [${stageName}] ${STAGE_MARKER}\"\n}\n\n// After: Removed field variables (CPS compatible)\nvoid stageStart(String stageName) {\n    echo \"===== STAGE Starting: [${stageName}] =====\"\n}\n</code></pre></p> <p>Learning Points: - Jenkins Pipeline CPS has compatibility issues with <code>private</code>, <code>static final</code> fields - In vars/ files, using strings directly in methods is more stable than field variables</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#33-step-3-logger-completion-and-integration","title":"3.3 Step 3: Logger Completion and Integration","text":"View Details <p>Commits: <code>a4eb7ee</code> ~ <code>d699fac</code> (3 commits)</p> <p>Goal: Final logger implementation and integration with existing code</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#work-by-commit_1","title":"Work by Commit","text":"Commit Work File Changes <code>a4eb7ee</code> Final logger.groovy implementation, renamed helperShellScript \u2192 shellScriptHelper, integrated logger in stageInitialization <code>vars/logger.groovy</code> +29 lines, <code>vars/helperShellScript.groovy</code> \u2192 <code>vars/shellScriptHelper.groovy</code> <code>44ffef5</code> Fixed shellScriptHelper call name Modified <code>vars/stageInitialization.groovy</code> <code>d699fac</code> Fixed throw error handling, improved stepError method Modified <code>vars/logger.groovy</code>, <code>vars/shellScriptHelper.groovy</code>, <code>vars/stageInitialization.groovy</code> <p>Final Logger API: <pre><code>// Stage Level\nvoid stageStart(String stageName)\nvoid stageEnd(String stageName)\n\n// Steps Group Level\nvoid stepsGroupStart(String groupName)\nvoid stepsGroupEnd(String groupName)\n\n// Step Level\nvoid stepStart(String description)\nvoid stepSuccess(String description)\nvoid stepFailed(String description)\nvoid stepError(String description)\n</code></pre></p> <p>Final Naming Convention Established: <pre><code>vars/ File Naming Convention (Final):\n- Stage modules: stage{StageName}.groovy\n- Helpers: {helperName}Helper.groovy \u2192 starts with lowercase\n- Logger: logger.groovy\n</code></pre></p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#4-3-level-logging-pattern","title":"4. 3-Level Logging Pattern","text":""},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#41-level-1-stage-highest","title":"4.1 Level 1: Stage (Highest)","text":"<pre><code>===== STAGE Starting: [ StageName ] =====\n===== STAGE Completed: [ StageName ] =====\n</code></pre>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#42-level-2-steps-group-middle","title":"4.2 Level 2: Steps Group (Middle)","text":"<pre><code>--- STEPS Starting Group: [ GroupName ] ---\n--- STEPS Completed Group: [ GroupName ] ---\n</code></pre>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#43-level-3-step-lowest","title":"4.3 Level 3: Step (Lowest)","text":"<pre><code>\u27a1\ufe0f Step Starting: [ description ]...\n\ud83d\udcac Step Info: [ description ]\n\ud83c\udfc3 Step Processing: [ description ]\n\ud83d\udca1 Step Shell Executed Result: [ result ]\n\u2705 Step Completed: [ description ]\n\u26a0\ufe0f Step Warning: [ description ]\n\u274c Step Failed: [ description ]\n\ud83d\udd25 Step Error: [ description ]\n</code></pre>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#5-new-file-sharedlibrariesvarsloggergroovy-63-lines","title":"5. New File: <code>sharedLibraries/vars/logger.groovy</code> (63 lines)","text":"<pre><code>// Stage Level\nvoid stageStart(String stageName)\nvoid stageEnd(String stageName)\n\n// Steps Group Level\nvoid stepsGroupStart(String groupName)\nvoid stepsGroupEnd(String groupName)\n\n// Step Level\nvoid stepStart(String description)\nvoid stepInfo(String description)\nvoid stepProcessing(String description)\nvoid stepShellExecutedResult(String description)\nvoid stepSuccess(String description)\nvoid stepWarning(String description)\nvoid stepFailed(String description)\nvoid stepError(String description, Throwable err)\nvoid stepError(String description)  // Overload: without Throwable\n</code></pre>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#6-usage-examples","title":"6. Usage Examples","text":""},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#61-usage-within-stage","title":"6.1 Usage Within Stage","text":"<pre><code>def call() {\n    logger.stageStart(env.STAGE_NAME)\n\n    logger.stepsGroupStart('Git Repository Setup')\n\n    logger.stepStart('Fetching origin branches')\n    sh 'git fetch origin'\n    logger.stepSuccess('Origin branches fetched')\n\n    logger.stepsGroupEnd('Git Repository Setup')\n\n    logger.stageEnd(env.STAGE_NAME)\n}\n</code></pre>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#62-console-output-example","title":"6.2 Console Output Example","text":"<pre><code>===== STAGE Starting: [ Initialization ] =====\n--- STEPS Starting Group: [ Git Repository Setup ] ---\n\u27a1\ufe0f Step Starting: [ Fetching origin branches ]...\n\u2705 Step Completed: [ Origin branches fetched ]\n--- STEPS Completed Group: [ Git Repository Setup ] ---\n===== STAGE Completed: [ Initialization ] =====\n</code></pre>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#7-error-handling","title":"7. Error Handling","text":""},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#71-steperror-with-throwable","title":"7.1 stepError with Throwable","text":"<pre><code>void stepError(String description, Throwable err) {\n    StringWriter sw = new StringWriter()\n    PrintWriter pw = new PrintWriter(sw)\n    err.printStackTrace(pw)\n    String stackTrace = sw.toString()\n    println \"\ud83d\udd25\ud83d\udd25\ud83d\udd25 Full Stack Trace for Error \\n[${description}]\\n${stackTrace}\"\n    error(\"\ud83d\udd25 Step Error: \\n[ ${description} ] - Error: ${err.getMessage()}\")\n}\n</code></pre>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#72-usage-example","title":"7.2 Usage Example","text":"<pre><code>try {\n    // Dangerous operation\n} catch (Exception e) {\n    logger.stepError('Failed to execute critical operation', e)\n}\n</code></pre>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#8-architecture-significance","title":"8. Architecture Significance","text":""},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#81-standard-interface-established","title":"8.1 Standard Interface Established","text":"<p>Using the same logging pattern across all Stages and Steps \u2192 Consistent CI/CD log output</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#82-ease-of-debugging","title":"8.2 Ease of Debugging","text":"<ul> <li>Automatic Stack trace output</li> <li>Clear indication of start/completion for each step</li> <li>Status differentiation with emojis (\u2705 Success, \u26a0\ufe0f Warning, \u274c Failed, \ud83d\udd25 Error)</li> </ul>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#83-jenkins-blue-ocean-compatible","title":"8.3 Jenkins Blue Ocean Compatible","text":"<p>Step-by-step logging makes progress tracking easier in Blue Ocean UI</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#9-benefits","title":"9. Benefits","text":"<ol> <li>Consistency: Same log format across all pipelines</li> <li>Readability: Visual distinction with emojis and separators</li> <li>Debugging: Detailed stack trace on error occurrence</li> <li>Maintainability: Only one place to modify when changing log format</li> </ol>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#10-next-steps","title":"10. Next Steps","text":"<p>\u2192 Leg 3: Bitbucket API &amp; Shell Library Integration</p>"},{"location":"legs/leg-2-3-level-logger-system-implementation/changelog/#reference","title":"Reference","text":"<ul> <li>logger-system-design-integration.md - Logger System design document (Problem analysis \u2192 Solution \u2192 Implementation)</li> </ul>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/","title":"Leg 3: Bitbucket API &amp; Shell Library Integration","text":""},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#basic-information","title":"Basic Information","text":"Item Value Start <code>9c245c1</code> (2025-04-27, Leg 2 ended) Final <code>48f4295</code> (2025-05-05) Total Commits 84 Duration 2025-05-01 ~ 2025-05-05 (5 days)"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Goal</li> <li>Commit List (by Phase)</li> <li>Phase-by-Phase Detailed Analysis</li> <li>3.1 Phase 1: Jenkins Environment Test and Bitbucket API Initial Implementation</li> <li>3.2 Phase 2: Bitbucket API HTTP Communication Implementation and Debugging</li> <li>3.3 Phase 3: ShellScript Helper Refactoring</li> <li>3.4 Phase 4: Git Shell Scripts Implementation and stageProjectPrepare</li> <li>3.5 Phase 5: GitLibrary/ShellLibrary Separation and BitbucketApiService</li> <li>3.6 Phase 6: Shell Library Cleanup and Completion</li> <li>New Files</li> <li>4-Layer Architecture Established</li> <li>Core Patterns</li> <li>Bitbucket API Integration</li> <li>Benefits</li> <li>Next Steps</li> </ol>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#1-goal","title":"1. Goal","text":"<ol> <li>Bitbucket Cloud API integration for automatic build status reporting</li> <li>Abstract Git/Shell commands into reusable libraries</li> <li>Establish src/service/, src/utils/ layer architecture</li> </ol>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#2-commit-list-by-phase","title":"2. Commit List (by Phase)","text":"Phase Content Commit Count 1 Jenkins Environment Test and Bitbucket API Initial Implementation (2025-05-01) 7 2 Bitbucket API HTTP Communication Implementation and Debugging (2025-05-02 first half) 21 3 ShellScript Helper Refactoring (2025-05-02 second half) 8 4 Git Shell Scripts Implementation and stageProjectPrepare (2025-05-03) 26 5 GitLibrary/ShellLibrary Separation and BitbucketApiService (2025-05-04) 16 6 Shell Library Cleanup and Completion (2025-05-05) 6 Phase 1: Jenkins Environment Test and Bitbucket API Initial Implementation (7 commits) Date Commit Message 2025-05-01 <code>dd02d58</code> Add print jenkins environment 2025-05-01 <code>ea2d6bc</code> repo:push test 2025-05-01 <code>612b8e9</code> repo:push test 2025-05-01 <code>4fce553</code> Replace PR_BRANCH with GIT_BRANCH 2025-05-01 <code>ab3b6a6</code> Corrected PR_BRANCH to GIT_BRANCH 2025-05-01 <code>8b062fc</code> Delete necessary function to get full commit hash because full commit hash can be grabed as same value in Jenkins Initial Environment named 'GIT_COMMIT: Jenkins Log-763 2025-05-01 <code>12dcf8d</code> Implemented sendBuildStatusForCommit method to send build status to Bitbucket Cloud API. - Implemented it in low level to handle the details of the API request. - Implemented try-catch-finally block to handle exceptions. - Implemented withCredentials block to handle authentication. - Implemented try-with-resources block to handle resources. - Implemented logger to log the status of the build. - Implemented logger to log the response from the API. - Implemented logger to log the error message from the API. Phase 2: Bitbucket API HTTP Communication Implementation and Debugging (21 commits) Date Commit Message 2025-05-02 <code>e62b93f</code> Added package imports to apiHelper.groovy 2025-05-02 <code>43a73e0</code> Fixed Compail error 2025-05-02 <code>d17333e</code> Try to fix Compile Error 2025-05-02 <code>6e519c7</code> Add print StackTrace Error message code 2025-05-02 <code>d60a705</code> Try to print stacktrace error message 2025-05-02 <code>ef6406c</code> Add more logging for HTTP Request 2025-05-02 <code>a3011db</code> Added error type for HTTP request 2025-05-02 <code>ea71fb8</code> Try a new way to implement bitbucket api 2025-05-02 <code>97fe87b</code> Use StringBuilder not steam Collectors 2025-05-02 <code>dc76f45</code> Refactor SendBuildStatusForCommit Bitbucket API with HttpClient Class 2025-05-02 <code>72beb1f</code> Improve error logging 2025-05-02 <code>a761924</code> Fixed Compiler Error 2025-05-02 <code>aeae874</code> slightly touch StackTrace logging output 2025-05-02 <code>39725c6</code> Refactor Bitbucket API call 2025-05-02 <code>cd080f8</code> Added missing package importing in bitbucketApi groovy 2025-05-02 <code>a4bcc06</code> Added missing package in BitbucketApiClient groovy 2025-05-02 <code>4a9fe5b</code> Try to fix closing chuck expected error during Bitbucket API Communication 2025-05-02 <code>d0af7e3</code> Try to fix closing chunk expected second attempt 2025-05-02 <code>34e90c3</code> Missing variable declaralation 2025-05-02 <code>37980ea</code> slightly touch up logging message 2025-05-02 <code>cff33c3</code> Polishing Logging Phase 3: ShellScript Helper Refactoring (8 commits) Date Commit Message 2025-05-02 <code>9eaf277</code> Refactor try-out for ShellScript 2025-05-02 <code>7d4222a</code> Refactor ShellScriptHelper and Create ShellScripts as list of shellscript, delete ShellParams groovy 2025-05-02 <code>3678a3f</code> Try to fix Compaile Error 2025-05-02 <code>5a27ee0</code> Try to fix Compaile Error 2025-05-02 <code>555a11b</code> Try to fix Compaile Error 2025-05-02 <code>668d621</code> Fixed shellScriptHelper Implementation 2025-05-02 <code>3fc2917</code> Modified Data Type check and Empty Condition logic in validateShMap function, for GString 2025-05-02 <code>ee64f56</code> Mark unnecessary Jenkins Environment and Create a new Stage Phase 4: Git Shell Scripts Implementation and stageProjectPrepare (26 commits) Date Commit Message 2025-05-03 <code>ff92c62</code> Test isDirectory function 2025-05-03 <code>c862433</code> Test fileExists function instead of isDirectory 2025-05-03 <code>220bb9e</code> Fixed incorrect rutern data type for fileExists function 2025-05-03 <code>5585b83</code> new stageCheckoutSourceCode groovy Checkpoint 2025-05-03 <code>9c44606</code> Fixed GIT_SHOW_CUREENT_BRANCH Closure 2025-05-03 <code>cf092a4</code> Fixed ShellScripts.groovy to return the current branch name 2025-05-03 <code>aba6b68</code> Fixed GIT_SHOW_CURRENT_BRANCH Closure to return the current branch name 2025-05-03 <code>6dbf4e0</code> Fixed GIT_SHOW_CURRENT_BRANCH 2025-05-03 <code>7551ee8</code> Git test with pwd property 2025-05-03 <code>c479cb6</code> Fixed incorrect implementation for sh step and correct javadoc for ShellScripts groovy 2025-05-03 <code>8dda64b</code> Fixing GIT_SHOW_CURRENT_BRANCH Closure 2025-05-03 <code>1858dcf</code> Upgrade Shell Script Label 2025-05-03 <code>ca2cbb1</code> sh returnstdout test 2025-05-03 <code>da273ac</code> Improved logging 2025-05-03 <code>55a0fbe</code> Refactor a part of cloneOrUpdateRepo and test 2025-05-03 <code>9bf0779</code> Commented out the error log for the returnStdout option in shellScriptHelper.groovy, due to the better error handling in the sh step. 2025-05-03 <code>3e84f96</code> Implement Git source code checkout and synchronization logic - Created GIT_CHECK_ORIGIN_BRANCH_EXISTS to check if a branch exists on the 'origin' remote repository. - Created GIT_GET_ORIGIN_DEFAULT_BRANCH to get the default branch name for the 'origin' remote repository. - Changed the way to handle the error in shellScriptHelper.groovy, due to the better error handling in the sh step. - Implemented the Git Clone and Checkout logic in stageCheckoutSourceCode.groovy. - Implemented a part of the Synchronize with Default Branch logic in stageCheckoutSourceCode.groovy. 2025-05-03 <code>9b13c46</code> New shell scripts and updated existing shell scripts: - Created GIT_CHECK_ORIGIN_BRANCH_EXISTS to check if a branch exists on the 'origin' remote repository. - Fixed to use single quotes instead of triple quotes for shell scripts for GIT_GET_ORIGIN_DEFAULT_BRANCH. - Implemented GIT_CHECK_BRANCH_EXISTS to check if a branch exists locally or on the 'origin' remote. 2025-05-03 <code>ae9c014</code> Pipeline stage name change, Git sync check addition, and success logic modification - Rename stageCheckoutSourceCode to stageProjectPrepare - Created GIT_CHECK_UP_TO_DATE_WITH_REMOTE to check if the local branch is up to date with the remote branch - Rename stage names in Jenkinsfile - Modified how to handle successful logic in executeReturnStatus 2025-05-03 <code>ecf3e97</code> Add unstaged changes to previous commit 2025-05-03 <code>2bf21e7</code> Improved shell script helper function - Delete unused shell script helper function - Simplify ShellScriptHelper logging messages 2025-05-03 <code>89c1cca</code> Created / Implemented GIT_CHECK_IS_REMOTE_BRANCH_ANCESTOR shell script helper function 2025-05-03 <code>c995312</code> Implemented new shell script helper functions in stageProjectPrepare - Created GIT_CHECK_IS_REMOTE_BRANCH_ANCESTOR shell script helper function - Created GIT_MERGE_ORIGIN_BRANCH shell script helper function - Created GIT_LFS_FETCH_AND_CHECKOUT shell script helper function 2025-05-03 <code>432a130</code> Improved shell script logging 2025-05-03 <code>8eb0779</code> Commented out Prepare Workspace refacted into Jenkins Initialization and Project Preparation stages 2025-05-03 <code>7439856</code> Replace COMMIT_HASH with GIT_COMMIT Phase 5: GitLibrary/ShellLibrary Separation and BitbucketApiService (16 commits) Date Commit Message 2025-05-04 <code>8d6a236</code> Refactored Stages Implemented and Deleted Previous 2025-05-04 <code>aeeef99</code> Refactoring: ShellScripts into Libraries and Integration: - ShellScripts was refactored into GitLibrary and ShellLibrary - Implemented the refactored Libraries in stageProjectPrepare and stageInitialization 2025-05-04 <code>9702e3f</code> quick fixed incorrect class name usage 2025-05-04 <code>c637009</code> Implementation of Bitbucket API and Refactored related functions - Created BitbucketApiService and BitbucketApiLibrary - Created bitbucketApiHelper - Refactored stageInitialization 2025-05-04 <code>504cbdd</code> Add missing Class declaration 2025-05-04 <code>551c40d</code> Implmented not using BitbucketApiLibrary 2025-05-04 <code>3b38c6b</code> Add missing pakcage import 2025-05-04 <code>9454891</code> Try to fix 2025-05-04 <code>91ef0c6</code> Delete not use package import 2025-05-04 <code>f1c0a8e</code> Try to fix bitbucket API function 2025-05-04 <code>c8cd439</code> try to use function 2025-05-04 <code>97dd803</code> createBuildStatusForCommit 2025-05-04 <code>2dda24f</code> Try to fix api function variables 2025-05-04 <code>94ba7ec</code> Fixed calling incorrec method name 2025-05-04 <code>b6d8f82</code> Fixed Method Exception 2025-05-04 <code>efa5c44</code> Improved Http request logic and logging Phase 6: Shell Library Cleanup and Completion (6 commits) Date Commit Message 2025-05-05 <code>3278c38</code> Rename all Shell Library Clsoure for name convention 2025-05-05 <code>341252c</code> Implement dockerInfo shellscript into shellLibrary 2025-05-05 <code>26c2199</code> Add missing package import in PipelineForJenkins jenkinsfile 2025-05-05 <code>2c5eb16</code> Implement GroovyLint ShellScript into ShellLibrary 2025-05-05 <code>99387da</code> Added Missing Property for GroovyLint 2025-05-05 <code>48f4295</code> Take unnecessary log message in ShellLibrary GroovyLint script property"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#3-phase-by-phase-detailed-analysis","title":"3. Phase-by-Phase Detailed Analysis","text":""},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#31-phase-1-jenkins-environment-test-and-bitbucket-api-initial-implementation","title":"3.1 Phase 1: Jenkins Environment Test and Bitbucket API Initial Implementation","text":"View Details <p>Duration: 2025-05-01 (7 commits)</p> <p>Goal: Understand Jenkins environment variables and initial Bitbucket Cloud API implementation</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#step-1-jenkins-environment-variable-test-dd02d58-ab3b6a6","title":"Step 1: Jenkins Environment Variable Test (<code>dd02d58</code> ~ <code>ab3b6a6</code>)","text":"Commit Work <code>dd02d58</code> Jenkins environment variable output test <code>ea2d6bc</code> ~ <code>612b8e9</code> repo:push event test <code>4fce553</code> ~ <code>ab3b6a6</code> Replace PR_BRANCH with GIT_BRANCH"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#step-2-bitbucket-api-initial-implementation-8b062fc-12dcf8d","title":"Step 2: Bitbucket API Initial Implementation (<code>8b062fc</code> ~ <code>12dcf8d</code>)","text":"Commit Work <code>8b062fc</code> Delete full commit hash function (use GIT_COMMIT environment variable) <code>12dcf8d</code> Implement <code>sendBuildStatusForCommit</code> method: try-catch-finally, withCredentials, logger integration <p>Learning Points: - Jenkins provides full commit hash via <code>GIT_COMMIT</code> environment variable - Access commit info via environment variable without separate shell command</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#32-phase-2-bitbucket-api-http-communication-implementation-and-debugging","title":"3.2 Phase 2: Bitbucket API HTTP Communication Implementation and Debugging","text":"View Details <p>Duration: 2025-05-02 first half (21 commits)</p> <p>Goal: Implement and debug Bitbucket Cloud REST API HTTP communication</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#problem-solving-process","title":"Problem Solving Process","text":"Commit Attempt Problem Solution <code>e62b93f</code> Added package import - Added import to apiHelper.groovy <code>43a73e0</code> ~ <code>d17333e</code> Initial implementation Compile Error Fixed syntax errors <code>6e519c7</code> ~ <code>d60a705</code> Error logging StackTrace not visible Added print StackTrace code <code>ef6406c</code> ~ <code>a3011db</code> HTTP logging Need request/response verification Added error type logging <code>ea71fb8</code> ~ <code>97fe87b</code> HttpClient implementation Stream Collectors issue Changed to StringBuilder <code>dc76f45</code> Refactoring - Organized into HttpClient Class <code>72beb1f</code> ~ <code>aeae874</code> Error logging improvement Compiler Error Fixed and improved StackTrace output <code>39725c6</code> ~ <code>a4bcc06</code> API call refactoring Missing package Added import <code>4a9fe5b</code> ~ <code>d0af7e3</code> HTTP communication \"closing chunk expected\" Fixed chunk transfer method <code>34e90c3</code> ~ <code>cff33c3</code> Finalization Missing variable declaration Cleaned up logging <p>Learning Points: - Java 11+ HttpClient is usable in Jenkins Pipeline - StringBuilder is more stable than Stream Collectors in Jenkins CPS</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#33-phase-3-shellscript-helper-refactoring","title":"3.3 Phase 3: ShellScript Helper Refactoring","text":"View Details <p>Duration: 2025-05-02 second half (8 commits)</p> <p>Goal: Refactor ShellScript execution helper and remove ShellParams</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#problem-solving-process_1","title":"Problem Solving Process","text":"Commit Work Problem Solution <code>9eaf277</code> ShellScript refactoring attempt - Started structure change <code>7d4222a</code> Convert ShellScripts to list, delete ShellParams - Switched to Map-based <code>3678a3f</code> ~ <code>555a11b</code> Fix Compile Error Syntax error Fixed after 3 attempts <code>668d621</code> shellScriptHelper implementation complete - Final implementation <code>3fc2917</code> Fix validateShMap function GString type handling Improved type check logic <code>ee64f56</code> Clean up unnecessary env vars, create new Stage - Added stageCheckoutSourceCode <p>Code Change: <pre><code>// Before: ShellParams class\nShellParams params = new ShellParams(script: 'git fetch', label: 'Fetch')\n\n// After: Using Map\nshellScriptHelper.execute([script: 'git fetch', label: 'Fetch'])\n</code></pre></p> <p>Learning Points: - Groovy GString and String are handled as different types - Simple Map is more flexible than classes in Jenkins Pipeline</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#34-phase-4-git-shell-scripts-implementation-and-stageprojectprepare","title":"3.4 Phase 4: Git Shell Scripts Implementation and stageProjectPrepare","text":"View Details <p>Duration: 2025-05-03 (26 commits)</p> <p>Goal: Abstract Git commands as Closures and implement stageProjectPrepare Stage</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#step-1-file-existence-check-function-test-ff92c62-220bb9e","title":"Step 1: File Existence Check Function Test (<code>ff92c62</code> ~ <code>220bb9e</code>)","text":"Commit Attempt Problem Solution <code>ff92c62</code> isDirectory function test - Test <code>c862433</code> Changed to fileExists function - Alternative attempt <code>220bb9e</code> Fixed return type Wrong return type Fixed"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#step-2-stagecheckoutsourcecode-and-git-closure-5585b83-7439856","title":"Step 2: stageCheckoutSourceCode and Git Closure (<code>5585b83</code> ~ <code>7439856</code>)","text":"Commit Work <code>5585b83</code> stageCheckoutSourceCode.groovy checkpoint <code>9c44606</code> ~ <code>6dbf4e0</code> Fixed GIT_SHOW_CURRENT_BRANCH Closure (4 attempts) <code>7551ee8</code> ~ <code>c479cb6</code> pwd test, fixed sh step implementation <code>8dda64b</code> ~ <code>1858dcf</code> Final GIT_SHOW_CURRENT_BRANCH fix, Shell Script Label improvement <code>ca2cbb1</code> ~ <code>da273ac</code> returnStdout test, logging improvement <code>55a0fbe</code> Partial cloneOrUpdateRepo refactoring <code>9bf0779</code> Commented out returnStdout error log <code>3e84f96</code> Implemented Git checkout/sync logic: GIT_CHECK_ORIGIN_BRANCH_EXISTS, GIT_GET_ORIGIN_DEFAULT_BRANCH <code>9b13c46</code> Additional shell scripts: single quotes usage, GIT_CHECK_BRANCH_EXISTS <code>ae9c014</code> Renamed stageCheckoutSourceCode \u2192 stageProjectPrepare, added GIT_CHECK_UP_TO_DATE_WITH_REMOTE <code>ecf3e97</code> ~ <code>2bf21e7</code> Added unstaged changes, deleted unnecessary functions <code>89c1cca</code> ~ <code>c995312</code> Implemented GIT_CHECK_IS_REMOTE_BRANCH_ANCESTOR, GIT_MERGE_ORIGIN_BRANCH, GIT_LFS_FETCH_AND_CHECKOUT <code>432a130</code> ~ <code>7439856</code> Logging improvement, replaced COMMIT_HASH with GIT_COMMIT <p>Learning Points: - Closure for Shell command definition enables parameterized reuse - Need to trim results when using <code>returnStdout: true</code></p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#35-phase-5-gitlibraryshelllibrary-separation-and-bitbucketapiservice","title":"3.5 Phase 5: GitLibrary/ShellLibrary Separation and BitbucketApiService","text":"View Details <p>Duration: 2025-05-04 (16 commits)</p> <p>Goal: Separate Shell Scripts into GitLibrary/ShellLibrary and implement BitbucketApiService</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#step-1-library-separation-8d6a236-9702e3f","title":"Step 1: Library Separation (<code>8d6a236</code> ~ <code>9702e3f</code>)","text":"Commit Work <code>8d6a236</code> Deleted previous Stage and refactored <code>aeeef99</code> Separated ShellScripts \u2192 GitLibrary + ShellLibrary, applied to stageProjectPrepare/stageInitialization <code>9702e3f</code> Fixed incorrect class name"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#step-2-bitbucketapiservice-implementation-c637009-efa5c44","title":"Step 2: BitbucketApiService Implementation (<code>c637009</code> ~ <code>efa5c44</code>)","text":"Commit Attempt Problem Solution <code>c637009</code> Created BitbucketApiService, bitbucketApiHelper - Initial implementation <code>504cbdd</code> Missing Class declaration Compile Error Added <code>551c40d</code> Implemented without BitbucketApiLibrary - Simplified <code>3b38c6b</code> ~ <code>91ef0c6</code> Package import issue Compile Error Fixed/deleted import <code>f1c0a8e</code> ~ <code>c8cd439</code> Fixed API function Not working Attempted <code>97dd803</code> createBuildStatusForCommit - Function implementation <code>2dda24f</code> Fixed variables - Attempted <code>94ba7ec</code> Fixed method name Wrong method call Fixed <code>b6d8f82</code> Fixed Method Exception Exception occurred Fixed <code>efa5c44</code> Improved HTTP request logic and logging - Final cleanup <p>Architecture Change: <pre><code>Before:  src/utils/ShellScripts.groovy (all Shell commands)\nAfter:   src/utils/GitLibrary.groovy\n         src/utils/ShellLibrary.groovy\n         src/service/general/BitbucketApiService.groovy\n</code></pre></p> <p>Learning Points: - Domain-based Library separation improves management/testing - Encapsulate business logic (API calls) in Service layer</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#36-phase-6-shell-library-cleanup-and-completion","title":"3.6 Phase 6: Shell Library Cleanup and Completion","text":"View Details <p>Duration: 2025-05-05 (6 commits)</p> <p>Goal: Unify Shell Library naming convention and implement additional scripts</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#work-by-commit","title":"Work by Commit","text":"Commit Work <code>3278c38</code> Unified all Shell Library Closure naming convention <code>341252c</code> Added DOCKER_INFO shellscript <code>26c2199</code> Added package import to PipelineForJenkins Jenkinsfile <code>2c5eb16</code> Implemented GROOVY_LINT ShellScript <code>99387da</code> Added missing GroovyLint Property <code>48f4295</code> Removed unnecessary log message <p>Learning Points: - Consistent naming convention (<code>VERB_NOUN</code>) improves code readability - When adding Closure to Library, manage related properties together</p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#4-new-files","title":"4. New Files","text":""},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#41-layer-3-service-business-logic","title":"4.1 Layer 3: Service (Business Logic)","text":""},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#sharedlibrariessrcservicegeneralbitbucketapiservicegroovy-155-lines","title":"<code>sharedLibraries/src/service/general/BitbucketApiService.groovy</code> (155 lines)","text":"<p>Bitbucket Cloud REST API client <pre><code>class BitbucketApiService {\n    def pipeline\n\n    BitbucketApiService(pipeline) {\n        this.pipeline = pipeline\n    }\n\n    void sendBuildStatusForCommit(String commitHash, String state, String key, String url, String description) {\n        // HTTP POST to Bitbucket Cloud API\n        // /2.0/repositories/{workspace}/{repo}/commit/{commit}/statuses/build\n    }\n}\n</code></pre></p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#42-layer-4-utils-libraries","title":"4.2 Layer 4: Utils (Libraries)","text":""},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#sharedlibrariessrcutilsgitlibrarygroovy-258-lines","title":"<code>sharedLibraries/src/utils/GitLibrary.groovy</code> (258 lines)","text":"<p>Git command library <pre><code>class GitLibrary {\n    // Check branch existence\n    static Closure GIT_CHECK_ORIGIN_BRANCH_EXISTS = { branchName -&gt;\n        \"git ls-remote --heads origin ${branchName} | grep -q ${branchName}\"\n    }\n\n    // Get default branch\n    static Closure GIT_GET_ORIGIN_DEFAULT_BRANCH = {\n        \"git remote show origin | grep 'HEAD branch' | cut -d' ' -f5\"\n    }\n\n    // Check if remote branch is ancestor\n    static Closure GIT_CHECK_IS_REMOTE_BRANCH_ANCESTOR = { baseBranch, targetBranch -&gt;\n        \"git merge-base --is-ancestor origin/${baseBranch} origin/${targetBranch}\"\n    }\n\n    // Merge remote branch\n    static Closure GIT_MERGE_ORIGIN_BRANCH = { branchName -&gt;\n        \"git merge origin/${branchName} --no-edit\"\n    }\n\n    // Git LFS fetch and checkout\n    static Closure GIT_LFS_FETCH_AND_CHECKOUT = {\n        \"git lfs fetch --all &amp;&amp; git lfs checkout\"\n    }\n\n    // Check if local branch is synced with remote\n    static Closure GIT_CHECK_UP_TO_DATE_WITH_REMOTE = { branchName -&gt;\n        '''\n        LOCAL=$(git rev-parse HEAD)\n        REMOTE=$(git rev-parse origin/${branchName})\n        [ \"$LOCAL\" = \"$REMOTE\" ]\n        '''\n    }\n}\n</code></pre></p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#sharedlibrariessrcutilsshelllibrarygroovy-210-lines","title":"<code>sharedLibraries/src/utils/ShellLibrary.groovy</code> (210 lines)","text":"<p>General Shell command library <pre><code>class ShellLibrary {\n    // Get Docker info\n    static Closure DOCKER_INFO = {\n        \"docker info\"\n    }\n\n    // Execute Groovy Lint\n    static Closure GROOVY_LINT = { targetPath, configPath -&gt;\n        \"npm-groovy-lint --path ${targetPath} --config ${configPath}\"\n    }\n\n    // Copy file\n    static Closure COPY_FILE = { source, destination -&gt;\n        \"cp ${source} ${destination}\"\n    }\n\n    // Check directory existence\n    static Closure CHECK_DIR_EXISTS = { path -&gt;\n        \"[ -d ${path} ]\"\n    }\n}\n</code></pre></p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#43-layer-2-vars-entry-points","title":"4.3 Layer 2: vars/ (Entry Points)","text":""},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#sharedlibrariesvarsbitbucketapihelpergroovy-33-lines","title":"<code>sharedLibraries/vars/bitbucketApiHelper.groovy</code> (33 lines)","text":"<pre><code>def sendBuildStatus(String state, String description) {\n    BitbucketApiService service = new BitbucketApiService(this)\n    service.sendBuildStatusForCommit(\n        env.GIT_COMMIT,\n        state,\n        env.BUILD_TAG,\n        env.BUILD_URL,\n        description\n    )\n}\n</code></pre>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#sharedlibrariesvarsstageprojectpreparegroovy-84-lines","title":"<code>sharedLibraries/vars/stageProjectPrepare.groovy</code> (84 lines)","text":"<p>Git checkout and project preparation Stage <pre><code>def call(Map config = [:]) {\n    logger.stageStart(env.STAGE_NAME)\n\n    logger.stepsGroupStart('Git Repository Setup')\n    // Use GitLibrary functions\n    shellScriptHelper.execute(GitLibrary.GIT_CHECK_ORIGIN_BRANCH_EXISTS(env.PR_BRANCH))\n    // ...\n\n    logger.stepsGroupEnd('Git Repository Setup')\n    logger.stageEnd(env.STAGE_NAME)\n}\n</code></pre></p>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#5-4-layer-architecture-established","title":"5. 4-Layer Architecture Established","text":"<pre><code>devops-jenkins-linux/\n\u251c\u2500\u2500 */Jenkinsfile                      # Layer 1: Entry Point\n\u2502   \u251c\u2500\u2500 DLXJenkins/Jenkinsfile\n\u2502   \u251c\u2500\u2500 DLXJenkins/JenkinsfileDeployment\n\u2502   \u251c\u2500\u2500 JsJenkins/Jenkinsfile\n\u2502   \u251c\u2500\u2500 JsJenkins/JenkinsfileDeployment\n\u2502   \u2514\u2500\u2500 PipelineForJenkins/Jenkinsfile\n\u2502\n\u2514\u2500\u2500 sharedLibraries/\n    \u251c\u2500\u2500 vars/                          # Layer 2: Orchestration\n    \u2502   \u251c\u2500\u2500 stageInitialization.groovy\n    \u2502   \u251c\u2500\u2500 stageProjectPrepare.groovy\n    \u2502   \u251c\u2500\u2500 shellScriptHelper.groovy\n    \u2502   \u251c\u2500\u2500 bitbucketApiHelper.groovy\n    \u2502   \u2514\u2500\u2500 logger.groovy (Cross-Cutting)\n    \u2502\n    \u2514\u2500\u2500 src/\n        \u251c\u2500\u2500 service/                   # Layer 3: Services\n        \u2502   \u2514\u2500\u2500 general/\n        \u2502       \u2514\u2500\u2500 BitbucketApiService.groovy\n        \u2502\n        \u251c\u2500\u2500 utils/                     # Layer 4: Utilities\n        \u2502   \u251c\u2500\u2500 GitLibrary.groovy\n        \u2502   \u2514\u2500\u2500 ShellLibrary.groovy\n        \u2502\n        \u2514\u2500\u2500 resource/                  # Layer 4: Utilities (Constants)\n            \u2514\u2500\u2500 Status.groovy\n</code></pre>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#6-core-patterns","title":"6. Core Patterns","text":""},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#61-shell-command-abstraction-using-closure","title":"6.1 Shell Command Abstraction Using Closure","text":"<pre><code>// Definition (GitLibrary.groovy)\nstatic Closure GIT_FETCH_ORIGIN = { branchName -&gt;\n    \"git fetch origin ${branchName}\"\n}\n\n// Usage (stageProjectPrepare.groovy)\nshellScriptHelper.execute([\n    script: GitLibrary.GIT_FETCH_ORIGIN(env.PR_BRANCH),\n    label: 'Fetch PR branch from origin'\n])\n</code></pre>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#62-advantages","title":"6.2 Advantages","text":"<ol> <li>Type Safety: Clearly define parameters with Closure</li> <li>Reusability: Use same Git commands in multiple Stages</li> <li>Testability: Test Shell command string generation logic independently</li> <li>Documentation: Can add descriptions for each command</li> </ol>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#7-bitbucket-api-integration","title":"7. Bitbucket API Integration","text":""},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#71-build-status-reporting-flow","title":"7.1 Build Status Reporting Flow","text":"<pre><code>Pipeline Start\n    \u2193\nbitbucketApiHelper.sendBuildStatus('INPROGRESS', 'Build started')\n    \u2193\n... (build execution) ...\n    \u2193\nbitbucketApiHelper.sendBuildStatus('SUCCESSFUL', 'Build completed')\n    or\nbitbucketApiHelper.sendBuildStatus('FAILED', 'Build failed')\n</code></pre>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#72-verification-in-bitbucket-pr","title":"7.2 Verification in Bitbucket PR","text":"<ul> <li>Build status badge displayed on PR page</li> <li>Per-commit build result verification possible</li> </ul>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#8-benefits","title":"8. Benefits","text":"<ol> <li>Centralization: Git/Shell commands managed in one place</li> <li>Consistency: All pipelines use same commands</li> <li>Visibility: Real-time build status verification in Bitbucket</li> <li>Maintainability: Only modify library when changing commands</li> </ol>"},{"location":"legs/leg-3-bitbucket-api-and-shell-library-integration/changelog/#9-next-steps","title":"9. Next Steps","text":"<p>\u2192 Leg 4: Full Pipeline Refactoring and Stage Modularization</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/","title":"Leg 4: Full Pipeline Refactoring &amp; Stage Modularization","text":""},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#basic-information","title":"Basic Information","text":"Item Value Start <code>48f4295</code> (2025-05-05, Leg 3 ended) Final <code>ff74ac8</code> (2025-05-12) Total Commits 128 Duration 2025-05-06 ~ 2025-05-12 (7 days)"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Goal</li> <li>Commit List (by Phase)</li> <li>Phase-by-Phase Detailed Analysis</li> <li>3.1 Phase 1: PipelineForJenkins Stage Modularization</li> <li>3.2 Phase 2: DLX Pipeline Webhook Trigger Configuration</li> <li>3.3 Phase 3: DLX-PR-Pipeline Stage Modularization</li> <li>3.4 Phase 4: DLX-Deployment Pipeline Refactoring</li> <li>3.5 Phase 5: Full Jenkinsfile Cleanup and Integration</li> <li>3.6 Phase 6: SSH Library and Deployment Feature Completion</li> <li>3.7 Phase 7: Finalization and Bug Fixes</li> <li>New Stage Files</li> <li>New Libraries</li> <li>Jenkinsfile Transformation Example</li> <li>Webhook Configuration Improvements</li> <li>Final Architecture</li> <li>Benefits</li> <li>Conclusion</li> </ol>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#1-goal","title":"1. Goal","text":"<p>Modularize all Stages of 5 pipelines so Jenkinsfiles consist only of Stage calls</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#2-commit-list-by-phase","title":"2. Commit List (by Phase)","text":"Phase Content Commit Count 1 PipelineForJenkins Stage Modularization (2025-05-05 ~ 2025-05-06 early) 8 2 DLX Pipeline Webhook Trigger Configuration (2025-05-06) 40 3 DLX-PR-Pipeline Stage Modularization (2025-05-07 first half) 24 4 DLX-Deployment Pipeline Refactoring (2025-05-07 middle) 22 5 Full Jenkinsfile Cleanup and Integration (2025-05-07 second half) 18 6 SSH Library and Deployment Feature Completion (2025-05-08) 12 7 Finalization and Bug Fixes (2025-05-09 ~ 2025-05-12) 4 Phase 1: PipelineForJenkins Stage Modularization (8 commits) Date Commit Message 2025-05-05 <code>8e96fb9</code> Improved shellScriptHelper logging 2025-05-06 <code>3ef978a</code> Refactored LintGrovyJenkinsfile Stage 2025-05-06 <code>9dcc23b</code> Added logging in stageLintGroovyJenkinsfile 2025-05-06 <code>6f4cf84</code> Modulized Static Analysis Stage 2025-05-06 <code>0e66b11</code> Test Modulized Static Analysis Stage 2025-05-06 <code>87e8a89</code> Replace the un-modularized bitbucket api function with the modularized one for post steps 2025-05-06 <code>2c2d821</code> Refactored SonarQube test 2025-05-06 <code>063955e</code> Added Missing the variable for importing package Phase 2: DLX Pipeline Webhook Trigger Configuration (40 commits) Date Commit Message 2025-05-06 <code>4c8509e</code> == Start DLX Pipeline Refactoring == : Refactored Prepare Workspace Stage 2025-05-06 <code>f25f136</code> Commented out regexpFilter for DLX Pipeline 2025-05-06 <code>c26d434</code> try to get full request body 2025-05-06 <code>19c71e9</code> Added getting BITBUCKET_EVENT_KEY 2025-05-06 <code>3ac83a5</code> Fixed how to import Http Header variables 2025-05-06 <code>163cff2</code> getting full request header 2025-05-06 <code>e2fe075</code> Test getting http request header 2025-05-06 <code>f09fcc9</code> quick teset 2025-05-06 <code>1fff356</code> modified logging for getting http request body and header 2025-05-06 <code>d5eab38</code> Added Request Body and Header trigger 2025-05-06 <code>79f6155</code> One more time webhoob trigger for implmenting GenericTrigger configuration fully 2025-05-06 <code>0c004ac</code> Try to retrieve x event key only 2025-05-06 <code>cbb805f</code> Try to not to use expression of JsonPath for Http header 2025-05-06 <code>b6f2c58</code> Try new way to retrieve http header 2025-05-06 <code>85b81c3</code> Try new way to retrieve http header 2025-05-06 <code>f948ddd</code> Try to retrieve lowcase and underscore for generic Header Variables 2025-05-06 <code>b558e24</code> Try one more time 2025-05-06 <code>58edeec</code> X-Event-Key 2025-05-06 <code>1811e1c</code> Added regexpFilter for HTTP Header 2025-05-06 <code>7e07e96</code> Print env first 2025-05-06 <code>943c40c</code> Try to use x_event_key 2025-05-06 <code>50ea98a</code> Push to check accessing x-event-key header 2025-05-06 <code>cb5a64a</code> Try to get Branch name 2025-05-06 <code>fcb920f</code> Test Http body Json retrieving 2025-05-06 <code>ac3bb52</code> Print Json Request body Jons 2025-05-06 <code>b1456e6</code> Try to use HTTP BODY JSON 2025-05-06 <code>374e775</code> Assigned all necessary Jenkins environment for repo push Bitbucket WebTrigger 2025-05-06 <code>76296e7</code> Same Implement repo push event trigger for DLX PR pipeline 2025-05-06 <code>ee741e8</code> Incorrect environment variable using for PR_BRANCH 2025-05-06 <code>c9220f4</code> Added missing package importing 2025-05-06 <code>f87e726</code> Switch better symbol for info log 2025-05-06 <code>9b173c0</code> DLX-PR-Pipeline-Linting Stage 2025-05-06 <code>a08e8e9</code> Test loading groovy file in Envrionment 2025-05-06 <code>39f37c1</code> Take loading groovy in environment braket off 2025-05-06 <code>c183faa</code> Fixed empty value for REPORT_DIR 2025-05-06 <code>6876f0b</code> Fixed Destination Branch Environment Assignment logic 2025-05-06 <code>d09288f</code> Add missing package importing 2025-05-06 <code>d9ed92e</code> Added More Missing Packge Importing 2025-05-06 <code>fc77459</code> Added More step to secure returning value from shellscript 2025-05-06 <code>27dcc7c</code> Implement DESTINATION_BRANCH environment value assignment in different way for every pipelines Phase 3: DLX-PR-Pipeline Stage Modularization (24 commits) Date Commit Message 2025-05-07 <code>d8aab9b</code> Refactored Unity Linting STage 2025-05-07 <code>27dd597</code> try to fix copy lint config file for unity linting 2025-05-07 <code>ebfd6fb</code> Correct unnecessary argument for CopyLintConfig ShellScripting 2025-05-07 <code>88f815b</code> Try to fix shellscript 2025-05-07 <code>ce58b16</code> Add sh inside shellScript 2025-05-07 <code>ed7f993</code> EditMode modulurized test 2025-05-07 <code>c01107f</code> EditMode stage test 2025-05-07 <code>59009e0</code> Fixed how to use goorvy file in vars 2025-05-07 <code>319d413</code> Refacted PlayMode and Coverage Stage 2025-05-07 <code>5b43e05</code> Refactored CopyWebGLBuilder file 2025-05-07 <code>173e352</code> Fixed wrong import package 2025-05-07 <code>6bd044f</code> Added Missing Reference 2025-05-07 <code>e9b7c70</code> Change logic for checking lighting and reflection Probe files 2025-05-07 <code>07f2646</code> Try to improve new logging style 2025-05-07 <code>e2f47d3</code> Refactored Build Project Stage for DLX PR pipeline 2025-05-07 <code>f2828b3</code> Improve logging and detatched stripIndent functions for error issue 2025-05-07 <code>65878e3</code> Delete no need paranthesis in checkLightingAndReflectionFiles 2025-05-07 <code>4e0b1ff</code> Improved logger 2025-05-07 <code>e36d730</code> stiripIndent function test 2025-05-07 <code>591b815</code> stripIndent function test 2025-05-07 <code>703d90f</code> Implement stripIndent function 2025-05-07 <code>bb271db</code> Fixed incorrect argument to execute webgl build unity headless mode 2025-05-07 <code>85fea53</code> Complete DLX-PR-Pipeline Refactor 2025-05-07 <code>69357f0</code> Pointing Refactor-with-TDD global Trusted Shared Library Branch Phase 4: DLX-Deployment Pipeline Refactoring (22 commits) Date Commit Message 2025-05-07 <code>500ca0e</code> Delete Unnecessary function 2025-05-07 <code>d54d03e</code> Try to added regexpFilterExpression for not merged trigger for PR branch 2025-05-07 <code>83e8eaf</code> test webhook trigger filter for jenkins pipeline 2025-05-07 <code>8d0608a</code> Add getting http x-event-key header value for DLX-Deployment pipeline 2025-05-07 <code>4bf13d8</code> Deleted unnecessary try and catch 2025-05-07 <code>25187d9</code> Refactor Delete Merged Branch Stage 2025-05-07 <code>5e6acfc</code> Moved logger inside script bracket 2025-05-07 <code>0857b38</code> Debugging fileExist function 2025-05-07 <code>201d711</code> Refactoring Cleanup PR Branch Artifacts 2025-05-07 <code>c8ce9b3</code> refactor again 2025-05-07 <code>a8d7bcd</code> Try to fix directory finding 2025-05-07 <code>3e038c8</code> Use different configuration property to find PR path 2025-05-07 <code>9b2f802</code> Try to use wildcard 2025-05-07 <code>e1e312b</code> Implement Cleanup PR Branch Artifacts 2025-05-07 <code>970293e</code> Fixed not use trim 2025-05-07 <code>3234206</code> Fixed incorrect return value for FindPRJobDirectory 2025-05-07 <code>18dbce2</code> Modulurized the stage 2025-05-07 <code>7e5773d</code> Refactor stageProjectPrepare groovy for unify PR and Deployment Pipeline together 2025-05-07 <code>c209fc0</code> Refactored Prepare Workspace into Project Preparation 2025-05-07 <code>790c946</code> Fixed the delete PR artifacts file logic for CD pipeline 2025-05-07 <code>9878a06</code> Refactor Linting Stage 2025-05-07 <code>c31dd95</code> Test Refactor Unity Execution in Deployment Phase 5: Full Jenkinsfile Cleanup and Integration (18 commits) Date Commit Message 2025-05-07 <code>eef487b</code> Temparory test 2025-05-07 <code>c432015</code> Modulurized ssh shell scripting for Deploying WebGL to dlx-web hosting server 2025-05-07 <code>68626bb</code> Initial Refactor completed 2025-05-07 <code>5aa21ce</code> Initial Refactored jenkinsflies for DLX-PR, Deployment, and Pipeline Code 2025-05-07 <code>c5f85e8</code> Improved Linting logic for Unity 2025-05-07 <code>ec9a895</code> Polish ShellLibrary.groovy to improve readability 2025-05-07 <code>7a7f017</code> Fixed incorrect python calling 2025-05-07 <code>00c271e</code> git add . 2025-05-07 <code>7ae76ab</code> Improved catchError function 2025-05-07 <code>f469267</code> Refactored sendTestReport function in UnityHelper into ShellLibrary 2025-05-07 <code>3154ca8</code> Added getting PR_COMMIT for pullrequest event webhook 2025-05-07 <code>92ee76a</code> Updated stageInitialization groovy more readable 2025-05-07 <code>5e743b4</code> Modified ShellScripting Logging Message 2025-05-07 <code>922b4b2</code> Add dir function to get full commit hash 2025-05-07 <code>ce227c9</code> Added one more logging for shellscript result 2025-05-07 <code>432064f</code> Updated logging in stageInitialization 2025-05-07 <code>818100a</code> Changed shellscript type for ssh 2025-05-07 <code>02311c4</code> Added Connection check ssh Phase 6: SSH Library and Deployment Feature Completion (12 commits) Date Commit Message 2025-05-08 <code>7deca3e</code> Try to fix ssh command 2025-05-08 <code>02f76b7</code> Check SSH Connectivity Modulurized 2025-05-08 <code>b42f4b8</code> Added Network Connection Check 2025-05-08 <code>8ff97bc</code> EconestogaDLX connection check 2025-05-08 <code>c4c8da5</code> Added ConnectionAttempts for CheckSSHConnectivity 2025-05-08 <code>31950bd</code> Added stripIndent for ssh 2025-05-08 <code>7ce9794</code> Added stripIndent for every ssh shellscript 2025-05-08 <code>1e8e9dc</code> Improved logging 2025-05-08 <code>1e94b39</code> logging improved 2025-05-08 <code>7de89c2</code> Added stripIdent() and trim() for every shellscript 2025-05-08 <code>a0e53db</code> Fixed one git library 2025-05-08 <code>a381824</code> Fixed typo Phase 7: Finalization and Bug Fixes (4 commits) Date Commit Message 2025-05-09 <code>4db95fe</code> Added missing package in Gladle test configuration 2025-05-09 <code>c54feff</code> Delete artifact(dump file) of running test locally 2025-05-09 <code>10bec90</code> Added Error handling for bitbucket api communication 2025-05-12 <code>ff74ac8</code> Revert \"Temparory test\""},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#3-phase-by-phase-detailed-analysis","title":"3. Phase-by-Phase Detailed Analysis","text":""},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#31-phase-1-pipelineforjenkins-stage-modularization","title":"3.1 Phase 1: PipelineForJenkins Stage Modularization","text":"View Details <p>Duration: 2025-05-05 ~ 2025-05-06 early (8 commits)</p> <p>Goal: Stage modularization of first pipeline (PipelineForJenkins)</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#work-by-commit","title":"Work by Commit","text":"Commit Work <code>8e96fb9</code> Improved shellScriptHelper logging <code>3ef978a</code> Refactored LintGroovyJenkinsfile Stage <code>9dcc23b</code> Added logging to stageLintGroovyJenkinsfile <code>6f4cf84</code> Modularized Static Analysis Stage <code>0e66b11</code> Tested Static Analysis Stage <code>87e8a89</code> Replaced with modularized bitbucket api function in post steps <code>2c2d821</code> SonarQube refactoring test <code>063955e</code> Added missing package import variable <p>Learning Points: - Start refactoring with the simplest pipeline - Separate each Stage into independent files in vars/ folder</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#32-phase-2-dlx-pipeline-webhook-trigger-configuration","title":"3.2 Phase 2: DLX Pipeline Webhook Trigger Configuration","text":"View Details <p>Duration: 2025-05-06 (40 commits)</p> <p>Goal: Implement GenericTrigger-based Webhook for DLX pipeline</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-1-webhook-trigger-initial-configuration-4c8509e-79f6155","title":"Step 1: Webhook Trigger Initial Configuration (<code>4c8509e</code> ~ <code>79f6155</code>)","text":"Commit Work <code>4c8509e</code> Started DLX Pipeline refactoring, refactored Prepare Workspace Stage <code>f25f136</code> Commented out DLX Pipeline regexpFilter <code>c26d434</code> ~ <code>163cff2</code> Attempted to get HTTP request body/header <code>e2fe075</code> ~ <code>1fff356</code> HTTP request header test and logging modification <code>d5eab38</code> ~ <code>79f6155</code> Added Request Body/Header trigger, GenericTrigger configuration"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-2-http-header-processing-issue-resolution-0c004ac-50ea98a","title":"Step 2: HTTP Header Processing Issue Resolution (<code>0c004ac</code> ~ <code>50ea98a</code>)","text":"Commit Attempt Problem Solution <code>0c004ac</code> ~ <code>cbb805f</code> Get x-event-key JsonPath expression issue Tried removing expression <code>b6f2c58</code> ~ <code>b558e24</code> Changed header access method Tried lowercase/underscore Tested various methods <code>58edeec</code> X-Event-Key - Used exact header name <code>1811e1c</code> ~ <code>50ea98a</code> Added regexpFilter Environment variable access Tried x_event_key"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-3-webhook-completion-and-environment-variable-setup-cb5a64a-27dcc7c","title":"Step 3: Webhook Completion and Environment Variable Setup (<code>cb5a64a</code> ~ <code>27dcc7c</code>)","text":"Commit Work <code>cb5a64a</code> ~ <code>b1456e6</code> Tested getting Branch name, HTTP body JSON <code>374e775</code> Completed Jenkins environment variable assignment for repo:push event <code>76296e7</code> ~ <code>ee741e8</code> Applied same implementation to DLX PR pipeline, fixed PR_BRANCH environment variable <code>c9220f4</code> ~ <code>d9ed92e</code> Fixed missing package import <code>fc77459</code> ~ <code>27dcc7c</code> Handled shellscript return value, separated DESTINATION_BRANCH assignment logic <p>Learning Points: - GenericTrigger plugin handles Bitbucket Webhook - Access HTTP header variables with lowercase+underscore (x_event_key) - Separate PR events and Push events with regexpFilter</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#33-phase-3-dlx-pr-pipeline-stage-modularization","title":"3.3 Phase 3: DLX-PR-Pipeline Stage Modularization","text":"View Details <p>Duration: 2025-05-07 first half (24 commits)</p> <p>Goal: Modularize Unity-related Stages for DLX PR pipeline</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-1-unity-linting-stage-d8aab9b-ce58b16","title":"Step 1: Unity Linting Stage (<code>d8aab9b</code> ~ <code>ce58b16</code>)","text":"Commit Attempt Problem Solution <code>d8aab9b</code> Refactored Unity Linting Stage - Started <code>27dd597</code> ~ <code>88f815b</code> Copy lint config file shellscript issue Attempted fix <code>ce58b16</code> Added sh - Added sh inside shellscript"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-2-unity-test-stage-ed7f993-319d413","title":"Step 2: Unity Test Stage (<code>ed7f993</code> ~ <code>319d413</code>)","text":"Commit Work <code>ed7f993</code> ~ <code>c01107f</code> Modularized EditMode Stage test <code>59009e0</code> Fixed how to use groovy file in vars <code>319d413</code> Refactored PlayMode, Coverage Stage"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-3-build-stage-and-finalization-5b43e05-69357f0","title":"Step 3: Build Stage and Finalization (<code>5b43e05</code> ~ <code>69357f0</code>)","text":"Commit Work <code>5b43e05</code> ~ <code>6bd044f</code> Refactored CopyWebGLBuilder, fixed package <code>e9b7c70</code> Changed Lighting/ReflectionProbe file check logic <code>07f2646</code> ~ <code>4e0b1ff</code> Improved logging style <code>e2f47d3</code> Refactored Build Project Stage <code>f2828b3</code> ~ <code>703d90f</code> Implemented stripIndent function (3 attempts) <code>bb271db</code> Fixed Unity headless mode argument <code>85fea53</code> Completed DLX-PR-Pipeline refactoring <code>69357f0</code> Pointed Library to Refactor-with-TDD branch <p>Learning Points: - Parameterize Unity-related Stages for reuse (testType: 'EditMode'/'PlayMode') - stripIndent() function improves multiline script readability</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#34-phase-4-dlx-deployment-pipeline-refactoring","title":"3.4 Phase 4: DLX-Deployment Pipeline Refactoring","text":"View Details <p>Duration: 2025-05-07 middle (22 commits)</p> <p>Goal: Refactor DLX Deployment(CD) pipeline</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-1-webhook-and-basic-stage-500ca0e-4bf13d8","title":"Step 1: Webhook and Basic Stage (<code>500ca0e</code> ~ <code>4bf13d8</code>)","text":"Commit Work <code>500ca0e</code> Deleted unnecessary function <code>d54d03e</code> ~ <code>83e8eaf</code> Tested filter for unmerged PR branch trigger <code>8d0608a</code> Added x-event-key header value for DLX-Deployment pipeline <code>4bf13d8</code> Deleted unnecessary try-catch"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-2-cleanup-pr-branch-artifacts-stage-25187d9-790c946","title":"Step 2: Cleanup PR Branch Artifacts Stage (<code>25187d9</code> ~ <code>790c946</code>)","text":"Commit Attempt Problem Solution <code>25187d9</code> Refactored Delete Merged Branch Stage - Started <code>5e6acfc</code> ~ <code>0857b38</code> Moved logger location, debugged fileExists - Test <code>201d711</code> ~ <code>a8d7bcd</code> Refactored Cleanup PR Branch Artifacts Directory finding issue Attempted <code>3e038c8</code> ~ <code>9b2f802</code> Used different config property, tried wildcard - Test <code>e1e312b</code> Implementation complete - Final <code>970293e</code> ~ <code>3234206</code> Fixed unused trim, fixed FindPRJobDirectory return value - Bug fix <code>18dbce2</code> Stage modularization complete - Final <code>7e5773d</code> ~ <code>c209fc0</code> Integrated stageProjectPrepare (PR + Deployment) - Integration <code>790c946</code> Fixed PR artifacts delete logic for CD pipeline - Fix"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-3-remaining-stage-refactoring-9878a06-c31dd95","title":"Step 3: Remaining Stage Refactoring (<code>9878a06</code> ~ <code>c31dd95</code>)","text":"Commit Work <code>9878a06</code> Refactored Linting Stage <code>c31dd95</code> Tested Deployment Unity Execution refactoring <p>Learning Points: - Share stageProjectPrepare between PR and Deployment pipelines - PR artifact cleanup logic needs Jenkins workspace path handling</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#35-phase-5-full-jenkinsfile-cleanup-and-integration","title":"3.5 Phase 5: Full Jenkinsfile Cleanup and Integration","text":"View Details <p>Duration: 2025-05-07 second half (18 commits)</p> <p>Goal: Clean up all Jenkinsfiles and implement SSH deployment</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-1-ssh-deployment-and-initial-cleanup-eef487b-5aa21ce","title":"Step 1: SSH Deployment and Initial Cleanup (<code>eef487b</code> ~ <code>5aa21ce</code>)","text":"Commit Work <code>eef487b</code> Temporary test <code>c432015</code> Modularized WebGL deployment SSH shell scripting <code>68626bb</code> Initial refactoring complete <code>5aa21ce</code> Initial refactored Jenkinsfiles for DLX-PR, Deployment, and Pipeline Code"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-2-detailed-improvements-c5f85e8-432064f","title":"Step 2: Detailed Improvements (<code>c5f85e8</code> ~ <code>432064f</code>)","text":"Commit Work <code>c5f85e8</code> Improved Unity Linting logic <code>ec9a895</code> Improved ShellLibrary.groovy readability <code>7a7f017</code> Fixed Python call <code>00c271e</code> git add <code>7ae76ab</code> Improved catchError function <code>f469267</code> Moved UnityHelper sendTestReport to ShellLibrary <code>3154ca8</code> Added PR_COMMIT for pullrequest event <code>92ee76a</code> Improved stageInitialization readability <code>5e743b4</code> ~ <code>ce227c9</code> Modified ShellScripting logging message <code>432064f</code> Updated stageInitialization logging"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#step-3-ssh-finalization-818100a-02311c4","title":"Step 3: SSH Finalization (<code>818100a</code> ~ <code>02311c4</code>)","text":"Commit Work <code>818100a</code> Changed SSH shellscript type <code>02311c4</code> Added SSH connection check <p>Learning Points: - All pipelines use same Stage modules - Abstract SSH commands into Library</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#36-phase-6-ssh-library-and-deployment-feature-completion","title":"3.6 Phase 6: SSH Library and Deployment Feature Completion","text":"View Details <p>Duration: 2025-05-08 (12 commits)</p> <p>Goal: Complete SSHShellLibrary and stabilize deployment feature</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#problem-solving-process","title":"Problem Solving Process","text":"Commit Attempt Problem Solution <code>7deca3e</code> Fixed SSH command Not working Attempted <code>02f76b7</code> Modularized SSH Connectivity check - Implemented <code>b42f4b8</code> ~ <code>8ff97bc</code> Network connection check, EconestogaDLX connection - Added <code>c4c8da5</code> Added ConnectionAttempts Connection failure Retry logic <code>31950bd</code> ~ <code>7ce9794</code> Added stripIndent for SSH Multiline issue Applied to all SSH scripts <code>1e8e9dc</code> ~ <code>1e94b39</code> Improved logging - Improvement <code>7de89c2</code> Added stripIndent()/trim() to all shellscripts Whitespace issue Batch applied <code>a0e53db</code> ~ <code>a381824</code> Fixed Git library, fixed typo Bug Fixed <p>Learning Points: - stripIndent()/trim() required for SSH commands - Handle retry with ConnectionAttempts for remote server connection</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#37-phase-7-finalization-and-bug-fixes","title":"3.7 Phase 7: Finalization and Bug Fixes","text":"View Details <p>Duration: 2025-05-09 ~ 2025-05-12 (4 commits)</p> <p>Goal: Final bug fixes and cleanup</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#work-by-commit_1","title":"Work by Commit","text":"Commit Work <code>4db95fe</code> Added missing package to Gradle test configuration <code>c54feff</code> Deleted local test run artifact (dump file) <code>10bec90</code> Added Bitbucket API communication error handling <code>ff74ac8</code> Reverted \"Temporary test\" <p>Learning Points: - Test artifacts need to be added to .gitignore - API communication should always include error handling</p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#4-new-stage-files-vars","title":"4. New Stage Files (vars/)","text":"File Lines Purpose stageInitialization.groovy 102 Jenkins environment initialization, environment variable setup stageProjectPrepare.groovy 115 Git clone/checkout, branch synchronization, LFS stageLintGroovyJenkinsfile.groovy 96 Groovy/Jenkinsfile static analysis (npm-groovy-lint) stageLintUnity.groovy 67 Unity C# linting (Rider batch mode) stageStaticAnalysis.groovy 44 SonarQube static code analysis stageUnityExecution.groovy 98 Unity EditMode/PlayMode/Coverage tests stageDeployBuild.groovy 72 WebGL build and deployment stageCleanupPRBranchArtifacts.groovy 55 PR artifact cleanup after merge stageSendBuildResults.groovy 31 Send Bitbucket build status"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#5-new-libraries","title":"5. New Libraries","text":""},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#51-sharedlibrariessrcutilssshshelllibrarygroovy-99-lines","title":"5.1 <code>sharedLibraries/src/utils/SSHShellLibrary.groovy</code> (99 lines)","text":"<p>SSH command library (for WebGL deployment) <pre><code>class SSHShellLibrary {\n    // SSH connection check\n    static Closure CHECK_SSH_CONNECTIVITY = { host, user, keyPath -&gt;\n        \"ssh -o BatchMode=yes -o ConnectTimeout=5 -i ${keyPath} ${user}@${host} 'echo ok'\"\n    }\n\n    // Create remote directory\n    static Closure SSH_CREATE_REMOTE_DIR = { host, user, keyPath, remotePath -&gt;\n        \"ssh -i ${keyPath} ${user}@${host} 'mkdir -p ${remotePath}'\"\n    }\n\n    // SCP file transfer\n    static Closure SCP_COPY_TO_REMOTE = { localPath, host, user, keyPath, remotePath -&gt;\n        \"scp -r -i ${keyPath} ${localPath} ${user}@${host}:${remotePath}\"\n    }\n\n    // Delete remote directory\n    static Closure SSH_REMOVE_REMOTE_DIR = { host, user, keyPath, remotePath -&gt;\n        \"ssh -i ${keyPath} ${user}@${host} 'rm -rf ${remotePath}'\"\n    }\n}\n</code></pre></p>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#6-jenkinsfile-transformation-example","title":"6. Jenkinsfile Transformation Example","text":""},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#61-before-dlxjenkinsjenkinsfile","title":"6.1 Before (DLXJenkins/Jenkinsfile)","text":"<pre><code>pipeline {\n    stages {\n        stage('Prepare WORKSPACE') {\n            steps {\n                script {\n                    // 50 lines of Git checkout logic\n                    // 20 lines of environment variable setup\n                    // 30 lines of error handling\n                }\n            }\n        }\n        stage('Linting') {\n            steps {\n                script {\n                    // 40 lines of linting logic\n                }\n            }\n        }\n        // ... more stages\n    }\n}\n</code></pre>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#62-after-dlxjenkinsjenkinsfile","title":"6.2 After (DLXJenkins/Jenkinsfile)","text":"<pre><code>@Library('global-trusted-shared-library@main') _\n\npipeline {\n    stages {\n        stage('Initialization') {\n            steps {\n                stageInitialization()\n            }\n        }\n        stage('Project Preparation') {\n            steps {\n                stageProjectPrepare()\n            }\n        }\n        stage('Linting') {\n            steps {\n                stageLintUnity()\n            }\n        }\n        stage('EditMode Tests') {\n            steps {\n                stageUnityExecution(testType: 'EditMode')\n            }\n        }\n        stage('PlayMode Tests') {\n            steps {\n                stageUnityExecution(testType: 'PlayMode')\n            }\n        }\n        stage('Build WebGL') {\n            steps {\n                stageDeployBuild(buildType: 'WebGL')\n            }\n        }\n    }\n    post {\n        always {\n            stageSendBuildResults()\n        }\n    }\n}\n</code></pre>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#7-webhook-configuration-improvements","title":"7. Webhook Configuration Improvements","text":""},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#71-pullrequest-vs-repopush-event-separation","title":"7.1 PullRequest vs Repo:Push Event Separation","text":"<pre><code>triggers {\n    GenericTrigger(\n        genericVariables: [\n            [key: 'BITBUCKET_EVENT_KEY', value: '$.headers.x-event-key']\n        ],\n        regexpFilterExpression: '^pullrequest:.*',\n        regexpFilterText: '$BITBUCKET_EVENT_KEY'\n    )\n}\n</code></pre>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#72-dynamic-environment-variable-assignment","title":"7.2 Dynamic Environment Variable Assignment","text":"<pre><code>// PR event\nif (env.BITBUCKET_EVENT_KEY.startsWith('pullrequest:')) {\n    env.PR_BRANCH = env.BITBUCKET_SOURCE_BRANCH\n    env.DESTINATION_BRANCH = env.BITBUCKET_DESTINATION_BRANCH\n}\n// Push event\nelse if (env.BITBUCKET_EVENT_KEY == 'repo:push') {\n    env.PR_BRANCH = env.GIT_BRANCH.replaceFirst('origin/', '')\n    env.DESTINATION_BRANCH = 'main'\n}\n</code></pre>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#8-final-architecture","title":"8. Final Architecture","text":"<pre><code>devops-jenkins-linux/\n\u251c\u2500\u2500 */Jenkinsfile                          # Layer 1: Entry Point\n\u2502   \u251c\u2500\u2500 DLXJenkins/Jenkinsfile\n\u2502   \u251c\u2500\u2500 DLXJenkins/JenkinsfileDeployment\n\u2502   \u251c\u2500\u2500 JsJenkins/Jenkinsfile\n\u2502   \u251c\u2500\u2500 JsJenkins/JenkinsfileDeployment\n\u2502   \u2514\u2500\u2500 PipelineForJenkins/Jenkinsfile\n\u2502\n\u2514\u2500\u2500 sharedLibraries/\n    \u251c\u2500\u2500 vars/                              # Layer 2: Orchestration\n    \u2502   \u251c\u2500\u2500 stageInitialization.groovy     # Stage Modules\n    \u2502   \u251c\u2500\u2500 stageProjectPrepare.groovy\n    \u2502   \u251c\u2500\u2500 stageLintGroovyJenkinsfile.groovy\n    \u2502   \u251c\u2500\u2500 stageLintUnity.groovy\n    \u2502   \u251c\u2500\u2500 stageStaticAnalysis.groovy\n    \u2502   \u251c\u2500\u2500 stageUnityExecution.groovy\n    \u2502   \u251c\u2500\u2500 stageDeployBuild.groovy\n    \u2502   \u251c\u2500\u2500 stageCleanupPRBranchArtifacts.groovy\n    \u2502   \u251c\u2500\u2500 stageSendBuildResults.groovy\n    \u2502   \u251c\u2500\u2500 shellScriptHelper.groovy       # Helpers\n    \u2502   \u251c\u2500\u2500 bitbucketApiHelper.groovy\n    \u2502   \u2514\u2500\u2500 logger.groovy                  # Cross-Cutting\n    \u2502\n    \u2514\u2500\u2500 src/\n        \u251c\u2500\u2500 service/                       # Layer 3: Services\n        \u2502   \u2514\u2500\u2500 general/\n        \u2502       \u2514\u2500\u2500 BitbucketApiService.groovy\n        \u2502\n        \u251c\u2500\u2500 utils/                         # Layer 4: Utilities\n        \u2502   \u251c\u2500\u2500 GitLibrary.groovy\n        \u2502   \u251c\u2500\u2500 ShellLibrary.groovy\n        \u2502   \u2514\u2500\u2500 SSHShellLibrary.groovy\n        \u2502\n        \u2514\u2500\u2500 resource/                      # Layer 4: Utilities (Constants)\n            \u2514\u2500\u2500 Status.groovy\n</code></pre>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#9-benefits","title":"9. Benefits","text":""},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#91-code-reuse","title":"9.1 Code Reuse","text":"<ul> <li>5 pipelines use same Stage files</li> <li>Duplicate code removed</li> </ul>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#92-easy-maintenance","title":"9.2 Easy Maintenance","text":"<ul> <li>Modify only one file when changing Stage logic</li> <li>Jenkinsfile only defines pipeline structure</li> </ul>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#93-improved-readability","title":"9.3 Improved Readability","text":"<ul> <li>Jenkinsfile reads like a table of contents</li> <li>Clear role for each Stage</li> </ul>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#94-testability","title":"9.4 Testability","text":"<ul> <li>Each Stage file can be tested independently</li> <li>Library functions can be unit tested</li> </ul>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#95-consistent-logging","title":"9.5 Consistent Logging","text":"<ul> <li>All Stages use logger</li> <li>Standardized output format</li> </ul>"},{"location":"legs/leg-4-full-pipeline-refactoring-and-stage-modularization/changelog/#10-conclusion","title":"10. Conclusion","text":"<p>5 monolithic pipelines \u2192 4-Layer Architecture + Centralized Library</p> <ul> <li>Jenkinsfile code volume reduced by approximately 70-78%</li> <li>12 reusable Stage modules created</li> <li>3 Shell libraries (Git, Shell, SSH)</li> <li>1 API service (Bitbucket)</li> <li>3-Level Logger standard interface</li> </ul>"},{"location":"problem-analysis/DRY-violation-analysis/","title":"DRY Violation Analysis","text":""},{"location":"problem-analysis/DRY-violation-analysis/#1-dry-principle-definition","title":"1. DRY Principle Definition","text":"<p>\"Every piece of knowledge must have a single, unambiguous, authoritative representation within a system.\" \u2014 Hunt &amp; Thomas, The Pragmatic Programmer (1999)</p>"},{"location":"problem-analysis/DRY-violation-analysis/#analysis-method","title":"Analysis Method","text":"<p>Duplication patterns are identified using a top-down comparison approach.</p> # Comparison Scope Analysis Purpose 1 All pipelines (5) Patterns commonly used across all pipelines 2 CI vs CD Distinguish CI-only / CD-only / common patterns 3 Between CI pipelines (DLX CI, JS CI, Jenkins CI) Duplication between CI pipelines 4 Between CD pipelines (DLX CD, JS CD) Duplication between CD pipelines 5 Within CD (JS CD) Internal duplication within single pipeline 6 Between Helper files Function/logic duplication between Helper files"},{"location":"problem-analysis/DRY-violation-analysis/#dry-violation-summary","title":"DRY Violation Summary","text":"Type Violation Severity Impact Inter-Helper duplication <code>logMessage()</code> identical function copy Medium Logging changes require 2 modifications Jenkinsfile duplication <code>parameters</code> block 7 identical parameters High Parameter addition/changes require 5 modifications Jenkinsfile duplication <code>triggers.GenericTrigger</code> block High Trigger changes require 5 modifications Jenkinsfile duplication <code>environment</code> block structure Medium Environment variable pattern changes require 5 modifications Jenkinsfile duplication <code>post</code> block structure High Build status handling changes require 5 modifications Jenkinsfile duplication <code>buildResults</code>/<code>stageResults</code> extraction Medium Status value changes require 5 modifications Inter-CI duplication <code>Prepare WORKSPACE</code> stage logic High Initialization logic changes require 3 modifications CI + CD duplication Static Analysis (SonarQube) pattern Medium SonarQube setting changes require 3 modifications Inter-CD duplication <code>mainBranches</code> constant Low Branch policy changes require 2 modifications JS CD internal duplication Server/Client deployment logic High Deployment method changes require 2 modifications"},{"location":"problem-analysis/DRY-violation-analysis/#2-analysis-results","title":"2. Analysis Results","text":""},{"location":"problem-analysis/DRY-violation-analysis/#21-all-pipeline-common-5","title":"2.1. All Pipeline Common (5)","text":"Duplication Pattern Location Separated <code>parameters</code> block (7 identical parameters) 5 Jenkinsfiles \u274c <code>triggers.GenericTrigger</code> block 5 Jenkinsfiles \u274c <code>environment</code> block structure (<code>CI_PIPELINE</code>, <code>PROJECT_TYPE</code>, <code>PROJECT_DIR</code>, <code>REPORT_DIR</code>, etc.) 5 Jenkinsfiles \u274c <code>post</code> block (always/success/failure/aborted) 5 Jenkinsfiles \u274c <code>buildResults</code>/<code>stageResults</code> extraction pattern 5 Jenkinsfiles \u274c <code>generalUtil</code> load pattern 5 Jenkinsfiles \u274c <code>COMMIT_HASH</code> extraction logic 5 Jenkinsfiles \u274c <code>currentBuild.description</code> setting 5 Jenkinsfiles \u274c"},{"location":"problem-analysis/DRY-violation-analysis/#22-ci-vs-cd-comparison","title":"2.2. CI vs CD Comparison","text":"Type CI-only CD-only Common (Not Separated) Trigger <code>regexpFilterExpression: 'OPEN'</code> <code>regexpFilterExpression: 'MERGED'</code> Rest of trigger structure identical Environment Variables <code>CI_PIPELINE = true</code> <code>CI_PIPELINE = false</code> Rest of environment variable pattern identical Stage Linting, Tests, Coverage, Static Analysis Delete Branch, Deploy Build Prepare Workspace, Build Post <code>sendBuildStatus(false)</code> pattern <code>sendBuildStatus(true)</code> pattern Overall structure identical"},{"location":"problem-analysis/DRY-violation-analysis/#23-ci-pipeline-comparison-dlx-ci-vs-js-ci-vs-jenkins-ci","title":"2.3. CI Pipeline Comparison (DLX CI vs JS CI vs Jenkins CI)","text":"Duplication Pattern DLX CI JS CI Jenkins CI Separated <code>Prepare WORKSPACE</code> stage structure \u2713 \u2713 \u2713 \u274c <code>isBranchUpToDateWithRemote</code> check \u2713 \u2713 \u2713 \u274c <code>initializeEnvironment</code> call \u2713 \u2713 \u2713 \u274c <code>cloneOrUpdateRepo</code> call \u2713 \u2713 \u2713 \u274c <code>mergeBranchIfNeeded</code> call \u2713 \u2713 - \u274c Linting stage \u2713 \u2713 \u2713 (Groovy) \u274c Static Analysis (SonarQube) - \u2713 \u2713 \u274c <p>Differences: - DLX CI: Unity-specific (<code>unityUtil</code>), EditMode/PlayMode tests - JS CI: Node.js-specific (<code>jsUtil</code>), npm dependency installation - Jenkins CI: Groovy-specific, Groovydoc generation, Gradle tests</p>"},{"location":"problem-analysis/DRY-violation-analysis/#24-cd-pipeline-comparison-dlx-cd-vs-js-cd","title":"2.4. CD Pipeline Comparison (DLX CD vs JS CD)","text":"Duplication Pattern DLX CD JS CD Separated <code>mainBranches = ['main', 'master']</code> \u2713 \u2713 \u274c <code>Delete Merged Branch</code> stage \u2713 \u2713 \u274c <code>cleanUpPRBranch</code> call \u2713 \u2713 \u2713 (Helper) Static Analysis (SonarQube) pattern - \u2713 \u274c <p>Deployment Method Differences: - DLX CD: SSH/SCP-based WebDAV server deployment - JS CD: Docker \u2192 Azure Container Registry \u2192 Container Apps deployment</p>"},{"location":"problem-analysis/DRY-violation-analysis/#25-js-cd-internal-duplication-serverclient-deployment","title":"2.5. JS CD Internal Duplication (Server/Client Deployment)","text":"<p>Server and Client deployment logic is repeated with almost identical patterns within the JS CD pipeline.</p> Duplication Pattern Server Build (line 242-317) Client Build (line 319-392) Separated <code>az acr repository show-tags</code> call \u2713 \u2713 \u274c <code>jsUtil.getPackageJsonVersion()</code> call line 268 line 343 \u274c <code>jsUtil.versionCompare()</code> check line 277 line 352 \u274c <code>docker build</code> command line 287-291 line 362-366 \u274c <code>docker push</code> command line 295-298 line 370-373 \u274c <code>az containerapp update</code> command line 302-307 line 377-382 \u274c <code>docker rmi</code> cleanup line 311 line 386 \u274c <p>Impact: Deployment logic changes require modifications in both Server/Client locations</p>"},{"location":"problem-analysis/DRY-violation-analysis/#26-helper-file-comparison","title":"2.6. Helper File Comparison","text":"<p>GeneralHelper vs JsHelper</p> Duplicated Function GeneralHelper JsHelper Note <code>logMessage()</code> line 35-44 line 7-16 Identical copy <p>GeneralHelper vs UnityHelper</p> Duplication Pattern GeneralHelper UnityHelper Note Direct duplication - - No function duplication Dependency - <code>generalUtil</code> load UnityHelper depends on GeneralHelper"},{"location":"problem-analysis/DRY-violation-analysis/#related-concepts","title":"Related Concepts","text":"Concept Source Relationship Duplicated Code Fowler (1999) Code Smells Code Smell expression of DRY violation Shotgun Surgery Fowler (1999) Code Smells Result of DRY violation (1 change \u2192 N modifications) Needless Repetition Martin (2000) Design Symptoms Design Symptom expression of DRY violation"},{"location":"problem-analysis/baseline-technical-snapshot/","title":"Baseline Technical Snapshot","text":"<p>Note: This document was analyzed based on commit <code>54479b2</code>.</p> <p>Other documents in <code>problem-analysis/</code> use commit <code>74fc356</code> as the baseline.</p> <p>Difference in analysis direction: - This document: Focused on code statistics, file structure, technical state - problem-analysis/: Problem analysis based on Software Smells classification system</p> <p>Commit: <code>54479b2</code> (2025-02-21) - \"emergency fixed\"</p> <p>This document provides a comprehensive analysis of the codebase state before the architectural refactoring.</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Code Statistics</li> <li>File Structure</li> <li>Domain Analysis</li> <li>Architecture Analysis</li> <li>Folder-by-Folder Analysis</li> <li>Critical Problems</li> <li>Code Duplication Analysis (Detailed)</li> <li>Dependency Graph</li> <li>Technical Debt Summary</li> <li>Summary Table</li> <li>Key Issues for Refactoring</li> </ol>"},{"location":"problem-analysis/baseline-technical-snapshot/#1-code-statistics","title":"1. Code Statistics","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#11-total-lines-by-category","title":"1.1 Total Lines by Category","text":"Category Files Lines Percentage Jenkinsfiles 5 1,239 33.1% Groovy Helpers 3 1,148 30.6% Python Scripts 9 749 20.0% Bash Scripts 2 330 8.8% Tests 2 84 2.2% Config/Other 6 195 5.2% TOTAL 27 3,745 100%"},{"location":"problem-analysis/baseline-technical-snapshot/#12-detailed-line-counts","title":"1.2 Detailed Line Counts","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#jenkinsfiles-1239-lines","title":"Jenkinsfiles (1,239 lines)","text":"File Lines DLXJenkins/Jenkinsfile 249 DLXJenkins/JenkinsfileDeployment 242 JsJenkins/Jenkinsfile 198 JsJenkins/JenkinsfileDeployment 372 PipelineForJenkins/Jenkinsfile 178"},{"location":"problem-analysis/baseline-technical-snapshot/#groovy-helpers-1148-lines","title":"Groovy Helpers (1,148 lines)","text":"File Lines groovy/generalHelper.groovy 403 groovy/jsHelper.groovy 408 groovy/unityHelper.groovy 337"},{"location":"problem-analysis/baseline-technical-snapshot/#python-scripts-749-lines","title":"Python Scripts (749 lines)","text":"File Lines python/linting_error_report.py 203 python/create_bitbucket_test_report.py 152 python/npm_audit.py 137 python/send_bitbucket_build_status.py 64 python/create_log_report.py 56 python/get_bitbucket_commit_hash.py 38 python/get_unity_version.py 34 python/get_unity_failure.py 26 python/log-template/logs.html 39"},{"location":"problem-analysis/baseline-technical-snapshot/#tests-84-lines","title":"Tests (84 lines)","text":"File Lines tests/JsHelperSpec.groovy 66 tests/GeneralHelperSpec.groovy 18"},{"location":"problem-analysis/baseline-technical-snapshot/#other-files-525-lines","title":"Other Files (525 lines)","text":"File Lines Bash/.editorconfig 264 Bash/Linting.bash 66 PipelineForJenkins/.groovylintrc.groovy.json 43 PipelineForJenkins/.groovylintrc.jenkins.json 19 .gitignore 51 build.gradle 42 Builder.cs 36 logErrors.txt 4"},{"location":"problem-analysis/baseline-technical-snapshot/#2-file-structure-27-files","title":"2. File Structure (27 files)","text":"<pre><code>54479b2/\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 build.gradle                          # Gradle build configuration\n\u251c\u2500\u2500 Builder.cs                            # Unity WebGL build script\n\u251c\u2500\u2500 logErrors.txt                         # Error log file\n\u2502\n\u251c\u2500\u2500 DLXJenkins/                           # Unity Project Pipeline\n\u2502   \u251c\u2500\u2500 Jenkinsfile                       # PR Pipeline (249 lines)\n\u2502   \u2514\u2500\u2500 JenkinsfileDeployment             # Deployment Pipeline (242 lines)\n\u2502\n\u251c\u2500\u2500 JsJenkins/                            # JavaScript Project Pipeline\n\u2502   \u251c\u2500\u2500 Jenkinsfile                       # PR Pipeline (198 lines)\n\u2502   \u2514\u2500\u2500 JenkinsfileDeployment             # Deployment Pipeline (372 lines)\n\u2502\n\u251c\u2500\u2500 PipelineForJenkins/                   # Jenkins Self Pipeline\n\u2502   \u251c\u2500\u2500 Jenkinsfile                       # (178 lines)\n\u2502   \u251c\u2500\u2500 .groovylintrc.groovy.json         # Groovy lint config\n\u2502   \u2514\u2500\u2500 .groovylintrc.jenkins.json        # Jenkins lint config\n\u2502\n\u251c\u2500\u2500 groovy/                               # Helper Scripts\n\u2502   \u251c\u2500\u2500 generalHelper.groovy              # Common utilities (403 lines)\n\u2502   \u251c\u2500\u2500 unityHelper.groovy                # Unity-specific (337 lines)\n\u2502   \u2514\u2500\u2500 jsHelper.groovy                   # JavaScript-specific (408 lines)\n\u2502\n\u251c\u2500\u2500 Bash/\n\u2502   \u251c\u2500\u2500 .editorconfig                     # Editor configuration\n\u2502   \u2514\u2500\u2500 Linting.bash                      # dotnet format linting script\n\u2502\n\u251c\u2500\u2500 python/                               # Python Scripts\n\u2502   \u251c\u2500\u2500 send_bitbucket_build_status.py    # Send build status\n\u2502   \u251c\u2500\u2500 create_bitbucket_test_report.py   # Send test report\n\u2502   \u251c\u2500\u2500 create_log_report.py              # Generate log report\n\u2502   \u251c\u2500\u2500 get_bitbucket_commit_hash.py      # Get commit hash\n\u2502   \u251c\u2500\u2500 get_unity_failure.py              # Analyze Unity failures\n\u2502   \u251c\u2500\u2500 get_unity_version.py              # Get Unity version\n\u2502   \u251c\u2500\u2500 linting_error_report.py           # Linting error report\n\u2502   \u251c\u2500\u2500 npm_audit.py                      # npm security audit\n\u2502   \u2514\u2500\u2500 log-template/logs.html            # Log HTML template\n\u2502\n\u2514\u2500\u2500 tests/                                # Tests\n    \u251c\u2500\u2500 GeneralHelperSpec.groovy          # generalHelper tests\n    \u2514\u2500\u2500 JsHelperSpec.groovy               # jsHelper tests\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#3-domain-analysis","title":"3. Domain Analysis","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#31-project-types","title":"3.1 Project Types","text":"Domain Pipeline Files Helper Unity Project DLXJenkins/Jenkinsfile, JenkinsfileDeployment unityHelper.groovy JavaScript Project JsJenkins/Jenkinsfile, JenkinsfileDeployment jsHelper.groovy Jenkins Pipeline Project PipelineForJenkins/Jenkinsfile generalHelper.groovy"},{"location":"problem-analysis/baseline-technical-snapshot/#32-pipeline-types","title":"3.2 Pipeline Types","text":"Type Trigger Purpose PR Pipeline <code>PR_STATE = 'OPEN'</code> Pull Request validation (tests, linting, static analysis) Deployment Pipeline <code>PR_STATE = 'MERGED'</code> Deployment (branch cleanup, build, server deployment)"},{"location":"problem-analysis/baseline-technical-snapshot/#4-architecture-analysis","title":"4. Architecture Analysis","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#41-current-architecture-flatmonolithic","title":"4.1 Current Architecture: Flat/Monolithic","text":"<pre><code>flowchart TB\n    subgraph Jenkinsfile[\"Jenkinsfile Layer\"]\n        direction TB\n        J1[\"Pipeline declaration\"]\n        J2[\"Stage definitions\"]\n        J3[\"Business logic (inline)\"]\n        J4[\"Error handling (inline)\"]\n        J5[\"Logging (inline echo)\"]\n    end\n\n    subgraph Helper[\"groovy/*Helper.groovy Layer\"]\n        direction TB\n        H1[\"Git operations (functions)\"]\n        H2[\"API calls (Python wrapper)\"]\n        H3[\"Utility functions\"]\n        H4[\"Each file 400+ lines (everything mixed)\"]\n    end\n\n    subgraph Python[\"python/*.py Layer\"]\n        direction TB\n        P1[\"Bitbucket API calls\"]\n        P2[\"XML parsing\"]\n        P3[\"Report generation\"]\n    end\n\n    Jenkinsfile --&gt;|\"load()\"| Helper\n    Helper --&gt;|\"sh(python...)\"| Python</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#42-layer-analysis","title":"4.2 Layer Analysis","text":"<p>Only 2 effective layers exist:</p> <ol> <li>Jenkinsfile Layer: Pipeline definition + business logic mixed</li> <li>Helper Layer: groovy/.groovy + python/.py (Flat structure)</li> </ol> <p>Inter-layer dependencies:</p> <pre><code>flowchart LR\n    A[Jenkinsfile] --&gt;|\"load()\"| B[groovy/*Helper.groovy]\n    B --&gt;|\"sh(python)\"| C[python/*.py]</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#5-folder-by-folder-analysis","title":"5. Folder-by-Folder Analysis","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#51-dlxjenkins-unity-pipeline","title":"5.1 DLXJenkins/ (Unity Pipeline)","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#jenkinsfile-249-lines","title":"Jenkinsfile (249 lines)","text":"<pre><code>// Problem 1: All logic inline\nstage('Prepare WORKSPACE') {\n    steps {\n        dir (\"${PROJECT_DIR}\") {\n            script {\n                sh 'env'\n                try {\n                    generalUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")\n                    unityUtil = load(\"${env.WORKSPACE}/groovy/unityHelper.groovy\")\n                } catch (Exception e) {\n                    error \"Failed to load Groovy scripts: ${e.message}\"\n                }\n                // ... 30+ lines of logic\n            }\n        }\n    }\n}\n\n// Problem 2: Duplicated patterns repeated in every stage\nstage('Linting') {\n    steps {\n        dir(\"${REPORT_DIR}\") {\n            sh 'mkdir -p linting_results'\n        }\n        script {\n            sh \"cp -f '${env.WORKSPACE}/Bash/.editorconfig' '${PROJECT_DIR}'\"\n            def exitCode = sh script: \"sh '${env.WORKSPACE}/Bash/Linting.bash'...\", returnStatus: true\n            // ... 20+ lines of error handling\n        }\n    }\n}\n</code></pre> <p>Problems: - Stage logic written inline in Jenkinsfile - Same patterns duplicated in JenkinsfileDeployment - Structure not amenable to testing</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#jenkinsfiledeployment-242-lines","title":"JenkinsfileDeployment (242 lines)","text":"<ul> <li>70%+ code duplication with Jenkinsfile</li> <li>Only deployment-specific logic added</li> </ul>"},{"location":"problem-analysis/baseline-technical-snapshot/#52-jsjenkins-javascript-pipeline","title":"5.2 JsJenkins/ (JavaScript Pipeline)","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#characteristics","title":"Characteristics","text":"<ul> <li>Same structure as DLXJenkins but uses jsHelper</li> <li>Includes Azure Container Registry deployment logic</li> <li>Includes SonarQube static analysis</li> </ul>"},{"location":"problem-analysis/baseline-technical-snapshot/#problems","title":"Problems","text":"<pre><code>// Almost identical code repeated from DLXJenkins\nstage('Prepare WORKSPACE') {\n    steps {\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                sh 'env'\n                generalUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")\n                jsUtil = load(\"${env.WORKSPACE}/groovy/jsHelper.groovy\")\n                // ... same pattern\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#53-groovy-helper-scripts","title":"5.3 groovy/ (Helper Scripts)","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#generalhelpergroovy-403-lines","title":"generalHelper.groovy (403 lines)","text":"<p>Functions included (mixed): 1. Git operations: cloneOrUpdateRepo, checkoutBranch, mergeBranchIfNeeded, isBranchUpToDateWithRemote 2. Environment setup: initializeEnvironment, parseTicketNumber 3. API calls: sendBuildStatus (Python wrapper) 4. Server deployment: publishTestResultsHtmlToWebServer, cleanMergedBranchReportsFromWebServer 5. File cleanup: cleanUpPRBranch, closeLogfiles</p> <p>Problems:</p> <pre><code>// Problem 1: All functionality mixed in one file\ndef cloneOrUpdateRepo(...) {\n    // Git logic\n}\ndef sendBuildStatus(...) {\n    // Python script call\n    sh \"python '${workspace}/python/send_bitbucket_build_status.py'...\"\n}\ndef publishTestResultsHtmlToWebServer(...) {\n    // SSH/SCP commands\n}\n\n// Problem 2: Duplicated shell commands\nsh 'git reset --hard'\nsh 'git clean -fd'\nsh \"git checkout ${targetBranch}\"\n// Repeated in multiple functions\n\n// Problem 3: Inconsistent error handling\ncatch (Exception e) {\n    echo \"An error occurred: ${e.getMessage()}\"\n    error('Merge process failed.')\n}\n// vs\ncatch (Exception e) {\n    error(\"Failed to execute: ${e.message}\")\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#unityhelpergroovy-337-lines","title":"unityHelper.groovy (337 lines)","text":"<p>Functions included: - Unity Batch Mode execution - Test report generation - Code Coverage configuration</p> <p>Problems: <pre><code>// Problem: Giant functions (100+ lines)\nint runUnityBatchMode(String unityExecutable, String projectDirectory, String reportDirectory, String stageName) {\n    // Closure definitions\n    Closure setLogFilePathAndUrl = { ... }\n    Closure&lt;String&gt; getTestRunArgs = { ... }\n    Closure&lt;String&gt; getAdditionalArgs = { ... }\n\n    // All stages handled in one function\n    if (['EditMode', 'PlayMode'].contains(stageName)) { ... }\n    else if (stageName == 'Coverage') { ... }\n    else if (['Webgl', 'Rider'].contains(stageName)) { ... }\n    // ... 100+ lines\n}\n</code></pre></p>"},{"location":"problem-analysis/baseline-technical-snapshot/#jshelpergroovy-408-lines","title":"jsHelper.groovy (408 lines)","text":"<p>Functions included: - npm command execution - SonarQube integration - Azure Container deployment</p> <p>Problems: - Same issues as generalHelper.groovy - Duplicated OS branching logic (isUnix() checks)</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#54-python-api-scripts","title":"5.4 python/ (API Scripts)","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#role","title":"Role","text":"<p>Handles HTTP API calls that are difficult to do directly in Groovy</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#file-list","title":"File List","text":"File Purpose send_bitbucket_build_status.py Send build status to Bitbucket create_bitbucket_test_report.py Send test report get_bitbucket_commit_hash.py Get commit hash linting_error_report.py Linting error report npm_audit.py npm security audit get_unity_failure.py Analyze Unity failures get_unity_version.py Get Unity version <p>Problems: <pre><code># Problem 1: Groovy calling Python \u2192 complex dependency\ndef sendBuildStatus(workspace, state, commitHash, deployment = false, javascript = false) {\n    def pythonCommand = \"python '${workspace}/python/send_bitbucket_build_status.py' '${commitHash}' '${state}'\"\n    sh(script: pythonCommand, returnStatus: true)\n}\n\n# Problem 2: Debugging difficult on errors\n# - Only exit code returned\n# - Detailed error messages lost\n</code></pre></p>"},{"location":"problem-analysis/baseline-technical-snapshot/#55-bash-shell-scripts","title":"5.5 Bash/ (Shell Scripts)","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#lintingbash","title":"Linting.bash","text":"<pre><code># Script for C# project linting\ndotnet format \"$SOLUTION_FILE\" --verify-no-changes\n</code></pre> <p>Problems: - Called directly from Jenkinsfile \u2192 difficult to test - Error code interpretation done in Jenkinsfile</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#56-tests-test-files","title":"5.6 tests/ (Test Files)","text":"<pre><code>// GeneralHelperSpec.groovy\nclass GeneralHelperSpec extends Specification {\n    def \"parseTicketNumber should extract ticket numbers\"() {\n        // Only one function tested\n    }\n}\n</code></pre> <p>Problems: - Extremely low test coverage (only parseTicketNumber function) - Most functions depend on Jenkins environment, cannot be tested</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#6-critical-problems","title":"6. Critical Problems","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#61-impact-of-file-changes","title":"6.1 Impact of File Changes","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#when-generalhelpergroovy-is-modified","title":"When generalHelper.groovy is modified:","text":"<pre><code>flowchart TB\n    GH[generalHelper.groovy]\n    GH --&gt; D1[DLXJenkins/Jenkinsfile]\n    GH --&gt; D2[DLXJenkins/JenkinsfileDeployment]\n    GH --&gt; J1[JsJenkins/Jenkinsfile]\n    GH --&gt; J2[JsJenkins/JenkinsfileDeployment]\n    GH --&gt; P1[PipelineForJenkins/Jenkinsfile]</code></pre> <p>\u2192 All 5 pipelines affected! \u2192 Risk of system-wide failure when deployed without testing</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#when-pythonsend_bitbucket_build_statuspy-is-modified","title":"When python/send_bitbucket_build_status.py is modified:","text":"<pre><code>flowchart TB\n    PY[send_bitbucket_build_status.py]\n    PY --&gt; GH[generalHelper.sendBuildStatus]\n    GH --&gt; D1[DLXJenkins/Jenkinsfile&lt;br/&gt;post success/failure]\n    GH --&gt; D2[DLXJenkins/JenkinsfileDeployment&lt;br/&gt;post success/failure]\n    GH --&gt; J1[JsJenkins/Jenkinsfile&lt;br/&gt;post success/failure]\n    GH --&gt; J2[JsJenkins/JenkinsfileDeployment&lt;br/&gt;post success/failure]\n    GH --&gt; P1[PipelineForJenkins/Jenkinsfile&lt;br/&gt;post success/failure]</code></pre> <p>\u2192 Affects Bitbucket status updates for all pipelines!</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#62-code-duplication-overview","title":"6.2 Code Duplication Overview","text":"<pre><code>// Patterns repeated across 5 Jenkinsfiles\n\n// Pattern 1: Helper loading (~10 lines \u00d7 5)\ngeneralUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")\n\n// Pattern 2: Branch check (~15 lines \u00d7 5)\nif (generalUtil.isBranchUpToDateWithRemote(PR_BRANCH)...) {\n    currentBuild.result = 'ABORTED'\n    error('Branch is up to date...')\n}\n\n// Pattern 3: Post actions (~20 lines \u00d7 5)\npost {\n    success { generalUtil.sendBuildStatus(..., 'SUCCESSFUL'...) }\n    failure { generalUtil.sendBuildStatus(..., 'FAILED'...) }\n    aborted { generalUtil.sendBuildStatus(..., 'STOPPED'...) }\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#63-testability-issues","title":"6.3 Testability Issues","text":"Component Testable? Reason Jenkinsfile No Requires Jenkins environment generalHelper.groovy Partial (1 function only) Depends on Jenkins APIs (sh, withCredentials, etc.) unityHelper.groovy No Requires Jenkins + Unity environment jsHelper.groovy No Requires Jenkins + Node.js environment python/*.py Partial Requires environment variables + API tokens"},{"location":"problem-analysis/baseline-technical-snapshot/#64-logging-problems","title":"6.4 Logging Problems","text":"<pre><code>// Inconsistent echo usage\necho 'Identifying Unity version...'\necho \"Parameters for bash: ${env.WORKSPACE}/Linting.bash...\"\necho \"After bash call, exit code: ${exitCode}\"\necho 'Error linting calling report'\n\n// Problems:\n// 1. No Stage/Step distinction\n// 2. Inconsistent format\n// 3. Difficult to identify error location\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#65-inconsistent-error-handling","title":"6.5 Inconsistent Error Handling","text":"<pre><code>// Method 1: catch + echo + error\ncatch (Exception e) {\n    echo \"An error occurred: ${e.getMessage()}\"\n    error('Process failed.')\n}\n\n// Method 2: catch + error directly\ncatch (Exception e) {\n    error \"Failed: ${e.message}\"\n}\n\n// Method 3: catchError\ncatchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {\n    error(\"Failed with exit code: ${exitCode}\")\n}\n\n// Problems:\n// - Stack trace lost\n// - Difficult to trace where error occurred\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#7-code-duplication-analysis-detailed","title":"7. Code Duplication Analysis (Detailed)","text":"<p>This section provides a comprehensive analysis of duplicated code patterns found across the codebase in commit 54479b2.</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#duplication-definition","title":"Duplication Definition","text":"<p>What IS counted as duplication: - Structural patterns appearing in multiple files with similar/identical code - Boilerplate code that could be extracted to shared modules - Copy-paste patterns where same logic exists in different locations</p> <p>What is NOT counted: - Project-specific configuration values (different env vars per project) - Intentional variations (OPEN vs MERGED triggers) - Single occurrences of any pattern</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#71-duplication-summary","title":"7.1 Duplication Summary","text":"Category Duplicated Lines Base Lines Percentage Jenkinsfile Patterns 463 1,239 37.4% Groovy Helper Patterns 106 1,148 9.2% Total 569 3,136* 18.1% <p>*Base = Jenkinsfiles (1,239) + Groovy Helpers (1,148) + Python (749), excluding Tests (84) and Config (525)</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#72-jenkinsfile-duplication-patterns","title":"7.2 Jenkinsfile Duplication Patterns","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-1-parameters-block-47-lines-total","title":"Pattern 1: Parameters Block (47 lines total)","text":"File Lines DLXJenkins/Jenkinsfile 10 DLXJenkins/JenkinsfileDeployment 9 JsJenkins/Jenkinsfile 10 JsJenkins/JenkinsfileDeployment 8 PipelineForJenkins/Jenkinsfile 10 <pre><code>parameters {\n    string(name: 'PR_BRANCH', defaultValue: '', description: '')\n    string(name: 'PR_DESTINATION_BRANCH', defaultValue: '', description: '')\n    string(name: 'PR_REPO_HTML', defaultValue: '', description: '')\n    string(name: 'PR_REPO_NAME', defaultValue: '', description: '')\n    string(name: 'PR_COMMIT', defaultValue: '', description: '')\n    string(name: 'PR_PROJECT', defaultValue: '', description: '')\n    string(name: 'PR_STATE', defaultValue: '', description: '')\n    string(name: 'TEST_RUN', defaultValue: '', description: '...')\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-2-triggers-block-83-lines-total","title":"Pattern 2: Triggers Block (83 lines total)","text":"File Lines DLXJenkins/Jenkinsfile 17 DLXJenkins/JenkinsfileDeployment 17 JsJenkins/Jenkinsfile 17 JsJenkins/JenkinsfileDeployment 16 PipelineForJenkins/Jenkinsfile 16 <pre><code>triggers {\n    GenericTrigger(\n        genericVariables: [\n            [key: 'PR_BRANCH', value: '$.pullrequest.source.branch.name'],\n            [key: 'PR_DESTINATION_BRANCH', value: '$.pullrequest.destination.branch.name'],\n            [key: 'PR_REPO_HTML', value: '$.repository.links.self.href'],\n            [key: 'PR_REPO_NAME', value: '$.repository.name'],\n            [key: 'PR_COMMIT', value: '$.pullrequest.source.commit.hash'],\n            [key: 'PR_PROJECT', value: '$.repository.full_name'],\n            [key: 'PR_STATE', value: '$.pullrequest.state']\n        ],\n        tokenCredentialId: 'trigger-token',\n        regexpFilterText: '$PR_STATE',\n        regexpFilterExpression: 'OPEN'  // or 'MERGED' for deployment\n    )\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-3-environment-block-63-lines-total","title":"Pattern 3: Environment Block (63 lines total)","text":"File Lines DLXJenkins/Jenkinsfile 11 DLXJenkins/JenkinsfileDeployment 10 JsJenkins/Jenkinsfile 16 JsJenkins/JenkinsfileDeployment 14 PipelineForJenkins/Jenkinsfile 12 <pre><code>environment {\n    CI_PIPELINE = 'true'\n    PROJECT_TYPE = 'Unity_Project'\n    PROJECT_DIR = \"${env.WORKSPACE}/${PROJECT_TYPE}\"\n    REPORT_DIR = \"${env.WORKSPACE}/PRJob/${PR_BRANCH}\"\n    JOB_REPO = \"${PR_REPO_HTML}\"\n    BITBUCKET_ACCESS_TOKEN = credentials('bitbucket-access-token')\n    REPO_SSH = \"git@bitbucket.org:${PR_PROJECT}.git\"\n    DESTINATION_BRANCH = \"${PR_DESTINATION_BRANCH}\"\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-4-post-actions-block-119-lines-total","title":"Pattern 4: Post Actions Block (119 lines total)","text":"File Lines DLXJenkins/Jenkinsfile 24 DLXJenkins/JenkinsfileDeployment 24 JsJenkins/Jenkinsfile 23 JsJenkins/JenkinsfileDeployment 23 PipelineForJenkins/Jenkinsfile 25 <pre><code>post {\n    always {\n        script {\n            echo 'Returning to the main branch...'\n            generalUtil.checkoutBranch(PROJECT_DIR, DESTINATION_BRANCH)\n        }\n    }\n    success {\n        script {\n            generalUtil.sendBuildStatus(env.WORKSPACE, 'SUCCESSFUL', env.COMMIT_HASH)\n        }\n    }\n    failure {\n        script {\n            generalUtil.sendBuildStatus(env.WORKSPACE, 'FAILED', env.COMMIT_HASH)\n        }\n    }\n    aborted {\n        script {\n            generalUtil.sendBuildStatus(env.WORKSPACE, 'STOPPED', env.COMMIT_HASH)\n        }\n    }\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-5-prepare-workspace-stage-151-lines-total","title":"Pattern 5: Prepare WORKSPACE Stage (151 lines total)","text":"<p>Each Jenkinsfile has a similar 'Prepare WORKSPACE' stage that includes helper loading, branch checks, environment initialization, and repository setup:</p> File Lines DLXJenkins/Jenkinsfile 35 DLXJenkins/JenkinsfileDeployment 28 JsJenkins/Jenkinsfile 33 JsJenkins/JenkinsfileDeployment 30 PipelineForJenkins/Jenkinsfile 25 <pre><code>stage('Prepare WORKSPACE') {\n    steps {\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                sh 'env'\n                try {\n                    generalUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")\n                    unityUtil = load(\"${env.WORKSPACE}/groovy/unityHelper.groovy\")\n                } catch (Exception e) {\n                    error \"Failed to load Groovy scripts: ${e.message}\"\n                }\n\n                if (generalUtil.isBranchUpToDateWithRemote(PR_BRANCH) &amp;&amp; !TEST_RUN.equals('Y')) {\n                    echo 'Local branch commit is up to date with remote branch, no changes. Aborting pipeline.'\n                    currentBuild.result = 'ABORTED'\n                    error('Branch is up to date, no changes.')\n                }\n\n                env.COMMIT_HASH = generalUtil.getFullCommitHash(env.WORKSPACE, PR_COMMIT)\n                generalUtil.initializeEnvironment(env.WORKSPACE, env.COMMIT_HASH, PR_BRANCH)\n                generalUtil.cloneOrUpdateRepo(PROJECT_TYPE, env.WORKSPACE, PROJECT_DIR, REPO_SSH, PR_BRANCH)\n                generalUtil.mergeBranchIfNeeded()\n            }\n        }\n    }\n}\n</code></pre> <p>Jenkinsfile Total: 47 + 83 + 63 + 119 + 151 = 463 lines</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#73-groovy-helper-duplication-patterns","title":"7.3 Groovy Helper Duplication Patterns","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-6-git-command-sequences-24-lines-in-generalhelpergroovy","title":"Pattern 6: Git Command Sequences (24 lines in generalHelper.groovy)","text":"<p>12 git shell commands repeated across multiple functions:</p> <pre><code>// Found in generalHelper.groovy - repeated in cloneOrUpdateRepo(), checkoutBranch(), mergeBranchIfNeeded()\nsh 'git reset --hard'\nsh 'git clean -fd'\nsh \"git checkout ${targetBranch}\"\nsh 'git pull origin'\nsh 'git fetch origin'\nsh 'git branch --show-current'\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-7-python-script-wrapper-calls-16-lines-in-generalhelpergroovy","title":"Pattern 7: Python Script Wrapper Calls (16 lines in generalHelper.groovy)","text":"<p>8 Python wrapper calls using same pattern:</p> <pre><code>def sendBuildStatus(workspace, state, commitHash) {\n    def pythonCommand = \"python '${workspace}/python/send_bitbucket_build_status.py' '${commitHash}' '${state}'\"\n    sh(script: pythonCommand, returnStatus: true)\n}\n// Similar calls for: create_bitbucket_test_report.py, get_unity_version.py, linting_error_report.py, etc.\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-8-error-handling-patterns-24-lines-in-generalhelpergroovy","title":"Pattern 8: Error Handling Patterns (24 lines in generalHelper.groovy)","text":"<p>8 inconsistent error handling blocks:</p> <pre><code>// Version 1\ncatch (Exception e) {\n    echo \"An error occurred: ${e.getMessage()}\"\n    error('Process failed.')\n}\n\n// Version 2\ncatch (Exception e) {\n    error \"Failed: ${e.message}\"\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-9-isunix-branching-12-lines-in-jshelpergroovy","title":"Pattern 9: isUnix() Branching (12 lines in jsHelper.groovy)","text":"<p>2 OS branching blocks:</p> <pre><code>if (isUnix()) {\n    sh \"command for unix\"\n} else {\n    bat \"command for windows\"\n}\n</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#pattern-10-error-handling-in-jshelperunityhelper-30-lines","title":"Pattern 10: Error Handling in jsHelper/unityHelper (30 lines)","text":"<ul> <li>jsHelper.groovy: 6 occurrences (18 lines)</li> <li>unityHelper.groovy: 4 occurrences (12 lines)</li> </ul> <p>Groovy Helper Total: 24 + 16 + 24 + 12 + 30 = 106 lines</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#74-cross-file-duplication-matrix","title":"7.4 Cross-File Duplication Matrix","text":"Pattern DLX/JF DLX/JFD JS/JF JS/JFD Pipe/JF generalH unityH jsH Parameters Block \u2713 \u2713 \u2713 \u2713 \u2713 - - - Triggers Block \u2713 \u2713 \u2713 \u2713 \u2713 - - - Environment Block \u2713 \u2713 \u2713 \u2713 \u2713 - - - Post Actions \u2713 \u2713 \u2713 \u2713 \u2713 - - - Prepare WORKSPACE \u2713 \u2713 \u2713 \u2713 \u2713 - - - Git Commands - - - - - \u2713 \u2713 \u2713 isUnix() Branch - - - - - \u2713 \u2713 \u2713 Python Wrapper - - - - - \u2713 \u2713 - Error Handling \u2713 \u2713 \u2713 \u2713 \u2713 \u2713 \u2713 \u2713 <p>Legend: JF=Jenkinsfile, JFD=JenkinsfileDeployment, H=Helper</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#75-impact-of-duplication","title":"7.5 Impact of Duplication","text":"Issue Impact Maintenance Overhead Changes must be made in 5+ locations for common patterns Bug Propagation Risk Fixing a bug in one place doesn't fix copies elsewhere Inconsistent Behavior Small variations in copied code cause different behavior Testing Difficulty Same logic must be tested multiple times Code Review Burden Reviewers must verify consistency across all copies"},{"location":"problem-analysis/baseline-technical-snapshot/#76-deduplication-opportunities","title":"7.6 Deduplication Opportunities","text":"Pattern Current After Refactoring Reduction Parameters Block 47 lines 10 lines (1 shared) 37 lines Triggers Block 83 lines 17 lines (1 shared) 66 lines Environment Block 63 lines 12 lines (1 shared) 51 lines Post Actions Block 119 lines 25 lines (1 shared) 94 lines Prepare WORKSPACE 151 lines 30 lines (1 shared) 121 lines Git Commands 24 lines 6 lines (closures) 18 lines Python Wrappers 16 lines 0 lines (HttpApiService) 16 lines Error Handling 66 lines 10 lines (centralized) 56 lines <p>Total Potential Reduction: 459 lines (81% of duplicated code)</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#77-pipeline-specific-duplication-analysis","title":"7.7 Pipeline-Specific Duplication Analysis","text":"<p>This section analyzes file-level duplication between pipelines, revealing cross-project code sharing patterns.</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#file-sizes-4-main-jenkinsfiles","title":"File Sizes (4 Main Jenkinsfiles)","text":"File Lines DLXJenkins/Jenkinsfile 249 DLXJenkins/JenkinsfileDeployment 242 JsJenkins/Jenkinsfile 198 JsJenkins/JenkinsfileDeployment 372 Total 1,061"},{"location":"problem-analysis/baseline-technical-snapshot/#within-project-duplication-pr-vs-deployment","title":"Within-Project Duplication (PR vs Deployment)","text":"<p>DLX Pipeline (Unity)</p> Metric Value Total lines (both files) 491 Identical lines 146 Duplication rate 29.7% <p>JS Pipeline (JavaScript)</p> Metric Value Total lines (both files) 570 Identical lines 156 Duplication rate 27.4%"},{"location":"problem-analysis/baseline-technical-snapshot/#cross-project-duplication-dlx-vs-js","title":"Cross-Project Duplication (DLX vs JS)","text":"<p>PR Pipelines (DLX Jenkinsfile vs JS Jenkinsfile)</p> Metric Value DLX Jenkinsfile 249 lines JS Jenkinsfile 198 lines Identical lines 135 Duplication rate 54.2% (of smaller file) <p>Deployment Pipelines (DLX vs JS JenkinsfileDeployment)</p> Metric Value DLX JenkinsfileDeployment 242 lines JS JenkinsfileDeployment 372 lines Identical lines 167 Duplication rate 69.0% (of smaller file)"},{"location":"problem-analysis/baseline-technical-snapshot/#summary","title":"Summary","text":"Comparison Identical Lines Rate DLX: PR vs Deployment 146 29.7% JS: PR vs Deployment 156 27.4% DLX PR vs JS PR 135 54.2% DLX Deploy vs JS Deploy 167 69.0%"},{"location":"problem-analysis/baseline-technical-snapshot/#key-insight","title":"Key Insight","text":"<p>Cross-project duplication (54-69%) is significantly higher than within-project duplication (27-30%)</p> <p>This reveals that: 1. DLX and JS pipelines share enormous amounts of identical code 2. Deployment pipelines are even more similar than PR pipelines 3. Refactoring to a Global Shared Library would eliminate this massive redundancy 4. The 569 lines (18.1%) from pattern-based analysis is a conservative estimate</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#8-dependency-graph","title":"8. Dependency Graph","text":"<pre><code>flowchart TB\n    subgraph Jenkinsfiles[\"Jenkinsfiles (5 files)\"]\n        JF1[DLXJenkins/Jenkinsfile]\n        JF2[DLXJenkins/JenkinsfileDeployment]\n        JF3[JsJenkins/Jenkinsfile]\n        JF4[JsJenkins/JenkinsfileDeployment]\n        JF5[PipelineForJenkins/Jenkinsfile]\n    end\n\n    subgraph Helpers[\"groovy/*.groovy\"]\n        GH[generalHelper.groovy]\n        UH[unityHelper.groovy]\n        JH[jsHelper.groovy]\n    end\n\n    subgraph Python[\"python/*.py\"]\n        P1[send_bitbucket_build_status.py]\n        P2[create_bitbucket_test_report.py]\n        P3[get_unity_version.py]\n        P4[...]\n    end\n\n    JF1 --&gt;|\"load()\"| GH\n    JF1 --&gt;|\"load()\"| UH\n    JF2 --&gt;|\"load()\"| GH\n    JF2 --&gt;|\"load()\"| UH\n    JF3 --&gt;|\"load()\"| GH\n    JF3 --&gt;|\"load()\"| JH\n    JF4 --&gt;|\"load()\"| GH\n    JF4 --&gt;|\"load()\"| JH\n    JF5 --&gt;|\"load()\"| GH\n\n    GH --&gt;|\"sh(python...)\"| P1\n    GH --&gt;|\"sh(python...)\"| P2\n    UH --&gt;|\"sh(python...)\"| P3</code></pre>"},{"location":"problem-analysis/baseline-technical-snapshot/#9-technical-debt-summary","title":"9. Technical Debt Summary","text":""},{"location":"problem-analysis/baseline-technical-snapshot/#91-code-metrics","title":"9.1 Code Metrics","text":"Metric Value Total Files 27 Total Lines 3,745 Jenkinsfile Lines 1,239 lines (5 files) Groovy Helper Lines 1,148 lines (3 files) Python Scripts 749 lines (9 files) Test Lines 84 lines (2 files) Test Coverage ~1 function testable"},{"location":"problem-analysis/baseline-technical-snapshot/#92-duplication-analysis","title":"9.2 Duplication Analysis","text":"Duplicated Pattern Occurrences Lines Parameters block 5 files 47 Triggers block 5 files 83 Environment block 5 files 63 Post actions block 5 files 119 Prepare WORKSPACE stage 5 files 151 Git commands (generalHelper) 12 calls 24 Python wrappers (generalHelper) 8 calls 16 Error handling (all helpers) 18 blocks 66 <p>Total Duplication: 569 lines (18.1% of active codebase*)</p> <p>*Active codebase = Jenkinsfiles (1,239) + Groovy Helpers (1,148) + Python (749) = 3,136 lines</p>"},{"location":"problem-analysis/baseline-technical-snapshot/#10-summary-table","title":"10. Summary Table","text":"Aspect Status Problem Architecture Flat/Monolithic No layer separation Code Reuse Poor Duplicated code across 5 Jenkinsfiles Testability Very Low Only 1 function testable Maintainability Poor 1 file modification \u2192 affects everything Logging Inconsistent No format consistency, no hierarchy Error Handling Inconsistent Stack trace lost API Communication Python dependent Not possible directly in Groovy Documentation Partial Some JSDoc present"},{"location":"problem-analysis/baseline-technical-snapshot/#11-key-issues-for-refactoring","title":"11. Key Issues for Refactoring","text":"<ol> <li>Separate concerns: Extract stage logic from Jenkinsfile into reusable modules</li> <li>Eliminate Python dependency: Implement HTTP communication directly in Groovy</li> <li>Standardize logging: Create centralized logging system with hierarchy</li> <li>Unify error handling: Create consistent error handling with stack trace preservation</li> <li>Enable testing: Structure code to allow unit testing</li> <li>Reduce duplication: Extract common patterns into reusable components</li> <li>Create layer architecture: Establish clear separation between layers</li> </ol>"},{"location":"problem-analysis/detailed-analysis/","title":"Problem Analysis","text":"<p>Problem analysis document for the pre-refactoring Jenkins Pipeline codebase (Baseline: <code>74fc356</code>).</p>"},{"location":"problem-analysis/detailed-analysis/#1-analysis-overview","title":"1. Analysis Overview","text":""},{"location":"problem-analysis/detailed-analysis/#11-background","title":"1.1. Background","text":"<p>This document is the problem analysis document for the pre-refactoring Baseline codebase.</p> <p>During the VARLab Co-op period, 5 monolithic pipelines (37% duplication, untestable) with 14 months of accumulated Technical Debt were refactored into a 4-Layer Architecture.</p>"},{"location":"problem-analysis/detailed-analysis/#111-project-context","title":"1.1.1. Project Context","text":"<ul> <li>As an R&amp;D project, rapid feature addition for value validation was the priority</li> <li>The Jenkins Global Trusted Shared Library feature itself was poorly documented and difficult to discover/apply</li> <li>This feature was discovered at month 13 of the project</li> </ul>"},{"location":"problem-analysis/detailed-analysis/#112-refactoring-trigger","title":"1.1.2. Refactoring Trigger","text":"<ul> <li>At month 14, a project break term of approximately 3 weeks occurred, and with permission from the software architect, full refactoring began</li> <li>Problems felt intuitively at the time:</li> <li>Modifying one thing caused problems elsewhere</li> <li>Continuous situation where all places had to be considered when making modifications or adding features</li> <li>Due to Jenkins characteristics, creating classes for Import/Export was not possible</li> </ul>"},{"location":"problem-analysis/detailed-analysis/#113-refactoring-approach","title":"1.1.3. Refactoring Approach","text":"<ul> <li>Started without completing problem identification or planning specific design pattern application</li> <li>Progressed naturally and emergently during the Tech Debt resolution process</li> <li>Design patterns naturally emerged by utilizing the Jenkins Global Trusted Shared Library feature</li> </ul>"},{"location":"problem-analysis/detailed-analysis/#12-analysis-purpose","title":"1.2. Analysis Purpose","text":"<ul> <li>At the time of refactoring, it was done intuitively without clear criteria.</li> <li> <p>To lead from experience-based understanding to systematic theory acquisition, classification and definition using Industry Convention criteria:</p> </li> <li> <p>Learn how the problems I felt are classified and named in practice</p> </li> <li>Check if there are any missed problems</li> <li>Understand the analysis methodology itself</li> </ul>"},{"location":"problem-analysis/detailed-analysis/#13-analysis-target","title":"1.3. Analysis Target","text":""},{"location":"problem-analysis/detailed-analysis/#131-helper-files-reusable-logic","title":"1.3.1. Helper Files (Reusable Logic)","text":"File Domain <code>generalHelper.groovy</code> Pipeline utilities (Git, Bitbucket, Logging) <code>jsHelper.groovy</code> Web Pipeline utilities <code>unityHelper.groovy</code> Unity Pipeline utilities"},{"location":"problem-analysis/detailed-analysis/#132-jenkinsfile-pipeline-orchestration","title":"1.3.2. Jenkinsfile (Pipeline Orchestration)","text":"File Domain <code>DLXJenkins/Jenkinsfile</code> Unity Project CI <code>DLXJenkins/JenkinsfileDeployment</code> Unity Project CD <code>JsJenkins/Jenkinsfile</code> Node.js Project CI <code>JsJenkins/JenkinsfileDeployment</code> Node.js Project CD <code>PipelineForJenkins/Jenkinsfile</code> Pipeline Library Self CI"},{"location":"problem-analysis/detailed-analysis/#14-analysis-methodology","title":"1.4. Analysis Methodology","text":"<p>Analyze problems by level using the Software Smells classification system.</p> <p>Reason for methodology selection: To learn how intuitively felt problems (\"modifying one thing causes problems elsewhere\", \"all places must be considered\") are classified and named in the industry, the most widely known classification systems were utilized.</p>"},{"location":"problem-analysis/detailed-analysis/#141-function-level","title":"1.4.1. Function Level","text":"Analysis Type Source Description Code Smells Fowler/Beck (1999) Method/function level problems SRP Violation Analysis Martin (2006, 2010) Single Responsibility Principle violation - change reason analysis <p>Note: SRP is a SOLID principle for OOP languages, but it is a generally applicable principle regardless of programming paradigm and is suitable as a baseline analysis criterion. Cases where two or more functional domains or logic units are mixed within a function are investigated.</p>"},{"location":"problem-analysis/detailed-analysis/#142-module-level-modulefile-level","title":"1.4.2. Module Level (Module/File Level)","text":"Analysis Type Source Description Design Smells - Symptoms Martin (2000) 7 symptoms (Rigidity, Fragility, Immobility, etc.) Design Smells - Principles Suryanarayana et al. (2014) OO principle violations (Abstraction, Encapsulation, Modularization) SRP Violation Analysis Martin (2006, 2010) Single Responsibility Principle violation - change reason analysis <p>Note: Applying OO or OOP principles to Procedural code (Jenkins Pipeline) to understand which concepts are applicable/inapplicable. - SRP Violation Analysis: Sequence diagrams are created per stage for each pipeline to identify functional domains.   - Jenkinsfile: SRP violation analysis based on the number of domains requiring changes due to actual logic existing rather than orchestration   - Helper files: Verify through cohesion whether they are being used as designed (originally the helper file design itself contains multiple domains and is not suitable for SRP, but verify if it's being used according to the original design purpose)</p> <ul> <li>Design Smells - Principles: Hierarchy Smells are not applicable as they presuppose inheritance structure, Abstraction/Modularization are interpreted at file/function level for application</li> </ul>"},{"location":"problem-analysis/detailed-analysis/#143-system-level","title":"1.4.3. System Level","text":"Analysis Type Source Description Architecture Smells Garcia et al. (2009), Sharma System-level structural problems DRY Violation Analysis Hunt &amp; Thomas (1999) Duplication pattern identification <p>Note: DRY violation analysis identifies duplication patterns using a top-down comparison approach. - All pipelines (5) \u2192 CI vs CD \u2192 Between CIs / Between CDs \u2192 Within single pipeline \u2192 Between Helpers - Grouped for analysis based on ranges where identical logic can exist</p>"},{"location":"problem-analysis/detailed-analysis/#2-detailed-document-structure","title":"2. Detailed Document Structure","text":"<pre><code>problem-analysis/\n\u251c\u2500\u2500 README.md                           # This document\n\u251c\u2500\u2500 baseline-technical-snapshot.md      # Baseline technical snapshot (code statistics, file structure)\n\u251c\u2500\u2500 DRY-violation-analysis.md           # System-wide DRY violation analysis\n\u2502\n\u251c\u2500\u2500 01-generalHelper/                   # Per-file analysis folder (example)\n\u2502   \u251c\u2500\u2500 srp-violation-analysis.md       # SRP violation analysis\n\u2502   \u251c\u2500\u2500 software-smells-analysis.md     # Code/Design/Architecture Smells\n\u2502   \u2514\u2500\u2500 design-smells-symptoms.md       # Martin's 7 Symptoms detail\n\u251c\u2500\u2500 02-jsHelper/                        # (Same structure)\n\u251c\u2500\u2500 ...\n\u251c\u2500\u2500 08-PipelineForJenkins-Jenkinsfile/  # (Same structure)\n\u2502\n\u251c\u2500\u2500 pipeline-sequence-diagrams/         # Pipeline sequence diagrams\n\u2514\u2500\u2500 reference/                          # Smells Taxonomy reference documents\n</code></pre>"},{"location":"problem-analysis/detailed-analysis/#3-analysis-results-summary","title":"3. Analysis Results Summary","text":""},{"location":"problem-analysis/detailed-analysis/#31-system-level","title":"3.1. System Level","text":""},{"location":"problem-analysis/detailed-analysis/#311-dry-violation-analysis","title":"3.1.1. DRY Violation Analysis","text":"<p>Grouped for analysis based on ranges where identical logic can exist: - All Jenkinsfiles (5) - CI vs CD (same project type) - Between CI pipelines - Between CD pipelines - Between Helper files</p> <p>Details: DRY-violation-analysis.md</p>"},{"location":"problem-analysis/detailed-analysis/#312-architecture-smells-summary","title":"3.1.2. Architecture Smells Summary","text":"File Hub-like Dependency Implicit Cross-module Dependency 01-generalHelper High High 02-jsHelper - Medium 03-unityHelper - Medium 04-DLXJenkins-Jenkinsfile - High 05-DLXJenkins-JenkinsfileDeployment - High 06-JsJenkins-Jenkinsfile - High 07-JsJenkins-JenkinsfileDeployment - High 08-PipelineForJenkins-Jenkinsfile - High <p>Detailed analysis: <code>{folder}/software-smells-analysis.md</code> &gt; <code>## 3. Architecture Smells (System Level)</code></p>"},{"location":"problem-analysis/detailed-analysis/#32-module-level-modulefile-level","title":"3.2. Module Level (Module/File Level)","text":""},{"location":"problem-analysis/detailed-analysis/#321-srp-violation-analysis-summary","title":"3.2.1. SRP Violation Analysis Summary","text":"File Analysis Criteria SRP Violation Summary 01-generalHelper Cohesion (Design Intent) Kitchen Sink - 19% cohesion (4/21 functions with 100% reuse) 02-jsHelper Cohesion (Design Intent) CI/CD-specific functions mixed - 50% cohesion 03-unityHelper Cohesion (Design Intent) CI-specific functions mixed - 50% cohesion 04-DLXJenkins-Jenkinsfile Logic Existence Logic exists in 6 domains, Prepare WORKSPACE has 5 change reasons 05-DLXJenkins-JenkinsfileDeployment Logic Existence Logic exists in 7 domains, deployment pattern repeated 2 times 06-JsJenkins-Jenkinsfile Logic Existence Logic exists in 5 domains, Server/Client pattern 80 lines repeated 07-JsJenkins-JenkinsfileDeployment Logic Existence Logic exists in 5 domains, Server/Client deployment 150 lines repeated 08-PipelineForJenkins-Jenkinsfile Logic Existence Logic exists in 5 domains, Groovy/Jenkinsfile lint 60 lines repeated <p>Detailed analysis: <code>{folder}/srp-violation-analysis.md</code> &gt; <code>## Conclusion</code></p>"},{"location":"problem-analysis/detailed-analysis/#322-design-smells-principles-summary-suryanarayana-2014","title":"3.2.2. Design Smells - Principles Summary (Suryanarayana 2014)","text":"File Abstraction Encapsulation Modularization 01-generalHelper Multifaceted, Missing Missing Insufficient, Hub-like 02-jsHelper Multifaceted, Missing Missing Insufficient 03-unityHelper Multifaceted Missing - 04-DLXJenkins-Jenkinsfile Multifaceted, Missing, Imperative Missing - 05-DLXJenkins-JenkinsfileDeployment Multifaceted, Missing, Imperative Missing - 06-JsJenkins-Jenkinsfile Multifaceted, Missing, Imperative Missing Insufficient 07-JsJenkins-JenkinsfileDeployment Multifaceted, Missing, Imperative Missing Insufficient 08-PipelineForJenkins-Jenkinsfile Multifaceted, Missing, Imperative Missing - <p>Detailed analysis: <code>{folder}/software-smells-analysis.md</code> &gt; <code>## 2. Design Smells (Module/File Level)</code></p>"},{"location":"problem-analysis/detailed-analysis/#323-design-smells-symptoms-summary-martin-2000","title":"3.2.3. Design Smells - Symptoms Summary (Martin 2000)","text":"<p>Note: 7 symptoms inferred based on Code Smells, Design Principles, Architecture Smells analysis results + direct code review</p> File Rigidity Fragility Immobility Viscosity Complexity Repetition Opacity 01-generalHelper High Medium-High High Medium Low High High 02-jsHelper Medium Medium Medium Medium Low Medium Medium 03-unityHelper High Medium Medium High Low High Medium 04-DLXJenkins-Jenkinsfile High High High Medium Low High High 05-DLXJenkins-JenkinsfileDeployment High High High High Low High Medium 06-JsJenkins-Jenkinsfile High High High High Low High High 07-JsJenkins-JenkinsfileDeployment High High High High Low High High 08-PipelineForJenkins-Jenkinsfile Medium High High Medium Low High Low <p>Detailed analysis: <code>{folder}/design-smells-symptoms.md</code></p>"},{"location":"problem-analysis/detailed-analysis/#33-function-level","title":"3.3. Function Level","text":""},{"location":"problem-analysis/detailed-analysis/#331-srp-violation-analysis-summary-function-level","title":"3.3.1. SRP Violation Analysis Summary (Function Level)","text":"<p>Note: Function-level SRP analysis performed only on Helper files. Jenkinsfiles are covered at module level (3.2.1) with stage-unit analysis.</p> File Functions with Multiple Change Reasons 01-generalHelper <code>initializeEnvironment</code>(2), <code>cleanUpPRBranch</code>(2), <code>checkQualityGateStatus</code>(5) 02-jsHelper <code>installNpmInTestingDirs</code>(3) 03-unityHelper <code>getUnityExecutable</code>(2), <code>runUnityBatchMode</code>(7) <p>Detailed analysis: <code>{folder}/srp-violation-analysis.md</code> &gt; <code>## 4. Function Level SRP Violation Analysis</code></p>"},{"location":"problem-analysis/detailed-analysis/#332-code-smells-summary-fowler-1999","title":"3.3.2. Code Smells Summary (Fowler 1999)","text":"File Change Preventers Dispensables Bloaters Couplers 01-generalHelper Divergent Change(High), Shotgun Surgery(High) - - - 02-jsHelper Divergent Change(Medium), Shotgun Surgery(Medium) Duplicated Code(Medium) Long Method(Low), Primitive Obsession(Low) - 03-unityHelper Divergent Change(Medium), Shotgun Surgery(High) - Long Method(High), Switch Statements(Medium) - 04-DLXJenkins-Jenkinsfile Divergent Change(High), Shotgun Surgery(Medium) Duplicated Code(Medium) Primitive Obsession(Low) - 05-DLXJenkins-JenkinsfileDeployment Divergent Change(High), Shotgun Surgery(Medium) Duplicated Code(High) Primitive Obsession(Low) - 06-JsJenkins-Jenkinsfile Divergent Change(High), Shotgun Surgery(High) Duplicated Code(High), Dead Code(Low) Long Method(High), Primitive Obsession(Low) Feature Envy(High) 07-JsJenkins-JenkinsfileDeployment Divergent Change(High), Shotgun Surgery(High) Duplicated Code(High) Long Method(High), Primitive Obsession(Low) - 08-PipelineForJenkins-Jenkinsfile Divergent Change(High), Shotgun Surgery(Medium) Duplicated Code(High) Primitive Obsession(Low) - <p>Detailed analysis: <code>{folder}/software-smells-analysis.md</code> &gt; <code>## 1. Code Smells (Method/Function Level)</code></p>"},{"location":"problem-analysis/detailed-analysis/#4-comprehensive-analysis-results","title":"4. Comprehensive Analysis Results","text":""},{"location":"problem-analysis/detailed-analysis/#41-core-problem-patterns","title":"4.1. Core Problem Patterns","text":"<p>Core problems appearing commonly across all 8 files:</p> Pattern Impact Scope Occurrence Frequency Severity Divergent Change All files 8/8 High Shotgun Surgery All files 8/8 High Duplicated Code 5 Jenkinsfiles + jsHelper 6/8 High Implicit Cross-module Dependency All files 8/8 High Missing Encapsulation All files 8/8 Medium Multifaceted Abstraction All files 8/8 Medium"},{"location":"problem-analysis/detailed-analysis/#42-priority-by-severity","title":"4.2. Priority by Severity","text":"<p>51 issues derived from all analysis documents (20 High, 23 Medium, 8 Low)</p>"},{"location":"problem-analysis/detailed-analysis/#high-immediate-resolution-required-20-items","title":"High (Immediate Resolution Required) - 20 items","text":"# Issue Type File Impact 1 Hub-like Dependency Architecture generalHelper 5 pipelines depend on single file 2 DRY Violation - parameters block DRY 5 Jenkinsfiles Parameter changes require 5 modifications 3 DRY Violation - triggers.GenericTrigger DRY 5 Jenkinsfiles Trigger changes require 5 modifications 4 DRY Violation - post block DRY 5 Jenkinsfiles Build status handling changes require 5 modifications 5 DRY Violation - Prepare WORKSPACE logic DRY 3 CI Jenkinsfiles Initialization logic changes require 3 modifications 6 Server/Client deployment duplication (150 lines) Code - Duplicated JS CD Deployment logic changes require 2 modifications 7 Server/Client report duplication (80 lines) Code - Duplicated JS CI Python script argument changes require 2 modifications 8 Kitchen Sink file (19% cohesion) Design - Modularization generalHelper Unclear change reasons, 21 functions/8 domains 9 Divergent Change (8 domains) Code - Change Preventers generalHelper 8 change reasons mixed 10 Shotgun Surgery (7 triggers) Code - Change Preventers generalHelper Path/command changes require 10+ modifications 11 Shotgun Surgery (7 places when adding new Stage) Code - Change Preventers unityHelper Stage addition requires 7 simultaneous modifications 12 Implicit Cross-module Dependency Architecture All files Runtime error when external system changes 13 Long Method (126 lines) Code - Bloaters unityHelper <code>runUnityBatchMode</code> 7 responsibilities mixed 14 Long Method (112 lines) Code - Bloaters JS CI <code>Unit Testing</code> 7 responsibilities mixed 15 Long Method (75 lines \u00d7 2) Code - Bloaters JS CD <code>Server/Client Deploy</code> 5 responsibilities each mixed 16 Feature Envy Code - Couplers JS CI <code>Unit Testing</code> Excessive dependency on external module 17 Insufficient Modularization Design - Modularization JS CI, JS CD Stage is too large and complex 18 Missing Encapsulation (Stage conditions in 7 places) Design - Encapsulation unityHelper Stage-specific conditional branching scattered 19 Missing Encapsulation (deployment patterns) Design - Encapsulation DLX CD, JS CD SSH/SCP, Docker patterns repeated 20 Multifaceted Abstraction Design - Abstraction All files Multiple domains mixed in one file"},{"location":"problem-analysis/detailed-analysis/#medium-planned-resolution-23-items","title":"Medium (Planned Resolution) - 23 items","text":"# Issue Type File Impact 21 CI/CD-specific functions mixed (50% cohesion) SRP Violation jsHelper, unityHelper Unnecessary dependencies 22 DRY Violation - environment block DRY 5 Jenkinsfiles Environment variable pattern changes require 5 modifications 23 DRY Violation - buildResults/stageResults DRY 5 Jenkinsfiles Status value changes require 5 modifications 24 DRY Violation - Static Analysis pattern DRY JS CI, JS CD, Jenkins CI SonarQube setting changes require 3 modifications 25 DRY Violation - logMessage() copy DRY generalHelper, jsHelper Logging changes require 2 modifications 26 Shotgun Surgery (Unity Stage name 5 places) Code - Change Preventers DLX CI Stage name changes require 5 modifications 27 Shotgun Surgery (6 places when adding report type) Code - Change Preventers JS CI New report type addition requires 6 modifications 28 Shotgun Surgery (4 places when adding deployment target) Code - Change Preventers JS CD New deployment target addition requires 4 modifications 29 Shotgun Surgery (4 places when adding lint type) Code - Change Preventers Jenkins CI New lint type addition requires 4 modifications 30 Duplicated Code (stageName/errorMsg 5 times) Code - Dispensables DLX CI Error message format changes require 5 modifications 31 Duplicated Code (deployment pattern 2 times) Code - Dispensables DLX CD SSH option changes require 2 modifications 32 Duplicated Code (lint pattern 60 lines) Code - Dispensables Jenkins CI Lint option changes require 2 modifications 33 Switch Statements (same branching 7 places) Code - Bloaters unityHelper Stage-specific conditional branching repeated 34 Missing Abstraction (magic strings/paths) Design - Abstraction All files Environment changes require multiple modifications 35 Imperative Abstraction Design - Abstraction 5 Jenkinsfiles Procedural script structure 36 Hub-like Modularization Design - Modularization generalHelper Many places depend on it 37 Viscosity (copying is easier) Design Symptom generalHelper, unityHelper Hacking is easier than correct changes 38 Fragility (unexpected impact) Design Symptom generalHelper, DLX CI/CD No domain boundaries 39 Opacity (complex nested conditions) Design Symptom unityHelper, DLX CI 3-4 level nesting, difficult to trace 40 Opacity (undefined variable usage) Design Symptom DLX CI FOLDER_NAME, TICKET_NUMBER definition location unclear 41 Deeply Nested Code (3 levels) Implementation JS CI Server/Client report processing 42 Magic String (SonarQube URL) Implementation JS CI, JS CD, Jenkins CI Hardcoded URL 43 Magic String (Docker image) Implementation Jenkins CI Hardcoded image name"},{"location":"problem-analysis/detailed-analysis/#low-gradual-improvement-8-items","title":"Low (Gradual Improvement) - 8 items","text":"# Issue Type File Impact 44 DRY Violation - mainBranches constant DRY DLX CD, JS CD Branch policy changes require 2 modifications 45 Primitive Obsession Code - Bloaters All Jenkinsfiles Lack of type safety 46 Dead Code (2 functions) Code - Dispensables generalHelper Unused code exists 47 Dead Code (commented code) Code - Dispensables JS CI JENKINS_API_KEY comment 48 Needless Complexity (Low) Design Symptom All files No excessive design beyond Dead Code 49 Opacity (counter-intuitive variable name) Design Symptom generalHelper 0=exists in projectExists 50 Opacity (function name mismatch) Design Symptom generalHelper parseJson, isBranchUpToDateWithMain 51 Opacity (complex Map/JSON structure) Design Symptom unityHelper logConfig, loadPathsToExclude"},{"location":"problem-analysis/detailed-analysis/#43-causal-relationships-between-issues","title":"4.3. Causal Relationships Between Issues","text":"<pre><code>flowchart LR\n    subgraph ROOT[\"Root Causes\"]\n        A1[\"Lack of Helper Design&lt;br/&gt;(generalHelper)\"]\n        A2[\"Common Patterns Not Extracted&lt;br/&gt;(parameters, triggers)\"]\n        A3[\"Environment Settings Hardcoded&lt;br/&gt;(magic strings/paths)\"]\n        A4[\"Insufficient CI/CD Separation&lt;br/&gt;(jsHelper, unityHelper)\"]\n        A5[\"Insufficient Function Decomposition\"]\n    end\n\n    subgraph L1[\"Level 1 Results - Design Smells\"]\n        B1[\"Kitchen Sink File&lt;br/&gt;(multi-purpose file)\"]\n        B2[\"Hub-like Dependency&lt;br/&gt;(everything depends on it)\"]\n        B3[\"Duplicated Code&lt;br/&gt;(copied to 5 places)\"]\n        B4[\"Implicit Cross-module&lt;br/&gt;Dependency\"]\n        B5[\"Missing Encapsulation&lt;br/&gt;(settings exposed)\"]\n        B6[\"Multifaceted Abstraction&lt;br/&gt;(multiple responsibilities)\"]\n        B7[\"Long Method&lt;br/&gt;(125-line function)\"]\n    end\n\n    subgraph L2[\"Level 2 Results - Code Smells\"]\n        C1[\"Divergent Change&lt;br/&gt;(1 file \u2190 N change reasons)\"]\n        C2[\"Shotgun Surgery&lt;br/&gt;(1 change \u2192 N files)\"]\n        C3[\"DRY Violation&lt;br/&gt;(synchronization issues)\"]\n        C4[\"Primitive Obsession&lt;br/&gt;(lack of type safety)\"]\n    end\n\n    subgraph L3[\"Level 3 Results - Symptoms\"]\n        D1[\"Rigidity&lt;br/&gt;(difficulty changing)\"]\n        D2[\"Fragility&lt;br/&gt;(unexpected failures)\"]\n        D3[\"Immobility&lt;br/&gt;(cannot reuse)\"]\n        D4[\"Viscosity&lt;br/&gt;(correct changes are difficult)\"]\n        D5[\"Opacity&lt;br/&gt;(difficult to understand)\"]\n    end\n\n    %% Chain 1: Lack of Helper Design\n    A1 --&gt; B1 --&gt; C1 --&gt; D1\n    B1 --&gt; B2 --&gt; C2 --&gt; D2\n    B1 --&gt; B6\n\n    %% Chain 2: Common Patterns Not Extracted\n    A2 --&gt; B3 --&gt; C3\n    B3 --&gt; B4 --&gt; D2\n    B3 --&gt; D3\n\n    %% Chain 3: Environment Settings Hardcoded\n    A3 --&gt; B5 --&gt; D4\n    B5 --&gt; C4\n\n    %% Chain 4: Insufficient CI/CD Separation\n    A4 --&gt; B6 --&gt; C1\n    B6 --&gt; D3\n\n    %% Chain 5: Insufficient Function Decomposition\n    A5 --&gt; B7 --&gt; D5\n    B7 --&gt; C2</code></pre>"},{"location":"problem-analysis/detailed-analysis/#44-refactoring-direction-implications","title":"4.4. Refactoring Direction Implications","text":"<p>Refactoring directions derived from analysis results:</p> # Problem Group Refactoring Direction Expected Effect 1 Hub-like Dependency + Kitchen Sink Helper File Separation: Separate Helpers by functional domain Reduce Divergent Change, Shotgun Surgery 2 DRY Violation (parameters/triggers) Utilize Shared Library: Extract common blocks to Shared Library 5 places \u2192 1 place change 3 Server/Client duplication Abstraction: Extract deployment pattern as function Remove 150 lines of duplication 4 Implicit Cross-module Dependency Explicit Dependencies: Constantize environment variables/script paths Reduce Fragility 5 CI/CD-specific functions mixed Cohesion-based Separation: Separate into CI-only / CD-only / Common Remove unnecessary dependencies <p>Note: This direction was naturally derived from analysis results, and actual refactoring was performed in <code>leg-4-full-pipeline-refactoring-and-stage-modularization</code>.</p>"},{"location":"problem-analysis/detailed-analysis/#5-per-file-analysis-documents","title":"5. Per-File Analysis Documents","text":"# Analysis Target SRP Analysis Software Smells Design Symptoms 01 generalHelper.groovy srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 02 jsHelper.groovy srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 03 unityHelper.groovy srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 04 DLXJenkins/Jenkinsfile srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 05 DLXJenkins/JenkinsfileDeployment srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 06 JsJenkins/Jenkinsfile srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 07 JsJenkins/JenkinsfileDeployment srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md 08 PipelineForJenkins/Jenkinsfile srp-violation-analysis.md software-smells-analysis.md design-smells-symptoms.md"},{"location":"problem-analysis/detailed-analysis/#6-related-documents","title":"6. Related Documents","text":"Document Description Analysis Criteria baseline-technical-snapshot.md Code statistics, file structure, technical state Commit <code>54479b2</code> <p>Note: <code>baseline-technical-snapshot.md</code> was analyzed based on commit <code>54479b2</code>, which differs from the baseline of other documents in this folder (commit <code>74fc356</code>). The analysis direction is also different, and that document is a technical snapshot focused on code statistics and file structure.</p>"},{"location":"problem-analysis/detailed-analysis/#7-references","title":"7. References","text":"<ul> <li>Software Smells &amp; Anti-Patterns Taxonomy</li> <li>Pipeline Sequence Diagrams</li> </ul>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/","title":"Design Smells","text":"<p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#groovygeneralhelpergroovy-design-smells-symptoms-analysis","title":"groovy/generalHelper.groovy - Design Smells Symptoms Analysis","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Symptoms analysis based on static analysis results (SRP, Software Smells, DRY) + code review</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#summary","title":"Summary","text":"Symptom Severity Main Evidence Rigidity High Shotgun Surgery (7 change triggers) Fragility Medium~High 8 domains mixed, 6 implicit dependencies Immobility High 656 lines/21 functions/8 domains, Hub-like Dependency Viscosity Medium Missing Encapsulation \u2192 copying is easier Needless Complexity Low 2 Dead Code instances Needless Repetition High DRY violation (SSH/SCP/Git patterns, logMessage copy) Opacity High Counter-intuitive variable names, function name mismatch, complex nested/retry logic, magic strings"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#inference-evidence","title":"Inference Evidence","text":"Symptom Evidence Source Rigidity Shotgun Surgery 7 change triggers \u2192 a single change causes multiple modifications Code Smells Fragility Divergent Change 8 domains + Implicit Dependency 6 \u2192 modifications affect unexpected places Code Smells + Arch Smells Immobility Hub-like Dependency 5 pipelines depend + Insufficient Modularization 656 lines/21 functions \u2192 excessive dependencies when separating Arch Smells + Design Smells Viscosity Missing Encapsulation SSH/SCP/Git patterns not encapsulated \u2192 copying is easier than the right approach Design Smells Needless Complexity Dead Code 2 functions (<code>getCurrentCommitHash</code>, <code>closeLogfiles</code>) \u2192 unused code exists SRP Analysis Needless Repetition DRY Violation <code>logMessage()</code> copy, SSH/SCP pattern repetition \u2192 same code repeated DRY Analysis Opacity Direct code review Code Review"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#1-rigidity","title":"1. Rigidity","text":"<p>Definition: Changing one place requires cascading changes to other places</p> <p>Symptom: \"I thought it was a simple change, but it turned out to be much more complex\"</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#inference-evidence-shotgun-surgery","title":"Inference Evidence: Shotgun Surgery","text":"Change Trigger Functions Needing Modification Number of Locations Git CLI change 8 functions 10+ Web server path change 4 functions 8 SSH/SCP command structure change 4 functions 10 Environment variable name change 4 functions 10 User account change 3 functions 3 <p>Conclusion: Changing just the <code>/var/www/html</code> path requires modifying 8 locations across 4 functions \u2192 High Rigidity</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#2-fragility","title":"2. Fragility","text":"<p>Definition: Modifying one place breaks conceptually unrelated places</p> <p>Symptom: \"I touched this, why did that break?\"</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#inference-evidence-divergent-change-implicit-cross-module-dependency","title":"Inference Evidence: Divergent Change + Implicit Cross-module Dependency","text":"<p>8 domains mixed in one file: - Git, Bitbucket, Deployment (WebServer), SonarQube, File System, Logging, Jenkins Configuration, Parsing</p> <p>6 implicit dependencies: - Python scripts, SonarQube REST API, Web server file system, Git CLI output, Linux command output, Jenkins Pipeline DSL</p> <p>Potential Fragility Scenarios:</p> Change Expected Impact Actual Impact (Inferred) Git fetch option change <code>cloneOrUpdateRepo</code> <code>mergeBranchIfNeeded</code> also affected (same pattern in 2 places) Python script argument change <code>getFullCommitHash</code> <code>initializeEnvironment</code> \u2192 <code>sendBuildStatus</code> chain affected SSH key path change publish functions clean functions also use the same pattern <p>Conclusion: Domains mixed without boundaries \u2192 unexpected impact on changes possible \u2192 Medium~High Fragility</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#3-immobility","title":"3. Immobility","text":"<p>Definition: Difficult to extract useful parts for reuse in other systems/modules</p> <p>Symptom: \"Trying to separate it brings too many dependencies along\"</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#inference-evidence-hub-like-dependency-insufficient-modularization","title":"Inference Evidence: Hub-like Dependency + Insufficient Modularization","text":"<p>Problems when attempting separation:</p> Extraction Target Functions Dependencies That Follow GitHelper 8 functions Jenkins DSL (<code>sh</code>, <code>env</code>, <code>echo</code>), <code>logMessage</code> BitbucketHelper 2 functions Python script path, Jenkins DSL WebServerHelper 4 functions <code>env.SSH_KEY</code>, <code>env.DLX_WEB_HOST_URL</code>, Jenkins DSL SonarQubeHelper 1 function <code>logMessage</code>, JSON parsing, HTTP client <p>Reuse Cost Analysis:</p> <pre><code>Separation Cost = Function extraction + Dependency resolution + Test modification + 5 pipeline modifications\nRewrite Cost = Write from scratch\n\nSeparation Cost &gt; Rewrite Cost \u2192 Immobility\n</code></pre> <p>Conclusion: 656 lines, 21 functions, 8 domains intertwined makes partial extraction difficult \u2192 High Immobility</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#4-viscosity","title":"4. Viscosity","text":"<p>Definition: The right approach (maintaining design) is harder than the wrong approach (hacking)</p> <p>Symptom: \"Doing it properly takes too long, let's just do it this way for now\"</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#inference-evidence-missing-encapsulation-dry-violation-induced","title":"Inference Evidence: Missing Encapsulation \u2192 DRY Violation Induced","text":"<p>Current State (Missing Encapsulation): - <code>sh 'git fetch origin'</code> - repeated 2 times - <code>sh \"ssh -i ${env.SSH_KEY} ...\"</code> - repeated 4 times - <code>sh \"scp -i ${env.SSH_KEY} ...\"</code> - repeated 4 times</p> <p>Right Approach vs Hack:</p> Situation Right Approach Hack Tendency Adding new publish function Create SSH/SCP helper function then use Copy-paste from existing function Copy (faster) Adding Git operation Create Git command wrapper then use Call <code>sh 'git ...'</code> directly Direct call (faster) <p>Conclusion: Lack of encapsulation creates \"copying is easier\" structure \u2192 Medium Viscosity</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#5-needless-complexity","title":"5. Needless Complexity","text":"<p>Definition: Over-engineering for features not currently needed</p> <p>Symptom: YAGNI violation, \"I might need this later\"</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#inference-evidence-dead-code","title":"Inference Evidence: Dead Code","text":"<p>Dead Code found in SRP Analysis (2):</p> Function Usage Status Inference <code>getCurrentCommitHash</code> 0 pipelines Created \"just in case\" <code>closeLogfiles</code> 0 pipelines No longer used (legacy) <p>Conclusion: Dead Code exists \u2192 Low Needless Complexity (limited to 2 functions)</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#6-needless-repetition","title":"6. Needless Repetition","text":"<p>Definition: Code that could be unified through abstraction is duplicated in multiple places</p> <p>Symptom: DRY violation, \"Similar code in multiple places\"</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#inference-evidence-dry-analysis-missing-encapsulation","title":"Inference Evidence: DRY Analysis + Missing Encapsulation","text":"<p>Duplication within Helper file:</p> Duplicate Pattern Repetition Count Location <code>sh 'git fetch origin'</code> 2 <code>cloneOrUpdateRepo</code>, <code>mergeBranchIfNeeded</code> SSH command pattern 4 4 publish/clean functions SCP transfer pattern 4 4 publish functions Permission setting pattern 4 4 publish functions <p>Duplication between Helper files:</p> Duplicate GeneralHelper JsHelper <code>logMessage()</code> line 35-44 line 7-16 (exact copy) <p>Conclusion: Same patterns repeated without abstraction \u2192 High Needless Repetition</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#7-opacity","title":"7. Opacity","text":"<p>Definition: Code is difficult to understand and intent is unclear</p> <p>Symptom: \"What does this code do?\"</p>"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#code-review-results","title":"Code Review Results","text":"Type Location Problem Description Counter-intuitive variable name Line 66 <code>projectExists = sh(..., returnStatus: true)</code> 0 = exists, but variable named <code>projectExists</code> is counter-intuitive Function name mismatch Lines 5-27 <code>parseJson()</code> Named \"parse\" but actually returns fixed data Function name mismatch Line 189 <code>isBranchUpToDateWithMain(destinationBranch)</code> Named \"Main\" but parameter is <code>destinationBranch</code> Complex nesting Lines 70-107 3-level <code>if-else</code> nesting Difficult to trace condition flow Complex retry loop Line 537 <code>for</code> loop + <code>break</code>/<code>continue</code> Complex state management Magic string (regex) Line 307 <code>/[A-Za-z]+-[0-9]+/</code> Pattern meaning undocumented Complex pipe command Lines 117-120 <code>git remote show \\| grep \\| awk</code> Step-by-step operation unclear"},{"location":"problem-analysis/01-generalHelper/design-smells-symptoms/#severity-classification","title":"Severity Classification","text":"<p>High (Bug Risk): - Counter-intuitive variable name: <code>projectExists</code> where 0 = exists (line 66)</p> <p>Medium (Maintenance Difficulty): - Function name mismatch with actual behavior (<code>parseJson</code>, <code>isBranchUpToDateWithMain</code>) - Magic string regex - difficult to understand due to lack of documentation - Complex nested/retry logic (lines 70-107, 537)</p> <p>Low (Readability): - Pipe command complexity (lines 117-120)</p> <p>Conclusion: Counter-intuitive variable names + function name mismatch + complex logic \u2192 High Opacity</p> <p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/","title":"Software Smells","text":"<p>\u2190 SRP Analysis | Next: jsHelper \u2192</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#groovygeneralhelpergroovy-software-smells-analysis","title":"groovy/generalHelper.groovy - Software Smells Analysis","text":"<p>Level-based Classification: Code Smell (Function Level) \u2192 Design Smell (Module Level) \u2192 Architecture Smell (System Level)</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#summary","title":"Summary","text":"Level Category Smell Type Severity Code Change Preventers Divergent Change High Code Change Preventers Shotgun Surgery High Design Abstraction Multifaceted Abstraction High Design Abstraction Missing Abstraction Medium Design Encapsulation Missing Encapsulation Medium Design Modularization Insufficient Modularization High Design Modularization Hub-like Modularization Medium Architecture Dependency Issues Hub-like Dependency High Architecture Dependency Issues Implicit Cross-module Dependency High"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#1-code-smells-methodfunction-level","title":"1. Code Smells (Method/Function Level)","text":"<p>Source: Fowler, M. (1999). Refactoring: Improving the Design of Existing Code</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#11-change-preventers","title":"1.1 Change Preventers","text":"Divergent Change <p>Definition: A single class/file is frequently changed for several different reasons</p> <p>Divergent Change Cases in generalHelper.groovy:</p> Change Reason Affected Functions Example Situation Git policy change <code>cloneOrUpdateRepo</code>, <code>checkoutBranch</code>, <code>getDefaultBranch</code>, etc. (8) Branch strategy change, fetch policy change Bitbucket API change <code>getFullCommitHash</code>, <code>sendBuildStatus</code> API version upgrade, authentication method change SonarQube settings change <code>checkQualityGateStatus</code> Quality Gate condition change, API path change Web server structure change <code>publishTestResultsHtmlToWebServer</code>, etc. (4) Directory structure change, permission system change Jenkins environment change All functions Environment variable name change, plugin update Logging policy change <code>closeLogfiles</code>, logging-related functions Log format change, retention policy change <p>Severity Evidence: - Impact Scope: High - 5 pipeline files depend on this file - Bug Potential: Medium - Unexpected behavior may occur when modifying Git/Bitbucket/web server functions - Modification Cost: High - Architecture change required to separate 8 domains</p> Shotgun Surgery (Major Change Triggers) <p>Definition: A single external change requires modifications to multiple functions</p> <p>Severity Evidence: - Impact Scope: Low - 10 locations within the single generalHelper.groovy file need modification - Bug Potential: High - Missing even one location causes runtime error or pipeline failure - Modification Cost: Medium - Refactoring needed to extract Git commands as constants/configuration</p> Change Trigger Affected Functions Example Git CLI change <code>cloneOrUpdateRepo</code>, <code>checkoutBranch</code>, <code>getDefaultBranch</code>, <code>mergeBranchIfNeeded</code>, <code>isBranchUpToDateWithRemote</code>, <code>isBranchUpToDateWithMain</code>, <code>tryMerge</code>, <code>getCurrentCommitHash</code> (8) When <code>git fetch</code> -&gt; <code>git fetch --all</code> changes, 2 locations need modification: <code>cloneOrUpdateRepo</code>(line 85), <code>mergeBranchIfNeeded</code>(line 177) Web server path change <code>publishTestResultsHtmlToWebServer</code>, <code>publishBuildResultsToWebServer</code>, <code>cleanMergedBranchFromWebServer</code>, <code>publishGroovyDocToWebServer</code> (4) When <code>/var/www/html</code> -&gt; <code>/srv/www</code> changes, 8 total locations across 4 functions need modification Python script interface change <code>getFullCommitHash</code>, <code>sendBuildStatus</code> (2) When <code>get_bitbucket_commit_hash.py</code> argument order changes, <code>getFullCommitHash</code>(line 251) needs modification SonarQube API change <code>checkQualityGateStatus</code> (1) When API path <code>/api/ce/component</code> -&gt; <code>/api/v2/ce/component</code> changes, lines 529, 530 need modification SSH/SCP command structure change <code>publishTestResultsHtmlToWebServer</code>, <code>publishBuildResultsToWebServer</code>, <code>cleanMergedBranchFromWebServer</code>, <code>publishGroovyDocToWebServer</code> (4) When <code>-i</code> option -&gt; <code>--identity</code> changes, 10 total locations across 4 functions need modification Environment variable name change <code>publishTestResultsHtmlToWebServer</code>, <code>publishBuildResultsToWebServer</code>, <code>cleanMergedBranchFromWebServer</code>, <code>publishGroovyDocToWebServer</code> (4) When <code>env.SSH_KEY</code> -&gt; <code>env.SSH_PRIVATE_KEY</code> changes, 10 total locations across 4 functions need modification User account change <code>publishTestResultsHtmlToWebServer</code>, <code>publishBuildResultsToWebServer</code>, <code>publishGroovyDocToWebServer</code> (3) When <code>vconadmin:vconadmin</code> -&gt; <code>deployer:deployer</code> changes, 3 locations need modification"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#2-design-smells-modulefile-level","title":"2. Design Smells (Module/File Level)","text":""},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#21-symptoms-martin-2000","title":"2.1 Symptoms (Martin 2000)","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Detailed analysis inferred from static analysis results: design-smells-symptoms.md</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#22-principles-suryanarayana-2014","title":"2.2 Principles (Suryanarayana 2014)","text":"<p>Source: Suryanarayana, G. et al. (2014). Refactoring for Software Design Smells</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#abstraction-smells","title":"Abstraction Smells","text":"Multifaceted Abstraction <p>Definition: A single abstraction (class/file) expresses multiple concerns</p> <p>8 Domains in generalHelper.groovy: - Git, Bitbucket, Deployment, SonarQube, File System, Logging, Jenkins Configuration, Parsing</p> <p>Related Symptom: Divergent Change (changed for multiple reasons due to multiple domains: Git/Bitbucket/SonarQube, etc.)</p> Missing Abstraction <p>Definition: Concepts are implemented with primitive types or strings instead of dedicated classes/constants</p> <p>Missing Abstraction Cases in generalHelper.groovy:</p> Concept Needing Abstraction Current State Affected Functions Web server path <code>\"/var/www/html\"</code> string repeated 4 publish/clean functions SSH connection info <code>env.SSH_KEY</code>, <code>env.DLX_WEB_HOST_URL</code> scattered 4 publish/clean functions User account <code>\"vconadmin:vconadmin\"</code> hardcoded 3 publish functions SonarQube URL <code>\"localhost:9000/sonarqube\"</code> hardcoded <code>checkQualityGateStatus</code> Git command options <code>\"--hard\"</code>, <code>\"-fd\"</code>, etc. scattered 8 Git functions"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#encapsulation-smells","title":"Encapsulation Smells","text":"Missing Encapsulation <p>Definition: Variations are not encapsulated, causing logic to be scattered</p> <p>Missing Encapsulation Cases in generalHelper.groovy:</p> Variation Needing Encapsulation Current State Affected Functions Git fetch execution <code>sh 'git fetch origin'</code> repeated in 2 places <code>cloneOrUpdateRepo</code>, <code>mergeBranchIfNeeded</code> SSH command execution <code>sh \"ssh -i ${env.SSH_KEY} ${env.DLX_WEB_HOST_URL} ...\"</code> repeated in 4 places 4 publish/clean functions SCP file transfer <code>sh \"scp -i ${env.SSH_KEY} ...\"</code> repeated in 4 places 4 publish functions Directory permission setting <code>chmod 755</code>, <code>chown vconadmin:vconadmin</code> scattered 4 publish functions <p>Related Symptom: Shotgun Surgery (not encapsulated -&gt; variations scattered -&gt; simultaneous modification required)</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#modularization-smells","title":"Modularization Smells","text":"Insufficient Modularization <p>Definition: A module (class/file) is too large or complex and should be further decomposed (God Class)</p> <p>Evidence of Insufficient Modularization in generalHelper.groovy:</p> Metric Value Standard File size 656 lines Generally 200-300 lines recommended Function count 21 5-7 recommended based on single responsibility Domain count 8 Single Responsibility Principle violation Actor count 6 All teams depend on it <p>Modules Needing Separation (8 domains): - GitHelper (8): <code>cloneOrUpdateRepo</code>, <code>getDefaultBranch</code>, <code>checkoutBranch</code>, <code>mergeBranchIfNeeded</code>, <code>isBranchUpToDateWithRemote</code>, <code>isBranchUpToDateWithMain</code>, <code>tryMerge</code>, <code>getCurrentCommitHash</code> - BitbucketHelper (2): <code>getFullCommitHash</code>, <code>sendBuildStatus</code> - WebServerHelper (4): <code>publishTestResultsHtmlToWebServer</code>, <code>publishBuildResultsToWebServer</code>, <code>cleanMergedBranchFromWebServer</code>, <code>publishGroovyDocToWebServer</code> - SonarQubeHelper (1): <code>checkQualityGateStatus</code> - FileSystemHelper (2): <code>cleanUpPRBranch</code>, <code>closeLogfiles</code> - LoggingHelper (1): <code>logMessage</code> - JenkinsHelper (1): <code>initializeEnvironment</code> - ParsingHelper (2): <code>parseJson</code>, <code>parseTicketNumber</code></p> Hub-like Modularization <p>Definition: A single abstraction (class/file) has too many dependencies with other abstractions</p> <p>Evidence of Hub-like Modularization in generalHelper.groovy: - 5 pipeline files <code>load()</code> this file - Many of the 21 functions are called from external sources</p> <p>Related Symptom: Hub-like Dependency (many places depend on it -&gt; central hub role)</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#3-architecture-smells-system-level","title":"3. Architecture Smells (System Level)","text":"<p>Source: Garcia et al. (2009), Lippert &amp; Roock (2006), Sharma &amp; Spinellis (2018)</p>"},{"location":"problem-analysis/01-generalHelper/software-smells-analysis/#31-dependency-issues","title":"3.1 Dependency Issues","text":"Hub-like Dependency <p>Definition: Too many dependencies are concentrated on a single component</p> <p>Severity Evidence: - Impact Scope: High - 5 pipeline files directly load this file - Bug Potential: Medium - Unexpected behavior when multiple teams modify simultaneously (merge conflicts, regression bugs) - Modification Cost: High - Architecture change required for domain-specific Helper separation</p> Implicit Cross-module Dependency (Major External Dependencies) <p>Definition: Hidden dependencies cause coupling to external systems without explicit interfaces</p> <p>Severity Evidence: - Impact Scope: High - Affects generalHelper.groovy + 5 dependent pipeline files - Bug Potential: High - Runtime errors when external systems (Python/SonarQube/SSH/Git) change (not detectable at compile time) - Modification Cost: Medium - Refactoring needed such as adding Adapter/Wrapper per external system</p> External System Calling Function Implicit Contract Content Python scripts <code>getFullCommitHash</code>, <code>sendBuildStatus</code> Script path + argument format + return value format SonarQube REST API <code>checkQualityGateStatus</code> API URL + response JSON structure Web server file system <code>publishTestResultsHtmlToWebServer</code>, <code>publishBuildResultsToWebServer</code>, <code>cleanMergedBranchFromWebServer</code>, <code>publishGroovyDocToWebServer</code> Remote directory structure + permission system Git CLI output <code>getDefaultBranch</code>, <code>checkoutBranch</code>, <code>isBranchUpToDateWithRemote</code>, etc. Command output format parsing (e.g., <code>git remote show origin</code>) Linux command output <code>closeLogfiles</code>, <code>cleanUpPRBranch</code> <code>lsof</code>, <code>ps</code>, <code>find</code> output format parsing Jenkins Pipeline DSL All functions Implicit dependency on <code>env.*</code>, <code>sh()</code>, <code>dir()</code>, <code>fileExists()</code>, etc. <p>\u2190 SRP Analysis | Next: jsHelper \u2192</p>"},{"location":"problem-analysis/01-generalHelper/srp-violation-analysis/","title":"SRP Violations","text":"<p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/01-generalHelper/srp-violation-analysis/#groovygeneralhelpergroovy-srp-violation-analysis","title":"groovy/generalHelper.groovy - SRP Violation Analysis","text":"<p>\"Kitchen Sink\" File - Actual cohesion only 19% compared to design intent (common function collection) (656 lines)</p>"},{"location":"problem-analysis/01-generalHelper/srp-violation-analysis/#1-srp-violation-analysis-criteria","title":"1. SRP Violation Analysis Criteria","text":"<ul> <li>generalHelper Design Intent: Since Unity Helper and JS Helper exist separately, generalHelper is designed to \"collect only functions commonly used across all pipelines\"</li> <li>Cohesion Analysis Criteria: \"Is it actually used in all pipelines?\" = Cohesion aligned with design intent</li> </ul>"},{"location":"problem-analysis/01-generalHelper/srp-violation-analysis/#2-cohesion-and-change-reasons-per-function","title":"2. Cohesion and Change Reasons per Function","text":"# Function Name DLX CI DLX CD JS CI JS CD Pipeline Change Reason 1 <code>parseJson</code> \u25cb \u25cb \u25cb \u25cb \u25cb When Jenkins build/stage result constants are added/changed 2 <code>logMessage</code> When logging output format/style changes (internal use) 3 <code>cloneOrUpdateRepo</code> \u25cb \u2717 \u25cb \u2717 \u25cb When Git CLI commands, repository cleanup policies change 4 <code>getDefaultBranch</code> \u25cb \u2717 \u25cb \u2717 \u25cb When Git remote command output format changes 5 <code>initializeEnvironment</code> \u25cb \u2717 \u25cb \u2717 \u2717 2 reasons: Environment variable setup + Bitbucket status API 6 <code>checkoutBranch</code> \u25cb \u25cb \u25cb \u25cb \u25cb When Git checkout/reset/clean workflow changes 7 <code>mergeBranchIfNeeded</code> \u25cb \u2717 \u25cb \u2717 \u2717 When Git merge strategy/workflow changes 8 <code>isBranchUpToDateWithRemote</code> When Git fetch/rev-parse commands change (internal use) 9 <code>isBranchUpToDateWithMain</code> When Git merge-base command changes (internal use) 10 <code>tryMerge</code> \u25cb \u2717 \u25cb \u2717 \u2717 When Git merge command/options change 11 <code>getFullCommitHash</code> \u25cb \u25cb \u25cb \u25cb \u25cb When Bitbucket API (Python script) interface changes 12 <code>getCurrentCommitHash</code> When Git rev-parse command changes (Dead Code) 13 <code>sendBuildStatus</code> \u25cb \u25cb \u25cb \u25cb \u25cb When Bitbucket build status API spec changes 14 <code>parseTicketNumber</code> \u25cb \u2717 \u25cb \u2717 \u2717 When branch naming convention (ticket pattern) changes 15 <code>publishTestResultsHtmlToWebServer</code> \u25cb \u2717 \u25cb \u2717 \u2717 When web server path/permission policy, SSH settings change 16 <code>publishBuildResultsToWebServer</code> \u25cb \u2717 \u25cb \u2717 \u2717 When web server deployment path structure changes 17 <code>cleanMergedBranchFromWebServer</code> \u2717 \u25cb \u2717 \u25cb \u2717 When web server cleanup path policy changes 18 <code>cleanUpPRBranch</code> \u2717 \u25cb \u2717 \u25cb \u2717 2 reasons: Directory cleanup + Linux package management 19 <code>closeLogfiles</code> When lsof output format, process termination method changes (Dead Code) 20 <code>checkQualityGateStatus</code> \u25cb \u2717 \u25cb \u2717 \u2717 5 reasons: SonarQube API + Retry + HTTP + JSON + Logging 21 <code>publishGroovyDocToWebServer</code> \u2717 \u2717 \u2717 \u2717 \u25cb When GroovyDoc deployment path/permission policy changes"},{"location":"problem-analysis/01-generalHelper/srp-violation-analysis/#3-module-level-srp-violation-analysis-cohesion-analysis-results","title":"3. Module Level SRP Violation Analysis - Cohesion Analysis Results","text":"<ul> <li>100% Usage (4): <code>parseJson</code>, <code>checkoutBranch</code>, <code>getFullCommitHash</code>, <code>sendBuildStatus</code></li> <li>60% Usage (2): <code>cloneOrUpdateRepo</code>, <code>getDefaultBranch</code></li> <li>40% Usage (10): CI-only or CD-only functions</li> <li>20% Usage (1): <code>publishGroovyDocToWebServer</code> (Pipeline only)</li> <li>Dead Code (2): <code>getCurrentCommitHash</code>, <code>closeLogfiles</code></li> <li>Internal Use (3): <code>logMessage</code>, <code>isBranchUpToDateWithRemote</code>, <code>isBranchUpToDateWithMain</code></li> </ul> <p>SRP Violation: Contrary to the design intent of \"common function collection\", only 4 out of 21 functions (19%) are 100% reused. The remaining 81% are used only in specific pipelines.</p>"},{"location":"problem-analysis/01-generalHelper/srp-violation-analysis/#4-function-level-srp-violation-analysis-functions-with-multiple-change-reasons","title":"4. Function Level SRP Violation Analysis - Functions with Multiple Change Reasons","text":"Multi-responsibility Function: <code>initializeEnvironment()</code> (2 change reasons) <pre><code>void initializeEnvironment(String workspace, String commitHash, String prBranch) {\n    echo \"Sending 'In Progress' status to Bitbucket...\"\n    sendBuildStatus(workspace, 'INPROGRESS', commitHash)  // Change reason 1: Bitbucket status API\n    env.TICKET_NUMBER = parseTicketNumber(prBranch)       // Change reason 2: Environment variable setup\n    env.FOLDER_NAME = \"${JOB_NAME}\".split('/').first()\n}\n</code></pre> <p>Change Reason Analysis: 1. When Bitbucket status API changes (line 137): <code>sendBuildStatus()</code> call method 2. When environment variable setup method changes (lines 138-139): <code>TICKET_NUMBER</code>, <code>FOLDER_NAME</code> setup</p> Multi-responsibility Function: <code>cleanUpPRBranch()</code> (2 change reasons) <pre><code>void cleanUpPRBranch(String prBranch) {\n    // Change reason 1: find tool installation (Linux package management)\n    def findPath = sh(script: 'command -v find', returnStdout: true).trim()\n    if (!findPath) {\n        echo \"'find' directory searching tool is not found...\"\n        echo \"Installing 'find' directory searching tool...\"\n        int installStatus = sh(script: 'sudo apt-get update &amp;&amp; sudo apt-get install -y findutils', returnStatus: true)\n        if (installStatus == 0 ) {\n            echo \"The 'findutils' package was installed successfully.\"\n        } else {\n            echo \"Failed to install 'findutils'. Exit code: ${installStatus}\"\n            error \"Installation failed with exit code: ${installStatus}\"\n        }\n    }\n\n    // Change reason 2: Directory cleanup policy\n    def branchPaths = sh(script: \"${findPath} ../ -type d -name \\\"${prBranch}\\\"\", returnStdout: true).trim()\n    if (!branchPaths.isEmpty()) {\n        def paths = branchPaths.split('\\n')\n        paths.each { branchPath -&gt;\n            echo \"Deleting Branch Path: ${branchPath}\"\n            sh(script: \"rm -r -f \\\"${branchPath}\\\"\", returnStatus: true)\n            // ...\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When Linux package management method changes (lines 403-414): <code>apt-get</code> -&gt; other package manager 2. When directory cleanup policy changes (lines 417-442): Search path, deletion conditions</p> Multi-responsibility Function: <code>checkQualityGateStatus()</code> (5 change reasons) <pre><code>Map checkQualityGateStatus(String projectKey, String adminToken) {\n    // Change reason 1: SonarQube API URL\n    String buildStatusURL = \"http://localhost:9000/sonarqube/api/ce/component?component=${projectKey}\"\n    String qualityGateResultURL = \"http://localhost:9000/sonarqube/api/qualitygates/project_status?projectKey=${projectKey}\"\n\n    // Change reason 2: Retry policy\n    int maxRetries = 5\n\n    for (int retryCount = 1; retryCount &lt;= maxRetries; retryCount++) {\n        // Change reason 3: HTTP client (using curl)\n        def process = buildStatusAPIcall.execute()\n        process.waitFor()\n\n        // Change reason 4: JSON parsing + business logic\n        def buildStatus = new JsonSlurperClassic().parseText(buildStatusResponse)\n        if (buildStatus?.queue?.size() &gt; 0) {\n            sleep(10)  // Change reason 2: Wait time\n            continue\n        }\n\n        // Change reason 5: Logging (10+ locations)\n        logMessage(\"Send an HTTP GET request to SonarQube Server...\")\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When SonarQube API URL changes (lines 529-530): API path, port, host 2. When retry policy changes (lines 533, 568): Retry count, wait time 3. When HTTP client changes (lines 534, 542, 581, 586): curl -&gt; HttpClient, etc. 4. When JSON response structure changes (lines 553, 560, 577, 597, 604): Parsing logic 5. When logging format changes (10+ locations): Log message format</p> <p>Additional Code Smell: Long Method (94 lines)</p>"},{"location":"problem-analysis/01-generalHelper/srp-violation-analysis/#conclusion","title":"Conclusion","text":"<p>SRP Violation: - Module Level: Only 19% of functions are 100% reused compared to \"common function collection\" design intent - Function Level: 3 functions have multiple change reasons (<code>initializeEnvironment</code>(2), <code>cleanUpPRBranch</code>(2), <code>checkQualityGateStatus</code>(5)) - 2 Dead Code functions found - \"Kitchen Sink\" Anti-pattern</p> <p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/","title":"Design Smells","text":"<p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#groovyjshelpergroovy-design-smells-symptoms-analysis","title":"groovy/jsHelper.groovy - Design Smells Symptoms Analysis","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Symptoms analysis based on static analysis results (SRP, Software Smells, DRY) + code review</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#summary","title":"Summary","text":"Symptom Severity Main Evidence Rigidity Medium Shotgun Surgery (npm commands/testingDirs change requires 3 location modifications) Fragility Medium 5 domains mixed, 5 implicit dependencies Immobility Medium 356 lines/10 functions/5 domains, 2 pipelines depend Viscosity Medium Missing Encapsulation \u2192 testingDirs parsing copy is easier Needless Complexity Low N/A (no Dead Code) Needless Repetition Medium DRY violation (<code>logMessage</code> copy, testingDirs parsing 3 times) Opacity Medium Incomplete implementation, counter-intuitive return values/function names, comma-separated strings"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#inference-evidence","title":"Inference Evidence","text":"Symptom Evidence Source Rigidity Shotgun Surgery npm commands/testingDirs change requires 3 location modifications Code Smells Fragility Divergent Change 5 domains + Implicit Dependency 5 Code Smells + Arch Smells Immobility Insufficient Modularization 356 lines/10 functions/5 domains Design Smells Viscosity Missing Encapsulation testingDirs parsing not encapsulated \u2192 copying is easier Design Smells Needless Complexity N/A - Needless Repetition DRY Violation <code>logMessage()</code> copy + Duplicated Code testingDirs parsing 3 times DRY Analysis + Code Smells Opacity Direct code review Code Review"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#1-rigidity","title":"1. Rigidity","text":"<p>Definition: Changing one place requires cascading changes to other places</p> <p>Symptom: \"I thought it was a simple change, but it turned out to be much more complex\"</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#inference-evidence-shotgun-surgery","title":"Inference Evidence: Shotgun Surgery","text":"Change Trigger Functions Needing Modification Number of Locations npm command structure change <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code> 3 testingDirs format change Same 3 functions 3 Directory validation change <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code> 2 <p>Conclusion: Changing npm command structure requires simultaneous modification of 3 functions \u2192 Medium Rigidity</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#2-fragility","title":"2. Fragility","text":"<p>Definition: Modifying one place breaks conceptually unrelated places</p> <p>Symptom: \"I touched this, why did that break?\"</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#inference-evidence-divergent-change-implicit-cross-module-dependency","title":"Inference Evidence: Divergent Change + Implicit Cross-module Dependency","text":"<p>5 domains mixed in one file: - npm/Node, File System, Logging, OS/Shell, Utility</p> <p>5 implicit dependencies: - Python script, Node.js CLI, npm CLI, Linux find command, Jenkins Pipeline DSL</p> <p>Potential Fragility Scenarios:</p> Change Expected Impact Actual Impact (Inferred) npm audit output format change <code>installNpmInTestingDirs</code> Python script call fails Jest report filename change <code>runUnitTestsInTestingDirs</code> <code>retrieveReportSummaryDirs</code> search fails Node version output format change <code>checkNodeVersion</code> Version parsing fails <p>Conclusion: Domains mixed without boundaries \u2192 unexpected impact on changes possible \u2192 Medium Fragility</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#3-immobility","title":"3. Immobility","text":"<p>Definition: Difficult to extract useful parts for reuse in other systems/modules</p> <p>Symptom: \"Trying to separate it brings too many dependencies along\"</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#inference-evidence-insufficient-modularization","title":"Inference Evidence: Insufficient Modularization","text":"<p>Problems when attempting separation:</p> Extraction Target Functions Dependencies That Follow NpmHelper 5 functions Jenkins DSL (<code>sh</code>, <code>env</code>, <code>echo</code>), <code>logMessage</code>, Python script path VersionHelper 1 function Pure function (few dependencies) FileSystemHelper 2 functions Jenkins DSL, <code>find</code> command <p>Reuse Cost Analysis:</p> <pre><code>Separation Cost = Function extraction + Dependency resolution + Test modification + 2 pipeline modifications\nRewrite Cost = Write from scratch\n\nSeparation Cost \u2248 Rewrite Cost \u2192 Medium Immobility\n</code></pre> <p>Conclusion: 356 lines, 10 functions, 5 domains mixed \u2192 smaller scale than generalHelper but similar pattern \u2192 Medium Immobility</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#4-viscosity","title":"4. Viscosity","text":"<p>Definition: The right approach (maintaining design) is harder than the wrong approach (hacking)</p> <p>Symptom: \"Doing it properly takes too long, let's just do it this way for now\"</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#inference-evidence-missing-encapsulation-dry-violation-induced","title":"Inference Evidence: Missing Encapsulation \u2192 DRY Violation Induced","text":"<p>Current State (Missing Encapsulation): - <code>testingDirs.split(',') as List&lt;String&gt;</code> - repeated 3 times (lines 70, 138, 222) - <code>if (testingDirs == null || testingDirs.isEmpty())</code> - repeated 3 times</p> <p>Right Approach vs Hack:</p> Situation Right Approach Hack Tendency Using testingDirs in new function Create parsing helper function then use Copy-paste from existing function Copy (faster) Adding npm command Create npm helper function then use Call <code>sh 'npm ...'</code> directly Direct call (faster) <p>Conclusion: Lack of encapsulation creates \"copying is easier\" structure \u2192 Medium Viscosity</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#5-needless-complexity","title":"5. Needless Complexity","text":"<p>Definition: Over-engineering for features not currently needed</p> <p>Symptom: YAGNI violation, \"I might need this later\"</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#inference-evidence-dead-code","title":"Inference Evidence: Dead Code","text":"<p>Dead Code found in SRP Analysis: None</p> <p>Conclusion: No Dead Code \u2192 Low Needless Complexity</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#6-needless-repetition","title":"6. Needless Repetition","text":"<p>Definition: Code that could be unified through abstraction is duplicated in multiple places</p> <p>Symptom: DRY violation, \"Similar code in multiple places\"</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#inference-evidence-dry-analysis-duplicated-code","title":"Inference Evidence: DRY Analysis + Duplicated Code","text":"<p>Duplication between Helper files:</p> Duplicate GeneralHelper JsHelper <code>logMessage()</code> line 35-44 line 7-16 (exact copy) <p>Duplication within Helper file:</p> Duplicate Pattern Repetition Count Location testingDirs null/empty check 3 lines 65-68, 130-134, 214-218 testingDirs parsing 3 lines 70, 138, 222 Directory existence check 2 lines 73-76, 142-145 <p>Conclusion: Same patterns repeated without abstraction \u2192 Medium Needless Repetition</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#7-opacity","title":"7. Opacity","text":"<p>Definition: Code is difficult to understand and intent is unclear</p> <p>Symptom: \"What does this code do?\"</p>"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#code-review-results","title":"Code Review Results","text":"Type Location Problem Description Comma-separated string Lines 64, 129, 213 <code>testingDirs: String</code> Type is String but actually a comma-separated list Counter-intuitive return value Line 82 <code>exitCode</code> Continues even if npm audit fails (only outputs warning) Function name-message mismatch Line 157 <code>echo \"npx jest failed...\"</code> Actually calls <code>npm run test</code> but mentions \"jest\" Incomplete implementation Line 199 Windows <code>bat()</code> call <code>workingDir</code> parameter unused Counter-intuitive function name Line 275 <code>versionCompare</code> return value <code>true</code> = \"project version is newer\" but mismatches function name"},{"location":"problem-analysis/02-jsHelper/design-smells-symptoms/#severity-classification","title":"Severity Classification","text":"<p>High (Bug Risk): - Incomplete implementation: <code>workingDir</code> parameter ignored in Windows <code>bat()</code> call (line 199)</p> <p>Medium (Maintenance Difficulty): - <code>testingDirs</code> comma-separated string (intent unclear from type) (lines 64, 129, 213) - Function name-message mismatch: calls <code>npm run test</code> but mentions \"jest\" (line 157) - Counter-intuitive function name: <code>versionCompare</code> return value meaning unclear (line 275) - Counter-intuitive return value: continues even if npm audit fails (line 82)</p> <p>Conclusion: Incomplete implementation + counter-intuitive return values/function names \u2192 Medium Opacity</p> <p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/","title":"Software Smells","text":"<p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#groovyjshelpergroovy-software-smells-analysis","title":"groovy/jsHelper.groovy - Software Smells Analysis","text":"<p>Level-based Classification: Code Smell (Function Level) \u2192 Design Smell (Module Level) \u2192 Architecture Smell (System Level)</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#summary","title":"Summary","text":"Level Category Smell Type Severity Code Change Preventers Divergent Change Medium Code Change Preventers Shotgun Surgery Medium Code Dispensables Duplicated Code Medium Code Bloaters Primitive Obsession Low Code Bloaters Long Method Low Design Abstraction Multifaceted Abstraction Medium Design Abstraction Missing Abstraction Medium Design Encapsulation Missing Encapsulation Medium Design Modularization Insufficient Modularization Medium Architecture Dependency Issues Implicit Cross-module Dependency Medium"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#1-code-smells-methodfunction-level","title":"1. Code Smells (Method/Function Level)","text":"<p>Source: Fowler, M. (1999). Refactoring: Improving the Design of Existing Code</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#11-change-preventers","title":"1.1 Change Preventers","text":"Divergent Change (5 change reasons) <p>Definition: A single class is frequently changed for several different reasons</p> Change Reason Affected Functions Example Situation npm command change <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code> npm \u2192 yarn change Python script change <code>installNpmInTestingDirs</code> <code>npm_audit.py</code> argument format change Jest configuration change <code>runUnitTestsInTestingDirs</code>, <code>retrieveReportSummaryDirs</code> Report filename change Node version check change <code>checkNodeVersion</code> nvm introduction Version comparison logic change <code>versionCompare</code> Prerelease version support <p>Severity Evidence: - Impact Scope: Medium - 2 pipeline files depend on this file (JsJenkins/Jenkinsfile, JsJenkins/JenkinsfileDeployment) - Bug Potential: Medium - Unexpected behavior may occur when modifying npm-related functions - Modification Cost: Medium - Refactoring needed to separate 5 domains</p> Shotgun Surgery (up to 3 functions require simultaneous modification) <p>Definition: A single change requires modifications to multiple classes/functions</p> Change Trigger Affected Functions Locations Needing Modification npm command structure change <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code> 3 functions testingDirs format change <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code> 3 functions Directory validation change <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code> 2 functions <p>Severity Evidence: - Impact Scope: Low - 3 locations within the single jsHelper.groovy file need modification (lines 70, 138, 222) - Bug Potential: High - Missing even one of 3 testingDirs parsing logic locations causes runtime error - Modification Cost: Low - Simple fix by extracting testingDirs parsing to a separate function</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#12-dispensables","title":"1.2 Dispensables","text":"Duplicated Code (external + internal duplication) <p>External Duplication (with generalHelper.groovy): - <code>logMessage()</code>: Identical code (lines 7-16) - duplicate with generalHelper.groovy lines 35-44</p> <p>Internal Duplication Patterns:</p> Duplicate Pattern Line Numbers Functions testingDirs null/empty check 65-68, 130-134, 214-218 3 functions testingDirs parsing 70, 138, 222 3 functions Directory existence check 73-76, 142-145 2 functions <p>Severity Evidence: - Impact Scope: Medium - Affects 2 files: jsHelper.groovy + generalHelper.groovy - Bug Potential: Medium - Modifying logMessage() in only one place causes unexpected behavior - Modification Cost: Low - Simple fix by extracting to shared module</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#13-bloaters","title":"1.3 Bloaters","text":"Primitive Obsession <p>Definition: Using primitive types instead of objects</p> Case Current State Problem Improvement Direction testingDirs parameter <code>String</code> (comma-separated) Parsing logic repeated 3 times <code>List&lt;String&gt;</code> Version string <code>String</code> (\"1.0.0\") Complex comparison logic Version object <p>Severity Evidence: - Impact Scope: Low - Only affects functions within the single jsHelper.groovy file - Bug Potential: Low - No current operational issues, maintenance inconvenience level - Modification Cost: Low - Simple fix by type change</p> Long Method Function Line Count Responsibility Count Needs Separation <code>installNpmInTestingDirs()</code> 52 lines (64-116) 3 (audit, Python script, npm install) O <code>versionCompare()</code> 44 lines (275-319) 1 X <p>Severity Evidence: - Impact Scope: Low - Only affects <code>installNpmInTestingDirs</code> function within the single jsHelper.groovy file - Bug Potential: Medium - 3 responsibilities mixed in 52 lines may cause unexpected behavior - Modification Cost: Low - Simple fix by separating audit, Python call, npm install into separate functions</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#2-design-smells-modulefile-level","title":"2. Design Smells (Module/File Level)","text":""},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#21-symptoms-martin-2000","title":"2.1 Symptoms (Martin 2000)","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Detailed analysis inferred from static analysis results: design-smells-symptoms.md</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#22-principles-suryanarayana-2014","title":"2.2 Principles (Suryanarayana 2014)","text":"<p>Source: Suryanarayana, G. et al. (2014). Refactoring for Software Design Smells</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#abstraction-smells","title":"Abstraction Smells","text":"Multifaceted Abstraction <p>Definition: A single abstraction (class/file) expresses multiple concerns (SRP violation)</p> <p>5 Domains in jsHelper.groovy: - npm/Node: <code>getPackageJsonVersion</code>, <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>checkNodeVersion</code>, <code>executeLintingInTestingDirs</code> - File System: <code>findTestingDirs</code>, <code>retrieveReportSummaryDirs</code> - Logging: <code>logMessage</code> - OS/Shell: <code>runCommandReturnStatus</code> - Utility: <code>versionCompare</code></p> <p>\u2192 Related Symptom: Divergent Change (changed for multiple reasons due to multiple domains: npm/file system/version, etc.)</p> Missing Abstraction <p>Definition: Concepts are implemented with primitive types or strings instead of dedicated classes/constants</p> Concept Needing Abstraction Current State Line Numbers Affected Functions npm commands <code>\"npm audit\"</code>, <code>\"npm install\"</code>, <code>\"npm run test\"</code>, <code>\"npm run lint\"</code> hardcoded 80, 108, 151, 232 <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code> Python script path <code>\"${WORKSPACE}/python/npm_audit.py\"</code> hardcoded 94 <code>installNpmInTestingDirs</code> Filename constants <code>\"package.json\"</code>, <code>\"audit-report.json\"</code> hardcoded 30, 80, 88 <code>findTestingDirs</code>, <code>installNpmInTestingDirs</code> <p>\u2192 Related Symptom: Primitive Obsession (concepts expressed with primitive types/strings)</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#encapsulation-smells","title":"Encapsulation Smells","text":"Missing Encapsulation <p>Definition: Variations are not encapsulated, causing logic to be scattered</p> Variation Needing Encapsulation Current State Line Numbers Affected Functions Directory existence check <code>new File(dirPath); if (!dir.exists() \\|\\| !dir.isDirectory())</code> 73-76, 142-145 <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code> testingDirs parsing <code>testingDirs.split(',') as List&lt;String&gt;</code> 70, 138, 222 <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code> null/empty check <code>if (testingDirs == null \\|\\| testingDirs.isEmpty())</code> 65-68, 130-134, 214-218 <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code> <p>\u2192 Related Symptoms: - Shotgun Surgery (not encapsulated \u2192 variations scattered \u2192 simultaneous modification required) - Duplicated Code (same patterns repeated without encapsulation)</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#modularization-smells","title":"Modularization Smells","text":"Insufficient Modularization <p>Definition: A module (class/file) is too large or complex and should be further decomposed</p> <p>Evidence of Insufficient Modularization in jsHelper.groovy:</p> Metric Value Standard File size 356 lines Generally 200-300 lines recommended Function count 10 5-7 recommended based on single responsibility Domain count 5 Single Responsibility Principle violation Actor count 3 Multiple teams depend on it <p>Modules Needing Separation (5 domains): - NpmHelper (5): <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code>, <code>checkNodeVersion</code>, <code>getPackageJsonVersion</code> - FileSystemHelper (2): <code>findTestingDirs</code>, <code>retrieveReportSummaryDirs</code> - VersionHelper (1): <code>versionCompare</code> - OsHelper (1): <code>runCommandReturnStatus</code> - LoggingHelper: <code>logMessage</code> \u2192 duplicate with generalHelper, needs separation to shared module</p> <p>Severity: Medium - Smaller scale than generalHelper but same pattern of insufficient modularization</p> <p>\u2192 Related Symptom: Long Method (lack of modularization causes <code>installNpmInTestingDirs</code> to be 52 lines)</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#3-architecture-smells-system-level","title":"3. Architecture Smells (System Level)","text":"<p>Source: Garcia et al. (2009), Lippert &amp; Roock (2006), Sharma &amp; Spinellis (2018)</p>"},{"location":"problem-analysis/02-jsHelper/software-smells-analysis/#31-dependency-issues","title":"3.1 Dependency Issues","text":"Implicit Cross-module Dependency <p>Definition: Hidden dependencies cause coupling to external systems without explicit interfaces</p> External System Calling Function Line Numbers Implicit Contract Content Python script <code>installNpmInTestingDirs</code> 94 <code>npm_audit.py</code> path + argument format (COMMIT_HASH, audit-report.json) Node.js CLI <code>getPackageJsonVersion</code>, <code>checkNodeVersion</code> 50, 174-176 <code>node -p</code>, <code>node -v</code>, <code>npm -v</code> output format npm CLI <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>executeLintingInTestingDirs</code> 80, 108, 151, 232 Command options + exit code meaning Linux find command <code>retrieveReportSummaryDirs</code> 339, 345 <code>find -type f -name</code> output format Jenkins Pipeline DSL All functions - <code>WORKSPACE</code>, <code>COMMIT_HASH</code>, <code>sh()</code>, <code>echo()</code>, <code>isUnix()</code>, etc. <p>Severity Evidence: - Impact Scope: Medium - Affects jsHelper.groovy + 2 dependent pipeline files - Bug Potential: High - Runtime errors when external systems (Python/Node/npm/Linux find) change - Modification Cost: Medium - Refactoring needed such as adding Adapter/Wrapper per external system</p> <p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/02-jsHelper/srp-violation-analysis/","title":"SRP Violations","text":"<p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/02-jsHelper/srp-violation-analysis/#groovyjshelpergroovy-srp-violation-analysis","title":"groovy/jsHelper.groovy - SRP Violation Analysis","text":"<p>JS Pipeline Dedicated File - CI/CD dedicated functions mixed (100% cohesion 50%) (356 lines)</p>"},{"location":"problem-analysis/02-jsHelper/srp-violation-analysis/#1-srp-violation-analysis-criteria","title":"1. SRP Violation Analysis Criteria","text":"<ul> <li>jsHelper Design Intent: A file that collects functions dedicated to JS pipelines (CI/CD)</li> <li>Cohesion Analysis Criteria: \"Is it used in both JS CI and JS CD?\" = Cohesion aligned with design intent</li> </ul>"},{"location":"problem-analysis/02-jsHelper/srp-violation-analysis/#2-cohesion-and-change-reasons-per-function","title":"2. Cohesion and Change Reasons per Function","text":"# Function Name JS CI JS CD Change Reason 1 <code>logMessage</code> When logging output method changes (internal use, duplicate with generalHelper) 2 <code>findTestingDirs</code> \u25cb \u25cb When package.json based project structure changes 3 <code>getPackageJsonVersion</code> \u2717 \u25cb When package.json version field access method changes 4 <code>installNpmInTestingDirs</code> \u25cb \u25cb 3 reasons: npm install + npm audit + Python script 5 <code>runUnitTestsInTestingDirs</code> \u25cb \u25cb When npm test command/Jest configuration changes 6 <code>checkNodeVersion</code> \u25cb \u25cb When Node/npm version check command changes 7 <code>runCommandReturnStatus</code> When OS-specific command execution method changes (internal use) 8 <code>executeLintingInTestingDirs</code> \u25cb \u25cb When npm lint command/ESLint configuration changes 9 <code>versionCompare</code> \u2717 \u25cb When semantic version comparison logic changes 10 <code>retrieveReportSummaryDirs</code> \u25cb \u2717 When Jest report file path/naming convention changes"},{"location":"problem-analysis/02-jsHelper/srp-violation-analysis/#3-module-level-srp-violation-analysis-cohesion-analysis-results","title":"3. Module Level SRP Violation Analysis - Cohesion Analysis Results","text":"<ul> <li>100% Usage (5): <code>findTestingDirs</code>, <code>installNpmInTestingDirs</code>, <code>runUnitTestsInTestingDirs</code>, <code>checkNodeVersion</code>, <code>executeLintingInTestingDirs</code></li> <li>50% Usage (3): CD-only (<code>getPackageJsonVersion</code>, <code>versionCompare</code>), CI-only (<code>retrieveReportSummaryDirs</code>)</li> <li>Internal Use (2): <code>logMessage</code>, <code>runCommandReturnStatus</code></li> </ul> <p>SRP Violation: Meets design intent of JS-dedicated file, but CI-only/CD-only functions are mixed (low cohesion)</p>"},{"location":"problem-analysis/02-jsHelper/srp-violation-analysis/#4-function-level-srp-violation-analysis-functions-with-multiple-change-reasons","title":"4. Function Level SRP Violation Analysis - Functions with Multiple Change Reasons","text":"Multi-responsibility Function: <code>installNpmInTestingDirs()</code> (3 change reasons) <pre><code>void installNpmInTestingDirs(String testingDirs) {\n    if (testingDirs == null || testingDirs.isEmpty()) {\n        echo \"Testing directories don't exist.\"\n        return\n    }\n    List&lt;String&gt; testDirs = testingDirs.split(',') as List&lt;String&gt;\n    for (String dirPath : testDirs) {\n        File dir = new File(dirPath)\n        if (!dir.exists() || !dir.isDirectory()) {\n            echo \"Directory does not exist: ${dirPath}. Skipping...\"\n            continue\n        }\n\n        // Change reason 1: npm audit policy\n        String npmAuditCommand = \"cd '${dirPath}' &amp;&amp; npm audit --json &gt; audit-report.json\"\n        echo \"Running command: ${npmAuditCommand}\"\n        int exitCode = runCommandReturnStatus(npmAuditCommand)\n        if (exitCode != 0) {\n            echo \"npm audit failed in directory: ${dirPath} with exit code: ${exitCode}. Proceeding with caution.\"\n        }\n\n        // Change reason 2: Python script interface\n        File reportFile = new File(\"${dirPath}/audit-report.json\")\n        if (reportFile.exists()) {\n            String pythonCommand = \"\"\"python '${WORKSPACE}/python/npm_audit.py'\n            '${COMMIT_HASH}' '${dirPath}/audit-report.json'\n            \"\"\"\n            exitCode = sh(script: pythonCommand, returnStatus: true)\n            // ...\n        }\n\n        // Change reason 3: npm install command\n        String npmCommand = \"cd '${dirPath}' &amp;&amp; npm install\"\n        exitCode = runCommandReturnStatus(npmCommand)\n        // ...\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When npm audit policy changes (lines 80-85): audit command, options, report format 2. When Python script interface changes (lines 93-102): <code>npm_audit.py</code> argument format 3. When npm install command changes (lines 107-113): install options, error handling</p>"},{"location":"problem-analysis/02-jsHelper/srp-violation-analysis/#conclusion","title":"Conclusion","text":"<p>SRP Violation: - Module Level: JS-dedicated but CI/CD-specific functions mixed (100% usage 50%, 50% usage 30%) - Function Level: 1 function has multiple change reasons (<code>installNpmInTestingDirs</code>(3)) - <code>logMessage()</code> is an exact copy of generalHelper (DRY violation)</p> <p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/","title":"Design Smells","text":"<p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#groovyunityhelpergroovy-design-smells-symptoms-analysis","title":"groovy/unityHelper.groovy - Design Smells Symptoms Analysis","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Symptoms analysis based on static analysis results (SRP, Software Smells, DRY) + code review</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#summary","title":"Summary","text":"Symptom Severity Main Evidence Rigidity High Shotgun Surgery (7 locations when adding new Stage) Fragility Medium 4 domains mixed, 6 implicit dependencies Immobility Medium 357 lines/8 functions/4 domains, 2 pipelines depend Viscosity High Missing Encapsulation \u2192 Stage logic copying is easier Needless Complexity Low N/A (no Dead Code) Needless Repetition High Stage-specific conditional branches in 7 locations Opacity Medium Complex nested conditions, complex Map/JSON structures"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#inference-evidence","title":"Inference Evidence","text":"Symptom Evidence Source Rigidity Shotgun Surgery 7 locations when adding new Stage Code Smells Fragility Divergent Change 4 domains + Implicit Dependency 6 Code Smells + Arch Smells Immobility Multifaceted Abstraction 357 lines/8 functions/4 domains Design Smells Viscosity Missing Encapsulation Stage-specific conditions not encapsulated \u2192 copying is easier Design Smells Needless Complexity N/A - Needless Repetition Switch Statements same branch pattern repeated in 7 locations Code Smells Opacity Direct code review Code Review"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#1-rigidity","title":"1. Rigidity","text":"<p>Definition: Changing one place requires cascading changes to other places</p> <p>Symptom: \"I thought it was a simple change, but it turned out to be much more complex\"</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#inference-evidence-shotgun-surgery","title":"Inference Evidence: Shotgun Surgery","text":"<p>Locations needing modification when adding new Stage \"Android\":</p> Modification Location Line Numbers Change Content Stage constant definition 6-10 Add <code>this.ANDROID = 'Android'</code> <code>setLogFilePathAndUrl</code> mapping 139-160 Add <code>(ANDROID): [path: ..., url: ...]</code> <code>getTestRunArgs</code> condition 209 Decide whether to include Android <code>getCodeCoverageArguments</code> condition 212 Decide whether to include Android <code>getAdditionalArgs</code> mapping 192-196 Add <code>Android: '...'</code> Command assembly branch 220-226 Add else if Graphics/quit options 229-233 Add Android condition <p>Conclusion: Adding just one new Stage requires simultaneous modification of 7 locations \u2192 High Rigidity</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#2-fragility","title":"2. Fragility","text":"<p>Definition: Modifying one place breaks conceptually unrelated places</p> <p>Symptom: \"I touched this, why did that break?\"</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#inference-evidence-divergent-change-implicit-cross-module-dependency","title":"Inference Evidence: Divergent Change + Implicit Cross-module Dependency","text":"<p>4 domains mixed in one file: - Unity batch mode, Python scripts, Bitbucket, File System</p> <p>6 implicit dependencies: - Python scripts (<code>create_bitbucket_test_report.py</code>, <code>get_unity_version.py</code>) - Unity Hub CLI - Unity batch mode CLI - Unity Code Coverage JSON (Settings.json) - Jenkins Pipeline DSL</p> <p>Potential Fragility Scenarios:</p> Change Expected Impact Actual Impact (Inferred) Unity CLI option change <code>runUnityBatchMode</code> All 7 conditional locations need review Python script argument change <code>getUnityExecutable</code> <code>sendTestReport</code> may also be affected Code Coverage JSON structure change <code>loadPathsToExclude</code> <code>getCodeCoverageArguments</code> fails <p>Conclusion: Stage-specific conditional branches scattered \u2192 unexpected impact on changes possible \u2192 Medium Fragility</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#3-immobility","title":"3. Immobility","text":"<p>Definition: Difficult to extract useful parts for reuse in other systems/modules</p> <p>Symptom: \"Trying to separate it brings too many dependencies along\"</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#inference-evidence-multifaceted-abstraction","title":"Inference Evidence: Multifaceted Abstraction","text":"<p>Problems when attempting separation:</p> Extraction Target Functions Dependencies That Follow UnityBatchModeHelper 6 functions Jenkins DSL, Stage constants, environment variables, Python scripts UnityInstallHelper 1 function Jenkins DSL, Python scripts, Unity Hub CLI BitbucketReportHelper 1 function Jenkins DSL, Python scripts <p>Reuse Cost Analysis:</p> <pre><code>Separation Cost = Function extraction + Stage conditional branch refactoring + 2 pipeline modifications\nRewrite Cost = Write from scratch\n\nSeparation Cost &gt; Rewrite Cost (Stage conditional branches complex) \u2192 Medium~High Immobility\n</code></pre> <p>Conclusion: 357 lines, 8 functions, 4 domains + Stage-specific conditional branches scattered \u2192 Medium Immobility</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#4-viscosity","title":"4. Viscosity","text":"<p>Definition: The right approach (maintaining design) is harder than the wrong approach (hacking)</p> <p>Symptom: \"Doing it properly takes too long, let's just do it this way for now\"</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#inference-evidence-missing-encapsulation-conditional-branch-copy-paste-induced","title":"Inference Evidence: Missing Encapsulation \u2192 Conditional Branch Copy-Paste Induced","text":"<p>Current State (Missing Encapsulation): - <code>[EDIT_MODE, PLAY_MODE].contains(stageName)</code> - repeated 3 times - <code>stageName == COVERAGE</code> - repeated 2 times - <code>[WEBGL, RIDER].contains(stageName)</code> - repeated 2 times</p> <p>Right Approach vs Hack:</p> Situation Right Approach Hack Tendency Adding new Stage Objectify Stage with Strategy pattern Copy-paste conditional statements in 7 locations Copy (faster) Changing Stage options Modify Stage settings data structure Direct modification of the conditional Direct modification (faster) <p>Conclusion: Lack of encapsulation creates \"conditional copy is easier\" structure \u2192 High Viscosity</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#5-needless-complexity","title":"5. Needless Complexity","text":"<p>Definition: Over-engineering for features not currently needed</p> <p>Symptom: YAGNI violation, \"I might need this later\"</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#inference-evidence-dead-code","title":"Inference Evidence: Dead Code","text":"<p>Dead Code found in SRP Analysis: None</p> <p>Conclusion: No Dead Code \u2192 Low Needless Complexity</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#6-needless-repetition","title":"6. Needless Repetition","text":"<p>Definition: Code that could be unified through abstraction is duplicated in multiple places</p> <p>Symptom: DRY violation, \"Similar code in multiple places\"</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#inference-evidence-switch-statements","title":"Inference Evidence: Switch Statements","text":"<p>Stage-specific Conditional Branch Repetition:</p> Branch Type Repetition Count Location <code>[EDIT_MODE, PLAY_MODE].contains(stageName)</code> 3 times lines 209, 220, 303 <code>stageName == COVERAGE</code> 2 times lines 222, 307 <code>[WEBGL, RIDER].contains(stageName)</code> 2 times lines 216, 224 <code>stageName != WEBGL &amp;&amp; stageName != PLAY_MODE</code> 1 time line 229 <code>stageName != PLAY_MODE &amp;&amp; stageName != EDIT_MODE</code> 1 time line 233 <p>Solution: Objectify Stage pattern (Strategy pattern or extract to data structure)</p> <p>Conclusion: Same Stage conditional branches scattered in 7 locations \u2192 High Needless Repetition</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#7-opacity","title":"7. Opacity","text":"<p>Definition: Code is difficult to understand and intent is unclear</p> <p>Symptom: \"What does this code do?\"</p>"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#code-review-results","title":"Code Review Results","text":"Type Location Problem Description Complex nested condition Lines 98-105 <code>if (exitCode == 0) ... else if (CI_PIPELINE) ...</code> 3-level conditional branch Complex Map structure Lines 139-160 <code>logConfig</code> Map Difficult to trace Stage-specific path/url settings Complex JSON parsing Lines 320-340 <code>loadPathsToExclude()</code> <code>m_Dictionary.m_DictionaryValues</code> path meaning unclear"},{"location":"problem-analysis/03-unityHelper/design-smells-symptoms/#severity-classification","title":"Severity Classification","text":"<p>Medium (Readability): - Complex nested condition: 3-level conditional branch (lines 98-105) - Complex Map structure: Difficult to trace Stage-specific path/url settings (lines 139-160) - Complex JSON parsing: <code>m_Dictionary.m_DictionaryValues</code> path meaning unclear (lines 320-340)</p> <p>Conclusion: Complex nested/Map/JSON structures \u2192 Medium Opacity</p> <p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/","title":"Software Smells","text":"<p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#groovyunityhelpergroovy-software-smells-analysis","title":"groovy/unityHelper.groovy - Software Smells Analysis","text":"<p>Level-based Classification: Code Smell (Function Level) \u2192 Design Smell (Module Level) \u2192 Architecture Smell (System Level)</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#summary","title":"Summary","text":"Level Category Smell Type Severity Code Change Preventers Divergent Change Medium Code Change Preventers Shotgun Surgery High Code Bloaters Long Method High Code Bloaters Switch Statements Medium Design Abstraction Multifaceted Abstraction Medium Design Encapsulation Missing Encapsulation High Design Hierarchy Missing Hierarchy Medium Architecture Dependency Issues Implicit Cross-module Dependency Medium"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#1-code-smells-methodfunction-level","title":"1. Code Smells (Method/Function Level)","text":"<p>Source: Fowler, M. (1999). Refactoring: Improving the Design of Existing Code</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#11-change-preventers","title":"1.1 Change Preventers","text":"Divergent Change (4 change reasons) <p>Definition: A single class is frequently changed for several different reasons</p> Change Reason Affected Functions Example Situation Unity batch mode CLI change <code>runUnityBatchMode</code>, <code>getCodeCoverageArguments</code>, <code>fetCoverageOptionsKeyAndValue</code>, <code>buildCoverageOptions</code> CLI options change due to Unity version upgrade Python script interface change <code>sendTestReport</code>, <code>getUnityExecutable</code> <code>get_unity_version.py</code> argument format change Bitbucket report format change <code>sendTestReport</code> Bitbucket API change Unity Code Coverage settings change <code>loadPathsToExclude</code>, <code>getCodeCoverageArguments</code> Settings.json structure change <p>Severity Evidence: - Impact Scope: Medium - Called 11 times total from 2 pipelines (Jenkinsfile 7 times, JenkinsfileDeployment 4 times) - Bug Potential: Medium - Unexpected behavior may occur when modifying Unity CLI/Python/Coverage related functions - Modification Cost: Medium - Refactoring needed to separate 4 domains</p> Shotgun Surgery (7 locations when adding Stage) <p>Definition: A single change requires modifications to multiple classes/functions</p> <p>Locations needing modification when adding new Stage \"Android\":</p> Modification Location Line Numbers Change Content Stage constant definition 6-10 Add <code>this.ANDROID = 'Android'</code> <code>setLogFilePathAndUrl</code> mapping 139-160 Add <code>(ANDROID): [path: ..., url: ...]</code> <code>getTestRunArgs</code> condition 209 Decide whether to include Android <code>getCodeCoverageArguments</code> condition 212 Decide whether to include Android <code>getAdditionalArgs</code> mapping 192-196 Add <code>Android: '...'</code> Command assembly branch 220-226 Add else if Graphics/quit options 229-233 Add Android condition <p>Severity Evidence: - Impact Scope: High - 7 locations within the single unityHelper.groovy file need modification - Bug Potential: High - Missing even one of 7 locations causes runtime error or Stage failure - Modification Cost: High - Architecture change required to objectify Stage</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#12-bloaters","title":"1.2 Bloaters","text":"Long Method - runUnityBatchMode() 126 lines Function Line Count Responsibility Count Detailed Responsibilities <code>runUnityBatchMode()</code> 126 lines (118-243) 7 Log path setup, test args, additional args, base command, coverage args, graphics options, execution <p>Responsibilities Needing Separation: 1. Log path setup (setLogFilePathAndUrl closure \u2192 separate function) 2. Test argument generation (getTestRunArgs closure \u2192 separate function) 3. Additional argument generation (getAdditionalArgs closure \u2192 separate function) 4. Command assembly logic (current branches) 5. Graphics option decision (current branches) 6. Command execution (sh call)</p> <p>Severity Evidence: - Impact Scope: High - Affects runUnityBatchMode function in unityHelper.groovy + all dependent Stages - Bug Potential: High - 7 responsibilities mixed in 126 lines may cause unexpected behavior when modified - Modification Cost: Medium - Refactoring needed to separate 4 closures into separate functions</p> Switch Statements (Stage-specific repeated branches) <p>Definition: The same switch/if-else branches are repeated in multiple places</p> Branch Type Repetition Count Location <code>[EDIT_MODE, PLAY_MODE].contains(stageName)</code> 3 times lines 209, 220, 303 <code>stageName == COVERAGE</code> 2 times lines 222, 307 <code>[WEBGL, RIDER].contains(stageName)</code> 2 times lines 216, 224 <code>stageName != WEBGL &amp;&amp; stageName != PLAY_MODE</code> 1 time line 229 <code>stageName != PLAY_MODE &amp;&amp; stageName != EDIT_MODE</code> 1 time line 233 <p>Solution: Objectify Stage pattern (Strategy pattern or extract to data structure)</p> <p>Severity Evidence: - Impact Scope: Medium - Same branch pattern exists in 7 locations within the single unityHelper.groovy file - Bug Potential: Medium - Modifying only some branches when adding new Stage causes unexpected behavior - Modification Cost: Medium - Refactoring needed to extract Stage pattern as Strategy objects</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#2-design-smells-modulefile-level","title":"2. Design Smells (Module/File Level)","text":""},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#21-symptoms-martin-2000","title":"2.1 Symptoms (Martin 2000)","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Detailed analysis inferred from static analysis results: design-smells-symptoms.md</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#22-principles-suryanarayana-2014","title":"2.2 Principles (Suryanarayana 2014)","text":"<p>Source: Suryanarayana, G. et al. (2014). Refactoring for Software Design Smells</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#abstraction-smells","title":"Abstraction Smells","text":"Multifaceted Abstraction <p>Definition: A single abstraction (class/file) expresses multiple concerns (SRP violation)</p> <p>4 Domains in unityHelper.groovy: - Unity: <code>getUnityExecutable</code>, <code>runUnityStage</code>, <code>runUnityBatchMode</code>, <code>getCodeCoverageArguments</code>, <code>fetCoverageOptionsKeyAndValue</code>, <code>buildCoverageOptions</code> - Python scripts: <code>sendTestReport</code>, <code>getUnityExecutable</code> - Bitbucket: <code>sendTestReport</code> - File System: <code>loadPathsToExclude</code></p> <p>Modules Needing Separation: - UnityBatchModeHelper (6): <code>runUnityStage</code>, <code>runUnityBatchMode</code>, <code>getCodeCoverageArguments</code>, <code>fetCoverageOptionsKeyAndValue</code>, <code>buildCoverageOptions</code>, <code>loadPathsToExclude</code> - UnityInstallHelper (1): <code>getUnityExecutable</code> - BitbucketReportHelper (1): <code>sendTestReport</code> \u2192 consider integration with generalHelper</p> <p>\u2192 Related Symptom: Divergent Change (changed for multiple reasons due to multiple domains: Unity CLI/Python/Bitbucket/Coverage, etc.)</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#encapsulation-smells","title":"Encapsulation Smells","text":"Missing Encapsulation <p>Definition: Variations are not encapsulated, causing logic to be scattered</p> <p>Stage-specific Conditional Branch Scattered Pattern:</p> Branch Location Stage Branch Logic Line Numbers Function/Closure Log path mapping <code>Map logConfig = [(EDIT_MODE): [...], ...]</code> 139-160 <code>setLogFilePathAndUrl</code> Test arguments <code>[EDIT_MODE, PLAY_MODE].contains(stageName)</code> 209 <code>runUnityBatchMode</code> Coverage arguments <code>[EDIT_MODE, PLAY_MODE, COVERAGE].contains(stageName)</code> 212 <code>runUnityBatchMode</code> Additional arguments <code>[WEBGL, RIDER].contains(stageName)</code> 216 <code>runUnityBatchMode</code> Command assembly <code>if ([EDIT_MODE, PLAY_MODE].contains(stageName)) {...}</code> 220-226 <code>runUnityBatchMode</code> Graphics options <code>(stageName != WEBGL &amp;&amp; stageName != PLAY_MODE)</code> 229-233 <code>runUnityBatchMode</code> Coverage options <code>if ([EDIT_MODE, PLAY_MODE].contains(stageName)) {...}</code> 303-310 <code>fetCoverageOptionsKeyAndValue</code> <p>When adding new Stage \"Android\": All 7 locations need modification</p> <p>\u2192 Related Symptoms: Shotgun Surgery (7 simultaneous modifications when Stage added/changed), Switch Statements (same branch pattern repeated)</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#hierarchy-smells","title":"Hierarchy Smells","text":"Missing Hierarchy <p>Definition: Should use inheritance/polymorphism instead of conditional branches (if/else)</p> <p>Evidence of Missing Hierarchy in unityHelper.groovy:</p> <p>Stage-specific branches can be replaced with polymorphism (Strategy pattern):</p> Current Branch Pattern Polymorphism Replacement <code>[EDIT_MODE, PLAY_MODE].contains(stageName)</code> <code>stage.requiresTestRun()</code> <code>[EDIT_MODE, PLAY_MODE, COVERAGE].contains(stageName)</code> <code>stage.requiresCoverage()</code> <code>[WEBGL, RIDER].contains(stageName)</code> <code>stage.getAdditionalArgs()</code> <code>stageName != WEBGL &amp;&amp; stageName != PLAY_MODE</code> <code>stage.requiresNographics()</code> <code>stageName != PLAY_MODE &amp;&amp; stageName != EDIT_MODE</code> <code>stage.requiresQuit()</code> <p>Improvement Direction: Abstract each Stage as an object to remove branch logic</p> <pre><code>// Before: Conditional branches\nif ([EDIT_MODE, PLAY_MODE].contains(stageName)) { ... }\n\n// After: Polymorphism\nstage.getTestRunArgs()  // Each Stage object encapsulates its own logic\n</code></pre> <p>\u2192 Related Symptom: Switch Statements (same branch pattern repeated in 7 locations)</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#3-architecture-smells-system-level","title":"3. Architecture Smells (System Level)","text":"<p>Source: Garcia et al. (2009), Lippert &amp; Roock (2006), Sharma &amp; Spinellis (2018)</p>"},{"location":"problem-analysis/03-unityHelper/software-smells-analysis/#31-dependency-issues","title":"3.1 Dependency Issues","text":"Implicit Cross-module Dependency <p>Definition: Hidden dependencies cause coupling to external systems without explicit interfaces</p> External System Calling Function Line Numbers Implicit Contract Content Python script (<code>create_bitbucket_test_report.py</code>) <code>sendTestReport</code> 22 Argument format (commitHash, reportDir) Python script (<code>get_unity_version.py</code>) <code>getUnityExecutable</code> 37, 41, 44 3 commands (executable-path, version, revision) Unity Hub CLI <code>getUnityExecutable</code> 48-65 <code>--headless install</code>, <code>install-modules</code> options Unity batch mode CLI <code>runUnityBatchMode</code> 203-236 <code>-batchmode</code>, <code>-projectPath</code>, <code>-logFile</code>, <code>-testPlatform</code>, etc. Unity Code Coverage JSON <code>loadPathsToExclude</code> 321-339 Settings.json structure (<code>m_Dictionary.m_DictionaryValues</code>) Jenkins Pipeline DSL All functions - <code>env</code>, <code>sh()</code>, <code>echo()</code>, <code>error()</code>, <code>fileExists()</code>, etc. <p>Severity Evidence: - Impact Scope: Medium - Affects unityHelper.groovy + 2 dependent pipeline files - Bug Potential: High - Runtime errors when external systems (Python/Unity Hub/Unity CLI/JSON structure) change (not detectable at compile time) - Modification Cost: Medium - Refactoring needed such as adding Adapter/Wrapper per external system</p> <p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/03-unityHelper/srp-violation-analysis/","title":"SRP Violations","text":"<p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/03-unityHelper/srp-violation-analysis/#groovyunityhelpergroovy-srp-violation-analysis","title":"groovy/unityHelper.groovy - SRP Violation Analysis","text":"<p>DLX Pipeline Dedicated File - CI-only functions mixed (100% cohesion 50%) (357 lines)</p>"},{"location":"problem-analysis/03-unityHelper/srp-violation-analysis/#1-srp-violation-analysis-criteria","title":"1. SRP Violation Analysis Criteria","text":"<ul> <li>unityHelper Design Intent: A file that collects functions dedicated to DLX (Unity) pipelines (CI/CD)</li> <li>Cohesion Analysis Criteria: \"Is it used in both DLX CI and DLX CD?\" = Cohesion aligned with design intent</li> </ul>"},{"location":"problem-analysis/03-unityHelper/srp-violation-analysis/#2-cohesion-and-change-reasons-per-function","title":"2. Cohesion and Change Reasons per Function","text":"# Function Name DLX CI DLX CD Change Reason 1 <code>sendTestReport</code> \u25cb \u25cb When Bitbucket test report Python script interface changes 2 <code>getUnityExecutable</code> \u25cb \u25cb 2 reasons: Unity version Python + Unity Hub CLI installation 3 <code>runUnityStage</code> \u25cb \u25cb When Unity batch mode error handling policy changes 4 <code>runUnityBatchMode</code> \u25cb \u25cb 7+ reasons: Log path + Test platform + Coverage + Stage-specific args + Unity CLI + xvfb-run + New Stage 5 <code>getCodeCoverageArguments</code> \u25cb \u2717 When Unity Code Coverage package options change 6 <code>fetCoverageOptionsKeyAndValue</code> \u25cb \u2717 When Stage-specific coverage option rules change 7 <code>loadPathsToExclude</code> \u25cb \u2717 When Unity Code Coverage Settings.json structure changes 8 <code>buildCoverageOptions</code> \u25cb \u2717 When coverage options string format changes"},{"location":"problem-analysis/03-unityHelper/srp-violation-analysis/#3-module-level-srp-violation-analysis-cohesion-analysis-results","title":"3. Module Level SRP Violation Analysis - Cohesion Analysis Results","text":"<ul> <li>100% Usage (4): <code>sendTestReport</code>, <code>getUnityExecutable</code>, <code>runUnityStage</code>, <code>runUnityBatchMode</code></li> <li>50% Usage (4): CI-only coverage functions</li> </ul> <p>SRP Violation: DLX-dedicated but CI-only functions (4 Code Coverage related) are mixed without separate separation</p>"},{"location":"problem-analysis/03-unityHelper/srp-violation-analysis/#4-function-level-srp-violation-analysis-functions-with-multiple-change-reasons","title":"4. Function Level SRP Violation Analysis - Functions with Multiple Change Reasons","text":"Multi-responsibility Function: <code>getUnityExecutable()</code> (2 change reasons) <pre><code>String getUnityExecutable(workspace, projectDir) {\n    try {\n        // Change reason 1: Unity version Python script\n        def unityExecutable = sh(script: \"python '${workspace}/python/get_unity_version.py' '${projectDir}' executable-path\",\n        returnStdout: true).trim()\n\n        if (!fileExists(unityExecutable)) {\n            def version = sh(script: \"python '${workspace}/python/get_unity_version.py' '${projectDir}' version\",\n             returnStdout: true).trim()\n            def revision = sh(script: \"python '${workspace}/python/get_unity_version.py' '${projectDir}' revision\",\n             returnStdout: true).trim()\n\n            // Change reason 2: Unity Hub CLI installation command\n            echo \"Unity Editor version ${version} not found. Attempting installation...\"\n            def installCommand = \"\"\"\\\"C:\\\\Program Files\\\\Unity Hub\\\\Unity Hub.exe\\\" \\\\\n            -- --headless install \\\\\n            --version ${version} \\\\\n            --changeset ${revision}\"\"\"\n            def exitCode = sh(script: installCommand, returnStatus: true)\n            // ...\n\n            echo 'Installing WebGL Build Support...'\n            def webglInstallCommand = \"\"\"\\\"C:\\\\Program Files\\\\Unity Hub\\\\Unity Hub.exe\\\" \\\\\n            -- --headless install-modules \\\\\n            --version ${version} \\\\\n            -m webgl\"\"\"\n            // ...\n        }\n        return unityExecutable\n    } catch (Exception e) {\n        error(\"An error occurred while retrieving or installing Unity executable: ${e.getMessage()}\")\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When Unity version Python script changes (lines 37-45): <code>get_unity_version.py</code> arguments/output format 2. When Unity Hub CLI installation command changes (lines 48-65): Unity Hub path, CLI options, module installation</p> Multi-responsibility Function: <code>runUnityBatchMode()</code> (7+ change reasons) <pre><code>int runUnityBatchMode(String unityExecutable, String projectDirectory, String reportDirectory, String stageName) {\n    String batchModeBaseCommand = ''\n    String logFilePath = ''\n    String logFileUrl = ''\n    String testRunArgs = ''\n    String codeCoverageArgs = ''\n    String additionalArgs = ''\n    String finalCommand = ''\n\n    // Change reason 1: Log path rules\n    Closure setLogFilePathAndUrl = { String prBranch, String reportDir, String stage -&gt;\n        String jobName = CI_PIPELINE ? 'PRJob' : 'DeploymentJob'\n        Map logConfig = [\n            (EDIT_MODE): [\n                path: \"${reportDir}/test_results/${stage}-tests.log\",\n                url: \"${env.BUILD_URL}execution/node/3/ws/${jobName}/${prBranch}/test_results/${stage}-tests.log\"\n            ],\n            // ... Stage-specific settings\n        ]\n        logFilePath = logConfig[stage].path\n        logFileUrl = logConfig[stage].url\n    }\n\n    // Change reason 2: Test platform arguments\n    Closure&lt;String&gt; getTestRunArgs = { String reportDir, String stage -&gt;\n        return \"-testPlatform ${stage} -runTests -testResults ${reportDir}/test_results/${stage}-results.xml\"\n    }\n\n    // Change reason 3: Stage-specific additional arguments (Webgl, Rider)\n    Closure&lt;String&gt; getAdditionalArgs = { String stage -&gt;\n        Map argsMap = [\n            Webgl: '-buildTarget WebGL -executeMethod Builder.BuildWebGL',\n            Rider: '-executeMethod Packages.Rider.Editor.RiderScriptEditor.SyncSolution'\n        ]\n        return argsMap[stage] ?: ''\n    }\n\n    setLogFilePathAndUrl(PR_BRANCH, reportDirectory, stageName)\n\n    // Change reason 4: Unity CLI base arguments\n    batchModeBaseCommand = \"${unityExecutable} -projectPath ${projectDirectory} -batchmode -logFile ${logFilePath}\"\n\n    // Change reason 5: Coverage arguments\n    testRunArgs = [EDIT_MODE, PLAY_MODE].contains(stageName) ? getTestRunArgs(reportDirectory, stageName) : ''\n    codeCoverageArgs = [EDIT_MODE, PLAY_MODE, COVERAGE].contains(stageName) ?\n        getCodeCoverageArguments(projectDirectory, reportDirectory, stageName) : ''\n    additionalArgs = [WEBGL, RIDER].contains(stageName) ? getAdditionalArgs(stageName) : ''\n\n    // Change reason 6: Graphics options (-nographics, xvfb-run)\n    finalCommand = (stageName != WEBGL &amp;&amp; stageName != PLAY_MODE)\n        ? (finalCommand + ' -nographics')\n        : ('/usr/bin/xvfb-run -a ' + finalCommand)\n\n    // Change reason 7: When adding new Stage type (all branches)\n    finalCommand += (stageName != PLAY_MODE &amp;&amp; stageName != EDIT_MODE) ? ' -quit' : ''\n\n    int exitCode = sh(script: \"${finalCommand}\", returnStatus: true)\n    return exitCode\n}\n</code></pre> <p>Change Reason Analysis: 1. When log path rules change (lines 135-170): Stage-specific log path/URL mapping 2. When test platform arguments change (lines 179-183): <code>-testPlatform</code>, <code>-runTests</code> options 3. When Stage-specific additional arguments change (lines 191-197): Webgl/Rider dedicated options 4. When Unity CLI base arguments change (lines 203-206): <code>-batchmode</code>, <code>-logFile</code> 5. When coverage arguments change (lines 209-213): <code>getCodeCoverageArguments()</code> call 6. When xvfb-run options change (lines 229-231): Graphics environment settings 7. When adding new Stage type (entire function): New type must be added to all conditions/mappings</p>"},{"location":"problem-analysis/03-unityHelper/srp-violation-analysis/#conclusion","title":"Conclusion","text":"<p>SRP Violation: - Module Level: DLX-dedicated but CI-only functions (4 Code Coverage) mixed without separation (100% usage 50%) - Function Level: 2 functions have multiple change reasons (<code>getUnityExecutable</code>(2), <code>runUnityBatchMode</code>(7)) - <code>runUnityBatchMode</code> has Long Method smell + 7+ locations need modification when adding new Stage (Shotgun Surgery risk)</p> <p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/","title":"Design Smells","text":"<p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#dlxjenkinsjenkinsfile-design-smells-symptoms-analysis","title":"DLXJenkins/Jenkinsfile - Design Smells Symptoms Analysis","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Symptoms analysis based on static analysis results (SRP, Software Smells, DRY) + code review</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#summary","title":"Summary","text":"Symptom Severity Main Evidence Rigidity High Shotgun Surgery (5 locations when Unity Stage name changes) Fragility High 6 domains mixed, 8 implicit dependencies Immobility High 286 lines/6 Stages, Hub-like Dependency (entire pipeline orchestration) Viscosity Medium Missing Encapsulation \u2192 stageName/errorMsg copying is easier Needless Complexity Low N/A Needless Repetition High DRY violation (stageName/errorMsg pattern repeated 5 times) Opacity Medium Undefined variables, complex nesting"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence","title":"Inference Evidence","text":"Symptom Evidence Source Rigidity Shotgun Surgery 5 locations when Unity Stage name changes Code Smells Fragility Divergent Change 6 domains + Implicit Dependency 8 Code Smells + Arch Smells Immobility Multifaceted Abstraction Entire CI pipeline orchestration Design Smells Viscosity Missing Encapsulation Unity Stage execution pattern not encapsulated Design Smells Needless Complexity N/A - Needless Repetition Duplicated Code stageName/errorMsg pattern repeated 5 times Code Smells Opacity Direct code review Code Review"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#1-rigidity","title":"1. Rigidity","text":"<p>Definition: Changing one place requires cascading changes to other places</p> <p>Symptom: \"I thought it was a simple change, but it turned out to be much more complex\"</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-shotgun-surgery","title":"Inference Evidence: Shotgun Surgery","text":"<p>Unity Stage name hardcoded locations:</p> Line Numbers Stage Name Error Message 112-114 <code>'Rider'</code> <code>'Synchronizing Unity and Rider IDE solution files failed'</code> 181-183 <code>'EditMode'</code> <code>'EditMode tests failed'</code> 195-197 <code>'PlayMode'</code> <code>'PlayMode tests failed'</code> 209-211 <code>'Coverage'</code> <code>'Code Coverage generation failed'</code> 237-239 <code>'Webgl'</code> <code>'WebGL Build failed'</code> <p>Change Scenario: If <code>unityHelper.groovy</code>'s Stage constant name changes from <code>'EditMode'</code> \u2192 <code>'Edit'</code>, 5 locations in Jenkinsfile need modification</p> <p>Conclusion: Changing Stage name requires simultaneous modification of 5 locations \u2192 High Rigidity</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#2-fragility","title":"2. Fragility","text":"<p>Definition: Modifying one place breaks conceptually unrelated places</p> <p>Symptom: \"I touched this, why did that break?\"</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-divergent-change-implicit-cross-module-dependency","title":"Inference Evidence: Divergent Change + Implicit Cross-module Dependency","text":"<p>6 domains mixed in one file: - Jenkins environment settings, Git/Bitbucket, Unity settings, Code quality (Linting), Unity build, Report/deployment</p> <p>8 implicit dependencies: - <code>python/linting_error_report.py</code>, <code>python/create_bitbucket_webgl_build_report.py</code> - <code>Bash/Linting.bash</code>, <code>Bash/.editorconfig</code>, <code>Builder.cs</code> - <code>generalHelper.groovy</code>, <code>unityHelper.groovy</code> - Jenkins Pipeline DSL</p> <p>Potential Fragility Scenarios:</p> Change Expected Impact Actual Impact (Inferred) Linting.bash exit code change Linting stage Python report script call logic breaks unityHelper Stage constant change That Stage Stage failure in 5 locations in Jenkinsfile Web server path change publishResultsToWebServer Report deployment fails <p>Conclusion: 6 domains mixed in one file + 8 implicit dependencies \u2192 High Fragility</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#3-immobility","title":"3. Immobility","text":"<p>Definition: Difficult to extract useful parts for reuse in other systems/modules</p> <p>Symptom: \"Trying to separate it brings too many dependencies along\"</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-multifaceted-abstraction","title":"Inference Evidence: Multifaceted Abstraction","text":"<p>Entire CI pipeline orchestration: - Single 286-line Jenkinsfile handles entire DLX CI flow - All Stage dependencies must be considered when separating</p> <p>Problems when attempting separation:</p> Extraction Target Dependencies That Follow PrepareStage generalUtil, unityUtil loading, branch check, Unity settings LintingStage Bash script, Python report, exit code handling UnityTestStage unityUtil, stageName/errorMsg, coverage settings BuildStage Builder.cs copy, unityUtil, Python report, web server deployment <p>Conclusion: Entire CI pipeline in single file \u2192 partial extraction difficult \u2192 High Immobility</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#4-viscosity","title":"4. Viscosity","text":"<p>Definition: The right approach (maintaining design) is harder than the wrong approach (hacking)</p> <p>Symptom: \"Doing it properly takes too long, let's just do it this way for now\"</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-missing-encapsulation-dry-violation-induced","title":"Inference Evidence: Missing Encapsulation \u2192 DRY Violation Induced","text":"<p>Current State (Missing Encapsulation): <pre><code>// Same pattern repeated 5 times\nString stageName = 'EditMode'\nString errorMassage = 'EditMode tests failed'\nunityUtil.runUnityStage(stageName, errorMassage)\n</code></pre></p> <p>Right Approach vs Hack:</p> Situation Right Approach Hack Tendency Adding new Unity Stage Create Stage settings Map then use Copy-paste existing pattern Copy (faster) Changing error message format Modify Stage settings Map in bulk Manually modify 5 locations Manual (faster) <p>Conclusion: Lack of encapsulation creates \"copying is easier\" structure \u2192 Medium Viscosity</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#5-needless-complexity","title":"5. Needless Complexity","text":"<p>Definition: Over-engineering for features not currently needed</p> <p>Symptom: YAGNI violation, \"I might need this later\"</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence_1","title":"Inference Evidence","text":"<p>Dead Code or over-engineering: N/A</p> <p>Conclusion: Low Needless Complexity</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#6-needless-repetition","title":"6. Needless Repetition","text":"<p>Definition: Code that could be unified through abstraction is duplicated in multiple places</p> <p>Symptom: DRY violation, \"Similar code in multiple places\"</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-duplicated-code","title":"Inference Evidence: Duplicated Code","text":"<p>stageName/errorMassage pattern repeated 5 times (3 lines \u00d7 5 = 15 lines duplicated):</p> Stage Line Numbers Rider 112-114 EditMode 181-183 PlayMode 195-197 Coverage 209-211 Webgl 237-239 <p>Improvement Direction: <pre><code>def UNITY_STAGES = [\n    Rider:    [name: 'Rider',    error: 'Synchronizing Unity and Rider IDE solution files failed'],\n    EditMode: [name: 'EditMode', error: 'EditMode tests failed'],\n    // ...\n]\n</code></pre></p> <p>Conclusion: Same pattern repeated 5 times without abstraction \u2192 High Needless Repetition</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#7-opacity","title":"7. Opacity","text":"<p>Definition: Code is difficult to understand and intent is unclear</p> <p>Symptom: \"What does this code do?\"</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#code-review-results","title":"Code Review Results","text":"Type Location Problem Description Undefined variable usage Lines 218-221 <code>FOLDER_NAME</code>, <code>TICKET_NUMBER</code> Definition location unclear (set in generalUtil.initializeEnvironment) Complex nesting Lines 129-166 Linting Stage 4-level if-else nesting, exitCode branch hard to trace"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/design-smells-symptoms/#severity-classification","title":"Severity Classification","text":"<p>Medium (Maintenance Difficulty): - Undefined variable usage: <code>FOLDER_NAME</code>, <code>TICKET_NUMBER</code> (lines 218-221) - Definition location unclear (set in generalUtil.initializeEnvironment) - Complex nesting: Linting Stage (lines 129-166) - 4-level if-else nesting, exitCode branch hard to trace</p> <p>Conclusion: Undefined variables + complex nesting \u2192 Medium Opacity</p> <p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/","title":"Software Smells","text":"<p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#dlxjenkinsjenkinsfile-software-smells-analysis","title":"DLXJenkins/Jenkinsfile - Software Smells Analysis","text":"<p>Level-based Classification: Code Smell (Function Level) \u2192 Design Smell (Module Level) \u2192 Architecture Smell (System Level)</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#summary","title":"Summary","text":"Level Category Smell Type Severity Code Change Preventers Divergent Change High Code Change Preventers Shotgun Surgery Medium Code Dispensables Duplicated Code Medium Code Bloaters Primitive Obsession Low Design Abstraction Multifaceted Abstraction High Design Abstraction Missing Abstraction Medium Design Encapsulation Missing Encapsulation Medium Design Abstraction Imperative Abstraction Medium Architecture Dependency Issues Implicit Cross-module Dependency High"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#1-code-smells-methodfunction-level","title":"1. Code Smells (Method/Function Level)","text":"<p>Source: Fowler, M. (1999). Refactoring: Improving the Design of Existing Code</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#11-change-preventers","title":"1.1 Change Preventers","text":"Divergent Change (6 change reasons) <p>Definition: A single class/file is frequently changed for several different reasons</p> Change Reason Affected Area Line Numbers Example Situation Jenkins environment settings change <code>Prepare WORKSPACE</code> 70-80 env output conditions, script loading path change Git/Bitbucket workflow change <code>Prepare WORKSPACE</code> 82-94 Branch check conditions, clone/merge policy change Unity settings change <code>Prepare WORKSPACE</code> 101-115 Unity version detection, Rider sync policy change Linting policy change <code>Linting</code> 119-167 editorconfig path, exit code handling change Unity build change <code>EditMode Tests</code>, <code>PlayMode Tests</code>, <code>Code Coverage</code>, <code>Build Project</code> 172-258 Test/coverage/build Stage change Web server deployment change <code>Code Coverage</code>, <code>Build Project</code> 217-222, 253-255 Deployment path, report type change <p>Severity Evidence: - Impact Scope: High - Single Jenkinsfile handles entire CI pipeline logic - Bug Potential: Medium - Modifying one domain may unexpectedly affect other domains - Modification Cost: Medium - Separating 6 domains requires shared library or separate script separation</p> Shotgun Surgery (5 locations when Unity Stage name changes) <p>Definition: A single change requires modifications to multiple classes/functions</p> <p>Unity Stage name hardcoded locations:</p> Line Numbers Stage Name Error Message 112-114 <code>'Rider'</code> <code>'Synchronizing Unity and Rider IDE solution files failed'</code> 181-183 <code>'EditMode'</code> <code>'EditMode tests failed'</code> 195-197 <code>'PlayMode'</code> <code>'PlayMode tests failed'</code> 209-211 <code>'Coverage'</code> <code>'Code Coverage generation failed'</code> 237-239 <code>'Webgl'</code> <code>'WebGL Build failed'</code> <p>Change Scenario: If <code>unityHelper.groovy</code>'s Stage constant name changes from <code>'EditMode'</code> \u2192 <code>'Edit'</code>: - Line 181 in Jenkinsfile needs modification - Missing it causes failure due to wrong Stage name in <code>runUnityStage</code> call</p> <p>Severity Evidence: - Impact Scope: Medium - 5 locations within the single Jenkinsfile need modification - Bug Potential: High - Missing even one of 5 locations causes Stage failure - Modification Cost: Low - Simple fix by extracting Stage names as constants</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#12-dispensables","title":"1.2 Dispensables","text":"Duplicated Code (stageName/errorMassage pattern repeated 5 times) <p>Definition: The same code pattern is repeated in multiple places</p> <p>Repeated Pattern (3 lines \u00d7 5 times = 15 lines duplicated):</p> <pre><code>// Lines 112-114 (Rider)\nString stageName = 'Rider'\nString errorMassage = 'Synchronizing Unity and Rider IDE solution files failed'\nunityUtil.runUnityStage(stageName, errorMassage)\n\n// Lines 181-183 (EditMode)\nString stageName = 'EditMode'\nString errorMassage = 'EditMode tests failed'\nunityUtil.runUnityStage(stageName, errorMassage)\n\n// Lines 195-197 (PlayMode), 209-211 (Coverage), 237-239 (Webgl) same pattern\n</code></pre> <p>Improvement Direction: Extract Stage settings as Map</p> <pre><code>// Before: Repeated 5 times\nString stageName = 'EditMode'\nString errorMassage = 'EditMode tests failed'\nunityUtil.runUnityStage(stageName, errorMassage)\n\n// After: Extract to data structure\ndef stageConfig = [\n    EditMode: [name: 'EditMode', error: 'EditMode tests failed'],\n    PlayMode: [name: 'PlayMode', error: 'PlayMode tests failed'],\n    // ...\n]\nunityUtil.runUnityStage(stageConfig.EditMode.name, stageConfig.EditMode.error)\n</code></pre> <p>Severity Evidence: - Impact Scope: Medium - Same pattern exists in 5 locations within the single Jenkinsfile - Bug Potential: Medium - Changing error message format in only some locations breaks consistency - Modification Cost: Low - Simple fix by extracting Stage settings as Map/constants</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#13-bloaters","title":"1.3 Bloaters","text":"Primitive Obsession <p>Definition: Using primitive types (strings) instead of objects/constants</p> Case Current State Line Numbers Problem Stage names <code>'Rider'</code>, <code>'EditMode'</code>, <code>'PlayMode'</code>, <code>'Coverage'</code>, <code>'Webgl'</code> strings 112, 181, 195, 209, 237 Duplicate definition with unityHelper constants Report type <code>'CodeCoverage'</code> string 221 Type errors only discovered at runtime Directory names <code>'linting_results'</code>, <code>'test_results'</code>, <code>'coverage_results'</code> strings 123, 175-176 Same names repeated across multiple Stages Status values <code>pass = 'Pass'</code>, <code>fail = 'Fail'</code> 1-2 Passed as Python script arguments <p>Severity Evidence: - Impact Scope: Low - Only affects functions within the single Jenkinsfile - Bug Potential: Low - No current operational issues, maintenance inconvenience level - Modification Cost: Low - Simple fix by extracting as constants</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#2-design-smells-modulefile-level","title":"2. Design Smells (Module/File Level)","text":""},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#21-symptoms-martin-2000","title":"2.1 Symptoms (Martin 2000)","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Detailed analysis inferred from static analysis results: design-smells-symptoms.md</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#22-principles-suryanarayana-2014","title":"2.2 Principles (Suryanarayana 2014)","text":"<p>Source: Suryanarayana, G. et al. (2014). Refactoring for Software Design Smells</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#abstraction-smells","title":"Abstraction Smells","text":"Multifaceted Abstraction <p>Definition: A single abstraction (class/file) expresses multiple concerns (SRP violation)</p> <p>6 Domains in DLXJenkins/Jenkinsfile: - Jenkins environment settings: Script loading, JSON parsing, env output - Git/Bitbucket: Branch check, commit hash retrieval - Unity settings: Unity version detection, Rider sync - Code quality: Linting, editorconfig, exit code handling - Unity build: EditMode/PlayMode/Coverage/WebGL Stage - Report/deployment: Web server deployment, Bitbucket report</p> <p>Modules Needing Separation: - <code>PrepareStage.groovy</code>: Script loading, branch check, Unity settings - <code>LintingStage.groovy</code>: Linting execution, report generation - <code>UnityTestStage.groovy</code>: EditMode/PlayMode/Coverage Stage - <code>BuildStage.groovy</code>: WebGL build, deployment</p> <p>\u2192 Related Symptom: Divergent Change (single file changed for 6 different reasons)</p> Missing Abstraction <p>Definition: Concepts are implemented with primitive types or strings instead of dedicated classes/constants</p> Concept Needing Abstraction Current State Line Numbers Affected Stage Unity Stage names <code>'Rider'</code>, <code>'EditMode'</code>, <code>'PlayMode'</code>, <code>'Coverage'</code>, <code>'Webgl'</code> hardcoded 112, 181, 195, 209, 237 5 Stages Unity error messages <code>'EditMode tests failed'</code>, etc. hardcoded 114, 183, 197, 211, 239 5 Stages Directory names <code>'linting_results'</code>, <code>'test_results'</code>, <code>'coverage_results'</code> 123, 175-176 Linting, EditMode Paths <code>'Assets/Editor/'</code>, <code>'Builder.cs'</code> 234-235 Build Project Report type <code>'CodeCoverage'</code> 221 Code Coverage <p>\u2192 Related Symptoms: - Primitive Obsession (concepts expressed with primitive type strings) - Shotgun Surgery (5 locations need simultaneous modification when Stage name changes)</p> Imperative Abstraction <p>Definition: Abstraction operations are written procedurally rather than object-oriented</p> <p>Evidence of Imperative Abstraction in DLXJenkins/Jenkinsfile:</p> <p>Due to the nature of Jenkins Pipeline DSL, procedural script structure: - <code>stage()</code> blocks execute sequentially - Connected to external scripts through implicit contracts - Called via <code>sh</code> commands without explicit interfaces</p> External Script Call Method Implicit Contract <code>Bash/Linting.bash</code> <code>sh script: \"sh '${path}' ...\"</code> Argument order, exit code meaning <code>python/linting_error_report.py</code> <code>sh script: \"python '${path}' ...\"</code> Argument order (4), pass/fail strings <code>python/create_bitbucket_webgl_build_report.py</code> <code>sh script: \"python '${path}' ...\"</code> Argument order, --debug flag <p>\u2192 Related Symptom: Implicit Cross-module Dependency (implicit contracts with 7 external scripts)</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#encapsulation-smells","title":"Encapsulation Smells","text":"Missing Encapsulation <p>Definition: Variations are not encapsulated, causing logic to be scattered</p> <p>Unity Stage execution pattern repeated (3 lines \u00d7 5 times = 15 lines):</p> Location Stage Name Pattern Lines 112-114 Rider <code>String stageName = 'Rider'; String errorMassage = '...'; unityUtil.runUnityStage(...)</code> Lines 181-183 EditMode Same pattern Lines 195-197 PlayMode Same pattern Lines 209-211 Coverage Same pattern Lines 237-239 Webgl Same pattern <p>Encapsulation Solution: Extract Stage settings as Map/object</p> <pre><code>// Before: Repeated 5 times\nString stageName = 'EditMode'\nString errorMassage = 'EditMode tests failed'\nunityUtil.runUnityStage(stageName, errorMassage)\n\n// After: Encapsulate in data structure\ndef UNITY_STAGES = [\n    Rider:    [name: 'Rider',    error: 'Synchronizing Unity and Rider IDE solution files failed'],\n    EditMode: [name: 'EditMode', error: 'EditMode tests failed'],\n    PlayMode: [name: 'PlayMode', error: 'PlayMode tests failed'],\n    Coverage: [name: 'Coverage', error: 'Code Coverage generation failed'],\n    Webgl:    [name: 'Webgl',    error: 'WebGL Build failed']\n]\nunityUtil.runUnityStage(UNITY_STAGES.EditMode.name, UNITY_STAGES.EditMode.error)\n</code></pre> <p>\u2192 Related Symptoms: - Duplicated Code (same pattern repeated 5 times) - Shotgun Surgery (5 locations need modification when error message format changes)</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#3-architecture-smells-system-level","title":"3. Architecture Smells (System Level)","text":"<p>Source: Garcia et al. (2009), Lippert &amp; Roock (2006), Sharma &amp; Spinellis (2018)</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/software-smells-analysis/#31-dependency-issues","title":"3.1 Dependency Issues","text":"Implicit Cross-module Dependency <p>Definition: Hidden dependencies cause coupling to external systems without explicit interfaces</p> External System Line Numbers Implicit Contract Content <code>python/linting_error_report.py</code> 143-146, 160-164 Argument format (json path, commitHash, pass/fail, projectDir) + argument order <code>python/create_bitbucket_webgl_build_report.py</code> 251 Argument format (commitHash, logPath) + <code>--debug</code> flag <code>Bash/Linting.bash</code> 129-130 Argument format (projectDir, reportDir) + exit code meaning (0=success, 2=report generated) <code>Bash/.editorconfig</code> 127 File existence and location <code>Builder.cs</code> 235 File existence and location (<code>cp Builder.cs</code>) <code>generalHelper.groovy</code> 72 <code>load()</code> success + function signatures (parseJson, isBranchUpToDateWithRemote, etc.) <code>unityHelper.groovy</code> 73 <code>load()</code> success + function signatures (getUnityExecutable, runUnityStage, etc.) Jenkins Pipeline DSL Entire file <code>env</code>, <code>sh()</code>, <code>dir()</code>, <code>echo()</code>, <code>error()</code>, <code>catchError()</code>, <code>currentBuild</code>, etc. <p>Severity Evidence: - Impact Scope: High - Affects Jenkinsfile + 7 external scripts/files - Bug Potential: High - Runtime errors when external script interfaces change (not detectable at compile time) - Modification Cost: Medium - Needs interface documentation per external script or Wrapper function addition</p> <p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/srp-violation-analysis/","title":"SRP Violations","text":"<p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/srp-violation-analysis/#dlxjenkinsjenkinsfile-286-lines","title":"DLXJenkins/Jenkinsfile (286 lines)","text":""},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/srp-violation-analysis/#1-srp-violation-analysis-criteria","title":"1. SRP Violation Analysis Criteria","text":"<ul> <li>Jenkinsfile Role: Orchestration (pipeline sequence/flow control)</li> <li>SRP Violation Condition: If actual Logic exists in Jenkinsfile, Jenkinsfile also needs modification when that domain changes</li> <li>Analysis Method: Using domain classification from pipeline-sequence-diagrams/dlx-ci.md</li> </ul>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/srp-violation-analysis/#2-functional-domains-and-logic-presence","title":"2. Functional Domains and Logic Presence","text":"<p>Reference: dlx-ci.md - Functional Domain Summary</p> Domain Stage Logic Exists in Jenkinsfile Description Git Management Prepare WORKSPACE, Post \u2717 Delegated to Helper (<code>cloneOrUpdateRepo</code>, <code>checkoutBranch</code>) Bitbucket API Prepare WORKSPACE, Linting, Code Coverage, Build, Post \u25b3 Python script direct call (path/args hardcoded) Unity CLI Prepare WORKSPACE, EditMode, PlayMode, Code Coverage, Build \u25b3 <code>stageName</code>/<code>errorMsg</code> hardcoded, Helper call Web Server (SSH/SCP) Code Coverage, Build \u25b3 Report path/type hardcoded Linting (Bash) Linting \u25cb Bash script direct call, exitCode branch logic Environment Setup Prepare WORKSPACE \u25b3 <code>sh 'env'</code>, script loading path, directory creation <p>(\u25cb: Logic exists, \u25b3: Partial (hardcoding/direct calls), \u2717: Fully delegated to Helper)</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/srp-violation-analysis/#3-stage-by-stage-srp-violation-analysis","title":"3. Stage-by-Stage SRP Violation Analysis","text":""},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/srp-violation-analysis/#change-reasons-summary-by-stage","title":"Change Reasons Summary by Stage","text":"Lines Stage/Area Change Reasons 64-118 <code>Prepare WORKSPACE</code> stage 5 reasons: env output policy + script loading path + branch check policy + Unity version detection policy + Rider sync policy 119-167 <code>Linting</code> stage 5 reasons: Directory structure + editorconfig path + Linting.bash script + exit code handling + Python report script 172-187 <code>EditMode Tests</code> stage 3 reasons: Test results directory + coverage results directory + Unity stage name/error message 190-201 <code>PlayMode Tests</code> stage Unity stage name/error message 204-227 <code>Code Coverage</code> stage 3 reasons: Unity stage name/error message + report path/type + test report args 229-258 <code>Build Project</code> stage 6 reasons: Assets/Editor path + Builder.cs location + Unity stage name/error message + DEBUG_MODE handling + Python report script + build results path Multi-responsibility Area: <code>Prepare WORKSPACE</code> stage (5 change reasons) <pre><code>stage('Prepare WORKSPACE') {\n    steps {\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                sh 'env'                                              // Change reason 1: env output policy\n                try {\n                    generalUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")  // Change reason 2: script loading path\n                    unityUtil = load(\"${env.WORKSPACE}/groovy/unityHelper.groovy\")\n                    // ...\n                } catch (Exception e) { ... }\n\n                if (generalUtil.isBranchUpToDateWithRemote(PR_BRANCH) &amp;&amp; !TEST_RUN.equals('Y')) {  // Change reason 3: branch check policy\n                    // ...\n                }\n                // Helper function calls (excluded)\n            }\n        }\n\n        // Unity Setup\n        script {\n            env.UNITY_EXECUTABLE = unityUtil.getUnityExecutable(env.WORKSPACE, PROJECT_DIR)  // Change reason 4: Unity version detection policy\n        }\n\n        // Initial running the project on Unity Editor\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                env.UNITY_EXECUTABLE = unityUtil.getUnityExecutable(env.WORKSPACE, PROJECT_DIR)  // (duplicate call)\n            }\n            script {\n                String stageName = 'Rider'\n                String errorMassage = 'Synchronizing Unity and Rider IDE solution files failed'\n                unityUtil.runUnityStage(stageName, errorMassage)  // Change reason 5: Rider sync policy\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When env output policy changes (line 70): Debug output conditions 2. When script loading path changes (lines 72-73): Helper file location 3. When branch check policy changes (lines 82-86): Duplicate build prevention conditions 4. When Unity version detection policy changes (lines 101, 108): getUnityExecutable call method 5. When Rider sync policy changes (lines 112-114): runUnityStage('Rider') call</p> <p>Helper function calls (getFullCommitHash, initializeEnvironment, cloneOrUpdateRepo, mergeBranchIfNeeded) are generalHelper.groovy's responsibility, so excluded</p> Multi-responsibility Area: <code>Linting</code> stage (5 change reasons) <pre><code>stage('Linting') {\n    steps {\n        dir(\"${REPORT_DIR}\") {\n            sh 'mkdir -p linting_results'   // Change reason 1: lint results directory structure\n        }\n        echo 'running lint script'\n        script {\n            sh \"cp -f '${env.WORKSPACE}/Bash/.editorconfig' '${PROJECT_DIR}' 2&gt;/dev/null\"  // Change reason 2: editorconfig path\n            def exitCode = sh script: \"\"\"sh '${env.WORKSPACE}/Bash/Linting.bash' \\\\\n                '${PROJECT_DIR}' '${REPORT_DIR}/linting_results'\"\"\", returnStatus: true  // Change reason 3: Linting.bash script\n\n            if (exitCode != 0) {\n                if (exitCode == 2) {  // Change reason 4: exit code handling policy\n                    sh script: \"\"\"python '${env.WORKSPACE}/python/linting_error_report.py' \\\\\n                        '${REPORT_DIR}/linting_results/format-report.json' \\\\\n                        ${COMMIT_HASH} ${fail} '${PROJECT_DIR}'\"\"\"  // Change reason 5: Python report script\n                }\n                catchError(buildResult: buildResults.SUCCESS, stageResult: stageResults.FAILURE) {\n                    error(\"Linting failed with exit code: ${exitCode}\")\n                }\n            } else {\n                sh script: \"\"\"python '${env.WORKSPACE}/python/linting_error_report.py' ...\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When lint results directory structure changes (line 123): Folder structure 2. When editorconfig path changes (line 127): Config file location 3. When Linting.bash script changes (lines 129-131): Bash script interface 4. When exit code handling policy changes (lines 133, 141): exit code branch 5. When Python report script changes (lines 143-146): Report generation args</p> Multi-responsibility Area: <code>EditMode Tests</code> stage (3 change reasons) <pre><code>stage('EditMode Tests') {\n    steps {\n        dir(\"${REPORT_DIR}\") {\n            sh 'mkdir -p test_results'      // Change reason 1: test results directory structure\n            sh 'mkdir -p coverage_results'  // Change reason 2: coverage results directory structure\n        }\n        echo 'Running EditMode tests...'\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                String stageName = 'EditMode'  // Change reason 3: Unity stage name/error message hardcoded\n                String errorMassage = 'EditMode tests failed'\n                unityUtil.runUnityStage(stageName, errorMassage)  // Helper call (excluded)\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When test results directory structure changes (line 175): <code>test_results</code> folder structure 2. When coverage results directory structure changes (line 176): <code>coverage_results</code> folder structure 3. When Unity stage name/error message changes (lines 181-182): <code>stageName</code>, <code>errorMassage</code> hardcoded</p> Multi-responsibility Area: <code>Code Coverage</code> stage (3 change reasons) <pre><code>stage('Code Coverage\\nSend Reports') {\n    steps {\n        dir(\"${PROJECT_DIR}\") {\n            echo 'Generating code coverage report...'\n            script {\n                String stageName = 'Coverage'  // Change reason 1: Unity stage name/error message\n                String errorMassage = 'Code Coverage generation failed'\n                unityUtil.runUnityStage(stageName, errorMassage)  // Helper call\n            }\n\n            echo 'Sending test report to Bitbucket.'\n            script {\n                generalUtil.publishTestResultsHtmlToWebServer(  // Change reason 2: report path/type hardcoded\n                    FOLDER_NAME, TICKET_NUMBER,\n                    \"${REPORT_DIR}/coverage_results/Report\", 'CodeCoverage'\n                )\n                unityUtil.sendTestReport(env.WORKSPACE, REPORT_DIR, COMMIT_HASH)  // Change reason 3: test report args\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When Unity stage name/error message changes (lines 210-211): <code>stageName</code>, <code>errorMassage</code> hardcoded 2. When report path/type changes (lines 217-219): <code>coverage_results/Report</code>, <code>'CodeCoverage'</code> hardcoded 3. When test report args change (line 221): <code>sendTestReport</code> call args</p> Multi-responsibility Area: <code>Build Project</code> stage (6 change reasons) <pre><code>stage('Build Project') {\n    steps {\n        script {\n            echo 'Building Unity project...'\n            sh \"mkdir -p \\\"${PROJECT_DIR}/Assets/Editor/\\\"\"  // Change reason 1: Assets/Editor path\n            sh \"cp Builder.cs \\\"${PROJECT_DIR}/Assets/Editor/\\\"\"  // Change reason 2: Builder.cs location\n\n            String stageName = 'Webgl'  // Change reason 3: Unity stage name/error message\n            String errorMassage = 'WebGL Build failed'\n            unityUtil.runUnityStage(stageName, errorMassage)  // Helper call\n\n            echo 'Sending Bitbucket WebGL build report'\n            String pythonArgs = \" ${COMMIT_HASH} ${REPORT_DIR}/build_project_results/*.log\"\n\n            if ((params.DEBUG_MODE ?: '').toUpperCase() == 'Y') {  // Change reason 4: DEBUG_MODE handling\n                pythonArgs += ' --debug'\n            }\n            sh \" python ${env.WORKSPACE}/python/create_bitbucket_webgl_build_report.py ${pythonArgs}\"  // Change reason 5: Python report script\n\n            generalUtil.publishBuildResultsToWebServer(FOLDER_NAME, TICKET_NUMBER,  // Change reason 6: build results path hardcoded\n                \"${PROJECT_DIR}/Builds\", \"${REPORT_DIR}/build_project_results\")\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When Assets/Editor path changes (line 234): Directory structure 2. When Builder.cs location changes (line 235): Build script path 3. When Unity stage name/error message changes (lines 237-238): <code>stageName</code>, <code>errorMassage</code> hardcoded 4. When DEBUG_MODE handling changes (lines 247-249): Debug flag handling 5. When Python report script changes (line 251): Report generation 6. When build results path changes (lines 253-254): <code>${PROJECT_DIR}/Builds</code>, <code>build_project_results</code> hardcoded</p>"},{"location":"problem-analysis/04-DLXJenkins-Jenkinsfile/srp-violation-analysis/#conclusion","title":"Conclusion","text":"<p>SRP Violation: - Logic from 5 domains exists in Jenkinsfile (except Git Management) - Linting Stage: Bash script direct call + exitCode branch logic exists in Jenkinsfile - Hardcoding in many Stages: <code>stageName</code>/<code>errorMsg</code>, paths, Python script args, etc. - Orchestration Role Violation: Domain logic directly included in Jenkinsfile requires Jenkinsfile modification when that domain changes</p> <p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/","title":"Design Smells","text":"<p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#dlxjenkinsjenkinsfiledeployment-design-smells-symptoms-analysis","title":"DLXJenkins/JenkinsfileDeployment - Design Smells Symptoms Analysis","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Symptoms analysis based on static analysis results (SRP, Software Smells, DRY) + code review</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#summary","title":"Summary","text":"Symptom Severity Key Evidence Rigidity High Shotgun Surgery (4 Unity Stages + 2 deployment servers) Fragility High 7 domains mixed, 9 implicit dependencies Immobility High 265 lines/7 Stages, entire CD pipeline orchestration Viscosity High Missing Encapsulation \u2192 copying deployment pattern/stageName is easier Needless Complexity Low Not applicable Needless Repetition High DRY violation (deployment pattern 2 times + stageName 4 times repeated) Opacity Medium Direct environment variable access"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence","title":"Inference Evidence","text":"Symptom Evidence Source Rigidity Shotgun Surgery 4 Unity Stages + 2 deployment servers Code Smells Fragility Divergent Change 7 domains + Implicit Dependency 9 Code Smells + Arch Smells Immobility Multifaceted Abstraction entire CD pipeline orchestration Design Smells Viscosity Missing Encapsulation deployment pattern + Unity Stage not encapsulated Design Smells Needless Complexity Not applicable - Needless Repetition Duplicated Code deployment pattern 2 times + stageName 4 times Code Smells Opacity Direct code review Code Review"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#1-rigidity","title":"1. Rigidity","text":"<p>Definition: Changing one place requires cascading changes in other places</p> <p>Symptom: \"Thought it was a simple change but it was much more complex\"</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-shotgun-surgery","title":"Inference Evidence: Shotgun Surgery","text":"<p>Unity Stage name hardcoded locations (4 places):</p> Line Number Stage Name Error Message 120-122 <code>'Rider'</code> <code>'Synchronizing Unity and Rider IDE solution files failed'</code> 164-166 <code>'EditMode'</code> <code>'EditMode tests failed'</code> 178-180 <code>'PlayMode'</code> <code>'PlayMode tests failed'</code> 193-195 <code>'Webgl'</code> <code>'WebGL Build failed'</code> <p>Deployment server pattern repetition (2 places): - Lines 205-209: LTI server (SSH mkdir + SCP + SSH UpdateBuildURL.sh) - Lines 218-233: eConestoga server (same pattern)</p> <p>Conclusion: 4 places for Stage name changes + 2 places for deployment command changes required \u2192 High Rigidity</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#2-fragility","title":"2. Fragility","text":"<p>Definition: Modifying one place breaks conceptually unrelated places</p> <p>Symptom: \"Why did that break when I touched this?\"</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-divergent-change-implicit-cross-module-dependency","title":"Inference Evidence: Divergent Change + Implicit Cross-module Dependency","text":"<p>7 domains mixed in one file: - Jenkins environment config, Git workflow, Bitbucket status, Unity config, Linting, Unity build, Deployment (SSH/SCP)</p> <p>9 implicit dependencies: - <code>Bash/Linting.bash</code>, <code>Bash/.editorconfig</code>, <code>Builder.cs</code> - <code>ShellScripts/UpdateBuildURL.sh</code> (remote server) - <code>generalHelper.groovy</code>, <code>unityHelper.groovy</code> - SSH/SCP commands, <code>env.DLX_LIST</code> environment variable - Jenkins Pipeline DSL</p> <p>Potential Fragility scenarios:</p> Change Expected Impact Actual Impact (Inferred) SSH key path change Deploy Build Both LTI + eConestoga affected Remote server UpdateBuildURL.sh change Deploy Build Deployment failure (detected only at runtime) Git checkout order change Prepare WORKSPACE Unity project state inconsistency <p>Conclusion: 7 domains mixed + 9 implicit dependencies \u2192 High Fragility</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#3-immobility","title":"3. Immobility","text":"<p>Definition: Difficult to extract useful parts and reuse in other systems/modules</p> <p>Symptom: \"Too many dependencies come along when trying to separate\"</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-multifaceted-abstraction","title":"Inference Evidence: Multifaceted Abstraction","text":"<p>Entire CD pipeline orchestration: - Single 265-line Jenkinsfile handles entire DLX CD flow - Unlike CI, Git commands directly included (no Helper usage)</p> <p>Problems when attempting separation:</p> Extraction Target Dependencies That Follow CleanupStage generalUtil loading, branch check, web server cleanup PrepareStage Git commands (clone/checkout/reset/pull), Bitbucket status, Unity config DeployStage SSH/SCP pattern, server URL, UpdateBuildURL.sh path <p>Conclusion: Entire CD pipeline in single file + Git commands directly included \u2192 High Immobility</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#4-viscosity","title":"4. Viscosity","text":"<p>Definition: The right way (preserving design) is harder than the wrong way (hacking)</p> <p>Symptom: \"It takes too long to do it properly, so let's just do it this way for now\"</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-missing-encapsulation-dry-violation-induced","title":"Inference Evidence: Missing Encapsulation \u2192 DRY Violation Induced","text":"<p>Current state (Missing Encapsulation): - stageName/errorMsg pattern repeated 4 times - SSH/SCP deployment pattern repeated 2 times (LTI + eConestoga)</p> <p>Right way vs Hacking:</p> Situation Right Way Hack Tendency Add new deployment server Create deployment function and call Copy-paste existing SSH/SCP pattern Copy (faster) Change SSH options Modify deployment function Manually modify 2 places Manual (faster) <p>Conclusion: Lack of encapsulation makes \"copying is easier\" structure \u2192 High Viscosity</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#5-needless-complexity","title":"5. Needless Complexity","text":"<p>Definition: Excessive design for features not currently needed</p> <p>Symptom: YAGNI violation, \"might need it later\"</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence_1","title":"Inference Evidence","text":"<p>Dead Code or excessive design: Not applicable</p> <p>Conclusion: Low Needless Complexity</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#6-needless-repetition","title":"6. Needless Repetition","text":"<p>Definition: Code that could be unified through abstraction is duplicated in multiple places</p> <p>Symptom: DRY violation, \"similar code in multiple places\"</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-duplicated-code","title":"Inference Evidence: Duplicated Code","text":"<p>1. Deployment server pattern repeated 2 times (LTI vs eConestoga):</p> Server Line Numbers Pattern LTI 205-209 <code>ssh mkdir</code> + <code>scp</code> + <code>ssh UpdateBuildURL.sh</code> eConestoga 218-233 Same pattern, only URL differs <p>2. stageName/errorMassage pattern repeated 4 times (3 lines \u00d7 4 = 12 lines duplicated)</p> <p>Improvement direction: <pre><code>def deployToServer(serverUrl, folderName, sourcePath) {\n    sh \"ssh -i ${env.SSH_KEY} ${serverUrl} \\\"sudo mkdir -p /var/www/html/${folderName}...\\\"\"\n    sh \"scp -i ${env.SSH_KEY} -rp ${sourcePath}/* ${serverUrl}:/var/www/html/${folderName}\"\n    sh \"ssh -i ${env.SSH_KEY} ${serverUrl} 'bash ~/ShellScripts/UpdateBuildURL.sh /var/www/html/${folderName}'\"\n}\n</code></pre></p> <p>Conclusion: Deployment pattern 2 times + stageName 4 times repeated \u2192 High Needless Repetition</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#7-opacity","title":"7. Opacity","text":"<p>Definition: Code is hard to understand and intent is unclear</p> <p>Symptom: \"What does this code do?\"</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#code-review-results","title":"Code Review Results","text":"Type Location Problem Description Direct environment variable access Lines 205-231 <code>env.SSH_KEY</code>, <code>env.DLX_WEB_HOST_URL</code> Environment variable names not documented"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/design-smells-symptoms/#severity-classification","title":"Severity Classification","text":"<p>Medium (maintenance difficulty): - Direct environment variable access: <code>env.SSH_KEY</code>, <code>env.DLX_WEB_HOST_URL</code> (lines 205-231) - Environment variable names not documented</p> <p>Conclusion: Direct environment variable access \u2192 Medium Opacity</p> <p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/","title":"Software Smells","text":"<p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#dlxjenkinsjenkinsfiledeployment-software-smells-analysis","title":"DLXJenkins/JenkinsfileDeployment - Software Smells Analysis","text":"<p>Level-based classification: Code Smell (function level) \u2192 Design Smell (module level) \u2192 Architecture Smell (system level)</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#summary","title":"Summary","text":"Level Category Smell Type Severity Code Change Preventers Divergent Change High Code Change Preventers Shotgun Surgery Medium Code Dispensables Duplicated Code High Code Bloaters Primitive Obsession Low Design Abstraction Multifaceted Abstraction High Design Abstraction Missing Abstraction Medium Design Encapsulation Missing Encapsulation High Design Abstraction Imperative Abstraction Medium Architecture Dependency Issues Implicit Cross-module Dependency High"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#1-code-smells-methodfunction-level","title":"1. Code Smells (Method/Function Level)","text":"<p>Source: Fowler, M. (1999). Refactoring: Improving the Design of Existing Code</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#11-change-preventers","title":"1.1 Change Preventers","text":"Divergent Change (7 change reasons) <p>Definition: A single class/file is frequently changed for multiple different reasons</p> Change Reason Affected Area Line Numbers Example Scenario Jenkins environment config change <code>Delete Merged Branch</code>, <code>Prepare WORKSPACE</code> 57-62, 88-89 Script loading path, JSON parsing logic change Git workflow change <code>Prepare WORKSPACE</code> 92-106 clone/checkout/reset/pull policy change Bitbucket status API change <code>Prepare WORKSPACE</code>, <code>post</code> 110, 251, 256, 261 sendBuildStatus argument format change Unity config change <code>Prepare WORKSPACE</code> 113, 120-122 Unity version detection, Rider sync policy change Linting policy change <code>Linting</code> 128-153 editorconfig path, exit code handling change Unity build change <code>EditMode Tests</code>, <code>PlayMode Tests</code>, <code>Build Project</code> 156-198 Test/Build Stage changes Deployment server config change <code>Deploy Build</code> 200-237 SSH/SCP commands, server URL, directory structure change <p>Severity Evidence: - Impact Range: High - Single Jenkinsfile handles entire CD pipeline logic - Bug Potential: Medium - Modifying one domain may cause unexpected impact on other domains - Modification Cost: Medium - Separating 7 domains requires shared library or separate script extraction</p> Shotgun Surgery (4 locations to modify when changing Unity Stage names) <p>Definition: A single change requires modification of multiple classes/functions</p> <p>Unity Stage name hardcoded locations:</p> Line Number Stage Name Error Message 120-122 <code>'Rider'</code> <code>'Synchronizing Unity and Rider IDE solution files failed'</code> 164-166 <code>'EditMode'</code> <code>'EditMode tests failed'</code> 178-180 <code>'PlayMode'</code> <code>'PlayMode tests failed'</code> 193-195 <code>'Webgl'</code> <code>'WebGL Build failed'</code> <p>Change Scenario: If <code>unityHelper.groovy</code> Stage constant name changes from <code>'Webgl'</code> \u2192 <code>'WebGL'</code>: - JenkinsfileDeployment line 193 needs modification - Missing this causes <code>runUnityStage</code> call to fail with incorrect Stage name</p> <p>Severity Evidence: - Impact Range: Medium - 4 locations within single JenkinsfileDeployment file need modification - Bug Potential: High - Missing even one of 4 locations causes Stage failure - Modification Cost: Low - Simple fix by extracting Stage names to constants</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#12-dispensables","title":"1.2 Dispensables","text":"Duplicated Code (deployment pattern repeated 2 times + stageName/errorMassage pattern repeated 4 times) <p>Definition: Same code pattern repeated in multiple places</p> <p>1. Deployment server pattern repetition (LTI vs eConestoga):</p> <pre><code>// Lines 205-209 (LTI server deployment)\nsh \"ssh -i ${env.SSH_KEY} ${env.DLX_WEB_HOST_URL} \\\"sudo mkdir -p /var/www/html/${FOLDER_NAME} \\\n&amp;&amp; sudo chown vconadmin:vconadmin /var/www/html/${FOLDER_NAME}\\\"\"\nsh \"scp -i ${env.SSH_KEY} -rp ${PROJECT_DIR}/Builds/* \\\"${env.DLX_WEB_HOST_URL}:/var/www/html/${FOLDER_NAME}\\\"\"\nsh \"ssh -i ${env.SSH_KEY} ${env.DLX_WEB_HOST_URL} 'bash ~/ShellScripts/UpdateBuildURL.sh /var/www/html/${FOLDER_NAME}'\"\n\n// Lines 218-233 (eConestoga server deployment) - Same pattern, only server URL differs\nsh \"ssh -i ${env.SSH_KEY} ${env.DLX_ECONESTOGA_URL} ...\"\nsh \"scp -i ${env.SSH_KEY} -rp ... ${env.DLX_ECONESTOGA_URL}:...\"\nsh \"ssh -i ${env.SSH_KEY} ${env.DLX_ECONESTOGA_URL} ...\"\n</code></pre> <p>\u2192 When adding deployment server: Copy-paste of same pattern required (15+ lines of duplication for 3rd server)</p> <p>2. stageName/errorMassage pattern repetition (3 lines \u00d7 4 times = 12 lines of duplication):</p> <pre><code>// Lines 120-122, 164-166, 178-180, 193-195 same pattern\nString stageName = '...'\nString errorMassage = '...'\nunityUtil.runUnityStage(stageName, errorMassage)\n</code></pre> <p>Severity Evidence: - Impact Range: High - Deployment pattern duplication requires full logic copy when adding new server - Bug Potential: High - Inconsistency if only one of 2 locations modified when changing SSH options, paths, etc. - Modification Cost: Medium - Refactoring needed to extract deployment logic into function</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#13-bloaters","title":"1.3 Bloaters","text":"Primitive Obsession <p>Definition: Primitive types (strings) used instead of objects/constants</p> Case Current State Line Numbers Problem Stage names <code>'Rider'</code>, <code>'EditMode'</code>, <code>'PlayMode'</code>, <code>'Webgl'</code> strings 120, 164, 178, 193 Duplicate definition with unityHelper constants Directory names <code>'linting_results'</code>, <code>'test_results'</code> strings 133, 159 Same names repeated across multiple Stages Server paths <code>'/var/www/html/${FOLDER_NAME}'</code> string 205-206, 220, 226, 232 Same path repeated in 4 locations Main branch list <code>['main', 'master']</code> array 3 Hardcoded branch names <p>Severity Evidence: - Impact Range: Low - Affects only functions within single JenkinsfileDeployment file - Bug Potential: Low - No issues with current behavior, just maintenance inconvenience - Modification Cost: Low - Simple fix by extracting to constants</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#2-design-smells-modulefile-level","title":"2. Design Smells (Module/File Level)","text":""},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#21-symptoms-martin-2000","title":"2.1 Symptoms (Martin 2000)","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Detailed analysis inferred from static analysis results: design-smells-symptoms.md</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#22-principles-suryanarayana-2014","title":"2.2 Principles (Suryanarayana 2014)","text":"<p>Source: Suryanarayana, G. et al. (2014). Refactoring for Software Design Smells</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#abstraction-smells","title":"Abstraction Smells","text":"Multifaceted Abstraction <p>Definition: A single abstraction (class/file) represents multiple concerns (SRP violation)</p> <p>JenkinsfileDeployment's 4 domains: - Jenkins environment config: Script loading, JSON parsing, folder name extraction - Git/Bitbucket: Branch cleanup, clone, checkout, reset, pull, status sending - Unity build: Rider sync, Linting, EditMode/PlayMode tests, WebGL build - Deployment: SSH directory creation, SCP file copy, UpdateBuildURL.sh call (2 servers)</p> <p>Modules needing separation: - <code>CleanupStage.groovy</code>: Branch cleanup, web server cleanup - <code>PrepareStage.groovy</code>: Git workflow, Unity config - <code>BuildStage.groovy</code>: Linting, tests, WebGL build - <code>DeployStage.groovy</code>: SSH/SCP deployment logic (per-server abstraction)</p> <p>\u2192 Related symptom: Divergent Change (single file changes for 7 different reasons)</p> Missing Abstraction <p>Definition: Concepts implemented with primitive types or strings instead of dedicated classes/constants</p> Concept Needing Abstraction Current State Line Numbers Affected Area Deployment server config <code>env.DLX_WEB_HOST_URL</code>, <code>env.DLX_ECONESTOGA_URL</code> scattered 205-209, 218-233 Deploy Build Server path <code>'/var/www/html/${FOLDER_NAME}'</code> repeated 4 times 205-206, 220, 226, 232 Deploy Build Unity Stage names <code>'Rider'</code>, <code>'EditMode'</code>, <code>'PlayMode'</code>, <code>'Webgl'</code> hardcoded 120, 164, 178, 193 4 Stages Directory names <code>'linting_results'</code>, <code>'test_results'</code> 133, 159 Linting, EditMode Main branch list <code>['main', 'master']</code> hardcoded 3 Delete Merged Branch <p>Deployment server abstraction needed: <pre><code>// Before: Hardcoded per server\nsh \"ssh -i ${env.SSH_KEY} ${env.DLX_WEB_HOST_URL} ...\"\nsh \"ssh -i ${env.SSH_KEY} ${env.DLX_ECONESTOGA_URL} ...\"\n\n// After: Server config objectified\ndef DEPLOY_SERVERS = [\n    lti:        [url: env.DLX_WEB_HOST_URL,    name: 'LTI'],\n    econestoga: [url: env.DLX_ECONESTOGA_URL, name: 'eConestoga']\n]\n</code></pre></p> <p>\u2192 Related symptoms: - Primitive Obsession (server config expressed as primitive type strings) - Shotgun Surgery (4 locations need simultaneous modification when Stage names change)</p> Imperative Abstraction <p>Definition: Abstraction operations written procedurally rather than object-oriented</p> <p>JenkinsfileDeployment's Imperative Abstraction evidence:</p> <p>Procedural script structure due to Jenkins Pipeline DSL characteristics: - <code>stage()</code> blocks execute sequentially - Connected to external scripts/servers via implicit contracts - Called via <code>sh</code> commands without explicit interfaces</p> External System Call Method Implicit Contract <code>Bash/Linting.bash</code> <code>sh script: \"sh '${path}' ...\"</code> Argument order, exit code meaning <code>ShellScripts/UpdateBuildURL.sh</code> <code>sh \"ssh ... 'bash ~/ShellScripts/...'\"</code> Script exists on remote server + argument format SSH/SCP commands <code>sh \"ssh -i ${env.SSH_KEY} ...\"</code> Environment variables exist, server accessible <code>env.DLX_LIST</code> <code>DLX_LIST.split(',')</code> Environment variable exists, comma-separated format <p>\u2192 Related symptom: Implicit Cross-module Dependency (implicit contracts with 9 external systems)</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#encapsulation-smells","title":"Encapsulation Smells","text":"Missing Encapsulation <p>Definition: Variations not encapsulated, causing logic to be scattered</p> <p>1. Deployment pattern repetition (LTI vs eConestoga):</p> Location Server Pattern (3 lines) Lines 205-209 LTI <code>ssh mkdir</code> + <code>scp</code> + <code>ssh UpdateBuildURL.sh</code> Lines 218-233 eConestoga Same pattern, only URL differs <p>Encapsulation approach: Extract to deployment function</p> <pre><code>// Before: Repeated 2 times (copy-paste when adding server)\nsh \"ssh -i ${env.SSH_KEY} ${env.DLX_WEB_HOST_URL} \\\"sudo mkdir -p /var/www/html/${FOLDER_NAME}...\\\"\"\nsh \"scp -i ${env.SSH_KEY} -rp ${PROJECT_DIR}/Builds/* ...\"\nsh \"ssh -i ${env.SSH_KEY} ${env.DLX_WEB_HOST_URL} 'bash ~/ShellScripts/UpdateBuildURL.sh ...'\"\n\n// After: Encapsulated in function\ndef deployToServer(serverUrl, folderName, sourcePath) {\n    sh \"ssh -i ${env.SSH_KEY} ${serverUrl} \\\"sudo mkdir -p /var/www/html/${folderName}...\\\"\"\n    sh \"scp -i ${env.SSH_KEY} -rp ${sourcePath}/* ${serverUrl}:/var/www/html/${folderName}\"\n    sh \"ssh -i ${env.SSH_KEY} ${serverUrl} 'bash ~/ShellScripts/UpdateBuildURL.sh /var/www/html/${folderName}'\"\n}\ndeployToServer(env.DLX_WEB_HOST_URL, FOLDER_NAME, \"${PROJECT_DIR}/Builds\")\ndeployToServer(env.DLX_ECONESTOGA_URL, FOLDER_NAME, \"${PROJECT_DIR}/Builds\")\n</code></pre> <p>2. Unity Stage execution pattern repetition (3 lines \u00d7 4 times = 12 lines):</p> Location Stage Name Pattern Lines 120-122 Rider <code>String stageName = 'Rider'; String errorMassage = '...'; unityUtil.runUnityStage(...)</code> Lines 164-166 EditMode Same pattern Lines 178-180 PlayMode Same pattern Lines 193-195 Webgl Same pattern <p>\u2192 Related symptoms: - Duplicated Code (deployment pattern 2 times + Stage pattern 4 times repeated) - Shotgun Surgery (2 locations for SSH option changes, 4 locations for error message format changes)</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#3-architecture-smells-system-level","title":"3. Architecture Smells (System Level)","text":"<p>Source: Garcia et al. (2009), Lippert &amp; Roock (2006), Sharma &amp; Spinellis (2018)</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/software-smells-analysis/#31-dependency-issues","title":"3.1 Dependency Issues","text":"Implicit Cross-module Dependency <p>Definition: Hidden dependencies causing coupling to external systems without explicit interfaces</p> External System Line Numbers Implicit Contract Content <code>Bash/Linting.bash</code> 139-141 Argument format (projectDir, reportDir) + exit code meaning <code>Bash/.editorconfig</code> 137 File existence and location <code>Builder.cs</code> 191 File existence and location (<code>mv Builder.cs</code>) <code>ShellScripts/UpdateBuildURL.sh</code> 209, 232 Script exists on remote server + argument format (buildPath) <code>generalHelper.groovy</code> 57 <code>load()</code> success + function signatures (parseJson, getFullCommitHash, cleanUpPRBranch, sendBuildStatus, etc.) <code>unityHelper.groovy</code> 58 <code>load()</code> success + function signatures (getUnityExecutable, runUnityStage) SSH/SCP commands 205-209, 218-233 <code>env.SSH_KEY</code>, <code>env.DLX_WEB_HOST_URL</code>, <code>env.DLX_ECONESTOGA_URL</code> environment variables exist <code>env.DLX_LIST</code> 48 Environment variable exists + comma-separated format Jenkins Pipeline DSL Entire file <code>env</code>, <code>sh()</code>, <code>dir()</code>, <code>echo()</code>, <code>error()</code>, <code>fileExists()</code>, <code>currentBuild</code>, etc. <p>Severity Evidence: - Impact Range: High - Affects JenkinsfileDeployment + 9 external systems/scripts - Bug Potential: High - Runtime errors occur when remote server scripts/environment variables change (not detectable at compile time) - Modification Cost: Medium - Interface documentation or Wrapper functions needed per external system</p> <p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/srp-violation-analysis/","title":"SRP Violations","text":"<p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/srp-violation-analysis/#dlxjenkinsjenkinsfiledeployment-265-lines","title":"DLXJenkins/JenkinsfileDeployment (265 lines)","text":""},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/srp-violation-analysis/#1-srp-violation-analysis-criteria","title":"1. SRP Violation Analysis Criteria","text":"<ul> <li>Jenkinsfile Role: Orchestration (pipeline sequence/flow control)</li> <li>SRP Violation Condition: If actual Logic exists in Jenkinsfile, Jenkinsfile modification is required when that domain changes</li> <li>Analysis Method: Using domain classification from pipeline-sequence-diagrams/dlx-cd.md</li> </ul>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/srp-violation-analysis/#2-functional-domains-and-logic-presence","title":"2. Functional Domains and Logic Presence","text":"<p>Reference: dlx-cd.md - Functional Domain Summary</p> Domain Stage Logic Exists in Jenkinsfile Description Git Management Prepare WORKSPACE, Post \u25cb Direct Git clone/checkout/reset/pull calls Bitbucket API Delete Merged Branch, Prepare WORKSPACE, Post \u25b3 <code>sendBuildStatus</code> arguments hardcoded Unity CLI Prepare WORKSPACE, EditMode, PlayMode, Build \u25b3 <code>stageName</code>/<code>errorMsg</code> hardcoded, Helper calls Web Server (SSH/SCP) Delete Merged Branch, Deploy Build \u25cb Direct SSH/SCP command calls, server paths hardcoded Linting (Bash) Linting \u25cb Direct Bash script calls, exitCode branching logic Environment Config Delete Merged Branch \u25b3 Script loading paths, <code>mainBranches</code> check PR Cleanup Delete Merged Branch \u25b3 Helper calls, folder name extraction rules <p>(\u25cb: Logic exists, \u25b3: Partially exists (hardcoded/direct calls), \u2717: Fully delegated to Helper)</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/srp-violation-analysis/#3-stage-by-stage-srp-violation-analysis","title":"3. Stage-by-Stage SRP Violation Analysis","text":""},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/srp-violation-analysis/#change-reasons-summary-by-stage","title":"Change Reasons Summary by Stage","text":"Lines Stage/Area Change Reasons 54-83 <code>Delete Merged Branch</code> 4 reasons: Script loading paths + JSON parsing logic + main branch list + folder name extraction rules 86-126 <code>Prepare WORKSPACE</code> 7 reasons: Directory existence check + Git clone + Git checkout + Git reset + Git pull + Bitbucket status arguments + Unity stage name/error message 128-153 <code>Linting</code> stage 4 reasons: Lint result directory + editorconfig path + Linting.bash script + exit code handling 156-170 <code>EditMode Tests</code> stage 2 reasons: Test result directory + Unity stage name/error message 173-184 <code>PlayMode Tests</code> stage Unity stage name/error message 186-198 <code>Build Project</code> stage 3 reasons: Assets/Editor path + Builder.cs location + Unity stage name/error message 200-237 <code>Deploy Build</code> 5 reasons: SSH directory creation + SCP copy options + UpdateBuildURL.sh script + DLX project list + eConestoga server config Multiple Responsibility Area: <code>Delete Merged Branch</code> (4 change reasons) <pre><code>stage('Delete Merged Branch') {\n    steps {\n        script {\n            generalUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")  // Change reason 1: Script loading path\n            unityUtil = load(\"${env.WORKSPACE}/groovy/unityHelper.groovy\")\n\n            buildResults = generalUtil.parseJson().buildResults  // Change reason 2: JSON parsing logic\n            stageResults = generalUtil.parseJson().stageResults\n\n            if (!mainBranches.contains(DESTINATION_BRANCH)) {  // Change reason 3: Main branch list\n                env.FAILURE_REASON = 'Not merging to the main branch. Exiting the pipeline...'\n                currentBuild.result = buildResults.ABORTED\n                error(env.FAILURE_REASON)\n            }\n\n            COMMIT_HASH = generalUtil.getFullCommitHash(env.WORKSPACE, PR_COMMIT)  // Helper call (excluded)\n\n            generalUtil.cleanUpPRBranch(PR_BRANCH)  // Helper call (excluded)\n\n            env.FOLDER_NAME = \"${JOB_NAME}\".split('/').first()  // Change reason 4: Folder name extraction rules\n            def ticketNumber = generalUtil.parseTicketNumber(PR_BRANCH)\n            generalUtil.cleanMergedBranchFromWebServer(FOLDER_NAME, ticketNumber)  // Helper call (excluded)\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When script loading path changes (lines 57-58): Helper file location 2. When JSON parsing logic changes (lines 61-62): Constants structure 3. When main branch list changes (lines 65-68): Allowed branch conditions 4. When folder name extraction rules change (line 78): JOB_NAME parsing</p> <p>Helper function calls (getFullCommitHash, cleanUpPRBranch, cleanMergedBranchFromWebServer) are generalHelper.groovy's responsibility, so excluded</p> Multiple Responsibility Area: <code>Prepare WORKSPACE</code> (7 change reasons) <pre><code>stage('Prepare WORKSPACE') {\n    environment {\n        REPO_SSH = \"git@bitbucket.org:${PR_PROJECT}.git\"\n    }\n    steps {\n        script {\n            if (!fileExists(\"${PROJECT_DIR}\")) {  // Change reason 1: Directory existence check method\n                echo 'First time running pipeline. Cloning main branch...'\n                sh \"git clone ${REPO_SSH} \\\"${PROJECT_DIR}\\\"\"  // Change reason 2: Git clone command\n            }\n        }\n\n        dir(\"${PROJECT_DIR}\") {\n            echo 'Checkout to the main branch...'\n            sh \"git checkout ${DESTINATION_BRANCH}\"  // Change reason 3: Git checkout workflow\n            echo 'Cleaning project...'\n            sh 'git reset --hard HEAD'  // Change reason 4: Git reset policy\n            echo 'Pulling latest version of default branch...'\n            sh 'git pull'  // Change reason 5: Git pull method\n        }\n\n        script {\n            echo \"Sending 'In Progress' status to Bitbucket...\"\n            generalUtil.sendBuildStatus(env.WORKSPACE, 'INPROGRESS', COMMIT_HASH, true)  // Change reason 6: Bitbucket status arguments hardcoded\n\n            echo 'Identifying Unity version...'\n            env.UNITY_EXECUTABLE = unityUtil.getUnityExecutable(env.WORKSPACE, PROJECT_DIR)  // Helper call\n        }\n\n        echo 'Running Unity in batch mode to setup initial files...'\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                String stageName = 'Rider'  // Change reason 7: Unity stage name/error message\n                String errorMassage = 'Synchronizing Unity and Rider IDE solution files failed'\n                unityUtil.runUnityStage(stageName, errorMassage)  // Helper call\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When directory existence check method changes (line 92): <code>fileExists()</code> condition 2. When Git clone command changes (line 94): clone options 3. When Git checkout workflow changes (line 101): checkout sequence 4. When Git reset policy changes (line 103): reset options 5. When Git pull method changes (line 105): pull options 6. When Bitbucket status arguments change (line 110): <code>'INPROGRESS'</code>, <code>true</code> hardcoded 7. When Unity stage name/error message changes (lines 118-119): <code>stageName</code>, <code>errorMassage</code> hardcoded</p> Multiple Responsibility Area: <code>Linting</code> stage (4 change reasons) <pre><code>stage('Linting') {\n    steps {\n        dir(\"${REPORT_DIR}\") {\n            sh 'mkdir -p linting_results'  // Change reason 1: Lint result directory structure\n        }\n        echo 'running lint script'\n        script {\n            sh \"cp -f '${env.WORKSPACE}/Bash/.editorconfig' '${PROJECT_DIR}' 2&gt;/dev/null\"  // Change reason 2: editorconfig path\n            def exitCode = sh script: \"\"\"sh '${env.WORKSPACE}/Bash/Linting.bash' \\\\\n                '${PROJECT_DIR}' \\\\\n                '${REPORT_DIR}/linting_results'\"\"\", returnStatus: true  // Change reason 3: Linting.bash script\n\n            if (exitCode != 0) {  // Change reason 4: Exit code handling policy\n                catchError(buildResult: buildResults.SUCCESS, stageResult: stageResults.FAILURE) {\n                    error(\"Linting failed with exit code: ${exitCode}\")\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When lint result directory structure changes (line 133): Folder structure 2. When editorconfig path changes (line 137): Config file location 3. When Linting.bash script changes (lines 139-141): Bash script interface 4. When exit code handling policy changes (lines 145-148): Exit code branching</p> Multiple Responsibility Area: <code>EditMode Tests</code> stage (2 change reasons) <pre><code>stage('EditMode Tests') {\n    steps {\n        dir(\"${REPORT_DIR}\") {\n            sh 'mkdir -p test_results'  // Change reason 1: Test result directory structure\n        }\n        echo 'Running EditMode tests...'\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                String stageName = 'EditMode'  // Change reason 2: Unity stage name/error message hardcoded\n                String errorMassage = 'EditMode tests failed'\n                unityUtil.runUnityStage(stageName, errorMassage)  // Helper call (excluded)\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When test result directory structure changes (line 159): Folder structure 2. When Unity stage name/error message changes (lines 164-165): <code>stageName</code>, <code>errorMassage</code> hardcoded</p> Multiple Responsibility Area: <code>Build Project</code> stage (3 change reasons) <pre><code>stage('Build Project') {\n    steps {\n        echo 'Building Unity project for WebGL...'\n        sh \"mkdir -p \\\"${PROJECT_DIR}/Assets/Editor/\\\"\"  // Change reason 1: Assets/Editor path\n        sh \"mv Builder.cs \\\"${PROJECT_DIR}/Assets/Editor/\\\"\"  // Change reason 2: Builder.cs location (mv command)\n        script {\n            String stageName = 'Webgl'  // Change reason 3: Unity stage name/error message hardcoded\n            String errorMassage = 'WebGL Build failed'\n            unityUtil.runUnityStage(stageName, errorMassage)  // Helper call (excluded)\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When Assets/Editor path changes (line 190): Directory structure 2. When Builder.cs location changes (line 191): File move with <code>mv</code> command 3. When Unity stage name/error message changes (lines 193-194): <code>stageName</code>, <code>errorMassage</code> hardcoded</p> Multiple Responsibility Area: <code>Deploy Build</code> (5 change reasons) <pre><code>stage('Deploy Build') {\n    steps {\n        echo 'Deploying build to LTI web server...'\n\n        script {\n            // Change reasons 1-2: SSH directory creation + SCP copy (LTI server)\n            sh \"\"\"ssh -i ${env.SSH_KEY} ${env.DLX_WEB_HOST_URL} \\\"sudo mkdir -p /var/www/html/${FOLDER_NAME} \\\\\n            &amp;&amp; sudo chown vconadmin:vconadmin /var/www/html/${FOLDER_NAME}\\\"\"\"\"\n            sh \"\"\"scp -i ${env.SSH_KEY} -rp ${PROJECT_DIR}/Builds/* \\\"${env.DLX_WEB_HOST_URL}:/var/www/html/${FOLDER_NAME}\\\"\"\"\"\n            sh \"\"\"ssh -i ${env.SSH_KEY} ${env.DLX_WEB_HOST_URL} 'bash ~/ShellScripts/UpdateBuildURL.sh /var/www/html/${FOLDER_NAME}'\"\"\"  // Change reason 3: UpdateBuildURL.sh script\n        }\n\n        script {\n            if (DLX_PROJECT_LIST.contains(PR_REPO_NAME)) {  // Change reason 4: DLX project list\n                echo 'Deploying build to eConestoga dlx web server...'\n\n                // Change reason 5: eConestoga server config (same pattern as LTI repeated)\n                sh script: \"\"\"\n                    ssh -i ${env.SSH_KEY} ${env.DLX_ECONESTOGA_URL} \\\\\n                    \\\"sudo mkdir -p /var/www/html/${FOLDER_NAME} &amp;&amp; sudo chown vconadmin:vconadmin /var/www/html/${FOLDER_NAME}\\\"\n                \"\"\"\n                sh script: \"\"\"\n                    scp -i ${env.SSH_KEY} -rp ${PROJECT_DIR}/Builds/* \\\\\n                    ${env.DLX_ECONESTOGA_URL}:/var/www/html/${FOLDER_NAME}\n                \"\"\"\n                sh script: \"\"\"\n                    ssh -i ${env.SSH_KEY} ${env.DLX_ECONESTOGA_URL} \\\\\n                    'bash ~/ShellScripts/UpdateBuildURL.sh /var/www/html/${FOLDER_NAME}'\n                \"\"\"\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When SSH directory creation command changes (lines 205-206): mkdir + chown options 2. When SCP copy options change (line 207): scp arguments 3. When UpdateBuildURL.sh script changes (line 209): Script path/arguments 4. When DLX project list changes (line 213): Condition list 5. When eConestoga server config changes (lines 218-232): Same as LTI \u2192 code copy-paste</p>"},{"location":"problem-analysis/05-DLXJenkins-JenkinsfileDeployment/srp-violation-analysis/#conclusion","title":"Conclusion","text":"<p>SRP Violation: - Logic from 6 domains exists in Jenkinsfile (PR cleanup partially delegated) - Git Management: Unlike CI, Git commands exist directly in Jenkinsfile (no Helper usage) - Deploy Build Stage: Direct SSH/SCP command calls + LTI/eConestoga same pattern repeated - Orchestration Role Violation: Domain logic directly included in Jenkinsfile, requiring Jenkinsfile modification when that domain changes</p> <p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/","title":"Design Smells","text":"<p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#jsjenkinsjenkinsfile-design-smells-symptoms-analysis","title":"JsJenkins/Jenkinsfile - Design Smells Symptoms Analysis","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Symptoms analysis based on static analysis results (SRP, Software Smells, DRY) + code review</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#summary","title":"Summary","text":"Symptom Severity Key Evidence Rigidity High Shotgun Surgery (6 locations to modify when adding new report type) Fragility High 5 domains mixed, 7 implicit dependencies Immobility High 314 lines/5 Stages, entire JS CI orchestration Viscosity High Missing Encapsulation \u2192 copying Server/Client reports is easier Needless Complexity Low Dead Code (commented-out code, incorrect comments) Needless Repetition High DRY violation (Server/Client report pattern 80 lines repeated) Opacity High Undefined variables, complex nesting"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence","title":"Inference Evidence","text":"Symptom Evidence Source Rigidity Shotgun Surgery 6 locations to modify when adding new report type Code Smells Fragility Divergent Change 5 domains + Implicit Dependency 7 Code Smells + Arch Smells Immobility Multifaceted Abstraction + Insufficient Modularization 112-line Stage Design Smells Viscosity Missing Encapsulation Server/Client report pattern not encapsulated Design Smells Needless Complexity Comments (Dead Code) commented-out code Code Smells Needless Repetition Duplicated Code Server/Client pattern 2 times Code Smells Opacity Direct code review Code Review"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#1-rigidity","title":"1. Rigidity","text":"<p>Definition: Changing one place requires cascading changes in other places</p> <p>Symptom: \"Thought it was a simple change but it was much more complex\"</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-shotgun-surgery","title":"Inference Evidence: Shotgun Surgery","text":"<p>Locations needing modification when adding new report type (e.g., 'admin'):</p> Line Number Modification Content 149-156 Add <code>publishTestResultsHtmlToWebServer</code> call 164 Add <code>params.ADMIN_SOURCE_FOLDER</code> condition 167 Add new folder in path 184 Add Python script flag (<code>' --admin'</code>) 206 Add new condition block (copy 40 lines) 226 Add Python script flag <p>Conclusion: 6 locations need simultaneous modification when adding new report type \u2192 High Rigidity</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#2-fragility","title":"2. Fragility","text":"<p>Definition: Modifying one place breaks conceptually unrelated places</p> <p>Symptom: \"Why did that break when I touched this?\"</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-divergent-change-implicit-cross-module-dependency","title":"Inference Evidence: Divergent Change + Implicit Cross-module Dependency","text":"<p>5 domains mixed in one file: - Jenkins environment config, Git/Bitbucket, npm/Node testing, Reports (web server/Bitbucket), SonarQube</p> <p>7 implicit dependencies: - <code>python/create_bitbucket_coverage_report.py</code> - <code>generalHelper.groovy</code>, <code>jsHelper.groovy</code> - SonarQube Scanner, SonarQube API - Jenkins params (<code>SERVER_SOURCE_FOLDER</code>, <code>CLIENT_SOURCE_FOLDER</code>, <code>DEBUG_MODE</code>) - Jenkins Pipeline DSL</p> <p>Potential Fragility scenarios:</p> Change Expected Impact Actual Impact (Inferred) Python script argument order change Unit Testing Both Server/Client affected SonarQube URL change Static Analysis Hardcoded URL needs modification params name change Unit Testing Reference failure in 6 locations <p>Conclusion: 5 domains mixed + 7 implicit dependencies \u2192 High Fragility</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#3-immobility","title":"3. Immobility","text":"<p>Definition: Difficult to extract useful parts and reuse in other systems/modules</p> <p>Symptom: \"Too many dependencies come along when trying to separate\"</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-multifaceted-abstraction-insufficient-modularization","title":"Inference Evidence: Multifaceted Abstraction + Insufficient Modularization","text":"<p>Unit Testing stage's excessive size: - 112 lines (lines 134-246) - 7 responsibilities mixed</p> <p>Problems when attempting separation:</p> Extraction Target Dependencies That Follow TestStage jsUtil, params, COMMIT_HASH ReportStage generalUtil, jsUtil, params, Python script, DEBUG_MODE AnalysisStage SonarQube Scanner, SonarQube API, generalUtil <p>Conclusion: Entire JS CI in single file + Unit Testing 112 lines \u2192 High Immobility</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#4-viscosity","title":"4. Viscosity","text":"<p>Definition: The right way (preserving design) is harder than the wrong way (hacking)</p> <p>Symptom: \"It takes too long to do it properly, so let's just do it this way for now\"</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-missing-encapsulation-dry-violation-induced","title":"Inference Evidence: Missing Encapsulation \u2192 DRY Violation Induced","text":"<p>Current state (Missing Encapsulation): - Server/Client report handling pattern repeated 2 times (40 lines each) - <code>publishTestResultsHtmlToWebServer</code> call repeated 2 times</p> <p>Right way vs Hacking:</p> Situation Right Way Hack Tendency Add new report type Create report handling function Copy-paste existing 40 lines Copy (faster) Change DEBUG_MODE handling Modify function Manually modify 2 places Manual (faster) <p>Conclusion: Lack of encapsulation makes \"copying is easier\" structure \u2192 High Viscosity</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#5-needless-complexity","title":"5. Needless Complexity","text":"<p>Definition: Excessive design for features not currently needed</p> <p>Symptom: YAGNI violation, \"might need it later\"</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-dead-code","title":"Inference Evidence: Dead Code","text":"Line Number Problem Content 52 Commented-out code <code>// JENKINS_API_KEY = credentials('jenkins-api-key')</code> 63-64 Incorrect comment <code>// Unity Setup, Initial running the project on Unity Editor</code> (JS project) <p>Conclusion: Some Dead Code exists \u2192 Low Needless Complexity</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#6-needless-repetition","title":"6. Needless Repetition","text":"<p>Definition: Code that could be unified through abstraction is duplicated in multiple places</p> <p>Symptom: DRY violation, \"similar code in multiple places\"</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-duplicated-code","title":"Inference Evidence: Duplicated Code","text":"<p>Server/Client report handling pattern repeated 2 times (80 lines duplicated):</p> Type Line Numbers Pattern Server 164-203 <code>params check</code> + <code>retrieveReportSummaryDirs</code> + <code>DEBUG_MODE check</code> + <code>Python call</code> Client 206-244 Same pattern, only variable names and flags differ <p><code>publishTestResultsHtmlToWebServer</code> calls repeated 2 times (lines 149-156)</p> <p>Improvement direction: <pre><code>def processReport(sourceFolder, reportType) {\n    if (!sourceFolder?.trim()) { return }\n    Map summaryDirs = jsUtil.retrieveReportSummaryDirs(...)\n    if (summaryDirs.isEmpty()) { return }\n    String cmdArgs = \"... --${reportType}\"\n    if (isDebugMode()) { cmdArgs += ' --debug' }\n    sh \"python python/create_bitbucket_coverage_report.py ${cmdArgs}\"\n}\n</code></pre></p> <p>Conclusion: Server/Client pattern 80 lines duplicated \u2192 High Needless Repetition</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#7-opacity","title":"7. Opacity","text":"<p>Definition: Code is hard to understand and intent is unclear</p> <p>Symptom: \"What does this code do?\"</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#code-review-results","title":"Code Review Results","text":"Type Location Problem Description Undefined variable usage Line 80 <code>destinationBranch</code> Not defined (should use DESTINATION_BRANCH) Complex nesting Lines 146-244 Unit Testing Stage 80 lines of Server/Client handling logic, 3-level if nesting"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/design-smells-symptoms/#severity-classification","title":"Severity Classification","text":"<p>High (bug risk): - Undefined variable usage: <code>destinationBranch</code> (line 80) - Should use <code>DESTINATION_BRANCH</code></p> <p>Medium (maintenance difficulty): - Complex nesting: Unit Testing Stage (lines 146-244) - 80 lines of Server/Client handling logic, 3-level if nesting</p> <p>Conclusion: Undefined variable + complex nesting \u2192 High Opacity</p> <p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/","title":"Software Smells","text":"<p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#jsjenkinsjenkinsfile-software-smells-analysis","title":"JsJenkins/Jenkinsfile - Software Smells Analysis","text":"<p>Level-based classification: Code Smell (function level) \u2192 Design Smell (module level) \u2192 Architecture Smell (system level)</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#summary","title":"Summary","text":"Level Category Smell Type Severity Code Change Preventers Divergent Change High Code Change Preventers Shotgun Surgery High Code Dispensables Duplicated Code High Code Dispensables Comments (Dead Code) Low Code Bloaters Long Method High Code Bloaters Primitive Obsession Low Code Couplers Feature Envy High Implementation Logic/Flow Magic String Low Implementation Logic/Flow Deeply Nested Code Medium Design Abstraction Multifaceted Abstraction High Design Abstraction Missing Abstraction Medium Design Encapsulation Missing Encapsulation High Design Abstraction Imperative Abstraction Medium Design Modularization Insufficient Modularization High Architecture Dependency Issues Implicit Cross-module Dependency High"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#1-code-smells-methodfunction-level","title":"1. Code Smells (Method/Function Level)","text":"<p>Source: Fowler, M. (1999). Refactoring: Improving the Design of Existing Code</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#11-change-preventers","title":"1.1 Change Preventers","text":"Divergent Change (5 change reasons) <p>Definition: A single class/file is frequently changed for multiple different reasons</p> Change Reason Affected Area Line Numbers Example Scenario Jenkins environment config change <code>Prepare WORKSPACE</code> 69-77 Script loading path, JSON parsing logic change Git/Bitbucket workflow change <code>Prepare WORKSPACE</code> 79-94 Branch check, clone/merge policy change npm/Node config change <code>Install Dependencies</code> 104-119 checkNodeVersion, installNpmInTestingDirs call method change Test/report change <code>Unit Testing</code> 134-246 Coverage report path, Python script argument change SonarQube config change <code>Static Analysis</code> 249-285 Scanner options, Quality Gate condition change <p>Severity Evidence: - Impact Range: High - Single Jenkinsfile handles entire JS CI pipeline logic - Bug Potential: Medium - Modifying one domain may cause unexpected impact on other domains - Modification Cost: Medium - Separating 5 domains requires shared library or separate script extraction</p> Shotgun Surgery (6 locations to modify when adding new report type) <p>Definition: A single change requires modification of multiple classes/functions</p> <p>Locations needing modification when adding new report type (e.g., 'admin'):</p> Line Number Modification Content Current Code 149-156 Add <code>publishTestResultsHtmlToWebServer</code> call <code>'server'</code>, <code>'client'</code> 164 Add <code>params.ADMIN_SOURCE_FOLDER</code> condition <code>params.SERVER_SOURCE_FOLDER?.trim()</code> 167 Add new folder in path <code>${params.SERVER_SOURCE_FOLDER}</code> 184 Add Python script flag <code>' --server'</code> 206 Add new condition block <code>if (params.CLIENT_SOURCE_FOLDER?.trim())</code> 226 Add Python script flag <code>' --client'</code> <p>Change Scenario: When adding new report type <code>'admin'</code>: - Add <code>publishTestResultsHtmlToWebServer(..., 'admin')</code> call - Add <code>params.ADMIN_SOURCE_FOLDER</code> condition block (copy 40+ lines) - Add <code>' --admin'</code> flag - Missing even one of 6 locations causes new report type to not work</p> <p>Severity Evidence: - Impact Range: High - 6 locations across entire Unit Testing stage (112 lines) need modification - Bug Potential: High - Missing even one of 6 locations causes report omission or runtime error - Modification Cost: Medium - Refactoring needed to extract report types into data structure and process with loops</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#12-dispensables","title":"1.2 Dispensables","text":"Duplicated Code (Server/Client report handling pattern repeated 2 times) <p>Definition: Same code pattern repeated in multiple places</p> <p>Server vs Client report handling pattern repetition (lines 164-203 vs 206-244):</p> <pre><code>// Lines 164-203 (Server-side report)\nif (params.SERVER_SOURCE_FOLDER?.trim()) {\n    Map serverTestSummaryDirs = jsUtil.retrieveReportSummaryDirs(\n        \"${env.PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER?.trim() ?: ''}\",\n        COVERAGE_SUMMARY_FILE_NAME, TEST_SUMMARY_FILE_NAME\n    )\n    if (!serverTestSummaryDirs.isEmpty()) {\n        String cmdArgs = \" ${COMMIT_HASH}\" +\n                        \" ${serverTestSummaryDirs['coverageSummaryDir']}\" +\n                        \" ${serverTestSummaryDirs['testSummaryDir']}\" +\n                        ' --server'\n        if ((params.DEBUG_MODE ?: '').toUpperCase() == 'Y') {\n            cmdArgs += ' --debug'\n        }\n        sh \" python python/create_bitbucket_coverage_report.py ${cmdArgs}\"\n    }\n}\n\n// Lines 206-244 (Client-side report) - Same pattern, only variable names and flags differ\nif (params.CLIENT_SOURCE_FOLDER?.trim()) {\n    // ... same structure, uses '--client' flag\n}\n</code></pre> <p>\u2192 When adding new report type: Copy-paste of same pattern required (40+ lines of duplication)</p> <p>publishTestResultsHtmlToWebServer calls also repeated 2 times (lines 149-156)</p> <p>Severity Evidence: - Impact Range: High - 2 locations need simultaneous modification when changing report handling logic - Bug Potential: High - Inconsistency if only one of 2 locations modified when Python script argument format changes - Modification Cost: Medium - Refactoring needed to extract report handling logic into function</p> Comments (Dead Code) <p>Definition: Commented-out code or incorrect comments remain</p> Line Number Problem Content 52 Commented-out code <code>// JENKINS_API_KEY = credentials('jenkins-api-key')</code> - Unused code 63-64 Incorrect comment <code>// Unity Setup, Initial running the project on Unity Editor</code> - Mentions Unity in JS project <p>Severity Evidence: - Impact Range: Low - No impact on code behavior - Bug Potential: Low - Just causes confusion during maintenance - Modification Cost: Low - Simple fix by deleting/correcting comments</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#13-bloaters","title":"1.3 Bloaters","text":"Long Method - Unit Testing stage (112 lines) <p>Definition: A single method/area has too many responsibilities</p> Stage Lines Responsibility Count Detailed Responsibilities <code>Unit Testing</code> 112 lines (134-246) 7 Test execution, web server deployment (server), web server deployment (client), server report path lookup, server report sending, client report path lookup, client report sending <p>Responsibilities needing separation: 1. Test execution (lines 136-144): <code>runUnitTestsInTestingDirs</code> 2. Web server deployment (lines 148-156): <code>publishTestResultsHtmlToWebServer</code> \u00d7 2 3. Server report handling (lines 164-203): retrieveReportSummaryDirs + Python script call 4. Client report handling (lines 206-244): Same pattern</p> <p>Severity Evidence: - Impact Range: High - Affects entire Unit Testing stage - Bug Potential: High - Unexpected behavior possible when modifying 112 lines with 7 mixed responsibilities - Modification Cost: Medium - Refactoring needed to separate server/client report handling into separate functions</p> Primitive Obsession <p>Definition: Primitive types (strings) used instead of objects/constants</p> Case Current State Line Numbers Problem Filename constants <code>'coverage-summary.json'</code>, <code>'test-results.json'</code> 159-160 Defined only inside Unit Testing stage Directory name <code>'linting_results'</code> string 124 Same name hardcoded across different Jenkinsfiles SonarQube URL <code>'http://localhost:9000/sonarqube'</code> string 260 Hardcoded URL Quality Gate status <code>'OK'</code> string 274 Hardcoded status value Report types <code>'server'</code>, <code>'client'</code> strings 152, 156, 184, 226 Repeated in 4 locations <p>Severity Evidence: - Impact Range: Low - Affects only functions within single Jenkinsfile file - Bug Potential: Low - No issues with current behavior, just maintenance inconvenience - Modification Cost: Low - Simple fix by extracting to constants</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#14-couplers","title":"1.4 Couplers","text":"Feature Envy <p>Definition: One class/module is overly dependent on data or methods of another class/module</p> <p>Unit Testing stage's Feature Envy:</p> Dependency Target Call Count Line Numbers <code>jsUtil</code> 3 times 139, 166-170, 208-212 <code>generalUtil</code> 2 times 149-152, 153-156 Python script 2 times 192, 233 <code>params</code> 6 times 151, 155, 164, 167, 187, 206, 209, 228 <p>\u2192 Unit Testing stage is more interested in external module functionality than its own responsibilities</p> <p>Severity Evidence: - Impact Range: High - Entire Unit Testing stage coupled to external dependencies - Bug Potential: Medium - Stage modification required when external modules change - Modification Cost: Medium - Report handling logic needs to move to jsHelper or separate module</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#15-implementation-smells","title":"1.5 Implementation Smells","text":"Magic String <p>Definition: Unexplained string literals hardcoded in code</p> Line Number Magic String Problem 260 <code>'http://localhost:9000/sonarqube'</code> SonarQube URL hardcoded - Code modification required when environment changes 262 <code>'3.10'</code> Python version hardcoded - Code modification required when version upgrades 274 <code>'OK'</code> Quality Gate status value hardcoded - Code modification required when API changes <p>Severity Evidence: - Impact Range: Low - Affects only Static Analysis stage - Bug Potential: Medium - Need to find and modify hardcoded values when SonarQube environment changes - Modification Cost: Low - Simple fix by extracting to constants or environment variables</p> Deeply Nested Code <p>Definition: Excessive nesting (3+ levels) reduces code readability</p> <p>Unit Testing stage's 3-level nesting (lines 164-203, 206-244):</p> <pre><code>// 3-level nesting structure\nif (params.SERVER_SOURCE_FOLDER?.trim()) {           // Level 1: params existence check\n    Map serverTestSummaryDirs = jsUtil.retrieveReportSummaryDirs(...)\n    if (!serverTestSummaryDirs.isEmpty()) {          // Level 2: Map not empty check\n        if ((params.DEBUG_MODE ?: '').toUpperCase() == 'Y') {  // Level 3: DEBUG_MODE check\n            cmdArgs += ' --debug'\n        }\n        sh \" python python/create_bitbucket_coverage_report.py ${cmdArgs}\"\n    }\n    else {\n        echo 'Server-side summary files are not founded.'\n    }\n}\nelse {\n    echo 'params.SERVER_SOURCE_FOLDER is not founded...'\n}\n</code></pre> <p>Same pattern repeated for Client (lines 206-244)</p> <p>Severity Evidence: - Impact Range: Medium - Entire Unit Testing stage (112 lines) - Bug Potential: Medium - Hard to track conditional branches due to nested structure - Modification Cost: Low - Refactorable with Early Return pattern or Guard Clause</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#2-design-smells-modulefile-level","title":"2. Design Smells (Module/File Level)","text":""},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#21-symptoms-martin-2000","title":"2.1 Symptoms (Martin 2000)","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Detailed analysis inferred from static analysis results: design-smells-symptoms.md</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#22-principles-suryanarayana-2014","title":"2.2 Principles (Suryanarayana 2014)","text":"<p>Source: Suryanarayana, G. et al. (2014). Refactoring for Software Design Smells</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#abstraction-smells","title":"Abstraction Smells","text":"Multifaceted Abstraction <p>Definition: A single abstraction (class/file) represents multiple concerns (SRP violation)</p> <p>JsJenkins/Jenkinsfile's 5 domains: - Jenkins environment config: Script loading, JSON parsing, env output - Git/Bitbucket: Branch check, clone, merge - npm/Node testing: Dependency installation, test execution, coverage - Reports: Web server deployment, Python Bitbucket reports (server/client) - SonarQube: Code analysis, Quality Gate check</p> <p>Modules needing separation: - <code>PrepareStage.groovy</code>: Script loading, branch check, Git workflow - <code>TestStage.groovy</code>: npm dependencies, test execution - <code>ReportStage.groovy</code>: Web server deployment, Bitbucket reports (remove server/client repetition) - <code>AnalysisStage.groovy</code>: SonarQube scan, Quality Gate</p> <p>\u2192 Related symptom: Divergent Change (single file changes for 5 different reasons)</p> Missing Abstraction <p>Definition: Concepts implemented with primitive types or strings instead of dedicated classes/constants</p> Concept Needing Abstraction Current State Line Numbers Affected Area Report types <code>'server'</code>, <code>'client'</code> hardcoded in 4 locations 152, 156, 184, 226 Unit Testing Filename constants <code>'coverage-summary.json'</code>, <code>'test-results.json'</code> defined inside stage 159-160 Unit Testing SonarQube URL <code>'http://localhost:9000/sonarqube'</code> hardcoded 260 Static Analysis Quality Gate status <code>'OK'</code> hardcoded 274 Static Analysis Python version <code>'3.10'</code> hardcoded 262 Static Analysis Directory name <code>'linting_results'</code> 124 Linting <p>Report type abstraction needed: <pre><code>// Before: Hardcoded per type\ngeneralUtil.publishTestResultsHtmlToWebServer(..., 'server')\ngeneralUtil.publishTestResultsHtmlToWebServer(..., 'client')\n\n// After: Report type objectified\ndef REPORT_TYPES = [\n    server: [folder: params.SERVER_SOURCE_FOLDER, flag: '--server'],\n    client: [folder: params.CLIENT_SOURCE_FOLDER, flag: '--client']\n]\n</code></pre></p> <p>\u2192 Related symptoms: - Primitive Obsession (report types/URLs expressed as primitive type strings) - Magic String (SonarQube URL, Quality Gate status value) - Shotgun Surgery (6 locations need modification when adding report type)</p> Imperative Abstraction <p>Definition: Abstraction operations written procedurally rather than object-oriented</p> <p>JsJenkins/Jenkinsfile's Imperative Abstraction evidence:</p> <p>Procedural script structure due to Jenkins Pipeline DSL characteristics: - <code>stage()</code> blocks execute sequentially - Connected to external scripts/servers via implicit contracts - Called via <code>sh</code> commands without explicit interfaces</p> External System Call Method Implicit Contract <code>python/create_bitbucket_coverage_report.py</code> <code>sh \" python ...\"</code> Argument order, --server/--client/--debug flags SonarQube Scanner <code>sh \"${scannerTool}/bin/sonar-scanner ...\"</code> CLI option format <code>generalHelper.groovy</code> <code>load()</code> + function call 7+ function signatures <code>jsHelper.groovy</code> <code>load()</code> + function call 6 function signatures Jenkins params <code>params.SERVER_SOURCE_FOLDER</code> Parameter existence assumed <p>\u2192 Related symptom: Implicit Cross-module Dependency (implicit contracts with 7 external systems)</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#encapsulation-smells","title":"Encapsulation Smells","text":"Missing Encapsulation <p>Definition: Variations not encapsulated, causing logic to be scattered</p> <p>Server/Client report handling pattern repetition (lines 164-203 vs 206-244):</p> Location Type Pattern (40 lines) Lines 164-203 Server <code>params check</code> + <code>retrieveReportSummaryDirs</code> + <code>DEBUG_MODE check</code> + <code>Python call</code> Lines 206-244 Client Same pattern, only variable names and flags (<code>--server</code>/<code>--client</code>) differ <p>Encapsulation approach: Extract to report handling function</p> <pre><code>// Before: Repeated 2 times (40 lines \u00d7 2 = 80 lines)\nif (params.SERVER_SOURCE_FOLDER?.trim()) {\n    Map serverTestSummaryDirs = jsUtil.retrieveReportSummaryDirs(...)\n    if (!serverTestSummaryDirs.isEmpty()) {\n        String cmdArgs = \" ${COMMIT_HASH} ${serverTestSummaryDirs['coverageSummaryDir']}...\"\n        if ((params.DEBUG_MODE ?: '').toUpperCase() == 'Y') { cmdArgs += ' --debug' }\n        sh \" python python/create_bitbucket_coverage_report.py ${cmdArgs}\"\n    }\n}\n// Client also repeats same pattern...\n\n// After: Encapsulated in function\ndef processReport(sourceFolder, reportType) {\n    if (!sourceFolder?.trim()) { echo \"...\"; return }\n    Map summaryDirs = jsUtil.retrieveReportSummaryDirs(\"${env.PROJECT_DIR}/${sourceFolder}\", ...)\n    if (summaryDirs.isEmpty()) { echo \"...\"; return }\n    String cmdArgs = \" ${COMMIT_HASH} ${summaryDirs['coverageSummaryDir']} ... --${reportType}\"\n    if (isDebugMode()) { cmdArgs += ' --debug' }\n    sh \" python python/create_bitbucket_coverage_report.py ${cmdArgs}\"\n}\nprocessReport(params.SERVER_SOURCE_FOLDER, 'server')\nprocessReport(params.CLIENT_SOURCE_FOLDER, 'client')\n</code></pre> <p>publishTestResultsHtmlToWebServer calls also repeated 2 times (lines 149-156)</p> <p>\u2192 Related symptoms: - Duplicated Code (Server/Client pattern repeated 2 times = 80+ lines duplication) - Shotgun Surgery (2 locations need simultaneous modification when report format changes) - Deeply Nested Code (3-level nesting repeated 2 times)</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#modularization-smells","title":"Modularization Smells","text":"Insufficient Modularization <p>Definition: Abstraction is too large or complex (God Class/Method)</p> <p>Unit Testing stage's excessive size:</p> Metric Value Threshold Status Lines 112 lines (134-246) ~30 lines \u274c Exceeded Responsibility count 7 1-2 \u274c Exceeded External dependencies 4 (jsUtil, generalUtil, params, Python) 2-3 \u274c Exceeded Nesting depth 3 levels 2 levels \u274c Exceeded <p>7 responsibilities list: 1. Test execution (<code>runUnitTestsInTestingDirs</code>) 2. Web server deployment - Server (<code>publishTestResultsHtmlToWebServer</code>) 3. Web server deployment - Client (<code>publishTestResultsHtmlToWebServer</code>) 4. Server report path lookup (<code>retrieveReportSummaryDirs</code>) 5. Server report sending (<code>create_bitbucket_coverage_report.py</code>) 6. Client report path lookup (<code>retrieveReportSummaryDirs</code>) 7. Client report sending (<code>create_bitbucket_coverage_report.py</code>)</p> <p>Separation approach: <pre><code>// Before: 112-line single stage\nstage('Unit Testing') { /* 7 responsibilities mixed */ }\n\n// After: Separated by responsibility\nstage('Unit Testing') { jsUtil.runUnitTestsInTestingDirs(...) }\nstage('Publish Results') { reportUtil.publishToWebServer(...) }\nstage('Send Reports') { reportUtil.sendBitbucketReports(...) }\n</code></pre></p> <p>\u2192 Related symptoms: - Long Method (112 lines, 7 responsibilities) - Feature Envy (excessive dependency on jsUtil, generalUtil, params)</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#3-architecture-smells-system-level","title":"3. Architecture Smells (System Level)","text":"<p>Source: Garcia et al. (2009), Lippert &amp; Roock (2006), Sharma &amp; Spinellis (2018)</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/software-smells-analysis/#31-dependency-issues","title":"3.1 Dependency Issues","text":"Implicit Cross-module Dependency <p>Definition: Hidden dependencies causing coupling to external systems without explicit interfaces</p> External System Line Numbers Implicit Contract Content <code>python/create_bitbucket_coverage_report.py</code> 192, 233 Argument format (commitHash, coverageDir, testDir, --server/--client, --debug) <code>generalHelper.groovy</code> 72 <code>load()</code> success + function signatures (parseJson, isBranchUpToDateWithRemote, initializeEnvironment, cloneOrUpdateRepo, mergeBranchIfNeeded, publishTestResultsHtmlToWebServer, checkQualityGateStatus, etc.) <code>jsHelper.groovy</code> 73 <code>load()</code> success + function signatures (findTestingDirs, checkNodeVersion, installNpmInTestingDirs, executeLintingInTestingDirs, runUnitTestsInTestingDirs, retrieveReportSummaryDirs) SonarQube Scanner 254-265 Scanner path, CLI option format (<code>-Dsonar.projectKey</code>, <code>-Dsonar.host.url</code>, etc.) SonarQube API 271 <code>checkQualityGateStatus</code> return value structure (<code>entireCodeStatus</code>, <code>newCodeStatus</code>) Jenkins Pipeline Params 164, 206 <code>params.SERVER_SOURCE_FOLDER</code>, <code>params.CLIENT_SOURCE_FOLDER</code>, <code>params.DEBUG_MODE</code> existence Jenkins Pipeline DSL Entire file <code>env</code>, <code>sh()</code>, <code>dir()</code>, <code>echo()</code>, <code>error()</code>, <code>tool()</code>, <code>withSonarQubeEnv()</code>, <code>withCredentials()</code>, <code>currentBuild</code>, etc. <p>Severity Evidence: - Impact Range: High - Affects Jenkinsfile + 7 external systems/scripts - Bug Potential: High - Runtime errors occur when Python script/SonarQube API/params change (not detectable at compile time) - Modification Cost: Medium - Interface documentation or Wrapper functions needed per external system</p> <p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/srp-violation-analysis/","title":"SRP Violations","text":"<p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/srp-violation-analysis/#jsjenkinsjenkinsfile-314-lines","title":"JsJenkins/Jenkinsfile (314 lines)","text":""},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/srp-violation-analysis/#1-srp-violation-analysis-criteria","title":"1. SRP Violation Analysis Criteria","text":"<ul> <li>Jenkinsfile Role: Orchestration (pipeline sequence/flow control)</li> <li>SRP Violation Condition: If actual Logic exists in Jenkinsfile, Jenkinsfile modification is required when that domain changes</li> <li>Analysis Method: Using domain classification from pipeline-sequence-diagrams/js-ci.md</li> </ul>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/srp-violation-analysis/#2-functional-domains-and-logic-presence","title":"2. Functional Domains and Logic Presence","text":"<p>Reference: js-ci.md - Functional Domain Summary</p> Domain Stage Logic Exists in Jenkinsfile Description Git Management Prepare WORKSPACE, Post \u2717 Delegated to Helper (<code>cloneOrUpdateRepo</code>, <code>checkoutBranch</code>) Bitbucket API Prepare WORKSPACE, Unit Testing, Post \u25b3 Direct Python script calls (path/arguments hardcoded) Node.js (npm) Install Dependencies, Linting, Unit Testing \u25b3 Helper calls, arguments hardcoded Web Server (SSH/SCP) Unit Testing \u25b3 Report path/type hardcoded SonarQube Static Analysis \u25cb <code>sonar-scanner</code> config directly constructed, Quality Gate logic Environment Config Prepare WORKSPACE \u25b3 <code>sh 'env'</code>, script loading paths, JSON parsing <p>(\u25cb: Logic exists, \u25b3: Partially exists (hardcoded/direct calls), \u2717: Fully delegated to Helper)</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/srp-violation-analysis/#3-stage-by-stage-srp-violation-analysis","title":"3. Stage-by-Stage SRP Violation Analysis","text":""},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/srp-violation-analysis/#change-reasons-summary-by-stage","title":"Change Reasons Summary by Stage","text":"Lines Stage/Area Change Reasons 65-103 <code>Prepare WORKSPACE</code> 4 reasons: env output policy + script loading paths + branch check policy + JSON parsing logic 104-120 <code>Install Dependencies</code> stage cd command workspace path 121-131 <code>Linting</code> stage 2 reasons: lint result directory + executeLintingInTestingDirs arguments 134-246 <code>Unit Testing</code> 7 reasons: test execution arguments + server report path/type + client report path/type + server/client branching logic + DEBUG_MODE handling + Python script interface + client DEBUG_MODE handling 249-286 <code>Static Analysis</code> 2 reasons: SonarQube scanner config + Quality Gate check logic Multiple Responsibility Area: <code>Prepare WORKSPACE</code> (4 change reasons) <pre><code>stage('Prepare WORKSPACE') {\n    steps {\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                sh 'env'  // Change reason 1: env output policy\n                generalUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")  // Change reason 2: script loading path\n                jsUtil = load(\"${env.WORKSPACE}/groovy/jsHelper.groovy\")\n\n                buildResults = generalUtil.parseJson().buildResults  // Change reason 3: JSON parsing logic\n                stageResults = generalUtil.parseJson().stageResults\n\n                if (generalUtil.isBranchUpToDateWithRemote(PR_BRANCH)) {  // Change reason 4: branch check policy\n                    echo \"Current branch is up-to-date with origin/${destinationBranch}. Aborting pipeline.\"\n                    currentBuild.result = buildResults.ABORTED\n                    error('Branch is up to date, no changes.')\n                }\n\n                COMMIT_HASH = generalUtil.getFullCommitHash(env.WORKSPACE, PR_COMMIT)  // Helper call (excluded)\n\n                echo 'initialize environment'\n                generalUtil.initializeEnvironment(env.WORKSPACE, COMMIT_HASH, PR_BRANCH)  // Helper call (excluded)\n\n                echo 'clone Or Update Repo'\n                generalUtil.cloneOrUpdateRepo(PROJECT_TYPE, env.WORKSPACE, PROJECT_DIR, REPO_SSH, PR_BRANCH)  // Helper call (excluded)\n\n                echo 'merge Branch If Needed'\n                generalUtil.mergeBranchIfNeeded()  // Helper call (excluded)\n\n                // Save directories pipeline is going to test. unique to JS pipeline\n                echo 'find Testing Dirs'\n                env.TEST_DIRECTORIES = jsUtil.findTestingDirs(PROJECT_DIR)  // Helper call (excluded)\n                echo \"Testing directories: ${env.TEST_DIRECTORIES}\"\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When env output policy changes (line 71): Debug output condition 2. When script loading path changes (lines 72-73): Helper file location 3. When JSON parsing logic changes (lines 75-76): Constants structure 4. When branch check policy changes (lines 79-83): Duplicate build prevention condition</p> <p>Helper function calls (getFullCommitHash, initializeEnvironment, cloneOrUpdateRepo, mergeBranchIfNeeded, findTestingDirs) are Helper file's responsibility, so excluded</p> Multiple Responsibility Area: <code>Linting</code> stage (2 change reasons) <pre><code>stage('Linting') {\n    steps {\n        dir(\"${REPORT_DIR}\") {\n            sh 'mkdir -p linting_results'  // Change reason 1: lint result directory structure\n        }\n        script {\n            echo 'Linting step'\n            jsUtil.executeLintingInTestingDirs(env.TEST_DIRECTORIES, false)  // Change reason 2: executeLintingInTestingDirs argument hardcoded\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When lint result directory structure changes (line 124): <code>linting_results</code> folder structure 2. When executeLintingInTestingDirs argument hardcoding changes (line 128): <code>false</code> hardcoded (deploymentBuild argument)</p> Multiple Responsibility Area: <code>Unit Testing</code> (7 change reasons) <pre><code>stage('Unit Testing') {\n    steps {\n        script {\n            jsUtil.runUnitTestsInTestingDirs(env.TEST_DIRECTORIES, false)  // Change reason 1: test execution argument hardcoded\n            sh(script: 'cd \"' + env.WORKSPACE + '\"')\n        }\n\n        script {\n            skipMessage = 'Skip report sending process...'\n            echo 'Publish test results html to dlx-webhost server...'\n            generalUtil.publishTestResultsHtmlToWebServer(  // Change reason 2: server report path/type hardcoded\n                FOLDER_NAME, TICKET_NUMBER,\n                \"${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}/coverage/...\", 'server')\n            generalUtil.publishTestResultsHtmlToWebServer(  // Change reason 3: client report path/type hardcoded\n                FOLDER_NAME, TICKET_NUMBER,\n                \"${PROJECT_DIR}/${params.CLIENT_SOURCE_FOLDER}/coverage/...\", 'client')\n\n            final String COVERAGE_SUMMARY_FILE_NAME = 'coverage-summary.json'\n            final String TEST_SUMMARY_FILE_NAME = 'test-results.json'\n\n            // Server-side report\n            if (params.SERVER_SOURCE_FOLDER?.trim()) {  // Change reason 4: server/client branching logic\n                Map serverTestSummaryDirs = jsUtil.retrieveReportSummaryDirs(...)  // Helper call\n                if (!serverTestSummaryDirs.isEmpty()) {\n                    String cmdArgs = \" ${COMMIT_HASH} ${serverTestSummaryDirs['coverageSummaryDir']} ...\"\n                    if ((params.DEBUG_MODE ?: '').toUpperCase() == 'Y') {  // Change reason 5: DEBUG_MODE handling\n                        cmdArgs += ' --debug'\n                    }\n                    sh \" python python/create_bitbucket_coverage_report.py ${cmdArgs}\"  // Change reason 6: Python script interface\n                }\n            }\n\n            // Client-side report (almost identical code copy-pasted from server)\n            if (params.CLIENT_SOURCE_FOLDER?.trim()) {\n                Map clientTestSummaryDirs = jsUtil.retrieveReportSummaryDirs(...)  // Helper call\n                if (!clientTestSummaryDirs.isEmpty()) {\n                    String cmdArgs = \"...\"\n                    if ((params.DEBUG_MODE ?: '').toUpperCase() == 'Y') {  // Change reason 7: DEBUG_MODE handling (repeated)\n                        cmdArgs += ' --debug'\n                    }\n                    sh \" python python/create_bitbucket_coverage_report.py ${cmdArgs}\"  // Python script (repeated)\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When test execution argument changes (line 143): <code>false</code> hardcoded 2. When server report path/type changes (lines 149-151): <code>coverage/...</code>, <code>'server'</code> hardcoded 3. When client report path/type changes (lines 152-154): <code>coverage/...</code>, <code>'client'</code> hardcoded 4. When server/client branching logic changes (lines 166, 205): Conditional structure 5. When DEBUG_MODE handling changes (lines 187-190): Debug flag handling 6. When Python script interface changes (line 192): Report generation 7. When client DEBUG_MODE handling changes (lines 226-229): Debug flag handling (same code as server)</p> <p>Note: server/client handling code is almost identically copy-pasted (lines 164-203 vs 205-244)</p> Multiple Responsibility Area: <code>Static Analysis</code> (2 change reasons) <pre><code>stage('Static Analysis') {\n    steps {\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                // Change reason 1: SonarQube scanner config\n                String scannerHome = tool SONARQUBE_SCANNER\n                withSonarQubeEnv(SONARQUBE_SERVER) {\n                    sh \"\"\"\n                        ${scannerHome}/bin/sonar-scanner \\\\\n                        -Dsonar.projectKey=${env.SONAR_PROJECT_KEY} \\\\\n                        -Dsonar.host.url=http://localhost:9000/sonarqube \\\\\n                        -Dsonar.sources=. \\\\\n                        -Dsonar.exclusions=**/node_modules/**,**/coverage/**\n                    \"\"\"\n                }\n            }\n        }\n\n        withCredentials([string(credentialsId: 'SonarQube', variable: 'SONAR_QUBE_AUTH_TOKEN')]) {\n            script {\n                // Change reason 2: Quality Gate check logic\n                catchError(buildResult: buildResults.SUCCESS, stageResult: stageResults.FAILURE) {\n                    Map status = generalUtil.checkQualityGateStatus(SONAR_PROJECT_KEY, env.SONAR_QUBE_AUTH_TOKEN)  // Helper call\n\n                    final String STATUS_OK = 'OK'\n\n                    if ((status.entireCodeStatus != STATUS_OK) || (status.newCodeStatus != STATUS_OK)) {\n                        echo \"Entire Code Status: ${status.entireCodeStatus}, New Code Status: ${status.newCodeStatus}\"\n                        error('Quality gate failed!')\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When SonarQube scanner config changes (lines 255-265): Scanner options, host URL, exclusion patterns 2. When Quality Gate check logic changes (lines 271-281): Status comparison conditions, error handling</p>"},{"location":"problem-analysis/06-JsJenkins-Jenkinsfile/srp-violation-analysis/#conclusion","title":"Conclusion","text":"<p>SRP Violation: - Logic from 5 domains exists in Jenkinsfile (Git management excluded) - Unit Testing Stage: server/client report code copy-pasted + Python script arguments hardcoded - Static Analysis Stage: SonarQube scanner config directly exists in Jenkinsfile - Orchestration Role Violation: Domain logic directly included in Jenkinsfile, requiring Jenkinsfile modification when that domain changes</p> <p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/","title":"Design Smells","text":"<p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#jsjenkinsjenkinsfiledeployment-design-smells-symptoms-analysis","title":"JsJenkins/JenkinsfileDeployment - Design Smells Symptoms Analysis","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Symptoms analysis based on static analysis results (SRP, Software Smells, DRY) + code review</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#summary","title":"Summary","text":"Symptom Severity Key Evidence Rigidity High Shotgun Surgery (4 locations to modify when adding new deployment target) Fragility High 5 domains mixed, 10 implicit dependencies Immobility High 452 lines/8 Stages, entire JS CD orchestration Viscosity High Missing Encapsulation \u2192 copying Server/Client deployment is easier Needless Complexity Low Not applicable Needless Repetition High DRY violation (Server/Client deployment pattern 150 lines repeated) Opacity High Complex nesting (Server/Client Deploy), duplicate nested script"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence","title":"Inference Evidence","text":"Symptom Evidence Source Rigidity Shotgun Surgery 4 locations to modify when adding new deployment target Code Smells Fragility Divergent Change 5 domains + Implicit Dependency 10 Code Smells + Arch Smells Immobility Multifaceted Abstraction + Insufficient Modularization Design Smells Viscosity Missing Encapsulation Server/Client deployment pattern not encapsulated Design Smells Needless Complexity Not applicable - Needless Repetition Duplicated Code Server/Client pattern 2 times Code Smells Opacity Direct code review Code Review"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#1-rigidity","title":"1. Rigidity","text":"<p>Definition: Changing one place requires cascading changes in other places</p> <p>Symptom: \"Thought it was a simple change but it was much more complex\"</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-shotgun-surgery","title":"Inference Evidence: Shotgun Surgery","text":"<p>Locations needing modification when adding new deployment target (e.g., 'admin'):</p> Location Modification Content Parameter block Add <code>params.ADMIN_IMAGE_NAME</code>, <code>params.ADMIN_SOURCE_FOLDER</code>, <code>params.ADMIN_CONTAINER_APP_NAME</code> Check Build and Deploy Condition Add admin version check (20+ lines) Environment variables Add <code>env.ADMIN_SKIP_BUILD</code> New Stage Add <code>Admin-side Build and Deploy</code> stage (copy 75 lines) <p>Conclusion: 4 locations to modify + 75 lines copy required when adding new deployment target \u2192 High Rigidity</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#2-fragility","title":"2. Fragility","text":"<p>Definition: Modifying one place breaks conceptually unrelated places</p> <p>Symptom: \"Why did that break when I touched this?\"</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-divergent-change-implicit-cross-module-dependency","title":"Inference Evidence: Divergent Change + Implicit Cross-module Dependency","text":"<p>5 domains mixed in one file: - Jenkins environment config, Git/Bitbucket, npm/Node, Azure/Docker, SonarQube</p> <p>10 implicit dependencies: - <code>generalHelper.groovy</code>, <code>jsHelper.groovy</code> - Docker CLI, Azure CLI (<code>az acr</code>, <code>az containerapp</code>) - SonarQube Scanner, SonarQube API - Jenkins params (multiple) - <code>AZURE_CONTAINER_REGISTRY</code>, <code>AZURE_RESOURCE_GROUP</code> environment variables - Jenkins Pipeline DSL</p> <p>Potential Fragility scenarios:</p> Change Expected Impact Actual Impact (Inferred) Docker build option change Server Deploy Client Deploy also affected (2 locations) Azure CLI command change containerapp update Both Server/Client need modification Environment variable name change Affected Stage Reference failure in multiple locations <p>Conclusion: 5 domains mixed + 10 implicit dependencies \u2192 High Fragility</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#3-immobility","title":"3. Immobility","text":"<p>Definition: Difficult to extract useful parts and reuse in other systems/modules</p> <p>Symptom: \"Too many dependencies come along when trying to separate\"</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-multifaceted-abstraction-insufficient-modularization","title":"Inference Evidence: Multifaceted Abstraction + Insufficient Modularization","text":"<p>Server/Client Build and Deploy stages' excessive size: - Server: 75 lines (lines 242-317) - Client: 73 lines (lines 319-392) - Both almost identical</p> <p>Problems when attempting separation:</p> Extraction Target Dependencies That Follow CleanupStage generalUtil, jsUtil, mainBranches PrepareStage Git commands, generalUtil, jsUtil, env variables DeployStage jsUtil, Docker CLI, Azure CLI, params, env variables AnalysisStage SonarQube Scanner, SonarQube API, generalUtil <p>Conclusion: Entire JS CD in single file + Server/Client 150 lines duplicated \u2192 High Immobility</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#4-viscosity","title":"4. Viscosity","text":"<p>Definition: The right way (preserving design) is harder than the wrong way (hacking)</p> <p>Symptom: \"It takes too long to do it properly, so let's just do it this way for now\"</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-missing-encapsulation-dry-violation-induced","title":"Inference Evidence: Missing Encapsulation \u2192 DRY Violation Induced","text":"<p>Current state (Missing Encapsulation): - Server/Client deployment pattern repeated 2 times (75 lines each) - Check Build and Deploy Condition version check repeated 2 times</p> <p>Right way vs Hacking:</p> Situation Right Way Hack Tendency Add new deployment target Create deployment function and call Copy-paste 75 lines Copy (faster) Change Docker options Modify deployment function Manually modify 2 places Manual (faster) <p>Conclusion: Lack of encapsulation makes \"copying is easier\" structure \u2192 High Viscosity</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#5-needless-complexity","title":"5. Needless Complexity","text":"<p>Definition: Excessive design for features not currently needed</p> <p>Symptom: YAGNI violation, \"might need it later\"</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence_1","title":"Inference Evidence","text":"<p>Dead Code or excessive design: Not applicable</p> <p>Conclusion: Low Needless Complexity</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#6-needless-repetition","title":"6. Needless Repetition","text":"<p>Definition: Code that could be unified through abstraction is duplicated in multiple places</p> <p>Symptom: DRY violation, \"similar code in multiple places\"</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#inference-evidence-duplicated-code","title":"Inference Evidence: Duplicated Code","text":"<p>Server/Client Build and Deploy pattern repeated 2 times (150 lines duplicated):</p> Target Line Numbers Pattern Server 242-317 <code>getPackageJsonVersion</code> + <code>docker build</code> + <code>docker push</code> + <code>az containerapp update</code> + <code>docker rmi</code> Client 319-392 Same pattern, only variable names differ <p>Check Build and Deploy Condition also repeated 2 times (lines 220-232 vs 234-246)</p> <p>Improvement direction: <pre><code>def deployToAzure(targetConfig) {\n    String imageName = \"${env.AZURE_CONTAINER_REGISTRY}/${targetConfig.imageName}\"\n    String version = jsUtil.getPackageJsonVersion(\"${PROJECT_DIR}/${targetConfig.sourceFolder}\")\n    sh \"docker build -t ${imageName}:${version} ...\"\n    sh \"docker push ${imageName}:${version}\"\n    sh \"az containerapp update --name ${targetConfig.containerApp} --image ${imageName}:${version}\"\n    sh \"docker rmi ${imageName}:${version}\"\n}\n</code></pre></p> <p>Conclusion: Server/Client pattern 150 lines duplicated \u2192 High Needless Repetition</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#7-opacity","title":"7. Opacity","text":"<p>Definition: Code is hard to understand and intent is unclear</p> <p>Symptom: \"What does this code do?\"</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#code-review-results","title":"Code Review Results","text":"Type Location Problem Description Complex nesting Lines 242-317, 319-392 Server/Client Deploy 75 lines each of similar patterns Duplicate nested script Lines 96-100 <code>script { script { ... } }</code> Unnecessary double script block"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/design-smells-symptoms/#severity-classification","title":"Severity Classification","text":"<p>Medium (maintenance difficulty): - Complex nesting: Server/Client Deploy (lines 242-317, 319-392) - 75 lines each of similar patterns - Duplicate nested script: <code>script { script { ... } }</code> (lines 96-100) - Unnecessary double block</p> <p>Conclusion: Complex nesting + duplicate nested script \u2192 High Opacity</p> <p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/","title":"Software Smells","text":"<p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#jsjenkinsjenkinsfiledeployment-software-smells-analysis","title":"JsJenkins/JenkinsfileDeployment - Software Smells Analysis","text":"<p>Level-based classification: Code Smell (function level) \u2192 Design Smell (module level) \u2192 Architecture Smell (system level)</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#summary","title":"Summary","text":"Level Category Smell Type Severity Code Change Preventers Divergent Change High Code Change Preventers Shotgun Surgery High Code Dispensables Duplicated Code High Code Bloaters Long Method High Code Bloaters Primitive Obsession Low Implementation Logic/Flow Magic String Medium Design Abstraction Multifaceted Abstraction High Design Abstraction Missing Abstraction Medium Design Encapsulation Missing Encapsulation High Design Abstraction Imperative Abstraction Medium Design Modularization Insufficient Modularization High Architecture Dependency Issues Implicit Cross-module Dependency High"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#1-code-smells-methodfunction-level","title":"1. Code Smells (Method/Function Level)","text":"<p>Source: Fowler, M. (1999). Refactoring: Improving the Design of Existing Code</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#11-change-preventers","title":"1.1 Change Preventers","text":"Divergent Change (5 change reasons) <p>Definition: A single class/file is frequently changed for multiple different reasons</p> Change Reason Affected Area Line Numbers Example Scenario Jenkins environment config change <code>Delete Merged Branch</code> 55-59 Script loading path, JSON parsing logic change Git workflow change <code>Prepare WORKSPACE</code> 100-112 clone/checkout/reset/pull policy change npm/Node config change <code>Prepare WORKSPACE</code>, <code>Linting</code>, <code>Unit Testing</code> 118-125, 150-180, 182-209 Node version check, npm install, test config change Docker/Azure config change <code>Check Build and Deploy</code>, <code>Server/Client Deploy</code> 212-392 Docker build options, Azure CLI command change SonarQube config change <code>Static Analysis</code> 394-422 Scanner options, Quality Gate condition change <p>Severity Evidence: - Impact Range: High - Single JenkinsfileDeployment handles entire JS CD pipeline logic - Bug Potential: Medium - Modifying one domain may cause unexpected impact on other domains - Modification Cost: Medium - Separating 5 domains requires shared library or separate script extraction</p> Shotgun Surgery (4 locations to modify when adding new deployment target) <p>Definition: A single change requires modification of multiple classes/functions</p> <p>Locations needing modification when adding new deployment target (e.g., 'admin'):</p> Line Number Modification Content Current Code 212-239 Add admin check in <code>Check Build and Deploy Condition</code> Server/Client version check Parameter block Add <code>params.ADMIN_IMAGE_NAME</code>, <code>params.ADMIN_SOURCE_FOLDER</code>, <code>params.ADMIN_CONTAINER_APP_NAME</code> Server/Client params After 319-392 Add new <code>Admin-side Build and Deploy</code> stage (copy 75 lines) Server/Client Deploy Environment variables Add <code>env.ADMIN_SKIP_BUILD</code> <code>env.SERVER_SKIP_BUILD</code>, <code>env.CLIENT_SKIP_BUILD</code> <p>Change Scenario: When adding new deployment target <code>'admin'</code>: - Add 3 parameters - Add 20+ lines to Check Build and Deploy Condition - Copy 75 lines for Admin-side Build and Deploy stage - Missing even one of 4 locations causes new target deployment failure</p> <p>Severity Evidence: - Impact Range: High - 4+ locations across entire pipeline (450 lines) need modification - Bug Potential: High - Missing even one of 4 locations causes deployment omission or runtime error - Modification Cost: Medium - Refactoring needed to extract deployment targets into data structure and process with loops</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#12-dispensables","title":"1.2 Dispensables","text":"Duplicated Code (Server/Client deployment pattern 150 lines repeated) <p>Definition: Same code pattern repeated in multiple places</p> <p>Server vs Client Build and Deploy pattern repetition (lines 242-317 vs 319-392):</p> <pre><code>// Lines 242-317 (Server-side Build and Deploy)\nstage('Server-side Build and Deploy') {\n    when { expression { env.SERVER_SKIP_BUILD != 'true' } }\n    steps {\n        script {\n            String serverImageName = \"${env.AZURE_CONTAINER_REGISTRY}/${params.SERVER_IMAGE_NAME}\"\n            String serverVersion = jsUtil.getPackageJsonVersion(\"${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}\")\n\n            sh \"\"\"\n                docker build -t ${serverImageName}:${serverVersion} \\\\\n                -f ${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}/Dockerfile \\\\\n                ${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}\n            \"\"\"\n            sh \"docker push ${serverImageName}:${serverVersion}\"\n            sh \"\"\"\n                az containerapp update --name ${params.SERVER_CONTAINER_APP_NAME} \\\\\n                --resource-group ${env.AZURE_RESOURCE_GROUP} \\\\\n                --image ${serverImageName}:${serverVersion}\n            \"\"\"\n            sh \"docker rmi ${serverImageName}:${serverVersion}\"\n        }\n    }\n}\n\n// Lines 319-392 (Client-side Build and Deploy) - Same pattern, only variable names differ\nstage('Client-side Build and Deploy') {\n    // ... same structure, uses CLIENT_* variables\n}\n</code></pre> <p>\u2192 When adding new deployment target: Copy-paste of same pattern required (75+ lines of duplication)</p> <p>Check Build and Deploy Condition also repeated 2 times (lines 220-232 vs 234-246)</p> <p>Severity Evidence: - Impact Range: High - 2 locations need simultaneous modification when changing deployment logic - Bug Potential: High - Inconsistency if only one of 2 locations modified when Docker command options/Azure CLI options change - Modification Cost: High - Major refactoring needed to extract deployment logic into function and parameterize</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#13-bloaters","title":"1.3 Bloaters","text":"Long Method (Server/Client Deploy stages 75 lines each) <p>Definition: A single method/area has too many responsibilities</p> Stage Lines Responsibility Count Detailed Responsibilities <code>Server-side Build and Deploy</code> 75 lines 5 Version lookup, Docker build, Docker push, Azure update, image cleanup <code>Client-side Build and Deploy</code> 73 lines 5 Same <code>Check Build and Deploy Condition</code> 27 lines 2 (\u00d7 2 targets) Version lookup, version comparison <p>Responsibilities needing separation: 1. Version lookup: <code>jsUtil.getPackageJsonVersion()</code> 2. Docker build: <code>docker build</code> 3. Docker push: <code>docker push</code> 4. Azure update: <code>az containerapp update</code> 5. Image cleanup: <code>docker rmi</code></p> <p>Severity Evidence: - Impact Range: High - Affects entire Server/Client Deploy stages - Bug Potential: Medium - Unexpected behavior possible when modifying 75 lines with 5 mixed responsibilities - Modification Cost: Medium - Refactoring needed to separate deployment logic into separate functions</p> Primitive Obsession <p>Definition: Primitive types (strings) used instead of objects/constants</p> Case Current State Line Numbers Problem Deployment target config <code>params.SERVER_*</code>, <code>params.CLIENT_*</code> scattered Multiple Deployment target info scattered across parameters Azure resource group <code>env.AZURE_RESOURCE_GROUP</code> string 302, 377 Hardcoded as environment variable Directory name <code>'linting_results'</code> string 155 Same name hardcoded across different Jenkinsfiles SonarQube URL <code>'http://localhost:9000/sonarqube'</code> string 404 Hardcoded URL Main branch list <code>['main', 'master']</code> array 3 Hardcoded branch names <p>Severity Evidence: - Impact Range: Low - Affects only functions within single JenkinsfileDeployment file - Bug Potential: Low - No issues with current behavior, just maintenance inconvenience - Modification Cost: Low - Simple fix by extracting to constants/objects</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#14-implementation-smells","title":"1.4 Implementation Smells","text":"Magic String <p>Definition: Unexplained string literals hardcoded in code</p> Line Numbers Magic String Problem 287-291, 362-366 <code>docker build -t ... -f ... Dockerfile</code> Docker build options hardcoded 295-298, 370-373 <code>docker push</code> Docker push command 302-307, 377-382 <code>az containerapp update --name ... --resource-group ... --image ...</code> Azure CLI options hardcoded 404 <code>'http://localhost:9000/sonarqube'</code> SonarQube URL hardcoded <p>Severity Evidence: - Impact Range: Medium - Affects Server/Client Deploy, Static Analysis stages - Bug Potential: Medium - Need to find and modify hardcoded values when CLI options change - Modification Cost: Low - Simple fix by extracting to constants or functions</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#2-design-smells-modulefile-level","title":"2. Design Smells (Module/File Level)","text":""},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#21-symptoms-martin-2000","title":"2.1 Symptoms (Martin 2000)","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Detailed analysis inferred from static analysis results: design-smells-symptoms.md</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#22-principles-suryanarayana-2014","title":"2.2 Principles (Suryanarayana 2014)","text":"<p>Source: Suryanarayana, G. et al. (2014). Refactoring for Software Design Smells</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#abstraction-smells","title":"Abstraction Smells","text":"Multifaceted Abstraction <p>Definition: A single abstraction (class/file) represents multiple concerns (SRP violation)</p> <p>JsJenkins/JenkinsfileDeployment's 5 domains: - Jenkins environment config: Script loading, JSON parsing, folder name extraction - Git/Bitbucket: Branch cleanup, clone, checkout, reset, pull, status sending - npm/Node: Node version check, npm install, Linting, Unit Testing - Azure/Docker: Docker build/push, Azure Container Registry, Container Apps update - SonarQube: Code analysis, Quality Gate check</p> <p>Modules needing separation: - <code>CleanupStage.groovy</code>: Branch cleanup, web server cleanup - <code>PrepareStage.groovy</code>: Git workflow, npm config - <code>TestStage.groovy</code>: Linting, Unit Testing - <code>DeployStage.groovy</code>: Docker build/push, Azure Container Apps (remove Server/Client repetition) - <code>AnalysisStage.groovy</code>: SonarQube scan, Quality Gate</p> <p>\u2192 Related symptom: Divergent Change (single file changes for 5 different reasons)</p> Missing Abstraction <p>Definition: Concepts implemented with primitive types or strings instead of dedicated classes/constants</p> Concept Needing Abstraction Current State Line Numbers Affected Area Azure Container Registry <code>env.AZURE_CONTAINER_REGISTRY</code>, <code>env.AZURE_CONTAINER_REGISTRY_NAME</code> scattered 221, 223 Check Build, Deploy Docker image name <code>params.SERVER_IMAGE_NAME</code>, <code>params.CLIENT_IMAGE_NAME</code> hardcoded 268, 343 Server/Client Deploy Container App name <code>params.SERVER_CONTAINER_APP_NAME</code>, <code>params.CLIENT_CONTAINER_APP_NAME</code> 302, 377 Server/Client Deploy Main branch list <code>['main', 'master']</code> hardcoded 3 Delete Merged Branch SonarQube URL <code>'http://localhost:9000/sonarqube'</code> hardcoded 404 Static Analysis Directory name <code>'linting_results'</code> 155 Linting <p>Deployment target abstraction needed: <pre><code>// Before: Hardcoded per target\nString serverImageName = \"${env.AZURE_CONTAINER_REGISTRY}/${params.SERVER_IMAGE_NAME}\"\nString clientImageName = \"${env.AZURE_CONTAINER_REGISTRY}/${params.CLIENT_IMAGE_NAME}\"\n\n// After: Deployment target objectified\ndef DEPLOY_TARGETS = [\n    server: [\n        imageName: params.SERVER_IMAGE_NAME,\n        sourceFolder: params.SERVER_SOURCE_FOLDER,\n        containerApp: params.SERVER_CONTAINER_APP_NAME\n    ],\n    client: [\n        imageName: params.CLIENT_IMAGE_NAME,\n        sourceFolder: params.CLIENT_SOURCE_FOLDER,\n        containerApp: params.CLIENT_CONTAINER_APP_NAME\n    ]\n]\n</code></pre></p> <p>\u2192 Related symptoms: - Primitive Obsession (deployment target config expressed as primitive type strings) - Shotgun Surgery (4 locations need modification when adding deployment target)</p> Imperative Abstraction <p>Definition: Abstraction operations written procedurally rather than object-oriented</p> <p>JsJenkins/JenkinsfileDeployment's Imperative Abstraction evidence:</p> <p>Procedural script structure due to Jenkins Pipeline DSL characteristics: - <code>stage()</code> blocks execute sequentially - Connected to external CLI tools via implicit contracts - Called via <code>sh</code> commands without explicit interfaces</p> External System Call Method Implicit Contract Docker CLI <code>sh \"docker build ...\"</code> Dockerfile path, tag format Azure CLI <code>sh \"az acr repository show-tags ...\"</code> ACR name, repository name Azure CLI <code>sh \"az containerapp update ...\"</code> Container App name, resource group, image format <code>generalHelper.groovy</code> <code>load()</code> + function call 7+ function signatures <code>jsHelper.groovy</code> <code>load()</code> + function call 8 function signatures SonarQube Scanner <code>sh \"${scannerHome}/bin/sonar-scanner ...\"</code> CLI option format <p>\u2192 Related symptom: Implicit Cross-module Dependency (implicit contracts with 10 external systems)</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#encapsulation-smells","title":"Encapsulation Smells","text":"Missing Encapsulation <p>Definition: Variations not encapsulated, causing logic to be scattered</p> <p>Server/Client deployment pattern repetition (lines 242-317 vs 319-392):</p> Location Target Pattern (75 lines) Lines 242-317 Server <code>getPackageJsonVersion</code> + <code>docker build</code> + <code>docker push</code> + <code>az containerapp update</code> + <code>docker rmi</code> Lines 319-392 Client Same pattern, only variable names differ <p>Encapsulation approach: Extract to deployment function</p> <pre><code>// Before: Repeated 2 times (75 lines \u00d7 2 = 150 lines)\nstage('Server-side Build and Deploy') {\n    String serverImageName = \"${env.AZURE_CONTAINER_REGISTRY}/${params.SERVER_IMAGE_NAME}\"\n    String serverVersion = jsUtil.getPackageJsonVersion(\"${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}\")\n    sh \"docker build -t ${serverImageName}:${serverVersion} ...\"\n    sh \"docker push ${serverImageName}:${serverVersion}\"\n    sh \"az containerapp update --name ${params.SERVER_CONTAINER_APP_NAME} --image ${serverImageName}:${serverVersion}\"\n    sh \"docker rmi ${serverImageName}:${serverVersion}\"\n}\n// Client also repeats same pattern...\n\n// After: Encapsulated in function\ndef deployToAzure(targetConfig) {\n    String imageName = \"${env.AZURE_CONTAINER_REGISTRY}/${targetConfig.imageName}\"\n    String version = jsUtil.getPackageJsonVersion(\"${PROJECT_DIR}/${targetConfig.sourceFolder}\")\n    sh \"docker build -t ${imageName}:${version} -f ${PROJECT_DIR}/${targetConfig.sourceFolder}/Dockerfile ${PROJECT_DIR}/${targetConfig.sourceFolder}\"\n    sh \"docker push ${imageName}:${version}\"\n    sh \"az containerapp update --name ${targetConfig.containerApp} --resource-group ${env.AZURE_RESOURCE_GROUP} --image ${imageName}:${version}\"\n    sh \"docker rmi ${imageName}:${version}\"\n}\ndeployToAzure(DEPLOY_TARGETS.server)\ndeployToAzure(DEPLOY_TARGETS.client)\n</code></pre> <p>Check Build and Deploy Condition also repeated 2 times (lines 220-232 vs 234-246)</p> <p>\u2192 Related symptoms: - Duplicated Code (Server/Client deployment pattern 150 lines duplicated) - Shotgun Surgery (2 locations need simultaneous modification when Docker command options change)</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#modularization-smells","title":"Modularization Smells","text":"Insufficient Modularization <p>Definition: Abstraction is too large or complex (God Class/Method)</p> <p>Server/Client Build and Deploy stages' excessive duplication:</p> Stage Lines Responsibility Count Detailed Responsibilities <code>Server-side Build and Deploy</code> 75 lines (242-317) 5 Version lookup, Docker build, Docker push, Azure update, image cleanup <code>Client-side Build and Deploy</code> 73 lines (319-392) 5 Same <p>Separation approach: <pre><code>// Before: 150 lines duplicated\nstage('Server-side Build and Deploy') { /* 75 lines */ }\nstage('Client-side Build and Deploy') { /* 73 lines, same pattern */ }\n\n// After: Common function + parameterization\ndef deployTarget(targetName, imageName, sourceFolder, containerApp) { /* common logic */ }\n\nstage('Build and Deploy') {\n    parallel {\n        stage('Server') { deployTarget('server', params.SERVER_IMAGE_NAME, params.SERVER_SOURCE_FOLDER, params.SERVER_CONTAINER_APP_NAME) }\n        stage('Client') { deployTarget('client', params.CLIENT_IMAGE_NAME, params.CLIENT_SOURCE_FOLDER, params.CLIENT_CONTAINER_APP_NAME) }\n    }\n}\n</code></pre></p> <p>\u2192 Related symptoms: - Duplicated Code (150 lines duplicated) - Long Method (each stage is 75 lines)</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#3-architecture-smells-system-level","title":"3. Architecture Smells (System Level)","text":"<p>Source: Garcia et al. (2009), Lippert &amp; Roock (2006), Sharma &amp; Spinellis (2018)</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/software-smells-analysis/#31-dependency-issues","title":"3.1 Dependency Issues","text":"Implicit Cross-module Dependency <p>Definition: Hidden dependencies causing coupling to external systems without explicit interfaces</p> External System Line Numbers Implicit Contract Content <code>generalHelper.groovy</code> 55 <code>load()</code> success + function signatures (parseJson, getFullCommitHash, cleanUpPRBranch, sendBuildStatus, cleanMergedBranchFromWebServer, etc.) <code>jsHelper.groovy</code> 56 <code>load()</code> success + function signatures (checkNodeVersion, findTestingDirs, installNpmInTestingDirs, executeLintingInTestingDirs, runUnitTestsInTestingDirs, getPackageJsonVersion, versionCompare) Docker CLI 287-298, 311, 362-373, 386 <code>docker build</code>, <code>docker push</code>, <code>docker rmi</code> command format + Dockerfile location Azure CLI 222-225, 302-307, 377-382 <code>az acr repository show-tags</code>, <code>az containerapp update</code> command format + environment variable existence (<code>AZURE_CONTAINER_REGISTRY</code>, <code>AZURE_RESOURCE_GROUP</code>) SonarQube Scanner 399-410 Scanner path, CLI option format SonarQube API 414 <code>checkQualityGateStatus</code> return value structure Jenkins Pipeline Params Multiple <code>params.SERVER_*</code>, <code>params.CLIENT_*</code> existence Jenkins Pipeline DSL Entire file <code>env</code>, <code>sh()</code>, <code>dir()</code>, <code>echo()</code>, <code>error()</code>, <code>fileExists()</code>, <code>tool()</code>, <code>withSonarQubeEnv()</code>, <code>withCredentials()</code>, <code>parallel()</code>, <code>when()</code>, etc. <p>Severity Evidence: - Impact Range: High - JenkinsfileDeployment coupled to 10 external systems/tools - Bug Potential: High - Runtime errors occur when Docker/Azure CLI options change, environment variables missing (not detectable at compile time) - Modification Cost: Medium - Wrapper functions or interface documentation needed per external system</p> <p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/srp-violation-analysis/","title":"SRP Violations","text":"<p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/srp-violation-analysis/#jsjenkinsjenkinsfiledeployment-452-lines","title":"JsJenkins/JenkinsfileDeployment (452 lines)","text":""},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/srp-violation-analysis/#1-srp-violation-analysis-criteria","title":"1. SRP Violation Analysis Criteria","text":"<ul> <li>Jenkinsfile Role: Orchestration (pipeline sequence/flow control)</li> <li>SRP Violation Condition: If actual Logic exists in Jenkinsfile, Jenkinsfile modification is required when that domain changes</li> <li>Analysis Method: Using domain classification from pipeline-sequence-diagrams/js-cd.md</li> </ul>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/srp-violation-analysis/#2-functional-domains-and-logic-presence","title":"2. Functional Domains and Logic Presence","text":"<p>Reference: js-cd.md - Functional Domain Summary</p> Domain Stage Logic Exists in Jenkinsfile Description Git Management Prepare WORKSPACE, Post \u25cb Direct Git clone/checkout/reset/pull calls Bitbucket API Prepare WORKSPACE, Post \u25b3 <code>sendBuildStatus</code> arguments hardcoded Node.js (npm) Install Dependencies, Linting, Unit Testing, Server/Client Deploy \u25b3 Helper calls, arguments hardcoded SonarQube Static Analysis \u25cb <code>sonar-scanner</code> config directly constructed, Quality Gate logic Docker Check Condition, Server/Client Deploy \u25cb Direct Docker build/push/rmi command calls Azure Check Condition, Server/Client Deploy \u25cb Direct az CLI command calls (ACR, Container Apps) Environment Config Delete Merged Branch \u25b3 Script loading paths, <code>mainBranches</code> check PR Cleanup Delete Merged Branch \u25cb Direct find/rm command calls, folder name extraction rules <p>(\u25cb: Logic exists, \u25b3: Partially exists (hardcoded/direct calls), \u2717: Fully delegated to Helper)</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/srp-violation-analysis/#3-stage-by-stage-srp-violation-analysis","title":"3. Stage-by-Stage SRP Violation Analysis","text":""},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/srp-violation-analysis/#change-reasons-summary-by-stage","title":"Change Reasons Summary by Stage","text":"Lines Stage/Area Change Reasons 52-90 <code>Delete Merged Branch</code> 5 reasons: Script loading paths + JSON parsing logic + main branch list + folder name extraction rules + web server cleanup logic 92-148 <code>Prepare WORKSPACE</code> 6 reasons: Directory existence check + Git clone + Git checkout/reset/pull + Bitbucket status arguments + Node version check + npm install logic 150-180 <code>Linting</code> stage 2 reasons: Lint result directory + executeLintingInTestingDirs arguments 182-209 <code>Unit Testing</code> stage 2 reasons: Test execution arguments + cd command path 212-239 <code>Check Build and Deploy Condition</code> stage 3 reasons: Environment variable setup logic + version check logic + Docker image tag lookup 242-317 <code>Server-side Build and Deploy</code> stage 6 reasons: Docker build + Docker push + Azure Container Apps config + Docker image cleanup + version comparison logic + ACR tag lookup 319-392 <code>Client-side Build and Deploy</code> stage Same 6 reasons as Server (code copy-paste) 394-422 <code>Static Analysis</code> stage 2 reasons: SonarQube scanner config + Quality Gate check logic Multiple Responsibility Area: <code>Delete Merged Branch</code> (5 change reasons) <pre><code>stage('Delete Merged Branch') {\n    steps {\n        script {\n            generalUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")  // Change reason 1: Script loading path\n            jsUtil = load(\"${env.WORKSPACE}/groovy/jsHelper.groovy\")\n\n            buildResults = generalUtil.parseJson().buildResults  // Change reason 2: JSON parsing logic\n            stageResults = generalUtil.parseJson().stageResults\n\n            if (!mainBranches.contains(DESTINATION_BRANCH)) {  // Change reason 3: Main branch list\n                env.FAILURE_REASON = 'Not merging to the main branch. Exiting the pipeline...'\n                currentBuild.result = buildResults.ABORTED\n                error(env.FAILURE_REASON)\n            }\n\n            COMMIT_HASH = generalUtil.getFullCommitHash(env.WORKSPACE, PR_COMMIT)  // Helper call (excluded)\n\n            generalUtil.cleanUpPRBranch(PR_BRANCH)  // Helper call (excluded)\n\n            env.FOLDER_NAME = \"${JOB_NAME}\".split('/').first()  // Change reason 4: Folder name extraction rules\n            def ticketNumber = generalUtil.parseTicketNumber(PR_BRANCH)\n            generalUtil.cleanMergedBranchFromWebServer(FOLDER_NAME, ticketNumber)  // Change reason 5: Web server cleanup logic\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When script loading path changes (lines 55-56): Helper file location 2. When JSON parsing logic changes (lines 58-59): Constants structure 3. When main branch list changes (lines 61-65): Allowed branch conditions 4. When folder name extraction rules change (line 72): JOB_NAME parsing 5. When web server cleanup logic changes (line 74): cleanMergedBranchFromWebServer call</p> Multiple Responsibility Area: <code>Prepare WORKSPACE</code> (6 change reasons) <pre><code>stage('Prepare WORKSPACE') {\n    environment {\n        REPO_SSH = \"git@bitbucket.org:${PR_PROJECT}.git\"\n    }\n    steps {\n        script {\n            if (!fileExists(\"${PROJECT_DIR}\")) {  // Change reason 1: Directory existence check method\n                echo 'First time running pipeline. Cloning main branch...'\n                sh \"git clone ${REPO_SSH} \\\"${PROJECT_DIR}\\\"\"  // Change reason 2: Git clone command\n            }\n        }\n\n        dir(\"${PROJECT_DIR}\") {\n            echo 'Checkout to the main branch...'\n            sh \"git checkout ${DESTINATION_BRANCH}\"  // Change reason 3: Git checkout/reset/pull workflow\n            echo 'Cleaning project...'\n            sh 'git reset --hard HEAD'\n            echo 'Pulling latest version of default branch...'\n            sh 'git pull'\n        }\n\n        script {\n            echo \"Sending 'In Progress' status to Bitbucket...\"\n            generalUtil.sendBuildStatus(env.WORKSPACE, 'INPROGRESS', COMMIT_HASH, true)  // Change reason 4: Bitbucket status arguments\n\n            jsUtil.checkNodeVersion()  // Change reason 5: Node version check\n\n            echo 'find Testing Dirs'\n            env.TEST_DIRECTORIES = jsUtil.findTestingDirs(PROJECT_DIR)  // Helper call (excluded)\n            echo \"Testing directories: ${env.TEST_DIRECTORIES}\"\n\n            jsUtil.installNpmInTestingDirs(env.TEST_DIRECTORIES)  // Change reason 6: npm install logic\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When directory existence check method changes (line 100): <code>fileExists()</code> condition 2. When Git clone command changes (line 102): clone options 3. When Git checkout/reset/pull workflow changes (lines 107-112): Git command sequence/options 4. When Bitbucket status arguments change (line 116): <code>'INPROGRESS'</code>, <code>true</code> hardcoded 5. When Node version check changes (line 118): checkNodeVersion call method 6. When npm install logic changes (line 125): installNpmInTestingDirs call</p> Multiple Responsibility Area: <code>Check Build and Deploy Condition</code> (3 change reasons) <pre><code>stage('Check Build and Deploy Condition') {\n    steps {\n        script {\n            // Change reason 1: Environment variable setup logic\n            env.SERVER_SKIP_BUILD = 'false'\n            env.CLIENT_SKIP_BUILD = 'false'\n\n            // Server version check\n            String serverImageName = \"${env.AZURE_CONTAINER_REGISTRY}/${params.SERVER_IMAGE_NAME}\"\n            // Change reason 2: Docker image tag lookup\n            String latestServerTag = sh(script: \"\"\"\n                az acr repository show-tags --name ${env.AZURE_CONTAINER_REGISTRY_NAME} \\\\\n                --repository ${params.SERVER_IMAGE_NAME} --orderby time_desc --top 1 -o tsv\n            \"\"\", returnStdout: true).trim()\n\n            String packageJsonServerVersion = jsUtil.getPackageJsonVersion(\"${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}\")\n\n            // Change reason 3: Version comparison logic\n            if (latestServerTag &amp;&amp; jsUtil.versionCompare(packageJsonServerVersion, latestServerTag) &lt;= 0) {\n                echo \"Server version ${packageJsonServerVersion} already exists. Skipping build...\"\n                env.SERVER_SKIP_BUILD = 'true'\n            }\n\n            // Client repeats same pattern...\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When environment variable setup logic changes (lines 217-218): SKIP_BUILD flag initialization 2. When Docker image tag lookup changes (lines 222-225): az acr command options 3. When version comparison logic changes (lines 229-232): versionCompare condition</p> Multiple Responsibility Area: Server vs Client Build and Deploy (same pattern repeated) <p>Server-side Build and Deploy (lines 242-317):</p> <pre><code>stage('Server-side Build and Deploy') {\n    when { expression { env.SERVER_SKIP_BUILD != 'true' } }\n    steps {\n        script {\n            String serverImageName = \"${env.AZURE_CONTAINER_REGISTRY}/${params.SERVER_IMAGE_NAME}\"\n            String serverVersion = jsUtil.getPackageJsonVersion(\"${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}\")\n\n            // Docker build\n            sh \"\"\"\n                docker build -t ${serverImageName}:${serverVersion} \\\\\n                -f ${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}/Dockerfile \\\\\n                ${PROJECT_DIR}/${params.SERVER_SOURCE_FOLDER}\n            \"\"\"\n\n            // Docker push\n            sh \"docker push ${serverImageName}:${serverVersion}\"\n\n            // Azure Container Apps update\n            sh \"\"\"\n                az containerapp update --name ${params.SERVER_CONTAINER_APP_NAME} \\\\\n                --resource-group ${env.AZURE_RESOURCE_GROUP} \\\\\n                --image ${serverImageName}:${serverVersion}\n            \"\"\"\n\n            // Docker image cleanup\n            sh \"docker rmi ${serverImageName}:${serverVersion}\"\n        }\n    }\n}\n</code></pre> <p>Client-side Build and Deploy (lines 319-392): Almost identical code to Server, only variable names differ</p> <p>\u2192 When adding new deployment target (e.g., 'admin'): 75 lines copy-paste required</p> Multiple Responsibility Area: <code>Static Analysis</code> (2 change reasons) <pre><code>stage('Static Analysis') {\n    steps {\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                // Change reason 1: SonarQube scanner config\n                String scannerHome = tool SONARQUBE_SCANNER\n                withSonarQubeEnv(SONARQUBE_SERVER) {\n                    sh \"\"\"\n                        ${scannerHome}/bin/sonar-scanner \\\\\n                        -Dsonar.projectKey=${env.SONAR_PROJECT_KEY} \\\\\n                        -Dsonar.host.url=http://localhost:9000/sonarqube \\\\\n                        -Dsonar.sources=. \\\\\n                        -Dsonar.exclusions=**/node_modules/**,**/coverage/**\n                    \"\"\"\n                }\n            }\n        }\n\n        withCredentials([string(credentialsId: 'SonarQube', variable: 'SONAR_QUBE_AUTH_TOKEN')]) {\n            script {\n                // Change reason 2: Quality Gate check logic\n                catchError(buildResult: buildResults.SUCCESS, stageResult: stageResults.FAILURE) {\n                    Map status = generalUtil.checkQualityGateStatus(SONAR_PROJECT_KEY, env.SONAR_QUBE_AUTH_TOKEN)\n\n                    final String STATUS_OK = 'OK'\n\n                    if ((status.entireCodeStatus != STATUS_OK) || (status.newCodeStatus != STATUS_OK)) {\n                        echo \"Entire Code Status: ${status.entireCodeStatus}, New Code Status: ${status.newCodeStatus}\"\n                        error('Quality gate failed!')\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When SonarQube scanner config changes (lines 399-409): Scanner options, host URL, exclusion patterns 2. When Quality Gate check logic changes (lines 413-421): Status comparison conditions, error handling</p>"},{"location":"problem-analysis/07-JsJenkins-JenkinsfileDeployment/srp-violation-analysis/#conclusion","title":"Conclusion","text":"<p>SRP Violation: - Logic from 7 domains exists in Jenkinsfile - Git Management: Unlike CI, Git commands exist directly in Jenkinsfile (no Helper usage) - Docker/Azure Stage: Direct Docker build/push + az containerapp command calls - Server/Client Deploy: Almost identical code copy-pasted (75 lines copy required when adding new deployment target) - Orchestration Role Violation: Domain logic directly included in Jenkinsfile, requiring Jenkinsfile modification when that domain changes</p> <p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/","title":"Design Smells","text":"<p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#pipelineforjenkinsjenkinsfile-design-smells-symptoms-analysis","title":"PipelineForJenkins/Jenkinsfile - Design Smells Symptoms Analysis","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Symptoms analysis based on static analysis results (SRP, Software Smells, DRY) + code review</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#summary","title":"Summary","text":"Symptom Severity Key Evidence Rigidity Medium Shotgun Surgery (4 locations to modify when adding lint type) Fragility High 5 domains mixed, 9 implicit dependencies Immobility High 315 lines/6 Stages, entire pipeline library CI orchestration Viscosity Medium Missing Encapsulation \u2192 copying Groovy/Jenkinsfile lint is easier Needless Complexity Low Not applicable Needless Repetition High DRY violation (Groovy/Jenkinsfile lint pattern 60 lines repeated) Opacity Low Not applicable"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence","title":"Inference Evidence","text":"Symptom Evidence Source Rigidity Shotgun Surgery 4 locations to modify when adding lint type Code Smells Fragility Divergent Change 5 domains + Implicit Dependency 9 Code Smells + Arch Smells Immobility Multifaceted Abstraction pipeline library CI orchestration Design Smells Viscosity Missing Encapsulation lint execution pattern not encapsulated Design Smells Needless Complexity Not applicable - Needless Repetition Duplicated Code Groovy/Jenkinsfile pattern 2 times Code Smells Opacity Not applicable -"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#1-rigidity","title":"1. Rigidity","text":"<p>Definition: Changing one place requires cascading changes in other places</p> <p>Symptom: \"Thought it was a simple change but it was much more complex\"</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-shotgun-surgery","title":"Inference Evidence: Shotgun Surgery","text":"<p>Locations needing modification when adding new lint type (e.g., 'Python'):</p> Location Modification Content Docker image variable Add <code>def pythonImageStr = '...'</code> Lint execution block Add new <code>exitCodePython</code> variable and execution block (30+ lines) Result handling condition Add <code>|| exitCodePython != 0</code> Python report script Add new argument/call <p>Conclusion: 4 locations need modification when adding new lint type \u2192 Medium Rigidity</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#2-fragility","title":"2. Fragility","text":"<p>Definition: Modifying one place breaks conceptually unrelated places</p> <p>Symptom: \"Why did that break when I touched this?\"</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-divergent-change-implicit-cross-module-dependency","title":"Inference Evidence: Divergent Change + Implicit Cross-module Dependency","text":"<p>5 domains mixed in one file: - Jenkins environment config, Git/Bitbucket, Code quality (Groovy lint), Documentation (Groovydoc), SonarQube</p> <p>9 implicit dependencies: - <code>generalHelper.groovy</code> - <code>python/Lint_groovy_report.py</code> - Docker image (<code>nvuillam/npm-groovy-lint</code>) - <code>.groovylintrc.groovy.json</code>, <code>.groovylintrc.jenkins.json</code> - SonarQube Scanner, SonarQube API - Jenkins Tools (<code>groovy 'Groovy'</code>, <code>jdk 'JDK 17'</code>) - Jenkins Pipeline DSL</p> <p>Potential Fragility scenarios:</p> Change Expected Impact Actual Impact (Inferred) npm-groovy-lint Docker image update Lint Groovy Code Both Groovy/Jenkinsfile affected Lint config file format change Lint Groovy Code Affected lint type failure Python script argument change Lint Groovy Code Report generation failure <p>Conclusion: 5 domains mixed + 9 implicit dependencies \u2192 High Fragility</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#3-immobility","title":"3. Immobility","text":"<p>Definition: Difficult to extract useful parts and reuse in other systems/modules</p> <p>Symptom: \"Too many dependencies come along when trying to separate\"</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-multifaceted-abstraction","title":"Inference Evidence: Multifaceted Abstraction","text":"<p>Entire pipeline library CI orchestration: - Single 315-line Jenkinsfile handles entire Helper file CI flow - Groovy/Jenkinsfile lint mixed in single Stage</p> <p>Problems when attempting separation:</p> Extraction Target Dependencies That Follow PrepareStage generalUtil loading, branch check, Git workflow LintStage Docker image, lint config files, Python report script DocStage groovydoc command, web server deployment AnalysisStage SonarQube Scanner, SonarQube API, generalUtil <p>Conclusion: Entire pipeline library CI in single file \u2192 High Immobility</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#4-viscosity","title":"4. Viscosity","text":"<p>Definition: The right way (preserving design) is harder than the wrong way (hacking)</p> <p>Symptom: \"It takes too long to do it properly, so let's just do it this way for now\"</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-missing-encapsulation-dry-violation-induced","title":"Inference Evidence: Missing Encapsulation \u2192 DRY Violation Induced","text":"<p>Current state (Missing Encapsulation): - Groovy/Jenkinsfile lint execution pattern repeated 2 times (30 lines each) - Result handling pattern repeated 2 times</p> <p>Right way vs Hacking:</p> Situation Right Way Hack Tendency Add new lint type Create lint function and call Copy-paste existing 30 lines Copy (faster) Change lint options Modify function Manually modify 2 places Manual (faster) <p>Conclusion: Lack of encapsulation makes \"copying is easier\" structure \u2192 Medium Viscosity</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#5-needless-complexity","title":"5. Needless Complexity","text":"<p>Definition: Excessive design for features not currently needed</p> <p>Symptom: YAGNI violation, \"might need it later\"</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence_1","title":"Inference Evidence","text":"<p>Dead Code or excessive design: Not applicable</p> <p>Conclusion: Low Needless Complexity</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#6-needless-repetition","title":"6. Needless Repetition","text":"<p>Definition: Code that could be unified through abstraction is duplicated in multiple places</p> <p>Symptom: DRY violation, \"similar code in multiple places\"</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence-duplicated-code","title":"Inference Evidence: Duplicated Code","text":"<p>Groovy/Jenkinsfile lint pattern repeated 2 times (60 lines duplicated):</p> Type Line Numbers Pattern Groovy 115-145 <code>docker.image().inside()</code> + <code>sh npm-groovy-lint</code> + <code>if (exitCode != 0) { Python + catchError }</code> Jenkinsfile 150-190 Same pattern, only config file/target paths differ <p>Improvement direction: <pre><code>def runLint(configFile, targetPaths, reportFile, lintType) {\n    def exitCode = docker.image(LINT_IMAGE).inside(ENTRYPOINT) {\n        return sh(returnStatus: true, script: \"\"\"\n            npm-groovy-lint --failon error --output ${reportFile} \\\\\n                --config ${PROJECT_DIR}/${configFile} ${targetPaths.join(' ')}\n        \"\"\")\n    }\n    processLintResult(exitCode, reportFile, lintType)\n    return exitCode\n}\n</code></pre></p> <p>Conclusion: Groovy/Jenkinsfile pattern 60 lines duplicated \u2192 High Needless Repetition</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#7-opacity","title":"7. Opacity","text":"<p>Definition: Code is hard to understand and intent is unclear</p> <p>Symptom: \"What does this code do?\"</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/design-smells-symptoms/#inference-evidence_2","title":"Inference Evidence","text":"<p>Code review result: Not applicable</p> <p>Conclusion: Low Opacity</p> <p>\u2190 SRP Analysis | Software Smells \u2192</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/","title":"Software Smells","text":"<p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#pipelineforjenkinsjenkinsfile-software-smells-analysis","title":"PipelineForJenkins/Jenkinsfile - Software Smells Analysis","text":"<p>Level-based classification: Code Smell (function level) \u2192 Design Smell (module level) \u2192 Architecture Smell (system level)</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#summary","title":"Summary","text":"Level Category Smell Type Severity Code Change Preventers Divergent Change High Code Change Preventers Shotgun Surgery Medium Code Dispensables Duplicated Code High Code Bloaters Primitive Obsession Low Implementation Coding Standards Typo in Code High Implementation Logic/Flow Magic String Medium Design Abstraction Multifaceted Abstraction High Design Abstraction Missing Abstraction Medium Design Encapsulation Missing Encapsulation High Design Abstraction Imperative Abstraction Medium Architecture Dependency Issues Implicit Cross-module Dependency High"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#1-code-smells-methodfunction-level","title":"1. Code Smells (Method/Function Level)","text":"<p>Source: Fowler, M. (1999). Refactoring: Improving the Design of Existing Code</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#11-change-preventers","title":"1.1 Change Preventers","text":"Divergent Change (5 change reasons) <p>Definition: A single class/file is frequently changed for multiple different reasons</p> Change Reason Affected Area Line Numbers Example Scenario Jenkins environment config change <code>Prepare Workspace</code> 72-76 Script loading path, JSON parsing logic change Git/Bitbucket workflow change <code>Prepare Workspace</code> 78-95 Branch check, clone/checkout policy change Groovy lint config change <code>Lint Groovy Code</code> 105-190 Docker image, lint options, Python report script change Documentation config change <code>Generate Groovydoc</code> 194-224 groovydoc options, web server deployment method change SonarQube config change <code>Static Analysis</code> 242-285 Scanner options, Quality Gate condition change <p>Severity Evidence: - Impact Range: High - Single Jenkinsfile handles entire pipeline shared library CI logic - Bug Potential: Medium - Modifying one domain may cause unexpected impact on other domains - Modification Cost: Medium - Separating 5 domains requires shared library or separate script extraction</p> Shotgun Surgery (4 locations to modify when adding lint type) <p>Definition: A single change requires modification of multiple classes/functions</p> <p>Locations needing modification when adding new lint type (e.g., 'Python'):</p> Line Number Modification Content Current Code 111 Add Docker image variable <code>def imageStr = 'nvuillam/npm-groovy-lint'</code> 115-127 Add new lint execution block <code>docker.image(imageStr).inside(...)</code> 131-145 Add new lint result handling block <code>if (exitCodeGroovy != 0) { ... }</code> 168 Add new exit code condition <code>if (exitCodeJenkins != 0 || exitCodeGroovy != 0)</code> <p>Change Scenario: When adding new lint type <code>'Python'</code>: - Add Docker image variable (<code>def pythonImageStr = '...'</code>) - Add <code>exitCodePython</code> variable and execution block (30+ lines) - Add <code>|| exitCodePython != 0</code> to result handling condition - Modify Python report script call</p> <p>Severity Evidence: - Impact Range: Medium - 4 locations across entire Lint Groovy Code stage (85 lines) need modification - Bug Potential: High - Missing even one of 4 locations causes lint omission or incorrect report - Modification Cost: Low - Refactorable by extracting lint config into data structure and processing with loops</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#12-dispensables","title":"1.2 Dispensables","text":"Duplicated Code (Groovy/Jenkinsfile lint pattern repeated 2 times) <p>Definition: Same code pattern repeated in multiple places</p> <p>Groovy vs Jenkinsfile lint pattern repetition (lines 115-145 vs 150-190):</p> <pre><code>// Lines 115-127 (Groovy lint execution)\ndef exitCodeGroovy = docker.image(imageStr).inside(entrypointStr) {\n    return sh(\n        returnStatus: true,\n        script: \"\"\"\n            echo \"Linting Groovy scripts in ${PROJECT_DIR}/groovy ...\"\n            npm-groovy-lint \\\\\n                --failon error \\\\\n                --output groovy-lint-report.json \\\\\n                --config ${PROJECT_DIR}/.groovylintrc.groovy.json \\\\\n                ${PROJECT_DIR}/groovy\n        \"\"\"\n    )\n}\n\n// Lines 150-164 (Jenkinsfile lint execution) - Same pattern, only config file/target paths differ\ndef exitCodeJenkins = docker.image(imageStr).inside(entrypointStr) {\n    return sh(\n        returnStatus: true,\n        script: \"\"\"\n            echo \"Linting Jenkinsfiles in DLXJenkins, JsJenkins, PipelineForJenkins ...\"\n            npm-groovy-lint \\\\\n                --failon error \\\\\n                --output jenkins-lint-report.json \\\\\n                --config ${PROJECT_DIR}/.groovylintrc.jenkins.json \\\\\n                ${PROJECT_DIR}/DLXJenkins ${PROJECT_DIR}/JsJenkins ${PROJECT_DIR}/PipelineForJenkins\n        \"\"\"\n    )\n}\n</code></pre> <p>Result handling pattern also repeated 2 times (lines 131-145 vs 168-190):</p> <pre><code>// Pattern: Python report script call + catchError\nif (exitCode != 0) {\n    sh script: \"\"\"python '${env.WORKSPACE}/python/Lint_groovy_report.py' ... Fail ...\"\"\"\n    catchError(...) { error(\"linting failed\") }\n} else {\n    sh script: \"\"\"python '${env.WORKSPACE}/python/Lint_groovy_report.py' ... Pass ...\"\"\"\n}\n</code></pre> <p>\u2192 When adding new lint type: 30+ lines copy-paste required</p> <p>Severity Evidence: - Impact Range: High - 2 locations need simultaneous modification when changing lint logic - Bug Potential: High - Inconsistency if only one of 2 locations modified when Docker options or lint config changes - Modification Cost: Medium - Refactoring needed to extract lint execution/result handling into parameterized functions</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#13-bloaters","title":"1.3 Bloaters","text":"Primitive Obsession <p>Definition: Primitive types (strings) used instead of objects/constants</p> Case Current State Line Numbers Problem Docker image <code>'nvuillam/npm-groovy-lint'</code> string 111 Hardcoded image name Lint config files <code>'.groovylintrc.groovy.json'</code>, <code>'.groovylintrc.jenkins.json'</code> 123, 158 Hardcoded config file paths SonarQube URL <code>'http://localhost:9000/sonarqube'</code> string 254 Hardcoded URL Python version <code>'3.10'</code> string 260 Hardcoded version Quality Gate status <code>'OK'</code> string 274 Hardcoded status value Lint target folders <code>'DLXJenkins'</code>, <code>'JsJenkins'</code>, <code>'PipelineForJenkins'</code> 159-161 Hardcoded folder list <p>Severity Evidence: - Impact Range: Low - Affects only functions within single Jenkinsfile file - Bug Potential: Low - No issues with current behavior, just maintenance inconvenience - Modification Cost: Low - Simple fix by extracting to constants or environment variables</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#14-implementation-smells","title":"1.4 Implementation Smells","text":"Typo in Code <p>Definition: Potential bugs due to typos in code</p> Line Number Typo Correct Form Impact 247 <code>buildResults:</code> <code>buildResult:</code> catchError parameter name error - uncertain runtime behavior 247 <code>stageResults:</code> <code>stageResult:</code> catchError parameter name error - uncertain runtime behavior 271 <code>buildResults:</code> <code>buildResult:</code> Same typo repeated 271 <code>stageResults:</code> <code>stageResult:</code> Same typo repeated <p>Code comparison:</p> <pre><code>// Lines 247, 271 (current - typo)\ncatchError(buildResults: buildResults.SUCCESS, stageResults: stageResults.FAILURE) { ... }\n\n// Correct form (used in other Jenkinsfiles)\ncatchError(buildResult: buildResults.SUCCESS, stageResult: stageResults.FAILURE) { ... }\n</code></pre> <p>Severity Evidence: - Impact Range: Low - Affects only Static Analysis stage - Bug Potential: High - Jenkins Pipeline DSL may ignore incorrect parameter names, causing unexpected behavior - Modification Cost: Low - Simple fix by correcting typos</p> Magic String <p>Definition: Unexplained string literals hardcoded in code</p> Line Number Magic String Problem 111 <code>'nvuillam/npm-groovy-lint'</code> Docker image hardcoded - Code modification required when version upgrades 112 <code>'--entrypoint=\"\"'</code> Docker option hardcoded 254 <code>'http://localhost:9000/sonarqube'</code> SonarQube URL hardcoded 256 <code>'DEBUG'</code> Log level hardcoded 260 <code>'3.10'</code> Python version hardcoded <p>Severity Evidence: - Impact Range: Medium - Affects Lint Groovy Code, Static Analysis stages - Bug Potential: Medium - Need to find and modify hardcoded values when environment changes - Modification Cost: Low - Simple fix by extracting to constants or environment variables</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#2-design-smells-modulefile-level","title":"2. Design Smells (Module/File Level)","text":""},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#21-symptoms-martin-2000","title":"2.1 Symptoms (Martin 2000)","text":"<p>Source: Martin, R.C. (2000). Design Principles and Design Patterns</p> <p>Detailed analysis inferred from static analysis results: design-smells-symptoms.md</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#22-principles-suryanarayana-2014","title":"2.2 Principles (Suryanarayana 2014)","text":"<p>Source: Suryanarayana, G. et al. (2014). Refactoring for Software Design Smells</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#abstraction-smells","title":"Abstraction Smells","text":"Multifaceted Abstraction <p>Definition: A single abstraction (class/file) represents multiple concerns (SRP violation)</p> <p>PipelineForJenkins/Jenkinsfile's 5 domains: - Jenkins environment config: Script loading, JSON parsing, error handling - Git/Bitbucket: Branch check, clone, checkout - Code quality: Groovy lint, Jenkinsfile lint (Docker + npm-groovy-lint) - Documentation: Groovydoc generation, web server deployment - SonarQube: Code analysis, Quality Gate check</p> <p>Modules needing separation: - <code>PrepareStage.groovy</code>: Script loading, branch check, Git workflow - <code>LintStage.groovy</code>: Groovy/Jenkinsfile lint (remove pattern repetition) - <code>DocStage.groovy</code>: Groovydoc generation, web server deployment - <code>AnalysisStage.groovy</code>: SonarQube scan, Quality Gate</p> <p>\u2192 Related symptom: Divergent Change (single file changes for 5 different reasons)</p> Missing Abstraction <p>Definition: Concepts implemented with primitive types or strings instead of dedicated classes/constants</p> Concept Needing Abstraction Current State Line Numbers Affected Area Docker image <code>'nvuillam/npm-groovy-lint'</code> hardcoded 111 Lint Groovy Code Lint config files <code>'.groovylintrc.groovy.json'</code>, <code>'.groovylintrc.jenkins.json'</code> hardcoded 123, 158 Lint Groovy Code Lint target folders <code>'DLXJenkins'</code>, <code>'JsJenkins'</code>, <code>'PipelineForJenkins'</code> hardcoded 159-161 Lint Groovy Code SonarQube URL <code>'http://localhost:9000/sonarqube'</code> hardcoded 254 Static Analysis Python version <code>'3.10'</code> hardcoded 260 Static Analysis Quality Gate status <code>'OK'</code> hardcoded 274 Static Analysis <p>Lint config abstraction needed: <pre><code>// Before: Hardcoded per type\ndef exitCodeGroovy = docker.image('nvuillam/npm-groovy-lint').inside(...) {\n    sh \"npm-groovy-lint --config ${PROJECT_DIR}/.groovylintrc.groovy.json ${PROJECT_DIR}/groovy\"\n}\ndef exitCodeJenkins = docker.image('nvuillam/npm-groovy-lint').inside(...) {\n    sh \"npm-groovy-lint --config ${PROJECT_DIR}/.groovylintrc.jenkins.json ${PROJECT_DIR}/DLXJenkins ...\"\n}\n\n// After: Lint config objectified\ndef LINT_CONFIGS = [\n    groovy: [\n        config: '.groovylintrc.groovy.json',\n        targets: ['groovy'],\n        reportFile: 'groovy-lint-report.json'\n    ],\n    jenkins: [\n        config: '.groovylintrc.jenkins.json',\n        targets: ['DLXJenkins', 'JsJenkins', 'PipelineForJenkins'],\n        reportFile: 'jenkins-lint-report.json'\n    ]\n]\n</code></pre></p> <p>\u2192 Related symptoms: - Primitive Obsession (lint config expressed as primitive type strings) - Magic String (Docker image, SonarQube URL, Python version) - Shotgun Surgery (4 locations need modification when adding lint type)</p> Imperative Abstraction <p>Definition: Abstraction operations written procedurally rather than object-oriented</p> <p>PipelineForJenkins/Jenkinsfile's Imperative Abstraction evidence:</p> <p>Procedural script structure due to Jenkins Pipeline DSL characteristics: - <code>stage()</code> blocks execute sequentially - Connected to external tools (Docker, SonarQube) via implicit contracts - Called via <code>sh</code> commands without explicit interfaces</p> External System Call Method Implicit Contract Docker (npm-groovy-lint image) <code>docker.image().inside()</code> Image exists, entrypoint config, CLI option format <code>python/Lint_groovy_report.py</code> <code>sh \"python ...\"</code> Argument order (5), Pass/Fail strings <code>.groovylintrc.*.json</code> npm-groovy-lint --config Config file existence and format SonarQube Scanner <code>sh \"${scannerHome}/bin/sonar-scanner ...\"</code> CLI option format <code>generalHelper.groovy</code> <code>load()</code> + function call 9 function signatures Jenkins Tools <code>tool 'Groovy'</code>, <code>tool 'JDK 17'</code> Tool names exist <p>\u2192 Related symptom: Implicit Cross-module Dependency (implicit contracts with 9 external systems)</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#encapsulation-smells","title":"Encapsulation Smells","text":"Missing Encapsulation <p>Definition: Variations not encapsulated, causing logic to be scattered</p> <p>Groovy/Jenkinsfile lint pattern repetition (lines 115-145 vs 150-190):</p> Location Type Pattern (30 lines) Lines 115-145 Groovy <code>docker.image().inside()</code> + <code>sh npm-groovy-lint</code> + <code>if (exitCode != 0) { Python report + catchError }</code> Lines 150-190 Jenkinsfile Same pattern, only config file/target paths differ <p>Encapsulation approach: Extract to lint function</p> <pre><code>// Before: Repeated 2 times (30 lines \u00d7 2 = 60 lines)\ndef exitCodeGroovy = docker.image(imageStr).inside(entrypointStr) {\n    return sh(returnStatus: true, script: \"\"\"\n        npm-groovy-lint --failon error --output groovy-lint-report.json \\\\\n            --config ${PROJECT_DIR}/.groovylintrc.groovy.json ${PROJECT_DIR}/groovy\n    \"\"\")\n}\nif (exitCodeGroovy != 0) {\n    sh script: \"python '${env.WORKSPACE}/python/Lint_groovy_report.py' ...\"\n    catchError(...) { error(\"Groovy linting failed\") }\n}\n// Jenkinsfile also repeats same pattern...\n\n// After: Encapsulated in function\ndef runLint(configFile, targetPaths, reportFile, lintType) {\n    def exitCode = docker.image(LINT_IMAGE).inside(ENTRYPOINT) {\n        return sh(returnStatus: true, script: \"\"\"\n            npm-groovy-lint --failon error --output ${reportFile} \\\\\n                --config ${PROJECT_DIR}/${configFile} ${targetPaths.join(' ')}\n        \"\"\")\n    }\n    processLintResult(exitCode, reportFile, lintType)\n    return exitCode\n}\nrunLint('.groovylintrc.groovy.json', ['groovy'], 'groovy-lint-report.json', 'Groovy')\nrunLint('.groovylintrc.jenkins.json', ['DLXJenkins', 'JsJenkins', 'PipelineForJenkins'], 'jenkins-lint-report.json', 'Jenkinsfile')\n</code></pre> <p>\u2192 Related symptoms: - Duplicated Code (Groovy/Jenkinsfile lint pattern 60 lines repeated) - Shotgun Surgery (2 locations need simultaneous modification when lint options change)</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#3-architecture-smells-system-level","title":"3. Architecture Smells (System Level)","text":"<p>Source: Garcia et al. (2009), Lippert &amp; Roock (2006), Sharma &amp; Spinellis (2018)</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/software-smells-analysis/#31-dependency-issues","title":"3.1 Dependency Issues","text":"Implicit Cross-module Dependency <p>Definition: Hidden dependencies causing coupling to external systems without explicit interfaces</p> External System Line Numbers Implicit Contract Content <code>generalHelper.groovy</code> 72 <code>load()</code> success + function signatures (parseJson, isBranchUpToDateWithRemote, getFullCommitHash, initializeEnvironment, cloneOrUpdateRepo, checkoutBranch, publishGroovyDocToWebServer, checkQualityGateStatus, sendBuildStatus) <code>python/Lint_groovy_report.py</code> 133-139, 170-176, 183-189 Argument format (groovyReportPath, jenkinsReportPath, commitHash, Pass/Fail, projectDir) Docker (npm-groovy-lint image) 115-127, 150-164 Image existence, entrypoint config, npm-groovy-lint CLI option format <code>.groovylintrc.groovy.json</code> 123 Config file existence and format <code>.groovylintrc.jenkins.json</code> 158 Config file existence and format SonarQube Scanner 248-263 Scanner path, CLI option format (<code>-Dsonar.projectKey</code>, <code>-Dsonar.host.url</code>, <code>-Dsonar.lang.patterns.grvy</code>, etc.) SonarQube API 272 <code>checkQualityGateStatus</code> return value structure (<code>entireCodeStatus</code>, <code>newCodeStatus</code>) Jenkins Tools 9-11, 53-55 <code>groovy 'Groovy'</code>, <code>jdk 'JDK 17'</code>, <code>gradle 'Gradle'</code> tool names exist Jenkins Pipeline DSL Entire file <code>env</code>, <code>sh()</code>, <code>dir()</code>, <code>echo()</code>, <code>error()</code>, <code>tool()</code>, <code>docker.image()</code>, <code>withSonarQubeEnv()</code>, <code>withCredentials()</code>, <code>currentBuild</code>, <code>junit()</code>, etc. <p>Severity Evidence: - Impact Range: High - Jenkinsfile coupled to 9 external systems/config files - Bug Potential: High - Runtime errors occur when Docker image updates, lint config file format changes, Python script argument changes (not detectable at compile time) - Modification Cost: Medium - Interface documentation or Wrapper functions needed per external system</p> <p>\u2190 SRP Analysis | \u2190 Overview</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/srp-violation-analysis/","title":"SRP Violations","text":"<p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/srp-violation-analysis/#pipelineforjenkinsjenkinsfile-315-lines","title":"PipelineForJenkins/Jenkinsfile (315 lines)","text":""},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/srp-violation-analysis/#1-srp-violation-analysis-criteria","title":"1. SRP Violation Analysis Criteria","text":"<ul> <li>Jenkinsfile Role: Orchestration (pipeline sequence/flow control)</li> <li>SRP Violation Condition: If actual Logic exists in Jenkinsfile, Jenkinsfile modification is required when that domain changes</li> <li>Analysis Method: Using domain classification from pipeline-sequence-diagrams/jenkins-ci.md</li> </ul>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/srp-violation-analysis/#2-functional-domains-and-logic-presence","title":"2. Functional Domains and Logic Presence","text":"<p>Reference: jenkins-ci.md - Functional Domain Summary</p> Domain Stage Logic Exists in Jenkinsfile Description Git Management Prepare WORKSPACE, Post \u2717 Delegated to Helper (<code>cloneOrUpdateRepo</code>, <code>checkoutBranch</code>) Bitbucket API Prepare WORKSPACE, Post \u25b3 Direct Python script calls (path/arguments hardcoded) Docker Lint Groovy Code \u25cb Direct Docker container execution, npm-groovy-lint command direct call Gradle Run Unit Tests, Generate Groovydoc \u25cb Direct gradle test/groovydoc command calls Groovydoc Generate Groovydoc \u25cb find command + groovydoc options directly constructed Web Server (SSH/SCP) Generate Groovydoc \u25b3 <code>publishGroovyDocToWebServer</code> Helper call (path hardcoded) SonarQube Static Analysis \u25cb <code>sonar-scanner</code> config directly constructed, Quality Gate logic Environment Config Prepare WORKSPACE \u25b3 Script loading paths, JSON parsing, error handling policy <p>(\u25cb: Logic exists, \u25b3: Partially exists (hardcoded/direct calls), \u2717: Fully delegated to Helper)</p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/srp-violation-analysis/#3-stage-by-stage-srp-violation-analysis","title":"3. Stage-by-Stage SRP Violation Analysis","text":""},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/srp-violation-analysis/#change-reasons-summary-by-stage","title":"Change Reasons Summary by Stage","text":"Lines Stage/Area Change Reasons 66-104 <code>Prepare Workspace</code> 4 reasons: Script loading paths + JSON parsing logic + branch check policy + error handling policy 93-95 Duplicate checkout Logic error: checkout already performed inside <code>cloneOrUpdateRepo</code> \u2192 unnecessary duplicate call 105-193 <code>Lint Groovy Code</code> 5 reasons: Docker info output + Groovy lint config + Groovy lint result handling + Jenkinsfile lint config + Jenkinsfile lint result handling 115-145 vs 150-190 Groovy vs Jenkinsfile lint Same pattern repeated \u2192 code copy-paste required when adding new lint type 194-225 <code>Generate Groovydoc</code> 2 reasons: groovy file search method + groovydoc command options 227-232 <code>Run Unit Tests</code> stage gradle test command 234-240 <code>Publish Test Results</code> stage junit test result path 242-286 <code>Static Analysis</code> 3 reasons: catchError error handling policy + SonarQube scanner config + Quality Gate check logic Multiple Responsibility Area: <code>Prepare Workspace</code> (4 change reasons) <pre><code>stage('Prepare Workspace') {\n    steps {\n        script {\n            dir(\"${PROJECT_DIR}\") {\n                try {\n                    echo 'Preparing the workspace...'\n                    generalUtil = load(\"${env.WORKSPACE}/groovy/generalHelper.groovy\")  // Change reason 1: Script loading path\n\n                    buildResults = generalUtil.parseJson().buildResults  // Change reason 2: JSON parsing logic\n                    stageResults = generalUtil.parseJson().stageResults\n\n                    if (generalUtil.isBranchUpToDateWithRemote(PR_BRANCH) &amp;&amp; !TEST_RUN.equals('Y')) {  // Change reason 3: Branch check policy\n                        echo 'Local branch commit is up to date with remote branch, no changes. Aborting pipeline.'\n                        currentBuild.result = buildResults.ABORTED\n                        error('Branch is up to date, no changes.')\n                    }\n\n                    COMMIT_HASH = generalUtil.getFullCommitHash(env.WORKSPACE, PR_COMMIT)  // Helper call (excluded)\n\n                    generalUtil.initializeEnvironment(env.WORKSPACE, COMMIT_HASH, PR_BRANCH)  // Helper call (excluded)\n\n                    echo 'Cloning or updating repository...'\n                    generalUtil.cloneOrUpdateRepo(PROJECT_TYPE, env.WORKSPACE, PROJECT_DIR, REPO_SSH, params.PR_BRANCH)  // Helper call (excluded)\n\n                    echo \"Checking out branch ${params.PR_BRANCH}...\"\n                    dir(PROJECT_DIR) {\n                        generalUtil.checkoutBranch(PROJECT_DIR, params.PR_BRANCH)  // Helper call (excluded)\n                    }\n                } catch (Exception e) {  // Change reason 4: Error handling policy\n                    echo \"Error in Prepare Workspace stage: ${e.getMessage()}\"\n                    currentBuild.result = buildResults.FAILURE\n                    error(\"Workspace preparation failed: ${e.getMessage()}\")\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When script loading path changes (line 72): Helper file location 2. When JSON parsing logic changes (lines 75-76): Constants structure 3. When branch check policy changes (lines 78-82): Duplicate build prevention condition 4. When error handling policy changes (lines 96-100): catch block handling method</p> <p>Helper function calls (<code>getFullCommitHash</code>, <code>initializeEnvironment</code>, <code>cloneOrUpdateRepo</code>, <code>checkoutBranch</code>) are generalHelper.groovy's responsibility, so excluded</p> Multiple Responsibility Area: <code>Lint Groovy Code</code> (5 change reasons) <pre><code>stage('Lint Groovy Code') {\n    steps {\n        script {\n            sh 'docker info'  // Change reason 1: Docker info output\n            echo 'Running groovy lint using Docker image nvuillam/npm-groovy-lint with disabled entrypoint'\n            def imageStr = 'nvuillam/npm-groovy-lint'\n            def entrypointStr = '--entrypoint=\"\"'\n\n            // Change reason 2: Groovy lint config\n            def exitCodeGroovy = docker.image(imageStr).inside(entrypointStr) {\n                return sh(\n                    returnStatus: true,\n                    script: \"\"\"\n                        echo \"Linting Groovy scripts in ${PROJECT_DIR}/groovy ...\"\n                        npm-groovy-lint \\\\\n                            --failon error \\\\\n                            --output groovy-lint-report.json \\\\\n                            --config ${PROJECT_DIR}/.groovylintrc.groovy.json \\\\\n                            ${PROJECT_DIR}/groovy\n                    \"\"\"\n                )\n            }\n\n            // Change reason 3: Groovy lint result handling\n            if (exitCodeGroovy != 0) {\n                echo \"Linting errors in Groovy scripts. Calling Python script with 'Fail'.\"\n                sh script: \"\"\"\\\\\n                    python '${env.WORKSPACE}/python/Lint_groovy_report.py' \\\\\n                    '${env.WORKSPACE}/groovy-lint-report.json' ...\n                \"\"\".stripIndent()\n\n                catchError(buildResult: buildResults.SUCCESS, stageResult: stageResults.FAILURE) {\n                    error(\"Groovy linting failed (exit code ${exitCodeGroovy})\")\n                }\n            }\n\n            // Change reason 4: Jenkinsfile lint config (same pattern as Groovy repeated)\n            def exitCodeJenkins = docker.image(imageStr).inside(entrypointStr) {\n                return sh(\n                    returnStatus: true,\n                    script: \"\"\"\n                        echo \"Linting Jenkinsfiles in DLXJenkins, JsJenkins, PipelineForJenkins ...\"\n                        npm-groovy-lint \\\\\n                            --failon error \\\\\n                            --output jenkins-lint-report.json \\\\\n                            --config ${PROJECT_DIR}/.groovylintrc.jenkins.json \\\\\n                            ${PROJECT_DIR}/DLXJenkins \\\\\n                            ${PROJECT_DIR}/JsJenkins \\\\\n                            ${PROJECT_DIR}/PipelineForJenkins\n                    \"\"\"\n                )\n            }\n\n            // Change reason 5: Jenkinsfile lint result handling (same pattern as Groovy repeated)\n            if (exitCodeJenkins != 0 || exitCodeGroovy != 0) {\n                echo \"Linting errors in Jenkinsfiles. Calling Python script with 'Fail'.\"\n                sh script: \"\"\"\\\\\n                    python '${env.WORKSPACE}/python/Lint_groovy_report.py' ...\n                \"\"\".stripIndent()\n                // ...\n            } else {\n                echo \"No Jenkinsfile lint errors. Calling Python script with 'Pass'.\"\n                sh script: \"\"\"\\\\\n                    python '${env.WORKSPACE}/python/Lint_groovy_report.py' ...\n                \"\"\".stripIndent()\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When Docker info output changes (line 109): Debug output condition 2. When Groovy lint config changes (lines 115-127): Docker image, lint options, config file 3. When Groovy lint result handling changes (lines 131-145): Python script call, error handling 4. When Jenkinsfile lint config changes (lines 150-164): Almost identical code repeated from Groovy 5. When Jenkinsfile lint result handling changes (lines 168-190): Almost identical code repeated from Groovy</p> <p>Note: Groovy lint and Jenkinsfile lint use almost identical patterns (lines 115-145 vs 150-190)</p> Multiple Responsibility Area: <code>Generate Groovydoc</code> (2 change reasons) <pre><code>stage('Generate Groovydoc') {\n    steps {\n        script {\n            echo 'Generating Groovydoc...'\n            dir(PROJECT_DIR) {\n                // Change reason 1: groovy file search method\n                def fileList = sh(\n                    script: \"find ${PROJECT_DIR}/groovy -type f -name '*.groovy'\",\n                    returnStdout: true).trim()\n\n                if (!fileList) {\n                    error \"No .groovy files found in ${PROJECT_DIR}/groovy\"\n                }\n\n                echo \"Files found for Groovydoc: ${fileList}\"\n\n                // Change reason 2: groovydoc command options\n                sh \"\"\"\n                mkdir -p ${REPORT_DIR}\n                groovydoc -verbose -d ${REPORT_DIR} ${fileList.replaceAll('\\\\\\\\s+', ' ')}\n                \"\"\"\n\n                echo \"Documentation generated at ${REPORT_DIR}\"\n\n                // Helper call (excluded)\n                if (params.PR_STATE == 'MERGED') {\n                    generalUtil.publishGroovyDocToWebServer(REPORT_DIR)\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When groovy file search method changes (lines 200-202): <code>find</code> command options 2. When groovydoc command options change (lines 212-214): Output options, file handling</p> <p>Helper function call (<code>publishGroovyDocToWebServer</code>) is generalHelper.groovy's responsibility, so excluded</p> Multiple Responsibility Area: <code>Static Analysis</code> (3 change reasons) <pre><code>stage('Static Analysis') {\n    steps {\n        dir(\"${PROJECT_DIR}\") {\n            script {\n                sh 'pwd'\n                // Change reason 1: catchError error handling policy (typo: buildResults \u2192 stageResults)\n                catchError(buildResults: buildResults.SUCCESS, stageResults: stageResults.FAILURE) {\n                    String scannerHome = tool SONARQUBE_SCANNER\n                    echo \"SonarQube scanner located at: ${scannerHome}\"\n\n                    // Change reason 2: SonarQube scanner config\n                    withSonarQubeEnv(SONARQUBE_SERVER) {\n                        String sonarCommand = \"\\\"${scannerHome}/bin/sonar-scanner\\\" \" +\n                            \"\\\"-Dsonar.projectKey=${env.SONAR_PROJECT_KEY}\\\" \" +\n                            '\"-Dsonar.host.url=http://localhost:9000/sonarqube\" ' +\n                            '\"-Dsonar.sources=.\" ' +\n                            '\"-Dsonar.log.level=DEBUG\" ' +\n                            '\"-Dsonar.verbose=true\" ' +\n                            '\"-Dsonar.lang.patterns.grvy=\"**/*.groovy,**/Jenkinsfile,**/JenkinsfileDeployment\"\" ' +\n                            '\"-Dsonar.exclusions=**/python/log-template/logs.html,**/Builder.cs,**/build.gradle,**/Bash/**\" ' +\n                            '\"-Dsonar.python.version=3.10\"'\n\n                        echo \"Executing SonarQube scanner with command: ${sonarCommand}\"\n                        sh sonarCommand\n                    }\n                }\n            }\n        }\n\n        withCredentials([string(credentialsId: 'SonarQube', variable: 'SONAR_QUBE_AUTH_TOKEN')]) {\n            script {\n                // Change reason 3: Quality Gate check logic\n                catchError(buildResults: buildResults.SUCCESS, stageResults: stageResults.FAILURE) {\n                    Map status = generalUtil.checkQualityGateStatus(SONAR_PROJECT_KEY, env.SONAR_QUBE_AUTH_TOKEN)  // Helper call\n\n                    final String STATUS_OK = 'OK'\n\n                    if ((status.entireCodeStatus != STATUS_OK) || (status.newCodeStatus != STATUS_OK)) {\n                        echo \"Entire Code Status: ${status.entireCodeStatus}, New Code Status: ${status.newCodeStatus}\"\n                        error('Quality gate failed!')\n                    } else {\n                        echo 'Quality gate passed!'\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>Change Reason Analysis: 1. When catchError error handling policy changes (lines 247, 271): buildResult/stageResult settings (typo present) 2. When SonarQube scanner config changes (lines 252-260): Scanner options, paths, exclusion patterns 3. When Quality Gate check logic changes (lines 272-281): Status comparison conditions, error messages</p> <p>Note: Typo present at line 247 - <code>buildResults</code> \u2192 <code>buildResult</code>, <code>stageResults</code> \u2192 <code>stageResult</code></p>"},{"location":"problem-analysis/08-PipelineForJenkins-Jenkinsfile/srp-violation-analysis/#conclusion","title":"Conclusion","text":"<p>SRP Violation: - Logic from 5 domains exists in Jenkinsfile (Git management excluded) - Docker domain: Direct npm-groovy-lint container execution, lint command direct calls - Lint Groovy Code Stage: Groovy/Jenkinsfile lint same pattern repeated (code copy-paste required when adding new type) - Static Analysis Stage: SonarQube scanner config directly exists in Jenkinsfile - Orchestration Role Violation: Domain logic directly included in Jenkinsfile, requiring Jenkinsfile modification when that domain changes</p> <p>\u2190 Overview | Software Smells \u2192</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/","title":"DLX CD Pipeline Sequence Diagrams","text":"<p>Analysis Target: <code>DLXJenkins/JenkinsfileDeployment</code> (DLX Unity CD Pipeline)</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#domain-summary-by-function","title":"Domain Summary by Function","text":"Domain Function Used Stage Helper Location Git Management clone, checkout, reset, pull Prepare WORKSPACE, Post generalHelper + Jenkinsfile direct Bitbucket API send build status, get commit hash Delete Merged Branch, Prepare WORKSPACE, Post generalHelper + Python Unity CLI Rider Sync, run tests, WebGL build Prepare WORKSPACE, EditMode, PlayMode, Build Project unityHelper Web Server (SSH/SCP) deploy build, clean PR directory Delete Merged Branch, Deploy Build generalHelper + Jenkinsfile direct Linting (Bash) C# code style check Linting Bash Script Environment Setup parseJson, parseTicketNumber, mainBranches check Delete Merged Branch generalHelper PR Cleanup cleanUpPRBranch, cleanMergedBranchFromWebServer Delete Merged Branch generalHelper"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#domain-mapping-by-stage","title":"Domain Mapping by Stage","text":"Stage Git Bitbucket Unity Web Server Linting Environment Setup PR Cleanup Delete Merged Branch \u2713 \u2713 \u2713 \u2713 Prepare WORKSPACE \u2713 \u2713 \u2713 Linting \u2713 EditMode Tests \u2713 PlayMode Tests \u2713 Build Project \u2713 Deploy Build \u2713 Post \u2713 \u2713"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#overall-pipeline-overview","title":"Overall Pipeline Overview","text":"<pre><code>flowchart LR\n    subgraph Stages\n        S1[Delete Merged Branch]\n        S2[Prepare WORKSPACE]\n        S3[Linting]\n        S4[EditMode Tests]\n        S5[PlayMode Tests]\n        S6[Build Project]\n        S7[Deploy Build]\n    end\n\n    S1 --&gt; S2 --&gt; S3 --&gt; S4 --&gt; S5 --&gt; S6 --&gt; S7\n\n    S7 --&gt; Post[Post&lt;br/&gt;always/success/failure/aborted]</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#stage-1-delete-merged-branch","title":"Stage 1: Delete Merged Branch","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n    participant WS as Web Server&lt;br/&gt;(SSH/SCP)\n\n    Note over JF: Stage: Delete Merged Branch\n\n    JF-&gt;&gt;GH: load(\"generalHelper.groovy\")\n    JF-&gt;&gt;GH: load(\"unityHelper.groovy\")\n\n    JF-&gt;&gt;GH: parseJson()\n    GH--&gt;&gt;JF: buildResults, stageResults\n\n    JF-&gt;&gt;JF: mainBranches.contains(DESTINATION_BRANCH)\n    Note over JF: Abort if not merging to main\n\n    JF-&gt;&gt;GH: getFullCommitHash(workspace, PR_COMMIT)\n    GH-&gt;&gt;Python: get_bitbucket_commit_hash.py\n    Python-&gt;&gt;BB: GET /commits\n    BB--&gt;&gt;Python: commit hash\n    Python--&gt;&gt;GH: full commit hash\n    GH--&gt;&gt;JF: COMMIT_HASH\n\n    JF-&gt;&gt;GH: cleanUpPRBranch(PR_BRANCH)\n    Note over GH: find &amp; rm -rf PR directories\n\n    JF-&gt;&gt;GH: parseTicketNumber(PR_BRANCH)\n    GH--&gt;&gt;JF: ticketNumber\n\n    JF-&gt;&gt;GH: cleanMergedBranchFromWebServer(FOLDER_NAME, ticketNumber)\n    GH-&gt;&gt;WS: ssh rm -rf /var/www/html/{folder}/PR-Builds/{ticket}\n    WS--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#stage-2-prepare-workspace","title":"Stage 2: Prepare WORKSPACE","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant UH as unityHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n    participant Unity as Unity CLI\n\n    Note over JF: Stage: Prepare WORKSPACE\n\n    alt !fileExists(PROJECT_DIR)\n        JF-&gt;&gt;Git: git clone {REPO_SSH} {PROJECT_DIR}\n    end\n\n    JF-&gt;&gt;Git: git checkout {DESTINATION_BRANCH}\n    JF-&gt;&gt;Git: git reset --hard HEAD\n    JF-&gt;&gt;Git: git pull\n\n    JF-&gt;&gt;GH: sendBuildStatus(workspace, 'INPROGRESS', commitHash, true)\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py -d\n    Python-&gt;&gt;BB: POST /statuses/build\n    BB--&gt;&gt;Python: OK\n\n    JF-&gt;&gt;UH: getUnityExecutable(workspace, projectDir)\n    UH-&gt;&gt;Python: get_unity_version.py (executable-path)\n    Python--&gt;&gt;UH: unity path\n    UH--&gt;&gt;JF: UNITY_EXECUTABLE\n\n    JF-&gt;&gt;UH: runUnityStage('Rider', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('Rider')\n    UH-&gt;&gt;Unity: unity -batchmode -executeMethod Rider.SyncSolution\n    Unity--&gt;&gt;UH: exit code\n    UH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#stage-3-linting","title":"Stage 3: Linting","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant Bash as Bash Scripts\n\n    Note over JF: Stage: Linting\n\n    JF-&gt;&gt;JF: mkdir -p linting_results\n    JF-&gt;&gt;JF: cp .editorconfig\n    JF-&gt;&gt;Bash: sh Linting.bash\n    Bash--&gt;&gt;JF: exitCode\n\n    alt exitCode != 0\n        Note over JF: catchError - stage FAILURE\n    end</code></pre> <p>Note: In DLX CD, linting results are not reported to Bitbucket (differs from CI)</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#stage-4-editmode-tests","title":"Stage 4: EditMode Tests","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant UH as unityHelper\n    participant Unity as Unity CLI\n\n    Note over JF: Stage: EditMode Tests\n\n    JF-&gt;&gt;JF: mkdir -p test_results\n\n    JF-&gt;&gt;UH: runUnityStage('EditMode', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('EditMode')\n    UH-&gt;&gt;Unity: unity -batchmode -nographics -testPlatform EditMode -runTests\n    Unity--&gt;&gt;UH: exit code + test_results/*.xml\n    UH--&gt;&gt;JF: OK/FAIL</code></pre> <p>Note: In DLX CD, Code Coverage is not generated (CI_PIPELINE=false)</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#stage-5-playmode-tests","title":"Stage 5: PlayMode Tests","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant UH as unityHelper\n    participant Unity as Unity CLI\n\n    Note over JF: Stage: PlayMode Tests\n\n    JF-&gt;&gt;UH: runUnityStage('PlayMode', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('PlayMode')\n    UH-&gt;&gt;Unity: xvfb-run unity -batchmode -testPlatform PlayMode -runTests\n    Unity--&gt;&gt;UH: exit code + test_results/*.xml\n    UH--&gt;&gt;JF: OK/FAIL</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#stage-6-build-project","title":"Stage 6: Build Project","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant UH as unityHelper\n    participant Unity as Unity CLI\n\n    Note over JF: Stage: Build Project\n\n    JF-&gt;&gt;JF: mkdir -p Assets/Editor\n    JF-&gt;&gt;JF: mv Builder.cs Assets/Editor/\n\n    JF-&gt;&gt;UH: runUnityStage('Webgl', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('Webgl')\n    UH-&gt;&gt;Unity: xvfb-run unity -batchmode -buildTarget WebGL -executeMethod Builder.BuildWebGL\n    Unity--&gt;&gt;UH: Builds/*\n    UH--&gt;&gt;JF: OK/FAIL</code></pre> <p>Note: In DLX CD, Build Report is not sent to Bitbucket (differs from CI)</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#stage-7-deploy-build","title":"Stage 7: Deploy Build","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant WS1 as LTI Web Server\n    participant WS2 as eConestoga DLX Server\n\n    Note over JF: Stage: Deploy Build\n\n    Note over JF,WS1: Deploy to LTI Web Server\n    JF-&gt;&gt;WS1: ssh mkdir -p /var/www/html/{FOLDER_NAME}\n    JF-&gt;&gt;WS1: ssh chown vconadmin:vconadmin\n    JF-&gt;&gt;WS1: scp -rp Builds/*\n    JF-&gt;&gt;WS1: ssh bash UpdateBuildURL.sh\n    WS1--&gt;&gt;JF: OK\n\n    alt DLX_PROJECT_LIST.contains(PR_REPO_NAME)\n        Note over JF,WS2: Deploy to eConestoga DLX Server\n        JF-&gt;&gt;WS2: ssh mkdir -p /var/www/html/{FOLDER_NAME}\n        JF-&gt;&gt;WS2: ssh chown vconadmin:vconadmin\n        JF-&gt;&gt;WS2: scp -rp Builds/*\n        JF-&gt;&gt;WS2: ssh bash UpdateBuildURL.sh\n        WS2--&gt;&gt;JF: OK\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-cd/#post-alwayssuccessfailureaborted","title":"Post: always/success/failure/aborted","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Post: always/success/failure/aborted\n\n    Note over JF,GH: always block\n    JF-&gt;&gt;JF: currentBuild.description = PR_BRANCH\n    JF-&gt;&gt;GH: checkoutBranch(PROJECT_DIR, DESTINATION_BRANCH)\n    GH-&gt;&gt;Git: git reset --hard\n    GH-&gt;&gt;Git: git clean -fd\n    GH-&gt;&gt;Git: git checkout {destination}\n    GH-&gt;&gt;Git: git reset --hard origin/{destination}\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    Note over JF,GH: success/failure/aborted\n    alt success\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'SUCCESSFUL', commitHash, true)\n    else failure\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'FAILED', commitHash, true)\n    else aborted\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'STOPPED', commitHash, true)\n    end\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py -d\n    Python-&gt;&gt;BB: POST /statuses/build\n    BB--&gt;&gt;Python: OK\n    GH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/","title":"DLX CI Pipeline Sequence Diagrams","text":"<p>Analysis Target: <code>DLXJenkins/Jenkinsfile</code> (DLX Unity CI Pipeline)</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#domain-summary-by-function","title":"Domain Summary by Function","text":"Domain Function Used Stage Helper Location Git Management clone, fetch, checkout, reset, clean, merge Prepare WORKSPACE, Post generalHelper Bitbucket API send build status, get commit hash, send report Prepare WORKSPACE, Linting, Code Coverage, Build Project, Post generalHelper + Python Unity CLI run tests, generate coverage, WebGL build, Rider Sync Prepare WORKSPACE, EditMode, PlayMode, Code Coverage, Build Project unityHelper Web Server (SSH/SCP) deploy report/build results Code Coverage, Build Project generalHelper Linting (Bash) C# code style check Linting Bash Script Environment Setup parseJson, parseTicketNumber, env settings Prepare WORKSPACE generalHelper"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#domain-mapping-by-stage","title":"Domain Mapping by Stage","text":"Stage Git Bitbucket Unity Web Server Linting Environment Setup Prepare WORKSPACE \u2713 \u2713 \u2713 \u2713 Linting \u2713 \u2713 EditMode Tests \u2713 PlayMode Tests \u2713 Code Coverage \u2713 \u2713 \u2713 Build Project \u2713 \u2713 \u2713 Post \u2713 \u2713"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#overall-pipeline-overview","title":"Overall Pipeline Overview","text":"<pre><code>flowchart LR\n    subgraph Stages\n        S1[Prepare WORKSPACE]\n        S2[Linting]\n        S3[EditMode Tests]\n        S4[PlayMode Tests]\n        S5[Code Coverage&lt;br/&gt;Send Reports]\n        S6[Build Project]\n    end\n\n    S1 --&gt; S2 --&gt; S3 --&gt; S4 --&gt; S5 --&gt; S6\n\n    S6 --&gt; Post[Post&lt;br/&gt;always/success/failure/aborted]</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#stage-1-prepare-workspace","title":"Stage 1: Prepare WORKSPACE","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant UH as unityHelper\n    participant Git as Git CLI\n    participant BB as Bitbucket API\n    participant Unity as Unity CLI\n    participant Python as Python Scripts\n\n    Note over JF: Stage: Prepare WORKSPACE\n\n    JF-&gt;&gt;JF: sh 'env' (print environment variables)\n    JF-&gt;&gt;GH: load(\"generalHelper.groovy\")\n    JF-&gt;&gt;UH: load(\"unityHelper.groovy\")\n\n    JF-&gt;&gt;GH: parseJson()\n    GH--&gt;&gt;JF: buildResults, stageResults\n\n    JF-&gt;&gt;GH: isBranchUpToDateWithRemote(PR_BRANCH)\n    GH-&gt;&gt;Git: git fetch origin\n    GH-&gt;&gt;Git: git rev-parse HEAD\n    GH-&gt;&gt;Git: git rev-parse origin/{branch}\n    Git--&gt;&gt;GH: commit hashes\n    GH--&gt;&gt;JF: true/false\n\n    JF-&gt;&gt;GH: getFullCommitHash(PR_BRANCH)\n    GH-&gt;&gt;Python: get_bitbucket_commit_hash.py\n    Python-&gt;&gt;BB: GET /commits\n    BB--&gt;&gt;Python: commit hash\n    Python--&gt;&gt;GH: full commit hash\n    GH--&gt;&gt;JF: COMMIT_HASH\n\n    JF-&gt;&gt;GH: initializeEnvironment(workspace, commitHash, prBranch)\n    GH-&gt;&gt;GH: sendBuildStatus('INPROGRESS')\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py\n    Python-&gt;&gt;BB: POST /statuses/build\n    GH-&gt;&gt;GH: parseTicketNumber(prBranch)\n    GH--&gt;&gt;JF: TICKET_NUMBER, FOLDER_NAME\n\n    JF-&gt;&gt;GH: cloneOrUpdateRepo(workspace, projectDir, prBranch)\n    GH-&gt;&gt;Git: git clone / git fetch\n    GH-&gt;&gt;Git: git checkout\n    GH-&gt;&gt;Git: git reset --hard\n    GH-&gt;&gt;Git: git clean -fd\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    JF-&gt;&gt;GH: mergeBranchIfNeeded(prBranch)\n    GH-&gt;&gt;GH: getDefaultBranch()\n    GH-&gt;&gt;Git: git remote show origin\n    Git--&gt;&gt;GH: default branch\n    GH-&gt;&gt;GH: isBranchUpToDateWithMain()\n    GH-&gt;&gt;Git: git merge-base --is-ancestor\n    GH-&gt;&gt;GH: tryMerge(defaultBranch)\n    GH-&gt;&gt;Git: git merge origin/{default}\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    JF-&gt;&gt;UH: getUnityExecutable(workspace, projectDir)\n    UH-&gt;&gt;Python: get_unity_version.py (executable-path)\n    Python--&gt;&gt;UH: unity path\n    UH--&gt;&gt;JF: UNITY_EXECUTABLE\n\n    JF-&gt;&gt;UH: runUnityStage('Rider', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('Rider')\n    UH-&gt;&gt;Unity: unity -batchmode -executeMethod Rider.SyncSolution\n    Unity--&gt;&gt;UH: exit code\n    UH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#stage-2-linting","title":"Stage 2: Linting","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant Bash as Bash Scripts\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Stage: Linting\n\n    JF-&gt;&gt;JF: mkdir -p linting_results\n    JF-&gt;&gt;JF: cp .editorconfig\n    JF-&gt;&gt;Bash: sh Linting.bash\n    Bash--&gt;&gt;JF: exitCode\n\n    alt exitCode == 2 (lint errors)\n        JF-&gt;&gt;Python: linting_error_report.py (fail)\n        Python-&gt;&gt;BB: POST /reports\n    else exitCode == 0\n        JF-&gt;&gt;Python: linting_error_report.py (pass)\n        Python-&gt;&gt;BB: POST /reports\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#stage-3-editmode-tests","title":"Stage 3: EditMode Tests","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant UH as unityHelper\n    participant Unity as Unity CLI\n\n    Note over JF: Stage: EditMode Tests\n\n    JF-&gt;&gt;JF: mkdir -p test_results\n    JF-&gt;&gt;JF: mkdir -p coverage_results\n\n    JF-&gt;&gt;UH: runUnityStage('EditMode', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('EditMode')\n    UH-&gt;&gt;UH: setLogFilePathAndUrl()\n    UH-&gt;&gt;UH: getTestRunArgs()\n    UH-&gt;&gt;UH: getCodeCoverageArguments()\n    UH-&gt;&gt;Unity: unity -batchmode -nographics -testPlatform EditMode -runTests -enableCodeCoverage\n    Unity--&gt;&gt;UH: exit code + test_results/*.xml\n    UH--&gt;&gt;JF: OK/FAIL</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#stage-4-playmode-tests","title":"Stage 4: PlayMode Tests","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant UH as unityHelper\n    participant Unity as Unity CLI\n\n    Note over JF: Stage: PlayMode Tests\n\n    JF-&gt;&gt;UH: runUnityStage('PlayMode', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('PlayMode')\n    UH-&gt;&gt;Unity: xvfb-run unity -batchmode -testPlatform PlayMode -runTests -enableCodeCoverage\n    Unity--&gt;&gt;UH: exit code + test_results/*.xml\n    UH--&gt;&gt;JF: OK/FAIL</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#stage-5-code-coverage-send-reports","title":"Stage 5: Code Coverage &amp; Send Reports","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant UH as unityHelper\n    participant Unity as Unity CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n    participant WS as Web Server&lt;br/&gt;(SSH/SCP)\n\n    Note over JF: Stage: Code Coverage &amp; Send Reports\n\n    JF-&gt;&gt;UH: runUnityStage('Coverage', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('Coverage')\n    UH-&gt;&gt;UH: loadPathsToExclude()\n    Note over UH: Read Settings.json\n    UH-&gt;&gt;UH: fetCoverageOptionsKeyAndValue()\n    UH-&gt;&gt;UH: buildCoverageOptions()\n    UH-&gt;&gt;Unity: unity -batchmode -nographics -enableCodeCoverage -coverageOptions\n    Unity--&gt;&gt;UH: coverage_results/Report\n    UH--&gt;&gt;JF: OK/FAIL\n\n    JF-&gt;&gt;GH: publishTestResultsHtmlToWebServer(folderName, ticketNum, reportPath, 'CodeCoverage')\n    GH-&gt;&gt;WS: ssh mkdir -p /var/www/html/{folder}/{ticket}/CodeCoverage\n    GH-&gt;&gt;WS: scp -r coverage_results/Report/*\n    GH-&gt;&gt;WS: ssh chmod 755 &amp; chown\n    WS--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    JF-&gt;&gt;UH: sendTestReport(workspace, reportDir, commitHash)\n    UH-&gt;&gt;Python: create_bitbucket_test_report.py\n    Python-&gt;&gt;BB: POST /reports\n    BB--&gt;&gt;Python: OK\n    UH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#stage-6-build-project","title":"Stage 6: Build Project","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant UH as unityHelper\n    participant Unity as Unity CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n    participant WS as Web Server&lt;br/&gt;(SSH/SCP)\n\n    Note over JF: Stage: Build Project\n\n    JF-&gt;&gt;JF: mkdir -p Assets/Editor\n    JF-&gt;&gt;JF: cp Builder.cs Assets/Editor/\n\n    JF-&gt;&gt;UH: runUnityStage('Webgl', errorMsg)\n    UH-&gt;&gt;UH: runUnityBatchMode('Webgl')\n    UH-&gt;&gt;Unity: xvfb-run unity -batchmode -buildTarget WebGL -executeMethod Builder.BuildWebGL\n    Unity--&gt;&gt;UH: Builds/* + build_project_results/*.log\n    UH--&gt;&gt;JF: OK/FAIL\n\n    JF-&gt;&gt;Python: create_bitbucket_webgl_build_report.py (commitHash, logPath)\n    Python-&gt;&gt;BB: POST /reports\n    BB--&gt;&gt;Python: OK\n\n    JF-&gt;&gt;GH: publishBuildResultsToWebServer(folderName, ticketNum, buildsPath, resultsPath)\n    GH-&gt;&gt;WS: ssh mkdir -p /var/www/html/{folder}/{ticket}/build\n    GH-&gt;&gt;WS: scp -r Builds/*\n    GH-&gt;&gt;WS: scp -r build_project_results/*\n    GH-&gt;&gt;WS: ssh chmod 755 &amp; chown\n    WS--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/dlx-ci/#post-alwayssuccessfailureaborted","title":"Post: always/success/failure/aborted","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Post: always/success/failure/aborted\n\n    Note over JF,GH: always block\n    JF-&gt;&gt;GH: checkoutBranch(PROJECT_DIR, DESTINATION_BRANCH)\n    GH-&gt;&gt;Git: git reset --hard\n    GH-&gt;&gt;Git: git clean -fd\n    GH-&gt;&gt;Git: git checkout {destination}\n    GH-&gt;&gt;Git: git reset --hard origin/{destination}\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n    JF-&gt;&gt;JF: currentBuild.description = PR_BRANCH\n\n    Note over JF,GH: success/failure/aborted\n    alt success\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'SUCCESSFUL', commitHash)\n    else failure\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'FAILED', commitHash)\n    else aborted\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'STOPPED', commitHash)\n    end\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py\n    Python-&gt;&gt;BB: POST /statuses/build\n    BB--&gt;&gt;Python: OK\n    GH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/","title":"Jenkins CI Pipeline Sequence Diagrams","text":"<p>Analysis Target: <code>PipelineForJenkins/Jenkinsfile</code> (Jenkins Groovy CI Pipeline)</p> <p>Trigger: Runs when PR is <code>OPEN</code> or <code>MERGED</code> (differs from other pipelines)</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#domain-summary-by-function","title":"Domain Summary by Function","text":"Domain Function Used Stage Helper Location Git Management clone, fetch, checkout, reset, clean, merge Prepare WORKSPACE, Post generalHelper Bitbucket API send build status, get commit hash Prepare WORKSPACE, Post generalHelper + Python Docker run npm-groovy-lint container Lint Groovy Code Jenkinsfile direct Gradle run tests (gradle test) Run Unit Tests Jenkinsfile direct Groovydoc generate API documentation (gradle groovydoc) Generate Groovydoc Jenkinsfile direct Web Server (SSH/SCP) deploy Groovydoc HTML (MERGED only) Generate Groovydoc generalHelper SonarQube static code analysis, Quality Gate check Static Analysis generalHelper + sonar-scanner Environment Setup parseJson, parseTicketNumber Prepare WORKSPACE generalHelper"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#domain-mapping-by-stage","title":"Domain Mapping by Stage","text":"Stage Git Bitbucket Docker Gradle Groovydoc Web Server SonarQube Environment Setup Prepare WORKSPACE \u2713 \u2713 \u2713 Lint Groovy Code \u2713 Generate Groovydoc \u2713 \u2713 \u2713* Run Unit Tests \u2713 Publish Test Results \u2713 Static Analysis \u2713 Post \u2713 \u2713 <p>*Web Server: Groovydoc deployed only when MERGED</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#ci-pipeline-comparison-dlx-ci-vs-js-ci-vs-jenkins-ci","title":"CI Pipeline Comparison (DLX CI vs JS CI vs Jenkins CI)","text":"Item DLX CI JS CI Jenkins CI Tool Unity CLI Node.js (npm) Gradle + Docker Helper unityHelper jsHelper (none - direct calls) Trigger OPEN OPEN OPEN + MERGED Install Dependencies No Yes (npm install) No Linting Bash Script (C#) jsHelper (ESLint) Docker (npm-groovy-lint) Test Type EditMode/PlayMode Unit Testing (Jest) Gradle Test (Spock) Code Coverage Unity Code Coverage lcov-report JaCoCo Static Analysis No Yes (SonarQube) Yes (SonarQube) Build Project Yes (WebGL) No No Documentation No No Yes (Groovydoc)"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#overall-pipeline-overview","title":"Overall Pipeline Overview","text":"<pre><code>flowchart LR\n    subgraph Stages\n        S1[Prepare WORKSPACE]\n        S2[Lint Groovy Code]\n        S3[Generate Groovydoc]\n        S4[Run Unit Tests]\n        S5[Publish Test Results]\n        S6[Static Analysis]\n    end\n\n    S1 --&gt; S2 --&gt; S3 --&gt; S4 --&gt; S5 --&gt; S6\n\n    S6 --&gt; Post[Post&lt;br/&gt;always/success/failure/aborted]</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#stage-1-prepare-workspace","title":"Stage 1: Prepare WORKSPACE","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Stage: Prepare WORKSPACE\n\n    JF-&gt;&gt;JF: sh 'env' (print environment variables)\n    JF-&gt;&gt;GH: load(\"generalHelper.groovy\")\n\n    JF-&gt;&gt;GH: parseJson()\n    GH--&gt;&gt;JF: buildResults, stageResults\n\n    JF-&gt;&gt;GH: isBranchUpToDateWithRemote(PR_BRANCH)\n    GH-&gt;&gt;Git: git fetch origin\n    GH-&gt;&gt;Git: git rev-parse HEAD\n    GH-&gt;&gt;Git: git rev-parse origin/{branch}\n    Git--&gt;&gt;GH: commit hashes\n    GH--&gt;&gt;JF: true/false\n\n    JF-&gt;&gt;GH: getFullCommitHash(workspace, PR_COMMIT)\n    GH-&gt;&gt;Python: get_bitbucket_commit_hash.py\n    Python-&gt;&gt;BB: GET /commits\n    BB--&gt;&gt;Python: commit hash\n    Python--&gt;&gt;GH: full commit hash\n    GH--&gt;&gt;JF: COMMIT_HASH\n\n    JF-&gt;&gt;GH: initializeEnvironment(workspace, commitHash, prBranch)\n    GH-&gt;&gt;GH: sendBuildStatus('INPROGRESS')\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py\n    Python-&gt;&gt;BB: POST /statuses/build\n    GH-&gt;&gt;GH: parseTicketNumber(prBranch)\n    GH--&gt;&gt;JF: TICKET_NUMBER, FOLDER_NAME\n\n    JF-&gt;&gt;GH: cloneOrUpdateRepo(workspace, projectDir, prBranch)\n    GH-&gt;&gt;Git: git clone / git fetch\n    GH-&gt;&gt;Git: git checkout\n    GH-&gt;&gt;Git: git reset --hard\n    GH-&gt;&gt;Git: git clean -fd\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    JF-&gt;&gt;GH: mergeBranchIfNeeded(prBranch)\n    GH-&gt;&gt;GH: getDefaultBranch()\n    GH-&gt;&gt;Git: git remote show origin\n    Git--&gt;&gt;GH: default branch\n    GH-&gt;&gt;GH: isBranchUpToDateWithMain()\n    GH-&gt;&gt;Git: git merge-base --is-ancestor\n    GH-&gt;&gt;GH: tryMerge(defaultBranch)\n    GH-&gt;&gt;Git: git merge origin/{default}\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#stage-2-lint-groovy-code","title":"Stage 2: Lint Groovy Code","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant Docker as Docker Container&lt;br/&gt;(npm-groovy-lint)\n    participant FS as File System\n\n    Note over JF: Stage: Lint Groovy Code\n\n    JF-&gt;&gt;FS: mkdir -p linting_results\n\n    JF-&gt;&gt;Docker: docker run nvuillam/npm-groovy-lint\n    Note over Docker: -v ${WORKSPACE}:/workspace&lt;br/&gt;-w /workspace\n    Docker-&gt;&gt;Docker: npm-groovy-lint --path ./groovy --output json\n    Docker--&gt;&gt;FS: linting_results/groovy-lint-report.json\n    Docker--&gt;&gt;JF: exitCode\n\n    alt exitCode != 0\n        Note over JF: catchError - stage FAILURE\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#stage-3-generate-groovydoc","title":"Stage 3: Generate Groovydoc","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Gradle as Gradle CLI\n    participant WS as Web Server&lt;br/&gt;(SSH/SCP)\n\n    Note over JF: Stage: Generate Groovydoc\n\n    JF-&gt;&gt;Gradle: gradle groovydoc\n    Gradle--&gt;&gt;JF: build/docs/groovydoc/\n\n    alt PR_STATE == 'MERGED'\n        JF-&gt;&gt;GH: publishTestResultsHtmlToWebServer(FOLDER_NAME, TICKET_NUMBER, groovydoc, 'groovydoc')\n        GH-&gt;&gt;WS: ssh mkdir -p /var/www/html/{folder}/{ticket}/groovydoc\n        GH-&gt;&gt;WS: scp -r groovydoc/*\n        WS--&gt;&gt;GH: OK\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#stage-4-run-unit-tests","title":"Stage 4: Run Unit Tests","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant Gradle as Gradle CLI\n    participant FS as File System\n\n    Note over JF: Stage: Run Unit Tests\n\n    JF-&gt;&gt;Gradle: gradle test\n    Gradle-&gt;&gt;Gradle: Spock Framework test execution\n    Gradle--&gt;&gt;FS: build/test-results/test/*.xml\n    Gradle--&gt;&gt;FS: build/reports/tests/test/index.html\n    Gradle--&gt;&gt;FS: build/reports/jacoco/test/jacocoTestReport.xml\n    Gradle--&gt;&gt;JF: exitCode\n\n    alt exitCode != 0\n        Note over JF: catchError - stage FAILURE\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#stage-5-publish-test-results","title":"Stage 5: Publish Test Results","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Stage: Publish Test Results\n\n    JF-&gt;&gt;JF: junit 'build/test-results/test/*.xml'\n    Note over JF: Jenkins JUnit Plugin\n\n    JF-&gt;&gt;Python: create_bitbucket_test_report.py\n    Python-&gt;&gt;BB: POST /reports (test results)\n    BB--&gt;&gt;Python: OK\n\n    JF-&gt;&gt;Python: create_bitbucket_coverage_report.py\n    Python-&gt;&gt;BB: POST /reports (coverage results)\n    BB--&gt;&gt;Python: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#stage-6-static-analysis","title":"Stage 6: Static Analysis","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant SQ as SonarQube\n\n    Note over JF: Stage: Static Analysis\n\n    JF-&gt;&gt;SQ: sonar-scanner -Dsonar.projectKey={key} -Dsonar.sources=.\n    SQ--&gt;&gt;JF: analysis queued\n\n    JF-&gt;&gt;GH: checkQualityGateStatus(SONAR_PROJECT_KEY, token)\n    loop retry (max 5)\n        GH-&gt;&gt;SQ: GET /api/ce/component\n        SQ--&gt;&gt;GH: queue status\n        alt queue not empty\n            GH-&gt;&gt;GH: sleep(10)\n        else queue empty\n            GH-&gt;&gt;SQ: GET /api/qualitygates/project_status\n            SQ--&gt;&gt;GH: entireCodeStatus, newCodeStatus\n        end\n    end\n    GH--&gt;&gt;JF: PASSED/FAILED\n\n    alt status != OK\n        Note over JF: catchError - stage FAILURE\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/jenkins-ci/#post-alwayssuccessfailureaborted","title":"Post: always/success/failure/aborted","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Post: always/success/failure/aborted\n\n    Note over JF,GH: always block\n    JF-&gt;&gt;JF: currentBuild.description = PR_BRANCH\n    JF-&gt;&gt;GH: checkoutBranch(PROJECT_DIR, DESTINATION_BRANCH)\n    GH-&gt;&gt;Git: git reset --hard\n    GH-&gt;&gt;Git: git clean -fd\n    GH-&gt;&gt;Git: git checkout {destination}\n    GH-&gt;&gt;Git: git reset --hard origin/{destination}\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    Note over JF,GH: success/failure/aborted\n    alt success\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'SUCCESSFUL', commitHash, false)\n    else failure\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'FAILED', commitHash, false)\n    else aborted\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'STOPPED', commitHash, false)\n    end\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py\n    Python-&gt;&gt;BB: POST /statuses/build\n    BB--&gt;&gt;Python: OK\n    GH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/","title":"JS CD Pipeline Sequence Diagrams","text":"<p>Analysis Target: <code>JsJenkins/JenkinsfileDeployment</code> (JavaScript CD Pipeline)</p> <p>Trigger: Runs when PR is <code>MERGED</code></p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#domain-summary-by-function","title":"Domain Summary by Function","text":"Domain Function Used Stage Helper Location Git Management clone, checkout, reset, pull Prepare WORKSPACE, Post generalHelper + Jenkinsfile direct Bitbucket API send build status, get commit hash Prepare WORKSPACE, Post generalHelper + Python Node.js (npm) version check, npm install, linting, tests, version compare Install Dependencies, Linting, Unit Testing, Server/Client Deploy jsHelper SonarQube static code analysis, Quality Gate check Static Analysis generalHelper + sonar-scanner Docker build container, push image, cleanup Check Condition, Server/Client Deploy Jenkinsfile direct Azure ACR login, update Container App, get version Check Condition, Server/Client Deploy Jenkinsfile direct (az CLI) Environment Setup parseJson, findTestingDirs, mainBranches check Delete Merged Branch, Prepare WORKSPACE generalHelper + jsHelper PR Cleanup find &amp; rm -rf PR directories Delete Merged Branch Jenkinsfile direct"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#domain-mapping-by-stage","title":"Domain Mapping by Stage","text":"Stage Git Bitbucket Node.js SonarQube Docker Azure Environment Setup PR Cleanup Delete Merged Branch \u2713 \u2713 Prepare WORKSPACE \u2713 \u2713 \u2713 Install Dependencies \u2713 Linting \u2713 Unit Testing \u2713 Static Analysis \u2713 Check Build Condition \u2713 \u2713 Server Build &amp; Deploy \u2713 \u2713 \u2713 Client Build &amp; Deploy \u2713 \u2713 \u2713 Post \u2713 \u2713"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#js-ci-vs-js-cd-comparison","title":"JS CI vs JS CD Comparison","text":"Item JS CI JS CD Trigger <code>OPEN</code> (PR created) <code>MERGED</code> (PR merged) <code>CI_PIPELINE</code> <code>true</code> <code>false</code> Coverage Report Send Yes No Web Server Deploy Yes (lcov-report) No Docker Build No Yes Azure Deploy No Yes (Container App) Delete Merged Branch No Yes"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#dlx-cd-vs-js-cd-comparison","title":"DLX CD vs JS CD Comparison","text":"Item DLX CD JS CD Deploy Target LTI Web Server, eConestoga Azure Container App Build Tool Unity (WebGL) Docker Deploy Method SSH/SCP Docker push + az containerapp Version Management None package.json version compare Conditional Deploy DLX_PROJECT_LIST Version compare result"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#overall-pipeline-overview","title":"Overall Pipeline Overview","text":"<pre><code>flowchart LR\n    subgraph Stages\n        S1[Delete Merged Branch]\n        S2[Prepare WORKSPACE]\n        S3[Install Dependencies]\n        S4[Linting]\n        S5[Unit Testing]\n        S6[Static Analysis]\n        S7[Check Build Condition]\n        S8[Server Build &amp; Deploy]\n        S9[Client Build &amp; Deploy]\n    end\n\n    S1 --&gt; S2 --&gt; S3 --&gt; S4 --&gt; S5 --&gt; S6 --&gt; S7 --&gt; S8 --&gt; S9\n\n    S9 --&gt; Post[Post&lt;br/&gt;always/success/failure/aborted/unstable]</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-1-delete-merged-branch","title":"Stage 1: Delete Merged Branch","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant JSH as jsHelper\n    participant Shell as Shell (find/rm)\n\n    Note over JF: Stage: Delete Merged Branch\n\n    JF-&gt;&gt;JF: mainBranches.contains(DESTINATION_BRANCH)\n    Note over JF: Abort if not merging to main\n\n    JF-&gt;&gt;GH: load(\"generalHelper.groovy\")\n    JF-&gt;&gt;JSH: load(\"jsHelper.groovy\")\n\n    JF-&gt;&gt;GH: parseJson()\n    GH--&gt;&gt;JF: buildResults, stageResults\n\n    JF-&gt;&gt;Shell: find ../ -type d -name \"{PR_BRANCH}\"\n    Shell--&gt;&gt;JF: branch_path\n\n    alt branch_path exists\n        JF-&gt;&gt;Shell: rm -rf {branch_path}\n        JF-&gt;&gt;Shell: rm -rf {branch_path}@tmp\n    end\n\n    JF-&gt;&gt;JF: FOLDER_NAME = JOB_NAME.split('/').first()</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-2-prepare-workspace","title":"Stage 2: Prepare WORKSPACE","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant JSH as jsHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Stage: Prepare WORKSPACE\n\n    JF-&gt;&gt;GH: getFullCommitHash(workspace, PR_COMMIT)\n    GH-&gt;&gt;Python: get_bitbucket_commit_hash.py\n    Python-&gt;&gt;BB: GET /commits\n    BB--&gt;&gt;Python: commit hash\n    Python--&gt;&gt;GH: full commit hash\n    GH--&gt;&gt;JF: COMMIT_HASH\n\n    alt !fileExists(PROJECT_DIR)\n        JF-&gt;&gt;Git: git clone {REPO_SSH} {PROJECT_DIR}\n    end\n\n    JF-&gt;&gt;Git: git checkout {DESTINATION_BRANCH}\n    JF-&gt;&gt;Git: git reset --hard HEAD\n    JF-&gt;&gt;Git: git pull\n\n    JF-&gt;&gt;GH: sendBuildStatus(workspace, 'INPROGRESS', commitHash, true)\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py -d\n    Python-&gt;&gt;BB: POST /statuses/build\n    BB--&gt;&gt;Python: OK\n\n    JF-&gt;&gt;JSH: findTestingDirs(PROJECT_DIR)\n    JSH--&gt;&gt;JF: TEST_DIRECTORIES</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-3-install-dependencies","title":"Stage 3: Install Dependencies","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant JSH as jsHelper\n    participant NPM as npm CLI\n\n    Note over JF: Stage: Install Dependencies\n\n    JF-&gt;&gt;NPM: node -v\n    JF-&gt;&gt;NPM: npm -v\n    JF-&gt;&gt;NPM: npm config ls\n\n    JF-&gt;&gt;JSH: installNpmInTestingDirs(TEST_DIRECTORIES)\n    loop for each testDir\n        JSH-&gt;&gt;NPM: npm install\n        NPM--&gt;&gt;JSH: OK\n    end\n    JSH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-4-linting","title":"Stage 4: Linting","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant JSH as jsHelper\n    participant NPM as npm CLI\n\n    Note over JF: Stage: Linting\n\n    JF-&gt;&gt;JF: mkdir -p linting_results\n\n    JF-&gt;&gt;JSH: executeLintingInTestingDirs(TEST_DIRECTORIES, false)\n    loop for each testDir\n        JSH-&gt;&gt;NPM: npm run lint\n        NPM--&gt;&gt;JSH: exitCode\n    end\n    JSH--&gt;&gt;JF: OK/FAIL</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-5-unit-testing","title":"Stage 5: Unit Testing","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant JSH as jsHelper\n    participant NPM as npm CLI\n\n    Note over JF: Stage: Unit Testing\n\n    JF-&gt;&gt;JSH: runUnitTestsInTestingDirs(TEST_DIRECTORIES, false)\n    loop for each testDir\n        JSH-&gt;&gt;NPM: npm test\n        NPM--&gt;&gt;JSH: exitCode\n    end\n    JSH--&gt;&gt;JF: OK/FAIL</code></pre> <p>Note: In JS CD, Coverage Report is not sent to Bitbucket (differs from CI)</p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-6-static-analysis","title":"Stage 6: Static Analysis","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant SQ as SonarQube\n\n    Note over JF: Stage: Static Analysis\n\n    JF-&gt;&gt;SQ: sonar-scanner -Dsonar.projectKey={key} -Dsonar.sources=.\n    SQ--&gt;&gt;JF: analysis queued\n\n    JF-&gt;&gt;GH: checkQualityGateStatus(SONAR_PROJECT_KEY, token)\n    loop retry (max 5)\n        GH-&gt;&gt;SQ: GET /api/ce/component\n        SQ--&gt;&gt;GH: queue status\n        alt queue not empty\n            GH-&gt;&gt;GH: sleep(10)\n        else queue empty\n            GH-&gt;&gt;SQ: GET /api/qualitygates/project_status\n            SQ--&gt;&gt;GH: entireCodeStatus, newCodeStatus\n        end\n    end\n    GH--&gt;&gt;JF: PASSED/FAILED\n\n    alt status != OK\n        Note over JF: catchError - stage FAILURE\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-7-check-build-and-deploy-condition","title":"Stage 7: Check Build and Deploy Condition","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant Docker as Docker CLI\n    participant AZ as Azure CLI\n\n    Note over JF: Stage: Check Build and Deploy Condition\n\n    JF-&gt;&gt;Docker: docker info\n    Docker--&gt;&gt;JF: OK/FAIL\n    Note over JF: Error if Docker not running\n\n    JF-&gt;&gt;AZ: az login --identity\n    AZ--&gt;&gt;JF: OK\n\n    JF-&gt;&gt;AZ: az acr login --name webbuilds\n    AZ--&gt;&gt;JF: OK/FAIL\n    Note over JF: Error if ACR login failed</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-8-server-build-and-deploy","title":"Stage 8: Server Build and Deploy","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant JSH as jsHelper\n    participant AZ as Azure CLI\n    participant Docker as Docker CLI\n    participant ACR as Azure Container Registry\n\n    Note over JF: Stage: Server Build and Deploy\n    Note over JF: when: params.SERVER_SOURCE_FOLDER exists\n\n    JF-&gt;&gt;AZ: az acr repository show-tags --name webbuilds --repository {SERVER_CONTAINER_NAME}\n    AZ--&gt;&gt;JF: server_latest_version\n\n    JF-&gt;&gt;JSH: getPackageJsonVersion()\n    JSH--&gt;&gt;JF: project_server_version\n\n    JF-&gt;&gt;JSH: versionCompare(server_latest_version, project_server_version)\n    JSH--&gt;&gt;JF: true/false\n\n    alt version is up-to-date\n        JF-&gt;&gt;Docker: docker build -t {ACR}/{SERVER_CONTAINER_NAME}:{version}\n        Docker--&gt;&gt;JF: image built\n\n        JF-&gt;&gt;Docker: docker push {ACR}/{SERVER_CONTAINER_NAME}:{version}\n        Docker-&gt;&gt;ACR: push image\n        ACR--&gt;&gt;Docker: OK\n\n        JF-&gt;&gt;AZ: az containerapp update --name {SERVER_CONTAINER_NAME} --image {version}\n        AZ--&gt;&gt;JF: OK\n\n        JF-&gt;&gt;Docker: docker rmi {image}\n        Docker--&gt;&gt;JF: image removed\n    else version not up-to-date\n        Note over JF: UNSTABLE - Skip deployment\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#stage-9-client-build-and-deploy","title":"Stage 9: Client Build and Deploy","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant JSH as jsHelper\n    participant AZ as Azure CLI\n    participant Docker as Docker CLI\n    participant ACR as Azure Container Registry\n\n    Note over JF: Stage: Client Build and Deploy\n    Note over JF: when: params.CLIENT_SOURCE_FOLDER exists\n\n    JF-&gt;&gt;AZ: az acr repository show-tags --name webbuilds --repository {CLIENT_CONTAINER_NAME}\n    AZ--&gt;&gt;JF: client_latest_version\n\n    JF-&gt;&gt;JSH: getPackageJsonVersion()\n    JSH--&gt;&gt;JF: project_client_version\n\n    JF-&gt;&gt;JSH: versionCompare(client_latest_version, project_client_version)\n    JSH--&gt;&gt;JF: true/false\n\n    alt version is up-to-date\n        JF-&gt;&gt;Docker: docker build -t {ACR}/{CLIENT_CONTAINER_NAME}:{version}\n        Docker--&gt;&gt;JF: image built\n\n        JF-&gt;&gt;Docker: docker push {ACR}/{CLIENT_CONTAINER_NAME}:{version}\n        Docker-&gt;&gt;ACR: push image\n        ACR--&gt;&gt;Docker: OK\n\n        JF-&gt;&gt;AZ: az containerapp update --name {CLIENT_CONTAINER_NAME} --image {version}\n        AZ--&gt;&gt;JF: OK\n\n        JF-&gt;&gt;Docker: docker rmi {image}\n        Docker--&gt;&gt;JF: image removed\n    else version not up-to-date\n        Note over JF: UNSTABLE - Skip deployment\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-cd/#post-alwayssuccessfailureabortedunstable","title":"Post: always/success/failure/aborted/unstable","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Post: always/success/failure/aborted/unstable\n\n    Note over JF,GH: always block\n    JF-&gt;&gt;JF: currentBuild.description = PR_BRANCH\n    JF-&gt;&gt;GH: checkoutBranch(PROJECT_DIR, DESTINATION_BRANCH)\n    GH-&gt;&gt;Git: git reset --hard\n    GH-&gt;&gt;Git: git clean -fd\n    GH-&gt;&gt;Git: git checkout {destination}\n    GH-&gt;&gt;Git: git reset --hard origin/{destination}\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    Note over JF,GH: success/failure/aborted/unstable\n    alt success\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'SUCCESSFUL', commitHash, true)\n    else failure\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'FAILED', commitHash, true)\n    else aborted\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'STOPPED', commitHash, true)\n    else unstable\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'SUCCESSFUL', commitHash, true)\n    end\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py -d\n    Python-&gt;&gt;BB: POST /statuses/build\n    BB--&gt;&gt;Python: OK\n    GH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/","title":"JS CI Pipeline Sequence Diagrams","text":"<p>Analysis Target: <code>JsJenkins/Jenkinsfile</code> (JavaScript CI Pipeline)</p> <p>Trigger: Runs when PR is <code>OPEN</code></p>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#domain-summary-by-function","title":"Domain Summary by Function","text":"Domain Function Used Stage Helper Location Git Management clone, fetch, checkout, reset, clean, merge Prepare WORKSPACE, Post generalHelper Bitbucket API send build status, get commit hash, send coverage report Prepare WORKSPACE, Unit Testing, Post generalHelper + Python Node.js (npm) version check, npm install, run tests, linting Install Dependencies, Linting, Unit Testing jsHelper Web Server (SSH/SCP) deploy coverage report HTML Unit Testing generalHelper SonarQube static code analysis, Quality Gate check Static Analysis generalHelper + sonar-scanner Environment Setup parseJson, parseTicketNumber, findTestingDirs Prepare WORKSPACE generalHelper + jsHelper"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#domain-mapping-by-stage","title":"Domain Mapping by Stage","text":"Stage Git Bitbucket Node.js Web Server SonarQube Environment Setup Prepare WORKSPACE \u2713 \u2713 \u2713 Install Dependencies \u2713 Linting \u2713 Unit Testing \u2713 \u2713 \u2713 Static Analysis \u2713 Post \u2713 \u2713"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#dlx-ci-vs-js-ci-comparison","title":"DLX CI vs JS CI Comparison","text":"Item DLX CI JS CI Tool Unity CLI Node.js (npm) Helper unityHelper jsHelper Install Dependencies No Yes (npm install) Linting Bash Script (C#) jsHelper (ESLint) Test Type EditMode/PlayMode Unit Testing (Jest) Code Coverage Unity Code Coverage lcov-report Static Analysis No Yes (SonarQube) Build Project Yes (WebGL) No"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#overall-pipeline-overview","title":"Overall Pipeline Overview","text":"<pre><code>flowchart LR\n    subgraph Stages\n        S1[Prepare WORKSPACE]\n        S2[Install Dependencies]\n        S3[Linting]\n        S4[Unit Testing]\n        S5[Static Analysis]\n    end\n\n    S1 --&gt; S2 --&gt; S3 --&gt; S4 --&gt; S5\n\n    S5 --&gt; Post[Post&lt;br/&gt;always/success/failure/aborted]</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#stage-1-prepare-workspace","title":"Stage 1: Prepare WORKSPACE","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant JSH as jsHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Stage: Prepare WORKSPACE\n\n    JF-&gt;&gt;JF: sh 'env' (print environment variables)\n    JF-&gt;&gt;GH: load(\"generalHelper.groovy\")\n    JF-&gt;&gt;JSH: load(\"jsHelper.groovy\")\n\n    JF-&gt;&gt;GH: parseJson()\n    GH--&gt;&gt;JF: buildResults, stageResults\n\n    JF-&gt;&gt;GH: isBranchUpToDateWithRemote(PR_BRANCH)\n    GH-&gt;&gt;Git: git fetch origin\n    GH-&gt;&gt;Git: git rev-parse HEAD\n    GH-&gt;&gt;Git: git rev-parse origin/{branch}\n    Git--&gt;&gt;GH: commit hashes\n    GH--&gt;&gt;JF: true/false\n\n    JF-&gt;&gt;GH: getFullCommitHash(workspace, PR_COMMIT)\n    GH-&gt;&gt;Python: get_bitbucket_commit_hash.py\n    Python-&gt;&gt;BB: GET /commits\n    BB--&gt;&gt;Python: commit hash\n    Python--&gt;&gt;GH: full commit hash\n    GH--&gt;&gt;JF: COMMIT_HASH\n\n    JF-&gt;&gt;GH: initializeEnvironment(workspace, commitHash, prBranch)\n    GH-&gt;&gt;GH: sendBuildStatus('INPROGRESS')\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py\n    Python-&gt;&gt;BB: POST /statuses/build\n    GH-&gt;&gt;GH: parseTicketNumber(prBranch)\n    GH--&gt;&gt;JF: TICKET_NUMBER, FOLDER_NAME\n\n    JF-&gt;&gt;GH: cloneOrUpdateRepo(workspace, projectDir, prBranch)\n    GH-&gt;&gt;Git: git clone / git fetch\n    GH-&gt;&gt;Git: git checkout\n    GH-&gt;&gt;Git: git reset --hard\n    GH-&gt;&gt;Git: git clean -fd\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    JF-&gt;&gt;GH: mergeBranchIfNeeded(prBranch)\n    GH-&gt;&gt;GH: getDefaultBranch()\n    GH-&gt;&gt;Git: git remote show origin\n    Git--&gt;&gt;GH: default branch\n    GH-&gt;&gt;GH: isBranchUpToDateWithMain()\n    GH-&gt;&gt;Git: git merge-base --is-ancestor\n    GH-&gt;&gt;GH: tryMerge(defaultBranch)\n    GH-&gt;&gt;Git: git merge origin/{default}\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    JF-&gt;&gt;JSH: findTestingDirs(PROJECT_DIR)\n    JSH--&gt;&gt;JF: TEST_DIRECTORIES</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#stage-2-install-dependencies","title":"Stage 2: Install Dependencies","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant JSH as jsHelper\n    participant NPM as npm CLI\n\n    Note over JF: Stage: Install Dependencies\n\n    JF-&gt;&gt;JSH: checkNodeVersion()\n    JSH-&gt;&gt;NPM: node -v\n    NPM--&gt;&gt;JSH: version\n    JSH-&gt;&gt;NPM: npm -v\n    NPM--&gt;&gt;JSH: version\n\n    JF-&gt;&gt;JSH: installNpmInTestingDirs(TEST_DIRECTORIES)\n    loop for each testDir\n        JSH-&gt;&gt;NPM: npm install\n        NPM--&gt;&gt;JSH: OK\n    end\n    JSH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#stage-3-linting","title":"Stage 3: Linting","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant JSH as jsHelper\n    participant NPM as npm CLI\n\n    Note over JF: Stage: Linting\n\n    JF-&gt;&gt;JF: mkdir -p linting_results\n\n    JF-&gt;&gt;JSH: executeLintingInTestingDirs(TEST_DIRECTORIES, false)\n    loop for each testDir\n        JSH-&gt;&gt;NPM: npm run lint\n        NPM--&gt;&gt;JSH: exitCode\n    end\n    JSH--&gt;&gt;JF: OK/FAIL</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#stage-4-unit-testing","title":"Stage 4: Unit Testing","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant JSH as jsHelper\n    participant NPM as npm CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n    participant WS as Web Server&lt;br/&gt;(SSH/SCP)\n\n    Note over JF: Stage: Unit Testing\n\n    JF-&gt;&gt;JSH: runUnitTestsInTestingDirs(TEST_DIRECTORIES, false)\n    loop for each testDir\n        JSH-&gt;&gt;NPM: npm test --coverage\n        NPM--&gt;&gt;JSH: coverage-summary.json, test-results.json\n    end\n    JSH--&gt;&gt;JF: OK/FAIL\n\n    Note over JF,WS: Publish coverage HTML to Web Server\n    JF-&gt;&gt;GH: publishTestResultsHtmlToWebServer(FOLDER_NAME, TICKET_NUMBER, lcov-report, 'server')\n    GH-&gt;&gt;WS: ssh mkdir -p /var/www/html/{folder}/{ticket}/server\n    GH-&gt;&gt;WS: scp -r lcov-report/*\n    WS--&gt;&gt;GH: OK\n\n    JF-&gt;&gt;GH: publishTestResultsHtmlToWebServer(FOLDER_NAME, TICKET_NUMBER, lcov-report, 'client')\n    GH-&gt;&gt;WS: ssh mkdir -p /var/www/html/{folder}/{ticket}/client\n    GH-&gt;&gt;WS: scp -r lcov-report/*\n    WS--&gt;&gt;GH: OK\n\n    Note over JF,BB: Send coverage reports to Bitbucket\n    alt params.SERVER_SOURCE_FOLDER exists\n        JF-&gt;&gt;JSH: retrieveReportSummaryDirs(serverDir)\n        JSH--&gt;&gt;JF: coverageSummaryDir, testSummaryDir\n        JF-&gt;&gt;Python: create_bitbucket_coverage_report.py --server\n        Python-&gt;&gt;BB: POST /reports\n        BB--&gt;&gt;Python: OK\n    end\n\n    alt params.CLIENT_SOURCE_FOLDER exists\n        JF-&gt;&gt;JSH: retrieveReportSummaryDirs(clientDir)\n        JSH--&gt;&gt;JF: coverageSummaryDir, testSummaryDir\n        JF-&gt;&gt;Python: create_bitbucket_coverage_report.py --client\n        Python-&gt;&gt;BB: POST /reports\n        BB--&gt;&gt;Python: OK\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#stage-5-static-analysis","title":"Stage 5: Static Analysis","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant SQ as SonarQube\n\n    Note over JF: Stage: Static Analysis\n\n    JF-&gt;&gt;SQ: sonar-scanner -Dsonar.projectKey={key} -Dsonar.sources=.\n    SQ--&gt;&gt;JF: analysis queued\n\n    JF-&gt;&gt;GH: checkQualityGateStatus(SONAR_PROJECT_KEY, token)\n    loop retry (max 5)\n        GH-&gt;&gt;SQ: GET /api/ce/component\n        SQ--&gt;&gt;GH: queue status\n        alt queue not empty\n            GH-&gt;&gt;GH: sleep(10)\n        else queue empty\n            GH-&gt;&gt;SQ: GET /api/qualitygates/project_status\n            SQ--&gt;&gt;GH: entireCodeStatus, newCodeStatus\n        end\n    end\n    GH--&gt;&gt;JF: PASSED/FAILED\n\n    alt status != OK\n        Note over JF: catchError - stage FAILURE\n    end</code></pre>"},{"location":"problem-analysis/pipeline-sequence-diagrams/js-ci/#post-alwayssuccessfailureaborted","title":"Post: always/success/failure/aborted","text":"<pre><code>sequenceDiagram\n    autonumber\n\n    participant JF as Jenkinsfile&lt;br/&gt;(Orchestrator)\n    participant GH as generalHelper\n    participant Git as Git CLI\n    participant Python as Python Scripts\n    participant BB as Bitbucket API\n\n    Note over JF: Post: always/success/failure/aborted\n\n    Note over JF,GH: always block\n    JF-&gt;&gt;JF: currentBuild.description = PR_BRANCH\n    JF-&gt;&gt;GH: checkoutBranch(PROJECT_DIR, DESTINATION_BRANCH)\n    GH-&gt;&gt;Git: git reset --hard\n    GH-&gt;&gt;Git: git clean -fd\n    GH-&gt;&gt;Git: git checkout {destination}\n    GH-&gt;&gt;Git: git reset --hard origin/{destination}\n    Git--&gt;&gt;GH: OK\n    GH--&gt;&gt;JF: OK\n\n    Note over JF,GH: success/failure/aborted\n    alt success\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'SUCCESSFUL', commitHash, false)\n    else failure\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'FAILED', commitHash, false)\n    else aborted\n        JF-&gt;&gt;GH: sendBuildStatus(workspace, 'STOPPED', commitHash, false)\n    end\n    GH-&gt;&gt;Python: send_bitbucket_build_status.py\n    Python-&gt;&gt;BB: POST /statuses/build\n    BB--&gt;&gt;Python: OK\n    GH--&gt;&gt;JF: OK</code></pre>"},{"location":"problem-analysis/reference/","title":"Software Smells &amp; Anti-Patterns Taxonomy","text":"<p>This document provides a comprehensive classification of software smells and anti-patterns, organized by category, source/perspective, and specific types. It integrates classic definitions with modern research taxonomies (e.g., Sharma et al., Suryanarayana et al.).</p>"},{"location":"problem-analysis/reference/#summary-table","title":"Summary Table","text":"Category Primary Source / Perspective Scope &amp; Description Code Smell Fowler/Beck (1999) Scope: Intra-class or method level.Focus: Refactoring targets to improve maintainability and readability. Design Smell - Symptoms Robert C. Martin (2000) Scope: Inter-class or component relationships.Focus: Symptom-based: Observable signs of rotting design (Rigidity, Fragility, etc.). Design Smell - Principles Suryanarayana et al. (2014) Scope: Inter-class or component relationships.Focus: Principle-based: Violations of OO principles (Abstraction, Encapsulation, Modularization, Hierarchy). Architecture Smell Garcia et al. (2009), Lippert &amp; Roock, Sharma Scope: System-level structure.Focus: High-level structural issues affecting system evolution, deployment, and scalability. Anti-pattern Brown et al. (1998) Scope: Development, Architecture, and Project Management.Focus: Common solutions to recurring problems that generate negative consequences. Implementation Smell Sharma's Taxonomy Scope: Statement/Method level.Focus: Specific coding constructs that indicate poor implementation choices (subset of code smells). Test Smell Meszaros (xUnit Patterns) &amp; Others Scope: Test Code.Focus: Issues reducing test maintainability, reliability (flakiness), and execution speed. Configuration Smell Sharma's Taxonomy Scope: Configuration Files (IaC, XML, JSON, YAML).Focus: Security risks, deployment fragility, and environmental inconsistencies. Database Smell Sharma's Taxonomy, Arulraj et al. Scope: Database Schema &amp; Queries.Focus: Poor schema design, inefficient queries, and misuse of database features. Performance Smell Various Sources Scope: Runtime Behavior.Focus: Patterns known to degrade system latency, throughput, or resource efficiency. Grammar Smell Sharma's Taxonomy Scope: DSLs &amp; Parsers.Focus: Issues in language grammar definitions affecting parsing efficiency and ambiguity."},{"location":"problem-analysis/reference/#quick-navigation","title":"Quick Navigation","text":"# Category Types Count 1 Code Smells 22 2a Design Smells - Symptoms 7 2b Design Smells - Principles 27 3 Architecture Smells 9 4 Anti-patterns 27 (Dev: 11, Arch: 7, Mgmt: 9) 5 Implementation Smells 10 6 Test Smells 14 7 Configuration Smells 7 8 Database Smells 10 (Schema: 6, Query: 4) 9 Performance Smells 9 10 Grammar Smells 7"},{"location":"problem-analysis/reference/01-code-smells/","title":"Code Smells","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/01-code-smells/#code-smells","title":"Code Smells","text":"<ul> <li>Source: Refactoring: Improving the Design of Existing Code (Fowler &amp; Beck, 1999)</li> </ul> <p>Context: Visible signs that code may need refactoring (intra-class or method level).</p> <p>References: * Refactoring.guru Catalog * Code Smells Answer Table (Scribd) * Coding Horror: Code Smells * Industrial Logic: Smells to Refactorings</p> Type Description Duplicated Code Identical or very similar code exists in more than one location. Long Method A method contains too many lines of code or does too much. Large Class A class has too many fields/methods/lines of code. Long Parameter List A method has too many parameters, making it hard to read/call. Divergent Change You have to change the same class in different ways for different reasons. Shotgun Surgery A single change requires making many small changes to many different classes. Feature Envy A method seems more interested in a class other than the one it is in. Data Clumps Data items that like to hang around together (e.g., fields, parameters). Primitive Obsession Using primitives instead of small objects for simple tasks (e.g., currency, ranges). Switch Statements Complex switch statements or type codes that should be polymorphism. Parallel Inheritance Hierarchies Every time you make a subclass of one class, you have to make a subclass of another. Lazy Class A class that doesn't do enough to justify its existence. Speculative Generality Code created \"just in case\" to support anticipated future features. Temporary Field Instance variables that are set only in certain circumstances. Message Chains A client asks one object for another object, which asks for another, etc. Middle Man A class that delegates all its work to another class. Inappropriate Intimacy Classes know too much about each other's private parts. Alternative Classes w/ Diff. Interfaces Classes that do the same thing but have different method names/signatures. Incomplete Library Class A library class that doesn't provide the functionality you need. Data Class Classes that have fields, getters and setters, and nothing else. Refused Bequest Subclasses usually use only a little of what their parents give them. Comments Used to hide bad code (the \"deodorant\" for other smells). <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/02a-design-smells-symptoms/","title":"Design Smells (Symptoms)","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/02a-design-smells-symptoms/#design-smells-symptom-based","title":"Design Smells - Symptom-Based","text":"<ul> <li>Source: Principles and Patterns (Robert C. Martin, 2000)</li> </ul> <p>Context: Observable symptoms that indicate software is rotting - focusing on how design problems manifest rather than which principle is violated.</p> <p>References: * Design Principles and Design Patterns (UTU) * Agile Software Development (Book)</p>"},{"location":"problem-analysis/reference/02a-design-smells-symptoms/#extended-definitions","title":"Extended Definitions","text":"Type Definition Symptom / Criteria Example Rigidity Changing one place requires cascading changes to other places. \"What I thought was a simple change turned out to be much more complex.\" / Higher rigidity = more modules need to be modified. Modifying a parameter block requires changes to all 5 files. Fragility Modifying one place breaks conceptually unrelated places. \"Why does touching this break that?\" / Developers refer to certain code as \"danger zones.\" Modifying a Git function breaks Bitbucket reporting. Immobility Useful parts are difficult to extract and reuse in other systems/modules. Extracting code brings too many other dependencies. / Cost of separation &gt; cost of rewriting. Trying to extract only Git functions from generalHelper, but too many other dependencies. Viscosity Doing the right thing (preserving design) is harder than hacking. \"Doing it properly takes too long, let's just do it this way for now.\" / Maintaining design is more difficult than breaking it. Copy-paste is faster than creating a common function. Needless Complexity Over-engineering for features not currently needed. YAGNI violation / Code exists because \"we might need it later.\" Unused abstraction layers, unused parameters. Needless Repetition Code that could be unified through abstraction is duplicated in multiple places. DRY violation / Similar code exists in slightly different forms across multiple locations. Same post block repeated in 5 pipelines. Opacity Code is hard to understand and intent is unclear. \"What does this code do?\" / Code becomes harder to understand over time. Unclear variable names, no comments, complex logic. <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/02b-design-smells-principles/","title":"Design Smells (Principles)","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/02b-design-smells-principles/#design-smells-principle-based","title":"Design Smells - Principle-Based","text":"<ul> <li>Source: Refactoring for Software Design Smells (Suryanarayana et al., 2014)</li> </ul> <p>Context: Violations of core OO design principles (Abstraction, Encapsulation, Modularization, Hierarchy).</p> <p>References: * Refactoring for Software Design Smells (InfoQ) * Smells in Software Design (ACM) * Design Smells Taxonomy (Tushar Sharma)</p>"},{"location":"problem-analysis/reference/02b-design-smells-principles/#summary-table","title":"Summary Table","text":"Sub-Category Type Description Applied for Jenkins/Procedecual Abstraction Missing Abstraction Concepts are implemented using primitive types or data clumps instead of a dedicated class. O Abstraction Multifaceted Abstraction An abstraction has more than one responsibility (violates SRP). O Abstraction Unnecessary Abstraction An abstraction that is not needed (e.g., essentially empty). O Abstraction Unutilized Abstraction An abstraction that is declared but not used. O Abstraction Duplicate Abstraction Two or more abstractions have identical names or implementation. O Abstraction Imperative Abstraction An abstraction whose operations are procedural rather than object-oriented. - Abstraction Incomplete Abstraction An abstraction that does not support all complementary or expected operations. - Encapsulation Missing Encapsulation Variations are not encapsulated, leading to scattered logic. O Encapsulation Deficient Encapsulation Access modifiers are too permissive (e.g., everything is public). - Encapsulation Leaky Encapsulation An abstraction exposes implementation details through its interface. - Encapsulation Unexploited Encapsulation Client code uses explicit type checks (instanceof) instead of polymorphism. - Modularization Broken Modularization Data and/or methods that should be together are separated. O Modularization Insufficient Modularization An abstraction is too large or complex (e.g., God Class). O Modularization Cyclically-Dependent Modularization Two or more abstractions depend on each other directly or indirectly. O Modularization Hub-like Modularization An abstraction has dependencies with a large number of other abstractions. O Hierarchy Missing Hierarchy Use of conditional logic (if/else) instead of inheritance/polymorphism. - Hierarchy Unnecessary Hierarchy Inheritance is used where composition would be better, or no hierarchy is needed. - Hierarchy Unfactored Hierarchy Duplicate code exists among siblings in a hierarchy. - Hierarchy Wide Hierarchy A class has an excessive number of subclasses. - Hierarchy Speculative Hierarchy Hierarchy defined for future use that does not currently exist. - Hierarchy Deep Hierarchy Excessive inheritance levels (inheritance depth &gt; threshold). - Hierarchy Rebellious Hierarchy A subclass rejects the contract of its superclass. - Hierarchy Broken Hierarchy The superclass and subclass relationship is not \"is-a\". - Hierarchy Multipath Hierarchy A subclass inherits from a superclass through multiple paths (Diamond problem). - Hierarchy Cyclic Hierarchy A superclass depends on one of its subclasses. - <p>Note: This book assumes OOP-based design. Jenkins Pipeline (Groovy scripts) is procedural code without class/inheritance structures, so Hierarchy Smells and some Encapsulation Smells are not applicable. However, Abstraction and Modularization concepts can be interpreted at the file/function level.</p>"},{"location":"problem-analysis/reference/02b-design-smells-principles/#jenkinsprocedural-application-examples","title":"Jenkins/Procedural Application Examples","text":"Sub-Category Type Jenkins/Procedural Application Abstraction Missing Abstraction Constants/settings hardcoded instead of abstracted into variables or config Abstraction Multifaceted Abstraction Module/file/function has multiple responsibilities Abstraction Unnecessary Abstraction Unnecessary function/file separation Abstraction Unutilized Abstraction Declared but unused functions Abstraction Duplicate Abstraction Duplicate implementations across files Encapsulation Missing Encapsulation Variations scattered without encapsulation (e.g., same pattern repeated) Modularization Broken Modularization Functions that should be together are separated across files Modularization Insufficient Modularization File/module is too large (God File) Modularization Cyclically-Dependent Modularization Circular dependencies between helper files Modularization Hub-like Modularization One module has too many dependencies (e.g., generalHelper used by 5 pipelines) <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/03-architecture-smells/","title":"Architecture Smells","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/03-architecture-smells/#architecture-smells","title":"Architecture Smells","text":"<ul> <li>Source: Garcia et al., Lippert &amp; Roock, Sharma</li> </ul> <p>Context: System-level structural issues affecting maintainability, evolution, and deployment.</p> <p>References: * Architecture Smells (T. Sharma Preprint) * Does your Architecture Smell? (Designite) * Architectural Technical Debt Identification (Uni-Hamburg) * Architecture Smells Impact Analysis (DiVA Portal)</p>"},{"location":"problem-analysis/reference/03-architecture-smells/#summary-table-issue-type","title":"Summary Table (Issue Type)","text":"Type Description Dependency Issues Cyclic Dependency, Unstable Dependency, Hub-like Dependency (God Component), Implicit Cross-module Dependency. Structure Issues Scattered Functionality, Ambiguous Interface, Connector Envy, Extraneous Connector, Dense Structure."},{"location":"problem-analysis/reference/03-architecture-smells/#by-source","title":"By Source","text":""},{"location":"problem-analysis/reference/03-architecture-smells/#garcia-et-al-connectorcomponent-perspective","title":"Garcia et al. (Connector/Component Perspective)","text":"Type Issue Type Description Connector Envy Structure Components handle communication/connection logic that should be in a dedicated connector. Extraneous Connector Structure Two components communicate through a connector when a direct call would suffice. Ambiguous Interface Structure The interface of a component offers only a single, overly general entry point (e.g., <code>execute(Map params)</code>)."},{"location":"problem-analysis/reference/03-architecture-smells/#lippert-roock-symptom-based","title":"Lippert &amp; Roock (Symptom-Based)","text":"Type Issue Type Description Cyclic Dependency Dependency Components/Packages form a dependency cycle. Unstable Dependency Dependency A stable component depends on a less stable component."},{"location":"problem-analysis/reference/03-architecture-smells/#sharma-dependency-perspective","title":"Sharma (Dependency Perspective)","text":"Type Issue Type Description Hub-like Dependency (God Component) Dependency A component that is central to the system, with too many incoming/outgoing dependencies. Scattered Functionality Structure A single concern is implemented across multiple components. Dense Structure Structure The dependency graph is too dense (high average degree). Implicit Cross-module Dependency Dependency Hidden dependencies not visible in the architecture (e.g., shared database tables). <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/04-anti-patterns/","title":"Anti-Patterns","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/04-anti-patterns/#anti-patterns","title":"Anti-patterns","text":"<ul> <li>Source: Brown et al. (1998)</li> </ul> <p>Context: Recurring \"solutions\" that generate negative consequences (Development, Architecture, Management).</p> <p>References: * AntiPatterns: Refactoring Software, Architectures, and Projects in Crisis (UVIC Lecture) * Software Engineering Management Anti-patterns (UVIC)</p> Sub-Category Types Development The Blob, Lava Flow, Functional Decomposition, Poltergeists, Boat Anchor, Golden Hammer, Dead End, Spaghetti Code, Input Kludge, Walking through a Minefield, Cut-and-Paste. Architecture Vendor Lock-in, Stovepipe Enterprise, Stovepipe System, Swiss Army Knife, Design by Committee, Reinventing the Wheel, Cover Your Assets. Management Death March, Analysis Paralysis, Viewgraph Engineering, Mushroom Management, Intellectual Violence, Fire Drill, The Feud, Email is Dangerous, Throw it over the Wall."},{"location":"problem-analysis/reference/04-anti-patterns/#development-anti-patterns","title":"Development Anti-patterns","text":"<ul> <li>The Blob: A God Class that monopolizes processing; other classes are just data holders.</li> <li>Lava Flow: Dead code or design artifacts that persist because no one remembers what they do or fears deleting them.</li> <li>Functional Decomposition: Designing OO software as a series of main routines and subroutines.</li> <li>Poltergeists: Short-lived objects that exist only to invoke methods in other classes.</li> <li>Boat Anchor: Code left in the system \"just in case\" it's needed later (but never is).</li> <li>Golden Hammer: Using a familiar technology/solution for every problem, regardless of suitability.</li> <li>Dead End: Reaching a point where a chosen technology or design prevents further progress.</li> <li>Spaghetti Code: Unstructured, difficult-to-follow control flow.</li> <li>Input Kludge: Ad-hoc handling of user input without proper validation or parsing.</li> <li>Walking through a Minefield: Using a technology that is buggy or poorly supported.</li> <li>Cut-and-Paste Programming: Reusing code by copying it rather than abstracting it.</li> </ul>"},{"location":"problem-analysis/reference/04-anti-patterns/#architecture-anti-patterns","title":"Architecture Anti-patterns","text":"<ul> <li>Vendor Lock-in: Architecture heavily dependent on a specific vendor's proprietary features.</li> <li>Stovepipe Enterprise: Islands of automation; systems within an organization cannot interoperate.</li> <li>Stovepipe System: A system with ad-hoc integration, making it hard to maintain or modify.</li> <li>Swiss Army Knife: A component that attempts to do too many unrelated things.</li> <li>Design by Committee: A complex design resulting from satisfying too many stakeholders' conflicting views.</li> <li>Reinventing the Wheel: Building custom solutions for problems already solved by standard libraries/products.</li> <li>Cover Your Assets: Architecture decisions driven by risk avoidance rather than technical merit.</li> </ul>"},{"location":"problem-analysis/reference/04-anti-patterns/#management-anti-patterns","title":"Management Anti-patterns","text":"<ul> <li>Death March: A project with impossible deadlines or constraints, doomed to fail.</li> <li>Analysis Paralysis: Spending too much time in the analysis phase, delaying implementation.</li> <li>Viewgraph Engineering: Relying on slides/diagrams rather than working software to track progress.</li> <li>Mushroom Management: Keeping developers in the dark and \"feeding them manure\" (lack of communication).</li> <li>Intellectual Violence: Using intimidation or arrogance to suppress technical dissent.</li> <li>Fire Drill: Constant shifting of priorities, treating everything as an emergency.</li> <li>The Feud: Inter-team or interpersonal conflict impeding progress.</li> <li>Email is Dangerous: Misusing email for sensitive or complex communications that require nuance.</li> <li>Throw it over the Wall: Passing work to the next team (e.g., Dev to QA) without communication or ownership.</li> </ul> <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/05-implementation-smells/","title":"Implementation Smells","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/05-implementation-smells/#implementation-smells","title":"Implementation Smells","text":"<ul> <li>Source: Sharma's Taxonomy</li> </ul> <p>Context: Statement/Method level constructs indicating poor implementation.</p> <p>References: * IJMEMS: Code Smell Detection &amp; Classification * Luzkan's Smell Catalog</p> Type Description Logic/Flow Magic Number, Magic String, Complex Condition, Empty Catch Block, Long Statement, Deeply Nested Code, Missing Default in Switch. Organization Hardcoded Reference, Duplicate String Literal, Unused Import/Variable."},{"location":"problem-analysis/reference/05-implementation-smells/#detailed-descriptions","title":"Detailed Descriptions","text":"<ul> <li>Magic Number: Unexplained numeric literals in code.</li> <li>Magic String: Unexplained string literals in code.</li> <li>Complex Condition: Overly complicated boolean expressions in <code>if/while</code>.</li> <li>Empty Catch Block: Catching an exception and doing nothing (swallowing errors).</li> <li>Long Statement: A single line of code that is excessively long or complex.</li> <li>Deeply Nested Code: Excessive nesting of loops and conditionals (Arrow Anti-pattern).</li> <li>Missing Default in Switch: Switch statements that do not handle the default case.</li> <li>Hardcoded Reference: Hardcoding paths or URLs.</li> <li>Duplicate String Literal: Using the same string literal multiple times without a constant.</li> <li>Unused Import/Variable: Cluttering code with unnecessary declarations.</li> </ul> <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/06-test-smells/","title":"Test Smells","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/06-test-smells/#test-smells","title":"Test Smells","text":"<ul> <li>Source: Meszaros (xUnit Patterns) &amp; Others</li> </ul> <p>Context: Issues reducing test maintainability, reliability (flakiness), and speed.</p> <p>References: * xUnit Patterns (Meszaros) * Survey on Test Smells (T. Sharma)</p> Sub-Category Types Code/Behavior Assertion Roulette, Eager Test, Lazy Test, Mystery Guest, General Fixture, Test Maverick, Obscure Test, Conditional Test Logic, Test Logic in Production, Hard-coded Test Data. Project/Process Fragile Test, Flaky Test, Slow Tests, Erratic Test."},{"location":"problem-analysis/reference/06-test-smells/#codebehavior-smells","title":"Code/Behavior Smells","text":"<ul> <li>Assertion Roulette: Multiple assertions in a test without messages; hard to tell which failed.</li> <li>Eager Test: A test verifying too much functionality (multiple scenarios).</li> <li>Lazy Test: Multiple tests checking the same method using the same fixture (could be consolidated).</li> <li>Mystery Guest: The test relies on external resources (files, DB) not visible within the test code.</li> <li>General Fixture: The test setup creates a fixture much larger than what the test actually needs.</li> <li>Test Maverick: A test that sets up its own environment differently from the standard suite.</li> <li>Obscure Test: The test is hard to understand (documentation smell).</li> <li>Conditional Test Logic: Tests containing <code>if</code> or loops (tests should be linear).</li> <li>Test Logic in Production: Production code contains logic specifically for tests (e.g., <code>if (TEST_MODE)...</code>).</li> <li>Hard-coded Test Data: Data embedded in tests making them brittle to change.</li> </ul>"},{"location":"problem-analysis/reference/06-test-smells/#projectprocess-smells","title":"Project/Process Smells","text":"<ul> <li>Fragile Test: Tests that break easily when the SUT (System Under Test) changes slightly.</li> <li>Flaky Test: Tests that pass or fail intermittently without code changes.</li> <li>Slow Tests: Tests that take too long, discouraging frequent execution.</li> <li>Erratic Test: Tests that behave inconsistently due to concurrency or shared state.</li> </ul> <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/07-configuration-smells/","title":"Configuration Smells","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/07-configuration-smells/#configuration-smells","title":"Configuration Smells","text":"<ul> <li>Source: Sharma's Taxonomy</li> </ul> <p>Context: Issues in IaC, XML, JSON, YAML files regarding security and fragility.</p> <p>References: * Configuration Smells: Taxonomy (T. Sharma) * Configuration Smell Detection (NSF/Par)</p> Type Description Security/Consistency Hardcoded Password/Secret, Missing Configuration, Environment Dependent Configuration, Duplicate Configuration Keys, Unencrypted Sensitive Data, Inconsistent Configuration Naming, Overridden Configuration."},{"location":"problem-analysis/reference/07-configuration-smells/#detailed-descriptions","title":"Detailed Descriptions","text":"<ul> <li>Hardcoded Password/Secret: Storing credentials in plain text.</li> <li>Missing Configuration: Required configuration keys are absent.</li> <li>Environment Dependent Configuration: Configs that differ unpredictably between Dev/Prod.</li> <li>Duplicate Configuration Keys: Defining the same key multiple times.</li> <li>Unencrypted Sensitive Data: Sensitive values stored without encryption.</li> <li>Inconsistent Configuration Naming: Naming conventions vary across files/environments.</li> <li>Overridden Configuration: Excessive layering of config files making the final value hard to trace.</li> </ul> <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/08-database-smells/","title":"Database Smells","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/08-database-smells/#database-smells","title":"Database Smells","text":"<ul> <li>Source: Sharma's Taxonomy, \"Smelly Relations\"</li> </ul> <p>Context: Poor RDBMS schema design and inefficient SQL queries.</p> <p>References: * Smelly Relations: Database Schema Quality (Gatech) * Database Smell Taxonomy (T. Sharma) * SpeakerDeck: Smelly Relations</p> Sub-Category Types Schema Multi-purpose Column, Metadata as Data, Tables as Classes, Sturgeon's Law (90% unused), Ad-hoc TE (Type Extension), God Table. Query N+1 Select Problem, Fear of the Unknown (NULL handling), Index Abuse, Spaghetti Query."},{"location":"problem-analysis/reference/08-database-smells/#schema-smells","title":"Schema Smells","text":"<ul> <li>Multi-purpose Column: A column storing different types of data depending on context.</li> <li>Metadata as Data: Storing metadata (e.g., version, type) as row data instead of schema structure.</li> <li>Tables as Classes: Mapping every class directly to a table (ignoring impedance mismatch).</li> <li>Sturgeon's Law: Tables with 90% \"crud\" or unused columns.</li> <li>Ad-hoc TE (Type Extension): Adding columns like <code>attribute1</code>, <code>attribute2</code> for flexibility.</li> <li>God Table: A table with too many columns or too many rows (central hub).</li> </ul>"},{"location":"problem-analysis/reference/08-database-smells/#query-smells","title":"Query Smells","text":"<ul> <li>N+1 Select Problem: Executing N queries to fetch child records for N parent records.</li> <li>Fear of the Unknown: Inconsistent handling of NULL values.</li> <li>Index Abuse: Missing indexes on foreign keys/search columns, or too many unused indexes.</li> <li>Spaghetti Query: Extremely complex SQL queries that are hard to read/maintain.</li> </ul> <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/09-performance-smells/","title":"Performance Smells","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/09-performance-smells/#performance-smells","title":"Performance Smells","text":"<ul> <li>Source: Various (Practitioner Literature)</li> </ul> <p>Context: Patterns known to degrade latency, throughput, or resource efficiency.</p> <p>References: * Performance Anti-Patterns (ScienceDirect) * Hacker News Discussion on Performance * StackOverflow: Synchronization Costs</p> Type Description Resource Usage Excessive Object Creation, Memory Leak, Busy Waiting, Synchronous I/O in Main Thread, Unnecessary Synchronization, Temporary Object Abuse, Session Bloat, Image Bloat, Improper Caching."},{"location":"problem-analysis/reference/09-performance-smells/#detailed-descriptions","title":"Detailed Descriptions","text":"<ul> <li>Excessive Object Creation: Creating unnecessary temporary objects (GC pressure).</li> <li>Memory Leak: Objects are retained longer than necessary.</li> <li>Busy Waiting: Loops that constantly check a condition, consuming CPU.</li> <li>Synchronous I/O in Main Thread: Blocking the UI or main thread for network/disk ops.</li> <li>Unnecessary Synchronization: Locking resources when not needed (contention).</li> <li>Temporary Object Abuse: Recreating heavy objects (e.g., DB connections) repeatedly.</li> <li>Session Bloat: Storing too much data in HTTP sessions.</li> <li>Image Bloat: Serving images larger than the display area.</li> <li>Improper Caching: Caching too much, too little, or failing to invalidate stale data.</li> </ul> <p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/10-grammar-smells/","title":"Grammar Smells","text":"<p>\u2190 Overview</p>"},{"location":"problem-analysis/reference/10-grammar-smells/#grammar-smells","title":"Grammar Smells","text":"<ul> <li>Source: Sharma's Taxonomy</li> </ul> <p>Context: Issues in DSL definitions and parser rules.</p> <p>References: * Grammar Smells (T. Sharma)</p> Type Description DSL/Parser Ambiguous Grammar, Left Recursion, Common Prefix, Useless Rule, Unreachable Rule, Missing Semicolon/Separator Issues, Indentation Hell."},{"location":"problem-analysis/reference/10-grammar-smells/#detailed-descriptions","title":"Detailed Descriptions","text":"<ul> <li>Ambiguous Grammar: A grammar where a string can be parsed in multiple ways.</li> <li>Left Recursion: Grammar rules that recurse on the left side (issues for LL parsers).</li> <li>Common Prefix: Rules sharing the same start (requires backtracking or factoring).</li> <li>Useless Rule: A rule that is defined but never referenced.</li> <li>Unreachable Rule: A rule that can never be matched.</li> <li>Missing Semicolon/Separator Issues: Ambiguities arising from optional delimiters.</li> <li>Indentation Hell: Complex indentation-based block structures (if not handled carefully).</li> </ul> <p>\u2190 Overview</p>"}]}