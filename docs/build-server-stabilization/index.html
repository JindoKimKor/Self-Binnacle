<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Stabilized Crashed Unity Build Server - 80% faster builds, 90% CPU reduction through trade-off engineering">
  <meta name="author" content="Jindo Kim">
  <title>Stabilized Crashed Unity Build Server | Jindo Kim</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
  <link rel="stylesheet" href="../css/portfolio-theme.css">
  <style>
    /* Hero */
    .hero {
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-surface));
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2.5rem;
      margin-bottom: 2.5rem;
    }
    .hero h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 1.2rem;
      line-height: 1.3;
    }
    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-bottom: 1.2rem;
    }
    .hero-tag {
      display: inline-block;
      background: var(--bg-code);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.25rem 0.7rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    .hero-summary {
      color: var(--text-secondary);
      font-size: 0.95rem;
      line-height: 1.8;
    }
    .hero-summary strong { color: var(--text-primary); }

    .highlight-cell { color: var(--success); font-weight: 700; }
    .danger-cell { color: var(--danger); font-weight: 500; }

    /* Crisis card */
    .crisis {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-left: 3px solid var(--danger);
      border-radius: 0 8px 8px 0;
      padding: 1.5rem 1.8rem;
      margin: 1.2rem 0;
    }
    .crisis p { font-size: 0.9rem; }

    /* Solution cards */
    .solution {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem 1.8rem;
      margin: 1.2rem 0;
      border-left: 3px solid var(--accent);
    }
    .solution h3 { margin-top: 0; font-size: 1rem; }
    .solution p { font-size: 0.9rem; }

    /* Before/After inline */
    .ba-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem;
      margin: 0.8rem 0;
    }
    @media (max-width: 600px) {
      .ba-grid { grid-template-columns: 1fr; }
    }
    .ba-item {
      background: var(--bg-code);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.8rem 1rem;
      font-size: 0.85rem;
    }
    .ba-item.before { border-top: 2px solid var(--danger); }
    .ba-item.after { border-top: 2px solid var(--success); }
    .ba-label {
      font-size: 0.7rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 0.3rem;
    }
    .ba-item.before .ba-label { color: var(--danger); }
    .ba-item.after .ba-label { color: var(--success); }
    .ba-item p { margin: 0; font-size: 0.85rem; }

    /* Result stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;
    }
    @media (max-width: 700px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }
    .stat-card {
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.2rem;
      text-align: center;
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--success);
      line-height: 1.2;
    }
    .stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.3rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    /* Trade-off card */
    .tradeoff {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-left: 3px solid var(--warning);
      border-radius: 0 8px 8px 0;
      padding: 1.5rem 1.8rem;
      margin: 1.2rem 0;
    }
    .tradeoff h3 { margin-top: 0; color: var(--warning); }
    .tradeoff p { font-size: 0.9rem; }

    /* PDF links */
    .pdf-link {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      color: var(--link);
      text-decoration: none;
      transition: border-color 0.2s;
      margin-right: 0.5rem;
      margin-bottom: 0.4rem;
    }
    .pdf-link:hover {
      border-color: var(--accent);
      text-decoration: none;
    }
    .pdf-icon {
      width: 14px; height: 14px;
      flex-shrink: 0;
    }

    /* Timeline */
    .timeline {
      font-size: 0.85rem;
    }
    .timeline td { font-size: 0.83rem; }
    .timeline code {
      font-family: 'Roboto Mono', monospace;
      font-size: 0.78rem;
      background: var(--bg-code);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
    }
    .timeline a { color: var(--link); }

    /* Note text */
    .note {
      font-size: 0.8rem;
      color: var(--text-muted);
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Hero -->
    <div class="hero">
      <h1>Stabilized Crashed Unity Build Server</h1>
      <div class="hero-meta">
        <span class="hero-tag">Jenkins</span>
        <span class="hero-tag">Unity Editor</span>
        <span class="hero-tag">CI/CD</span>
        <span class="hero-tag">CPU Optimization</span>
        <span class="hero-tag">Trade-off Engineering</span>
      </div>
      <div class="hero-summary">
        <p><strong>Context:</strong> Unity CI/CD server stability crisis at VARLab (June 2024)</p>
        <p><strong>Problem:</strong> VM crashes when 2-3 pipelines run simultaneously due to Unity Editor's 100% CPU usage</p>
        <p><strong>Solution:</strong> Trade-off approach &mdash; shared project files + optimization skip</p>
        <p><strong>Result:</strong> Server stabilized, concurrent pipelines supported</p>
        <p><strong>Byproduct:</strong> 80% faster builds, 90% CPU reduction</p>
      </div>
    </div>

    <!-- Infographic -->
    <img src="build-server-stabilization-infographic.png" alt="Build Server Stabilization Infographic" style="width:100%; border-radius:12px; margin-bottom:2rem; border:1px solid var(--border);">

    <!-- Results up front -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value">80%</div>
        <div class="stat-label">Faster Builds</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">90%</div>
        <div class="stat-label">CPU Reduction</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">0</div>
        <div class="stat-label">Crashes</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">Safe</div>
        <div class="stat-label">Concurrent Pipelines</div>
      </div>
    </div>

    <hr>

    <!-- The Crisis -->
    <h2>The Crisis</h2>
    <div class="crisis">
      <p><strong>Symptom:</strong> CI/CD VM becomes extremely slow or shuts down when 2-3 PR pipelines run simultaneously.</p>
      <p><strong>Key Insight:</strong> Unity Editor provides no CPU throttling option. It consumes all available resources.</p>
    </div>

    <p><strong>Root Cause Analysis:</strong></p>
    <table>
      <thead>
        <tr><th>Process</th><th>CPU Impact</th><th>Build Time</th></tr>
      </thead>
      <tbody>
        <tr><td>Unity Editor initial compile (30,000+ files)</td><td class="danger-cell">100%</td><td>~10 min</td></tr>
        <tr><td>wasm-opt.exe (WebAssembly optimization)</td><td class="danger-cell">50-100%</td><td>2-3 min</td></tr>
        <tr><td>IL2CPP.exe (C# to Wasm conversion)</td><td class="danger-cell">70-90%</td><td>1-2 sec</td></tr>
      </tbody>
    </table>
    <p class="note">Build time varies by project size and machine resources. CPU always consumes all available resources.</p>

    <hr>

    <!-- Solution -->
    <h2>Solution: Trade-off Approach</h2>

    <div class="solution">
      <h3>1. Single Project Files for All Branches</h3>
      <div class="ba-grid">
        <div class="ba-item before">
          <div class="ba-label">Before</div>
          <p>Each branch creates new folder &rarr; git clone &rarr; Unity initial compile (<strong>10 min</strong>)</p>
        </div>
        <div class="ba-item after">
          <div class="ba-label">After</div>
          <p>All branches share single project folder &rarr; skip initial compile</p>
        </div>
      </div>
      <table>
        <thead>
          <tr><th>Stage</th><th>Before</th><th>After</th></tr>
        </thead>
        <tbody>
          <tr><td>EditMode Test</td><td>~10 min</td><td class="highlight-cell">&lt; 1 min</td></tr>
          <tr><td>Build Project</td><td>~10 min</td><td class="highlight-cell">1-5 min</td></tr>
        </tbody>
      </table>
      <p style="font-size:0.85rem; color:var(--text-muted);"><strong>Validation:</strong> Tested with 7 branches &mdash; no errors switching between branches.</p>
      <a href="JIRA-Ticket-Implement-single-project-files-for-all-branches.pdf" class="pdf-link">
        <svg class="pdf-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        JIRA Ticket (PDF)
      </a>
    </div>

    <div class="solution">
      <h3>2. WebAssembly Optimization Level = 0</h3>
      <div class="ba-grid">
        <div class="ba-item before">
          <div class="ba-label">Before</div>
          <p>wasm-opt.exe runs at <strong>50-100% CPU</strong> for 2-3 minutes during CI builds</p>
        </div>
        <div class="ba-item after">
          <div class="ba-label">After</div>
          <p>Set optimization level to 0 for CI pipeline (CD keeps optimization)</p>
        </div>
      </div>
      <table>
        <thead>
          <tr><th>Metric</th><th>Before</th><th>After</th></tr>
        </thead>
        <tbody>
          <tr><td>Peak CPU (wasm-opt.exe)</td><td class="danger-cell">50-100%</td><td class="highlight-cell">0% (skipped)</td></tr>
          <tr><td>Sustained CPU</td><td class="danger-cell">70-90%</td><td class="highlight-cell">10-20%</td></tr>
        </tbody>
      </table>
      <p style="font-size:0.85rem; color:var(--text-muted);"><strong>Rationale:</strong> CI pipeline only needs to verify build success/failure, not produce optimized artifacts.</p>
      <a href="Pull-Request-Reduce-CPU-Usage-On-CI-Pipeline.pdf" class="pdf-link">
        <svg class="pdf-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        Pull Request (PDF)
      </a>
      <a href="Build-Time-Reduction-with-Optimized-Unity-Settings.pdf" class="pdf-link">
        <svg class="pdf-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        Build Time Reduction Analysis (PDF)
      </a>
    </div>

    <hr>

    <!-- Trade-off -->
    <div class="tradeoff">
      <h3>Trade-off Accepted</h3>
      <p>This solution violates CI/CD best practice of "clean builds from scratch":</p>
      <ul>
        <li>Project files and artifacts are retained between builds</li>
        <li>Builds are not fully isolated</li>
      </ul>
      <p><strong>Why this was acceptable:</strong></p>
      <ul>
        <li>Unity Editor limitation &mdash; no workaround exists</li>
        <li>Modifying Unity Editor internals would violate software compliance</li>
        <li>The trade-off was later resolved with containerization and cloud architecture (see <a href="../cicd-cost-optimization/">94.88% Cost Reduction</a>)</li>
      </ul>
    </div>

    <hr>

    <!-- Timeline -->
    <h2>Timeline (Git Commits)</h2>
    <table class="timeline">
      <thead>
        <tr><th>Date</th><th>Commit</th><th>Description</th></tr>
      </thead>
      <tbody>
        <tr><td>Jun 13, 2024</td><td><a href="https://github.com/JindoKimKor/devops-jenkins-windows/commit/33b5daf"><code>33b5daf</code></a></td><td>Single project files for all branches</td></tr>
        <tr><td>Jun 19, 2024</td><td><a href="https://github.com/JindoKimKor/devops-jenkins-windows/commit/daa5216"><code>daa5216</code></a></td><td>More RAM, less CPU memory setting</td></tr>
        <tr><td>Jun 24, 2024</td><td><a href="https://github.com/JindoKimKor/devops-jenkins-windows/commit/51d4d74"><code>51d4d74</code></a></td><td>Test with enhanced setting (less CPU, more RAM)</td></tr>
        <tr><td>Jun 24, 2024</td><td><a href="https://github.com/JindoKimKor/devops-jenkins-windows/commit/d4c9807"><code>d4c9807</code></a></td><td>More memory for il2cpp.exe and wasm-opt.exe</td></tr>
        <tr><td>Jun 25, 2024</td><td><a href="https://github.com/JindoKimKor/devops-jenkins-windows/commit/a35e944"><code>a35e944</code></a></td><td>Original CPU usage setting</td></tr>
        <tr><td>Jun 25, 2024</td><td><a href="https://github.com/JindoKimKor/devops-jenkins-windows/commit/f619a90"><code>f619a90</code></a></td><td>emscripten compiler optimization low setting</td></tr>
        <tr><td>Jun 26, 2024</td><td><a href="https://github.com/JindoKimKor/devops-jenkins-windows/commit/909d0db"><code>909d0db</code></a></td><td>Reduce CPU Usage on CI Pipeline</td></tr>
      </tbody>
    </table>

  </div>
</body>
</html>
